{"version":3,"file":"utils.js","sourceRoot":"","sources":["../../src/pageobjects/utils.ts"],"names":[],"mappings":"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","sourcesContent":["/* eslint-disable object-shorthand */\nimport type { ChainablePromiseElement, ChainablePromiseArray } from 'webdriverio'\n\nimport * as allLocatorsTypes from '../locators/insiders'\nimport { ContextMenu } from '..'\n\ntype ClassWithFunctionLocatorsAsString<T> = {\n    [key in keyof T as T[key] extends Function | undefined ? key : never]: T[key]\n}\n\ntype ClassWithFunctionLocators$<T> = {\n    // @ts-expect-error this fails compiling here but works when applied to a class\n    [key in keyof ClassWithFunctionLocatorsAsString<T> as `${key}$`]: (\n        // @ts-expect-error this fails compiling here but works when applied to a class\n        ...args: Parameters<ClassWithFunctionLocatorsAsString<T>[key]>\n    ) => ChainablePromiseElement<WebdriverIO.Element>\n}\n\ntype ClassWithFunctionLocators$$<T> = {\n    // @ts-expect-error this fails compiling here but works when applied to a class\n    [key in keyof ClassWithFunctionLocatorsAsString<T> as `${key}$$`]: (\n        // @ts-expect-error this fails compiling here but works when applied to a class\n        ...args: Parameters<ClassWithFunctionLocatorsAsString<T>[key]>\n    ) => ChainablePromiseArray<WebdriverIO.Element[]>\n}\n\ntype ClassWithLocators$<T> = {\n    [key in keyof T & string as T[key] extends String | undefined\n        ? `${key}$`\n        : never]: ChainablePromiseElement<WebdriverIO.Element>\n}\ntype ClassWithLocators$$<T> = {\n    [key in keyof T & string as T[key] extends String | undefined\n        ? `${key}$$`\n        : never]: ChainablePromiseArray<WebdriverIO.Element[]>\n}\n\ntype LocatorProperties<T> = {\n    readonly locatorMap: AllLocatorType,\n    readonly locators: T\n}\n\ntype AllLocatorType = typeof allLocatorsTypes\nexport type LocatorComponents = keyof AllLocatorType | (keyof AllLocatorType)[]\nexport type Locators = Record<string | symbol, string | Function>\nexport type VSCodeLocatorMap = Record<keyof AllLocatorType, Locators>\nexport type IPageDecorator<T> = (\n    ClassWithLocators$<T> & ClassWithLocators$$<T> &\n    ClassWithFunctionLocators$<T> & ClassWithFunctionLocators$$<T>\n)\n\ntype PageObjectClass = {\n    new(...args: any[]): any\n    [staticMethod: string]: any\n}\n\nexport function PageDecorator<T extends PageObjectClass> (locators: Locators) {\n    return (ctor: T) => {\n        for (const [prop, globalLocator] of Object.entries(locators)) {\n            Object.defineProperties(ctor.prototype, {\n                [`${prop}$`]: {\n                    get: function (this: LocatorProperties<any> & BasePage<any>) {\n                        const locator: Locators[string] = this.locators[prop] || globalLocator\n                        if (typeof locator === 'function') {\n                            return (...args: string[]) => this.elem.$(locator(...args) as string)\n                        }\n                        return this.elem.$(locator)\n                    }\n                },\n                [`${prop}$$`]: {\n                    get: function (this: LocatorProperties<any> & BasePage<any>) {\n                        const locator: Locators[string] = this.locators[prop] || globalLocator\n                        if (typeof locator === 'function') {\n                            return (...args: string[]) => this.elem.$$(locator(...args) as string)\n                        }\n                        return this.elem.$$(locator)\n                    }\n                }\n            })\n        }\n\n        Object.seal(ctor)\n        Object.seal(ctor.prototype)\n        return ctor\n    }\n}\n\nexport abstract class BasePage<PageLocators, LocatorMap extends Record<string, Locators> = VSCodeLocatorMap> {\n    /**\n     * @private\n     */\n    abstract locatorKey: keyof LocatorMap | (keyof LocatorMap)[]\n\n    /**\n     * @private\n     */\n    constructor (\n        protected _locators: LocatorMap,\n        private _baseElem?: string | ChainablePromiseElement<WebdriverIO.Element>,\n        private _parentElem?: string | ChainablePromiseElement<WebdriverIO.Element>\n    ) {}\n\n    /**\n     * Get the locator map of given page object\n     */\n    get locators () {\n        if (Array.isArray(this.locatorKey)) {\n            return this.locatorKey.reduce((prev, locatorKey) => ({\n                ...prev,\n                ...this._locators[locatorKey]\n            } as Locators), {} as Locators) as any as PageLocators\n        }\n        return this._locators[this.locatorKey] as any as PageLocators\n    }\n\n    /**\n     * @private\n     */\n    get baseElem () {\n        return this._baseElem\n    }\n\n    /**\n     * @private\n     */\n    get locatorMap () {\n        return this._locators\n    }\n\n    /**\n     * Base element of given page object\n     */\n    get elem () {\n        const baseLocator = (this.locators as any as Locators).elem\n        if (this._baseElem) {\n            return typeof this._baseElem === 'string'\n                ? browser.$(this._baseElem)\n                : this._baseElem\n        }\n\n        if (typeof baseLocator === 'string') {\n            return browser.$(baseLocator)\n        }\n\n        return browser.$('html')\n    }\n\n    /**\n     * Parent element of given page object\n     */\n    get parent () {\n        if (this._parentElem) {\n            return typeof this._parentElem === 'string'\n                ? browser.$(this._parentElem)\n                : this._parentElem\n        }\n        return browser.$('html')\n    }\n\n    /**\n     * @private\n     */\n    setParentElement (parentElem: string | ChainablePromiseElement<WebdriverIO.Element>) {\n        this._parentElem = parentElem\n    }\n\n    /**\n     * Wait for the element to become visible\n     * @param timeout custom timeout for the wait\n     * @returns thenable self reference\n     */\n    async wait (timeout = 5000): Promise<this> {\n        await this.elem.waitForDisplayed({ timeout })\n        return this\n    }\n}\n\n/**\n * Abstract element that has a context menu\n */\nexport abstract class ElementWithContextMenu<T> extends BasePage<T> {\n    /**\n     * Open context menu on the element\n     */\n    async openContextMenu (): Promise<ContextMenu> {\n        const contextMenuLocators = this.locatorMap.ContextMenu as AllLocatorType['ContextMenu']\n        const workbench = browser.$((this.locatorMap.Workbench as AllLocatorType['Workbench']).elem)\n        const menus = await browser.$$(contextMenuLocators.contextView)\n\n        if (menus.length < 1) {\n            await this.elem.click({ button: 2 })\n            await browser.$(contextMenuLocators.contextView).waitForExist({ timeout: 2000 })\n            return new ContextMenu(this.locatorMap, workbench).wait()\n        }\n\n        if (await workbench.$$(contextMenuLocators.viewBlock).length > 0) {\n            await this.elem.click({ button: 2 })\n            await this.elem.waitForDisplayed({ reverse: true, timeout: 1000 })\n        }\n\n        await this.elem.click({ button: 2 })\n        return new ContextMenu(this.locatorMap).wait()\n    }\n}\n\nexport function sleep (ms = 500) {\n    return new Promise<void>((res) => {\n        setTimeout(res, ms)\n    })\n}\n"]}