"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.getImageOccurrence = getImageOccurrence;
exports.getImagesMatches = getImagesMatches;
exports.getImagesSimilarity = getImagesSimilarity;
exports.initOpenCv = initOpenCv;

require("source-map-support/register");

var _lodash = _interopRequireDefault(require("lodash"));

var _jimp = _interopRequireDefault(require("jimp"));

var _buffer = require("buffer");

var _bluebird = _interopRequireDefault(require("bluebird"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

let cv;
const DEFAULT_MATCH_THRESHOLD = 0.5;
const MATCH_NEIGHBOUR_THRESHOLD = 10;
const AVAILABLE_DETECTORS = {
  AKAZE: 'AKAZE',
  AGAST: 'AgastFeatureDetector',
  BRISK: 'BRISK',
  FAST: 'FastFeatureDetector',
  GFTT: 'GFTTDetector',
  KAZE: 'KAZE',
  MSER: 'MSER',
  ORB: 'ORB'
};
const AVAILABLE_MATCHING_FUNCTIONS = {
  FlannBased: 'FlannBased',
  BruteForce: 'BruteForce',
  BruteForceL1: 'BruteForce-L1',
  BruteForceHamming: 'BruteForce-Hamming',
  BruteForceHammingLut: 'BruteForce-HammingLUT',
  BruteForceSL2: 'BruteForce-SL2'
};
const MATCHING_METHODS = ['TM_CCOEFF', 'TM_CCOEFF_NORMED', 'TM_CCORR', 'TM_CCORR_NORMED', 'TM_SQDIFF', 'TM_SQDIFF_NORMED'];
const DEFAULT_MATCHING_METHOD = 'TM_CCOEFF_NORMED';

function toMatchingMethod(name) {
  if (!MATCHING_METHODS.includes(name)) {
    throw new Error(`The matching method '${name}' is unknown. ` + `Only the following matching methods are supported: ${MATCHING_METHODS}`);
  }

  return cv[name];
}

async function initOpenCv() {
  cv = require('opencv-bindings');

  while (!cv.getBuildInformation) {
    await _bluebird.default.delay(500);
  }

  process.removeAllListeners('unhandledRejection');
}

function detectAndCompute(img, detector) {
  const keyPoints = new cv.KeyPointVector();
  const descriptor = new cv.Mat();
  detector.detect(img, keyPoints);
  detector.compute(img, keyPoints, descriptor);
  return {
    keyPoints,
    descriptor
  };
}

function calculateMatchedRect(matchedPoints) {
  if (matchedPoints.length < 2) {
    return {
      x: 0,
      y: 0,
      width: 0,
      height: 0
    };
  }

  const pointsSortedByDistance = matchedPoints.map(point => [Math.sqrt(point.x * point.x + point.y * point.y), point]).sort((pair1, pair2) => pair1[0] >= pair2[0]).map(pair => pair[1]);

  const firstPoint = _lodash.default.head(pointsSortedByDistance);

  const lastPoint = _lodash.default.last(pointsSortedByDistance);

  const topLeftPoint = {
    x: firstPoint.x <= lastPoint.x ? firstPoint.x : lastPoint.x,
    y: firstPoint.y <= lastPoint.y ? firstPoint.y : lastPoint.y
  };
  const bottomRightPoint = {
    x: firstPoint.x >= lastPoint.x ? firstPoint.x : lastPoint.x,
    y: firstPoint.y >= lastPoint.y ? firstPoint.y : lastPoint.y
  };
  return {
    x: topLeftPoint.x,
    y: topLeftPoint.y,
    width: bottomRightPoint.x - topLeftPoint.x,
    height: bottomRightPoint.y - topLeftPoint.y
  };
}

function highlightRegion(mat, region) {
  if (region.width <= 0 || region.height <= 0) {
    return;
  }

  const color = new cv.Scalar(255, 0, 0, 255);
  const thickness = 2;
  const topLeft = new cv.Point(region.x, region.y);
  const botRight = new cv.Point(region.x + region.width, region.y + region.height);
  cv.rectangle(mat, topLeft, botRight, color, thickness, cv.LINE_8, 0);
  return mat;
}

async function getImagesMatches(img1Data, img2Data, options = {}) {
  await initOpenCv();
  let img1, img2, detector, result1, result2, matcher, matchesVec;

  try {
    const {
      detectorName = 'ORB',
      visualize = false,
      goodMatchesFactor,
      matchFunc = 'BruteForce'
    } = options;

    if (!_lodash.default.includes(_lodash.default.keys(AVAILABLE_DETECTORS), detectorName)) {
      throw new Error(`'${detectorName}' detector is unknown. ` + `Only ${JSON.stringify(_lodash.default.keys(AVAILABLE_DETECTORS))} detectors are supported.`);
    }

    if (!_lodash.default.includes(_lodash.default.keys(AVAILABLE_MATCHING_FUNCTIONS), matchFunc)) {
      throw new Error(`'${matchFunc}' matching function is unknown. ` + `Only ${JSON.stringify(_lodash.default.keys(AVAILABLE_MATCHING_FUNCTIONS))} matching functions are supported.`);
    }

    detector = new cv[AVAILABLE_DETECTORS[detectorName]]();
    [img1, img2] = await _bluebird.default.all([cvMatFromImage(img1Data), cvMatFromImage(img2Data)]);
    result1 = detectAndCompute(img1, detector);
    result2 = detectAndCompute(img2, detector);
    matcher = new cv.DescriptorMatcher(AVAILABLE_MATCHING_FUNCTIONS[matchFunc]);
    matchesVec = new cv.DMatchVector();
    let matches = [];
    matcher.match(result1.descriptor, result2.descriptor, matchesVec);
    const totalCount = matchesVec.size();

    if (totalCount < 1) {
      throw new Error(`Could not find any matches between images. Double-check orientation, ` + `resolution, or use another detector or matching function.`);
    }

    for (let i = 0; i < totalCount; i++) {
      matches.push(matchesVec.get(i));
    }

    const hasGoodMatchesFactor = _lodash.default.isFunction(goodMatchesFactor) || _lodash.default.isNumber(goodMatchesFactor) && !_lodash.default.isNaN(goodMatchesFactor);

    if (hasGoodMatchesFactor) {
      if (_lodash.default.isFunction(goodMatchesFactor)) {
        const distances = matches.map(match => match.distance);

        const minDistance = _lodash.default.min(distances);

        const maxDistance = _lodash.default.max(distances);

        matches = matches.filter(match => goodMatchesFactor(match.distance, minDistance, maxDistance));
      } else {
        if (matches.length > goodMatchesFactor) {
          matches = matches.sort((match1, match2) => match1.distance - match2.distance).slice(0, goodMatchesFactor);
        }
      }
    }

    const extractPoint = (keyPoints, indexPropertyName) => match => {
      const {
        pt,
        point
      } = keyPoints.get(match[indexPropertyName]);
      return pt || point;
    };

    const points1 = matches.map(extractPoint(result1.keyPoints, 'queryIdx'));
    const rect1 = calculateMatchedRect(points1);
    const points2 = matches.map(extractPoint(result2.keyPoints, 'trainIdx'));
    const rect2 = calculateMatchedRect(points2);
    const result = {
      points1,
      rect1,
      points2,
      rect2,
      totalCount,
      count: matches.length
    };

    if (visualize) {
      const goodMatchesVec = new cv.DMatchVector();

      for (let i = 0; i < matches.length; i++) {
        goodMatchesVec.push_back(matches[i]);
      }

      const visualization = new cv.Mat();
      const color = new cv.Scalar(0, 255, 0, 255);
      cv.drawMatches(img1, result1.keyPoints, img2, result2.keyPoints, goodMatchesVec, visualization, color);
      highlightRegion(visualization, rect1);
      highlightRegion(visualization, {
        x: img1.cols + rect2.x,
        y: rect2.y,
        width: rect2.width,
        height: rect2.height
      });
      result.visualization = await jimpImgFromCvMat(visualization).getBufferAsync(_jimp.default.MIME_PNG);
    }

    return result;
  } finally {
    try {
      img1.delete();
      img2.delete();
      detector.delete();
      result1.keyPoints.delete();
      result1.descriptor.delete();
      result2.keyPoints.delete();
      result2.descriptor.delete();
      matcher.delete();
      matchesVec.delete();
    } catch (ign) {}
  }
}

async function getImagesSimilarity(img1Data, img2Data, options = {}) {
  await initOpenCv();
  const {
    method = DEFAULT_MATCHING_METHOD,
    visualize = false
  } = options;
  let template, reference, matched;

  try {
    [template, reference] = await _bluebird.default.all([cvMatFromImage(img1Data), cvMatFromImage(img2Data)]);

    if (template.rows !== reference.rows || template.cols !== reference.cols) {
      throw new Error('Both images are expected to have the same size in order to ' + 'calculate the similarity score.');
    }

    template.convertTo(template, cv.CV_8UC3);
    reference.convertTo(reference, cv.CV_8UC3);
    matched = new cv.Mat();
    cv.matchTemplate(reference, template, matched, toMatchingMethod(method));
    const minMax = cv.minMaxLoc(matched);
    const result = {
      score: minMax.maxVal
    };

    if (visualize) {
      let bothImages, resultMat, mask, contours, hierarchy;

      try {
        resultMat = new cv.Mat(template.rows, template.cols * 2, cv.CV_8UC3);
        bothImages = new cv.MatVector();
        bothImages.push_back(reference);
        bothImages.push_back(template);
        cv.hconcat(bothImages, resultMat);
        mask = new cv.Mat();
        cv.absdiff(reference, template, mask);
        cv.cvtColor(mask, mask, cv.COLOR_BGR2GRAY, 0);
        cv.threshold(mask, mask, 128, 255, cv.THRESH_BINARY | cv.THRESH_OTSU);
        contours = new cv.MatVector();
        hierarchy = new cv.Mat();
        cv.findContours(mask, contours, hierarchy, cv.RETR_EXTERNAL, cv.CHAIN_APPROX_SIMPLE);

        for (let i = 0; i < contours.size(); i++) {
          const boundingRect = cv.boundingRect(contours.get(i));
          highlightRegion(resultMat, boundingRect);
          highlightRegion(resultMat, {
            x: reference.cols + boundingRect.x,
            y: boundingRect.y,
            width: boundingRect.width,
            height: boundingRect.height
          });
        }

        result.visualization = await jimpImgFromCvMat(resultMat).getBufferAsync(_jimp.default.MIME_PNG);
      } finally {
        try {
          bothImages.delete();
          resultMat.delete();
          mask.delete();
          contours.delete();
          hierarchy.delete();
        } catch (ign) {}
      }
    }

    return result;
  } finally {
    try {
      template.delete();
      reference.delete();
      matched.delete();
    } catch (ign) {}
  }
}

async function getImageOccurrence(fullImgData, partialImgData, options = {}) {
  await initOpenCv();
  const {
    visualize = false,
    threshold = DEFAULT_MATCH_THRESHOLD,
    multiple = false,
    matchNeighbourThreshold = MATCH_NEIGHBOUR_THRESHOLD,
    method = DEFAULT_MATCHING_METHOD
  } = options;
  let fullImg, partialImg, matched;

  try {
    [fullImg, partialImg] = await _bluebird.default.all([cvMatFromImage(fullImgData), cvMatFromImage(partialImgData)]);
    matched = new cv.Mat();
    const results = [];
    let visualization = null;

    try {
      cv.matchTemplate(fullImg, partialImg, matched, toMatchingMethod(method));
      const minMax = cv.minMaxLoc(matched);

      if (multiple) {
        const matches = [];

        for (let row = 0; row < matched.rows; row++) {
          for (let col = 0; col < matched.cols; col++) {
            const score = matched.floatAt(row, col);

            if (score >= threshold) {
              matches.push({
                score,
                x: col,
                y: row
              });
            }
          }
        }

        const nearMatches = filterNearMatches(matches, matchNeighbourThreshold);

        for (const {
          x,
          y,
          score
        } of nearMatches) {
          results.push({
            score,
            rect: {
              x,
              y,
              width: partialImg.cols,
              height: partialImg.rows
            }
          });
        }
      } else if (minMax.maxVal >= threshold) {
        const {
          x,
          y
        } = method.includes('SQDIFF') ? minMax.minLoc : minMax.maxLoc;
        results.push({
          score: minMax.maxVal,
          rect: {
            x,
            y,
            width: partialImg.cols,
            height: partialImg.rows
          }
        });
      }

      if (_lodash.default.isEmpty(results)) {
        throw new Error(`Match threshold: ${threshold}. Highest match value ` + `found was ${minMax.maxVal}`);
      }
    } catch (e) {
      throw new Error(`Cannot find any occurrences of the partial image in the full image. ` + `Original error: ${e.message}`);
    }

    if (visualize) {
      const fullHighlightedImage = fullImg.clone();

      for (const result of results) {
        const singleHighlightedImage = fullImg.clone();
        highlightRegion(singleHighlightedImage, result.rect);
        highlightRegion(fullHighlightedImage, result.rect);
        result.visualization = await jimpImgFromCvMat(singleHighlightedImage).getBufferAsync(_jimp.default.MIME_PNG);
      }

      visualization = await jimpImgFromCvMat(fullHighlightedImage).getBufferAsync(_jimp.default.MIME_PNG);
    }

    return {
      rect: results[0].rect,
      score: results[0].score,
      visualization,
      multiple: results
    };
  } finally {
    try {
      fullImg.delete();
      partialImg.delete();
      matched.delete();
    } catch (ign) {}
  }
}

function jimpImgFromCvMat(mat) {
  return new _jimp.default({
    width: mat.cols,
    height: mat.rows,
    data: _buffer.Buffer.from(mat.data)
  });
}

async function cvMatFromImage(img) {
  const jimpImg = await _jimp.default.read(img);
  return cv.matFromImageData(jimpImg.bitmap);
}

function filterNearMatches(nonZeroMatchResults, matchNeighbourThreshold) {
  return nonZeroMatchResults.reduce((acc, element) => {
    if (!acc.some(match => distance(match, element) <= matchNeighbourThreshold)) {
      acc.push(element);
    }

    return acc;
  }, []);
}

function distance(point1, point2) {
  const a2 = Math.pow(point1.x - point2.x, 2);
  const b2 = Math.pow(point1.y - point2.y, 2);
  return Math.sqrt(a2 + b2);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjdiIsIkRFRkFVTFRfTUFUQ0hfVEhSRVNIT0xEIiwiTUFUQ0hfTkVJR0hCT1VSX1RIUkVTSE9MRCIsIkFWQUlMQUJMRV9ERVRFQ1RPUlMiLCJBS0FaRSIsIkFHQVNUIiwiQlJJU0siLCJGQVNUIiwiR0ZUVCIsIktBWkUiLCJNU0VSIiwiT1JCIiwiQVZBSUxBQkxFX01BVENISU5HX0ZVTkNUSU9OUyIsIkZsYW5uQmFzZWQiLCJCcnV0ZUZvcmNlIiwiQnJ1dGVGb3JjZUwxIiwiQnJ1dGVGb3JjZUhhbW1pbmciLCJCcnV0ZUZvcmNlSGFtbWluZ0x1dCIsIkJydXRlRm9yY2VTTDIiLCJNQVRDSElOR19NRVRIT0RTIiwiREVGQVVMVF9NQVRDSElOR19NRVRIT0QiLCJ0b01hdGNoaW5nTWV0aG9kIiwibmFtZSIsImluY2x1ZGVzIiwiRXJyb3IiLCJpbml0T3BlbkN2IiwicmVxdWlyZSIsImdldEJ1aWxkSW5mb3JtYXRpb24iLCJCIiwiZGVsYXkiLCJwcm9jZXNzIiwicmVtb3ZlQWxsTGlzdGVuZXJzIiwiZGV0ZWN0QW5kQ29tcHV0ZSIsImltZyIsImRldGVjdG9yIiwia2V5UG9pbnRzIiwiS2V5UG9pbnRWZWN0b3IiLCJkZXNjcmlwdG9yIiwiTWF0IiwiZGV0ZWN0IiwiY29tcHV0ZSIsImNhbGN1bGF0ZU1hdGNoZWRSZWN0IiwibWF0Y2hlZFBvaW50cyIsImxlbmd0aCIsIngiLCJ5Iiwid2lkdGgiLCJoZWlnaHQiLCJwb2ludHNTb3J0ZWRCeURpc3RhbmNlIiwibWFwIiwicG9pbnQiLCJNYXRoIiwic3FydCIsInNvcnQiLCJwYWlyMSIsInBhaXIyIiwicGFpciIsImZpcnN0UG9pbnQiLCJfIiwiaGVhZCIsImxhc3RQb2ludCIsImxhc3QiLCJ0b3BMZWZ0UG9pbnQiLCJib3R0b21SaWdodFBvaW50IiwiaGlnaGxpZ2h0UmVnaW9uIiwibWF0IiwicmVnaW9uIiwiY29sb3IiLCJTY2FsYXIiLCJ0aGlja25lc3MiLCJ0b3BMZWZ0IiwiUG9pbnQiLCJib3RSaWdodCIsInJlY3RhbmdsZSIsIkxJTkVfOCIsImdldEltYWdlc01hdGNoZXMiLCJpbWcxRGF0YSIsImltZzJEYXRhIiwib3B0aW9ucyIsImltZzEiLCJpbWcyIiwicmVzdWx0MSIsInJlc3VsdDIiLCJtYXRjaGVyIiwibWF0Y2hlc1ZlYyIsImRldGVjdG9yTmFtZSIsInZpc3VhbGl6ZSIsImdvb2RNYXRjaGVzRmFjdG9yIiwibWF0Y2hGdW5jIiwia2V5cyIsIkpTT04iLCJzdHJpbmdpZnkiLCJhbGwiLCJjdk1hdEZyb21JbWFnZSIsIkRlc2NyaXB0b3JNYXRjaGVyIiwiRE1hdGNoVmVjdG9yIiwibWF0Y2hlcyIsIm1hdGNoIiwidG90YWxDb3VudCIsInNpemUiLCJpIiwicHVzaCIsImdldCIsImhhc0dvb2RNYXRjaGVzRmFjdG9yIiwiaXNGdW5jdGlvbiIsImlzTnVtYmVyIiwiaXNOYU4iLCJkaXN0YW5jZXMiLCJkaXN0YW5jZSIsIm1pbkRpc3RhbmNlIiwibWluIiwibWF4RGlzdGFuY2UiLCJtYXgiLCJmaWx0ZXIiLCJtYXRjaDEiLCJtYXRjaDIiLCJzbGljZSIsImV4dHJhY3RQb2ludCIsImluZGV4UHJvcGVydHlOYW1lIiwicHQiLCJwb2ludHMxIiwicmVjdDEiLCJwb2ludHMyIiwicmVjdDIiLCJyZXN1bHQiLCJjb3VudCIsImdvb2RNYXRjaGVzVmVjIiwicHVzaF9iYWNrIiwidmlzdWFsaXphdGlvbiIsImRyYXdNYXRjaGVzIiwiY29scyIsImppbXBJbWdGcm9tQ3ZNYXQiLCJnZXRCdWZmZXJBc3luYyIsIkppbXAiLCJNSU1FX1BORyIsImRlbGV0ZSIsImlnbiIsImdldEltYWdlc1NpbWlsYXJpdHkiLCJtZXRob2QiLCJ0ZW1wbGF0ZSIsInJlZmVyZW5jZSIsIm1hdGNoZWQiLCJyb3dzIiwiY29udmVydFRvIiwiQ1ZfOFVDMyIsIm1hdGNoVGVtcGxhdGUiLCJtaW5NYXgiLCJtaW5NYXhMb2MiLCJzY29yZSIsIm1heFZhbCIsImJvdGhJbWFnZXMiLCJyZXN1bHRNYXQiLCJtYXNrIiwiY29udG91cnMiLCJoaWVyYXJjaHkiLCJNYXRWZWN0b3IiLCJoY29uY2F0IiwiYWJzZGlmZiIsImN2dENvbG9yIiwiQ09MT1JfQkdSMkdSQVkiLCJ0aHJlc2hvbGQiLCJUSFJFU0hfQklOQVJZIiwiVEhSRVNIX09UU1UiLCJmaW5kQ29udG91cnMiLCJSRVRSX0VYVEVSTkFMIiwiQ0hBSU5fQVBQUk9YX1NJTVBMRSIsImJvdW5kaW5nUmVjdCIsImdldEltYWdlT2NjdXJyZW5jZSIsImZ1bGxJbWdEYXRhIiwicGFydGlhbEltZ0RhdGEiLCJtdWx0aXBsZSIsIm1hdGNoTmVpZ2hib3VyVGhyZXNob2xkIiwiZnVsbEltZyIsInBhcnRpYWxJbWciLCJyZXN1bHRzIiwicm93IiwiY29sIiwiZmxvYXRBdCIsIm5lYXJNYXRjaGVzIiwiZmlsdGVyTmVhck1hdGNoZXMiLCJyZWN0IiwibWluTG9jIiwibWF4TG9jIiwiaXNFbXB0eSIsImUiLCJtZXNzYWdlIiwiZnVsbEhpZ2hsaWdodGVkSW1hZ2UiLCJjbG9uZSIsInNpbmdsZUhpZ2hsaWdodGVkSW1hZ2UiLCJkYXRhIiwiQnVmZmVyIiwiZnJvbSIsImppbXBJbWciLCJyZWFkIiwibWF0RnJvbUltYWdlRGF0YSIsImJpdG1hcCIsIm5vblplcm9NYXRjaFJlc3VsdHMiLCJyZWR1Y2UiLCJhY2MiLCJlbGVtZW50Iiwic29tZSIsInBvaW50MSIsInBvaW50MiIsImEyIiwicG93IiwiYjIiXSwic291cmNlcyI6WyIuLi8uLi9saWIvaW5kZXguanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IF8gZnJvbSAnbG9kYXNoJztcbmltcG9ydCBKaW1wIGZyb20gJ2ppbXAnO1xuaW1wb3J0IHtCdWZmZXJ9IGZyb20gJ2J1ZmZlcic7XG5pbXBvcnQgQiBmcm9tICdibHVlYmlyZCc7XG5cbi8qKiBAdHlwZSB7YW55fSAqL1xubGV0IGN2O1xuXG4vKipcbiAqIEB0eXBlZGVmIFJlZ2lvblxuICogQHByb3BlcnR5IHtudW1iZXJ9IGxlZnQgLSBUaGUgb2Zmc2V0IGZyb20gdGhlIGxlZnQgc2lkZVxuICogQHByb3BlcnR5IHtudW1iZXJ9IHRvcCAtIFRoZSBvZmZzZXQgZnJvbSB0aGUgdG9wXG4gKiBAcHJvcGVydHkge251bWJlcn0gd2lkdGggLSBUaGUgd2lkdGhcbiAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBoZWlnaHQgLSBUaGUgaGVpZ2h0XG4gKi9cblxuLyoqXG4gKiBAdHlwZWRlZiBQb2ludFxuICogQHByb3BlcnR5IHtudW1iZXJ9IHggLSBUaGUgeCBjb29yZGluYXRlXG4gKiBAcHJvcGVydHkge251bWJlcn0geSAtIFRoZSB5IGNvb3JkaW5hdGVcbiAqL1xuXG4vKipcbiAqIEB0eXBlZGVmIFJlY3RcbiAqIEBwcm9wZXJ0eSB7bnVtYmVyfSB4IC0gVGhlIHRvcCBsZWZ0IGNvb3JkaW5hdGVcbiAqIEBwcm9wZXJ0eSB7bnVtYmVyfSB5IC0gVGhlIGJvdHRvbSByaWdodCBjb29yZGluYXRlXG4gKiBAcHJvcGVydHkge251bWJlcn0gd2lkdGggLSBUaGUgd2lkdGhcbiAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBoZWlnaHQgLSBUaGUgaGVpZ2h0XG4gKi9cblxuY29uc3QgREVGQVVMVF9NQVRDSF9USFJFU0hPTEQgPSAwLjU7XG5jb25zdCBNQVRDSF9ORUlHSEJPVVJfVEhSRVNIT0xEID0gMTA7XG5cbmNvbnN0IEFWQUlMQUJMRV9ERVRFQ1RPUlMgPSB7XG4gIEFLQVpFOiAnQUtBWkUnLFxuICBBR0FTVDogJ0FnYXN0RmVhdHVyZURldGVjdG9yJyxcbiAgQlJJU0s6ICdCUklTSycsXG4gIEZBU1Q6ICdGYXN0RmVhdHVyZURldGVjdG9yJyxcbiAgR0ZUVDogJ0dGVFREZXRlY3RvcicsXG4gIEtBWkU6ICdLQVpFJyxcbiAgTVNFUjogJ01TRVInLFxuICBPUkI6ICdPUkInLFxufTtcblxuY29uc3QgQVZBSUxBQkxFX01BVENISU5HX0ZVTkNUSU9OUyA9IHtcbiAgRmxhbm5CYXNlZDogJ0ZsYW5uQmFzZWQnLFxuICBCcnV0ZUZvcmNlOiAnQnJ1dGVGb3JjZScsXG4gIEJydXRlRm9yY2VMMTogJ0JydXRlRm9yY2UtTDEnLFxuICBCcnV0ZUZvcmNlSGFtbWluZzogJ0JydXRlRm9yY2UtSGFtbWluZycsXG4gIEJydXRlRm9yY2VIYW1taW5nTHV0OiAnQnJ1dGVGb3JjZS1IYW1taW5nTFVUJyxcbiAgQnJ1dGVGb3JjZVNMMjogJ0JydXRlRm9yY2UtU0wyJyxcbn07XG5cbmNvbnN0IE1BVENISU5HX01FVEhPRFMgPSBbXG4gICdUTV9DQ09FRkYnLFxuICAnVE1fQ0NPRUZGX05PUk1FRCcsXG4gICdUTV9DQ09SUicsXG4gICdUTV9DQ09SUl9OT1JNRUQnLFxuICAnVE1fU1FESUZGJyxcbiAgJ1RNX1NRRElGRl9OT1JNRUQnLFxuXTtcbmNvbnN0IERFRkFVTFRfTUFUQ0hJTkdfTUVUSE9EID0gJ1RNX0NDT0VGRl9OT1JNRUQnO1xuXG4vKipcbiAqIFRyYW5zZm9ybXMgbWF0Y2hpbmcgbWV0aG9kIG5hbWUgdG8gdGhlIGFjdHVhbFxuICogY29uc3RhbnQgdmFsdWUgZnJvbSBPcGVuQ1YgbGlicmFyeVxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBuYW1lIE9uZSBvZiBzdXBwb3J0ZWQgbWV0aG9kIG5hbWVzXG4gKiAoc2VlIE1BVENISU5HX01FVEhPRFMgYXJyYXkgYWJvdmUpXG4gKiBAcmV0dXJucyB7bnVtYmVyfSBUaGUgbWV0aG9kIHZhbHVlXG4gKiBAdGhyb3dzIHtFcnJvcn0gaWYgYW4gdW5zdXBwb3J0ZWQgbWV0aG9kIG5hbWUgaXMgZ2l2ZW5cbiAqL1xuZnVuY3Rpb24gdG9NYXRjaGluZ01ldGhvZChuYW1lKSB7XG4gIGlmICghTUFUQ0hJTkdfTUVUSE9EUy5pbmNsdWRlcyhuYW1lKSkge1xuICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgIGBUaGUgbWF0Y2hpbmcgbWV0aG9kICcke25hbWV9JyBpcyB1bmtub3duLiBgICtcbiAgICAgICAgYE9ubHkgdGhlIGZvbGxvd2luZyBtYXRjaGluZyBtZXRob2RzIGFyZSBzdXBwb3J0ZWQ6ICR7TUFUQ0hJTkdfTUVUSE9EU31gXG4gICAgKTtcbiAgfVxuICByZXR1cm4gY3ZbbmFtZV07XG59XG5cbi8qKlxuICogU3BpbnMgdW50aWwgdGhlIG9wZW5jdi1iaW5kaW5ncyBtb2R1bGUgaXMgZnVsbHkgbG9hZGVkXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIGluaXRPcGVuQ3YoKSB7XG4gIGN2ID0gcmVxdWlyZSgnb3BlbmN2LWJpbmRpbmdzJyk7XG4gIHdoaWxlICghY3YuZ2V0QnVpbGRJbmZvcm1hdGlvbikge1xuICAgIGF3YWl0IEIuZGVsYXkoNTAwKTtcbiAgfVxuICAvLyBvcGVuY3YtYmluZGluZ3Mgc2V0cyBhIGdsb2JhbCB1bmhhbmRsZWRSZWplY3Rpb24gaGFuZGxlciBvZiBhbiBhYm9ydCwgd2hpY2ggd2UgZG9uJ3Qgd2FudCwgc29cbiAgLy8gdW5kbyBpdCBoZXJlLiBodHRwczovL2dpdGh1Yi5jb20vb3BlbmN2L29wZW5jdi9pc3N1ZXMvMjE0ODFcbiAgcHJvY2Vzcy5yZW1vdmVBbGxMaXN0ZW5lcnMoJ3VuaGFuZGxlZFJlamVjdGlvbicpO1xufVxuXG4vKipcbiAqIEB0eXBlZGVmIE1hdGNoQ29tcHV0YXRpb25SZXN1bHRcbiAqIEBwcm9wZXJ0eSB7T3BlbkNWQmluZGluZ3NbJ01hdCddfSBkZXNjcmlwdG9yIC0gT3BlbkNWIG1hdGNoIGRlc2NyaXB0b3JcbiAqIEBwcm9wZXJ0eSB7T3BlbkNWQmluZGluZ3NbJ0tleVBvaW50VmVjdG9yJ119IGtleVBvaW50cyAtIFRoZSBhcnJheSBvZiBrZXkgcG9pbnRzXG4gKi9cblxuLyoqXG4gKiBDYWxjdWxhdGVzIGFuIE9wZW5DViBtYXRjaCBkZXNjcmlwdG9yIG9mIGFuIGltYWdlLCB3aGljaCBjYW4gYmUgdXNlZFxuICogZm9yIGJydXRlLWZvcmNlIG1hdGNoaW5nLlxuICogUmVhZCBodHRwczovL2RvY3Mub3BlbmN2Lm9yZy8zLjAtYmV0YS9kb2MvcHlfdHV0b3JpYWxzL3B5X2ZlYXR1cmUyZC9weV9tYXRjaGVyL3B5X21hdGNoZXIuaHRtbFxuICogZm9yIG1vcmUgZGV0YWlscy5cbiAqXG4gKiBAcGFyYW0ge09wZW5DVkJpbmRpbmdzWydNYXQnXX0gaW1nIEltYWdlIGRhdGFcbiAqIEBwYXJhbSB7T3BlbkNWQmluZGluZ3NbJ0ZlYXR1cmVEZXRlY3RvciddfSBkZXRlY3RvciBPcGVuQ1YgZmVhdHVyZSBkZXRlY3RvciBpbnN0YW5jZVxuICpcbiAqIEByZXR1cm5zIHtNYXRjaENvbXB1dGF0aW9uUmVzdWx0fVxuICovXG5mdW5jdGlvbiBkZXRlY3RBbmRDb21wdXRlKGltZywgZGV0ZWN0b3IpIHtcbiAgY29uc3Qga2V5UG9pbnRzID0gbmV3IGN2LktleVBvaW50VmVjdG9yKCk7XG4gIGNvbnN0IGRlc2NyaXB0b3IgPSBuZXcgY3YuTWF0KCk7XG4gIGRldGVjdG9yLmRldGVjdChpbWcsIGtleVBvaW50cyk7XG4gIGRldGVjdG9yLmNvbXB1dGUoaW1nLCBrZXlQb2ludHMsIGRlc2NyaXB0b3IpO1xuICByZXR1cm4ge1xuICAgIGtleVBvaW50cyxcbiAgICBkZXNjcmlwdG9yLFxuICB9O1xufVxuXG4vKipcbiAqIENhbGN1bGF0ZWQgdGhlIGJvdW5kaW5nIHJlY3QgY29vcmRpbmF0ZXMgZm9yIHRoZSBhcnJheSBvZiBtYXRjaGluZyBwb2ludHNcbiAqXG4gKiBAcGFyYW0ge0FycmF5PFBvaW50Pn0gbWF0Y2hlZFBvaW50cyBBcnJheSBvZiBtYXRjaGluZyBwb2ludHNcbiAqIEByZXR1cm5zIHtSZWN0fSBUaGUgbWF0Y2hpbmcgYm91bmRpbmcgcmVjdCBvciBhIHplcm8gcmVjdCBpZiBubyBtYXRjaFxuICogY2FuIGJlIGZvdW5kLlxuICovXG5mdW5jdGlvbiBjYWxjdWxhdGVNYXRjaGVkUmVjdChtYXRjaGVkUG9pbnRzKSB7XG4gIGlmIChtYXRjaGVkUG9pbnRzLmxlbmd0aCA8IDIpIHtcbiAgICByZXR1cm4ge1xuICAgICAgeDogMCxcbiAgICAgIHk6IDAsXG4gICAgICB3aWR0aDogMCxcbiAgICAgIGhlaWdodDogMCxcbiAgICB9O1xuICB9XG5cbiAgY29uc3QgcG9pbnRzU29ydGVkQnlEaXN0YW5jZSA9IG1hdGNoZWRQb2ludHNcbiAgICAubWFwKChwb2ludCkgPT4gW01hdGguc3FydChwb2ludC54ICogcG9pbnQueCArIHBvaW50LnkgKiBwb2ludC55KSwgcG9pbnRdKVxuICAgIC5zb3J0KChwYWlyMSwgcGFpcjIpID0+IHBhaXIxWzBdID49IHBhaXIyWzBdKVxuICAgIC5tYXAoKHBhaXIpID0+IHBhaXJbMV0pO1xuICBjb25zdCBmaXJzdFBvaW50ID0gXy5oZWFkKHBvaW50c1NvcnRlZEJ5RGlzdGFuY2UpO1xuICBjb25zdCBsYXN0UG9pbnQgPSBfLmxhc3QocG9pbnRzU29ydGVkQnlEaXN0YW5jZSk7XG4gIGNvbnN0IHRvcExlZnRQb2ludCA9IHtcbiAgICB4OiBmaXJzdFBvaW50LnggPD0gbGFzdFBvaW50LnggPyBmaXJzdFBvaW50LnggOiBsYXN0UG9pbnQueCxcbiAgICB5OiBmaXJzdFBvaW50LnkgPD0gbGFzdFBvaW50LnkgPyBmaXJzdFBvaW50LnkgOiBsYXN0UG9pbnQueSxcbiAgfTtcbiAgY29uc3QgYm90dG9tUmlnaHRQb2ludCA9IHtcbiAgICB4OiBmaXJzdFBvaW50LnggPj0gbGFzdFBvaW50LnggPyBmaXJzdFBvaW50LnggOiBsYXN0UG9pbnQueCxcbiAgICB5OiBmaXJzdFBvaW50LnkgPj0gbGFzdFBvaW50LnkgPyBmaXJzdFBvaW50LnkgOiBsYXN0UG9pbnQueSxcbiAgfTtcbiAgcmV0dXJuIHtcbiAgICB4OiB0b3BMZWZ0UG9pbnQueCxcbiAgICB5OiB0b3BMZWZ0UG9pbnQueSxcbiAgICB3aWR0aDogYm90dG9tUmlnaHRQb2ludC54IC0gdG9wTGVmdFBvaW50LngsXG4gICAgaGVpZ2h0OiBib3R0b21SaWdodFBvaW50LnkgLSB0b3BMZWZ0UG9pbnQueSxcbiAgfTtcbn1cblxuLyoqXG4gKiBEcmF3cyBhIHJlY3Rhbm5nbGUgb24gdGhlIGdpdmVuIGltYWdlIG1hdHJpeFxuICpcbiAqIEBwYXJhbSB7Y3YuTWF0fSBtYXQgVGhlIHNvdXJjZSBpbWFnZVxuICogQHBhcmFtIHtSZWN0fSByZWdpb24gVGhlIHJlZ2lvbiB0byBoaWdobGlnaHRcbiAqXG4gKiBAcmV0dXJucyB7Y3YuTWF0fSBUaGUgc2FtZSBpbWFnZSB3aXRoIHRoZSByZWN0YW5nbGUgb24gaXRcbiAqL1xuZnVuY3Rpb24gaGlnaGxpZ2h0UmVnaW9uKG1hdCwgcmVnaW9uKSB7XG4gIGlmIChyZWdpb24ud2lkdGggPD0gMCB8fCByZWdpb24uaGVpZ2h0IDw9IDApIHtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyBoaWdobGlnaHQgaW4gcmVkXG4gIGNvbnN0IGNvbG9yID0gbmV3IGN2LlNjYWxhcigyNTUsIDAsIDAsIDI1NSk7XG4gIGNvbnN0IHRoaWNrbmVzcyA9IDI7XG4gIGNvbnN0IHRvcExlZnQgPSBuZXcgY3YuUG9pbnQocmVnaW9uLngsIHJlZ2lvbi55KTtcbiAgY29uc3QgYm90UmlnaHQgPSBuZXcgY3YuUG9pbnQocmVnaW9uLnggKyByZWdpb24ud2lkdGgsIHJlZ2lvbi55ICsgcmVnaW9uLmhlaWdodCk7XG4gIGN2LnJlY3RhbmdsZShtYXQsIHRvcExlZnQsIGJvdFJpZ2h0LCBjb2xvciwgdGhpY2tuZXNzLCBjdi5MSU5FXzgsIDApO1xuICByZXR1cm4gbWF0O1xufVxuXG4vKipcbiAqIEB0eXBlZGVmIE1hdGNoaW5nT3B0aW9uc1xuICogQHByb3BlcnR5IHs/c3RyaW5nfSBkZXRlY3Rvck5hbWUgWydPUkInXSBPbmUgb2YgcG9zc2libGUgT3BlbkNWIGZlYXR1cmUgZGV0ZWN0b3IgbmFtZXNcbiAqIGZyb20ga2V5cyBvZiB0aGUgYEFWQUlMQUJMRV9ERVRFQ1RPUlNgIG9iamVjdC5cbiAqIFNvbWUgb2YgdGhlc2UgbWV0aG9kcyAoRkFTVCwgQUdBU1QsIEdGVFQsIEZBU1QsIFNJRlQgYW5kIE1TRVIpIGFyZSBub3QgYXZhaWxhYmxlXG4gKiBpbiB0aGUgZGVmYXVsdCBPcGVuQ1YgaW5zdGFsbGF0aW9uIGFuZCBoYXZlIHRvIGJlIGVuYWJsZWQgbWFudWFsbHkgYmVmb3JlXG4gKiBsaWJyYXJ5IGNvbXBpbGF0aW9uLlxuICogQHByb3BlcnR5IHs/c3RyaW5nfSBtYXRjaEZ1bmMgWydCcnV0ZUZvcmNlJ10gVGhlIG5hbWUgb2YgdGhlIG1hdGNoaW5nIGZ1bmN0aW9uLlxuICogU2hvdWxkIGJlIG9uZSBvZiB0aGUga2V5cyBvZiB0aGUgYEFWQUlMQUJMRV9NQVRDSElOR19GVU5DVElPTlNgIG9iamVjdC5cbiAqIEBwcm9wZXJ0eSB7P251bWJlcnxGdW5jdGlvbn0gZ29vZE1hdGNoZXNGYWN0b3IgVGhlIG1heGltdW0gY291bnQgb2YgXCJnb29kXCIgbWF0Y2hlc1xuICogKGUuIGcuIHdpdGggbWluaW1hbCBkaXN0YW5jZXMpIG9yIGEgZnVuY3Rpb24sIHdoaWNoIGFjY2VwdHMgMyBhcmd1bWVudHM6IHRoZSBjdXJyZW50IGRpc3RhbmNlLFxuICogbWluaW1hbCBkaXN0YW5jZSwgbWF4aW11bSBkaXN0YW5jZSBhbmQgcmV0dXJucyB0cnVlIG9yIGZhbHNlIHRvIGluY2x1ZGUgb3IgZXhjbHVkZSB0aGUgbWF0Y2guXG4gKiBAcHJvcGVydHkgez9ib29sZWFufSB2aXN1YWxpemUgW2ZhbHNlXSBXaGV0aGVyIHRvIHJldHVybiB0aGUgcmVzdWx0aW5nIHZpc2FsaXphdGlvblxuICogYXMgYW4gaW1hZ2UgKHVzZWZ1bCBmb3IgZGVidWdnaW5nIHB1cnBvc2VzKVxuICovXG5cbi8qKlxuICogQHR5cGVkZWYgTWF0Y2hpbmdSZXN1bHRcbiAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBjb3VudCBUaGUgY291bnQgb2YgbWF0Y2hlZCBlZGdlcyBvbiBib3RoIGltYWdlcy5cbiAqIFRoZSBtb3JlIG1hdGNoaW5nIGVkZ2VzIHRoZXJlIGFyZSBubyBib3RoIGltYWdlcyB0aGUgbW9yZSBzaW1pbGFyIHRoZXkgYXJlLlxuICogQHByb3BlcnR5IHtudW1iZXJ9IHRvdGFsQ291bnQgVGhlIHRvdGFsIGNvdW50IG9mIG1hdGNoZWQgZWRnZXMgb24gYm90aCBpbWFnZXMuXG4gKiBJdCBpcyBlcXVhbCB0byBgY291bnRgIGlmIGBnb29kTWF0Y2hlc0ZhY3RvcmAgZG9lcyBub3QgbGltaXQgdGhlIG1hdGNoZXMsXG4gKiBvdGhlcndpc2UgaXQgY29udGFpbnMgdGhlIHRvdGFsIGNvdW50IG9mIG1hdGNoZXMgYmVmb3JlIGBnb29kTWF0Y2hlc0ZhY3RvcmAgaXNcbiAqIGFwcGxpZWQuXG4gKiBAcHJvcGVydHkgez9CdWZmZXJ9IHZpc3VhbGl6YXRpb24gVGhlIHZpc3VhbGl6YXRpb24gb2YgdGhlIG1hdGNoaW5nIHJlc3VsdFxuICogcmVwcmVzZW50ZWQgYXMgUE5HIGltYWdlIGJ1ZmZlci4gVGhpcyB2aXN1YWxpemF0aW9uIGxvb2tzIGxpa2VcbiAqIGh0dHBzOi8vdXNlci1pbWFnZXMuZ2l0aHVidXNlcmNvbnRlbnQuY29tLzMxMTI1NTIxLzI5NzAyNzMxLWM3OWUzMTQyLTg5NzItMTFlNy05NDdlLWRiMTA5ZDQxNTQ2OS5qcGdcbiAqIEBwcm9wZXJ0eSB7QXJyYXk8UG9pbnQ+fSBwb2ludHMxIFRoZSBhcnJheSBvZiBtYXRjaGluZyBwb2ludHMgb24gdGhlIGZpcnN0IGltYWdlXG4gKiBAcHJvcGVydHkge1JlY3R9IHJlY3QxIFRoZSBib3VuZGluZyByZWN0IGZvciB0aGUgYG1hdGNoZWRQb2ludHMxYCBzZXQgb3IgYSB6ZXJvIHJlY3RcbiAqIGlmIG5vdCBlbm91Z2ggbWF0Y2hpbmcgcG9pbnRzIGFyZSBmb3VuZFxuICogQHByb3BlcnR5IHtBcnJheTxQb2ludD59IHBvaW50czIgVGhlIGFycmF5IG9mIG1hdGNoaW5nIHBvaW50cyBvbiB0aGUgc2Vjb25kIGltYWdlXG4gKiBAcHJvcGVydHkge1JlY3R9IHJlY3QyIFRoZSBib3VuZGluZyByZWN0IGZvciB0aGUgYG1hdGNoZWRQb2ludHMyYCBzZXQgb3IgYSB6ZXJvIHJlY3RcbiAqIGlmIG5vdCBlbm91Z2ggbWF0Y2hpbmcgcG9pbnRzIGFyZSBmb3VuZFxuICovXG5cbi8qKlxuICogQ2FsY3VsYXRlcyB0aGUgY291bnQgb2YgY29tbW9uIGVkZ2VzIGJldHdlZW4gdHdvIGltYWdlcy5cbiAqIFRoZSBpbWFnZXMgbWlnaHQgYmUgcm90YXRlZCBvciByZXNpemVkIHJlbGF0aXZlbHkgdG8gZWFjaCBvdGhlci5cbiAqXG4gKiBAcGFyYW0ge0J1ZmZlcn0gaW1nMURhdGEgVGhlIGRhdGEgb2YgdGhlIGZpcnN0IGltYWdlIHBhY2tlZCBpbnRvIGEgTm9kZUpTIGJ1ZmZlclxuICogQHBhcmFtIHtCdWZmZXJ9IGltZzJEYXRhIFRoZSBkYXRhIG9mIHRoZSBzZWNvbmQgaW1hZ2UgcGFja2VkIGludG8gYSBOb2RlSlMgYnVmZmVyXG4gKiBAcGFyYW0gez9NYXRjaGluZ09wdGlvbnN9IG9wdGlvbnMgW3t9XSBTZXQgb2YgbWF0Y2hpbmcgb3B0aW9uc1xuICpcbiAqIEByZXR1cm5zIHtNYXRjaGluZ1Jlc3VsdH0gTWFjaGluZyByZXN1bHRcbiAqIEB0aHJvd3Mge0Vycm9yfSBJZiBgZGV0ZWN0b3JOYW1lYCB2YWx1ZSBpcyB1bmtub3duLlxuICovXG5hc3luYyBmdW5jdGlvbiBnZXRJbWFnZXNNYXRjaGVzKGltZzFEYXRhLCBpbWcyRGF0YSwgb3B0aW9ucyA9IHt9KSB7XG4gIGF3YWl0IGluaXRPcGVuQ3YoKTtcblxuICBsZXQgaW1nMSwgaW1nMiwgZGV0ZWN0b3IsIHJlc3VsdDEsIHJlc3VsdDIsIG1hdGNoZXIsIG1hdGNoZXNWZWM7XG4gIHRyeSB7XG4gICAgY29uc3Qge1xuICAgICAgZGV0ZWN0b3JOYW1lID0gJ09SQicsXG4gICAgICB2aXN1YWxpemUgPSBmYWxzZSxcbiAgICAgIGdvb2RNYXRjaGVzRmFjdG9yLFxuICAgICAgbWF0Y2hGdW5jID0gJ0JydXRlRm9yY2UnLFxuICAgIH0gPSBvcHRpb25zO1xuICAgIGlmICghXy5pbmNsdWRlcyhfLmtleXMoQVZBSUxBQkxFX0RFVEVDVE9SUyksIGRldGVjdG9yTmFtZSkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgYCcke2RldGVjdG9yTmFtZX0nIGRldGVjdG9yIGlzIHVua25vd24uIGAgK1xuICAgICAgICAgIGBPbmx5ICR7SlNPTi5zdHJpbmdpZnkoXy5rZXlzKEFWQUlMQUJMRV9ERVRFQ1RPUlMpKX0gZGV0ZWN0b3JzIGFyZSBzdXBwb3J0ZWQuYFxuICAgICAgKTtcbiAgICB9XG4gICAgaWYgKCFfLmluY2x1ZGVzKF8ua2V5cyhBVkFJTEFCTEVfTUFUQ0hJTkdfRlVOQ1RJT05TKSwgbWF0Y2hGdW5jKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICBgJyR7bWF0Y2hGdW5jfScgbWF0Y2hpbmcgZnVuY3Rpb24gaXMgdW5rbm93bi4gYCArXG4gICAgICAgICAgYE9ubHkgJHtKU09OLnN0cmluZ2lmeShcbiAgICAgICAgICAgIF8ua2V5cyhBVkFJTEFCTEVfTUFUQ0hJTkdfRlVOQ1RJT05TKVxuICAgICAgICAgICl9IG1hdGNoaW5nIGZ1bmN0aW9ucyBhcmUgc3VwcG9ydGVkLmBcbiAgICAgICk7XG4gICAgfVxuXG4gICAgZGV0ZWN0b3IgPSBuZXcgY3ZbQVZBSUxBQkxFX0RFVEVDVE9SU1tkZXRlY3Rvck5hbWVdXSgpO1xuICAgIFtpbWcxLCBpbWcyXSA9IGF3YWl0IEIuYWxsKFtjdk1hdEZyb21JbWFnZShpbWcxRGF0YSksIGN2TWF0RnJvbUltYWdlKGltZzJEYXRhKV0pO1xuICAgIHJlc3VsdDEgPSBkZXRlY3RBbmRDb21wdXRlKGltZzEsIGRldGVjdG9yKTtcbiAgICByZXN1bHQyID0gZGV0ZWN0QW5kQ29tcHV0ZShpbWcyLCBkZXRlY3Rvcik7XG4gICAgbWF0Y2hlciA9IG5ldyBjdi5EZXNjcmlwdG9yTWF0Y2hlcihBVkFJTEFCTEVfTUFUQ0hJTkdfRlVOQ1RJT05TW21hdGNoRnVuY10pO1xuICAgIG1hdGNoZXNWZWMgPSBuZXcgY3YuRE1hdGNoVmVjdG9yKCk7XG4gICAgbGV0IG1hdGNoZXMgPSBbXTtcbiAgICBtYXRjaGVyLm1hdGNoKHJlc3VsdDEuZGVzY3JpcHRvciwgcmVzdWx0Mi5kZXNjcmlwdG9yLCBtYXRjaGVzVmVjKTtcbiAgICBjb25zdCB0b3RhbENvdW50ID0gbWF0Y2hlc1ZlYy5zaXplKCk7XG4gICAgaWYgKHRvdGFsQ291bnQgPCAxKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgIGBDb3VsZCBub3QgZmluZCBhbnkgbWF0Y2hlcyBiZXR3ZWVuIGltYWdlcy4gRG91YmxlLWNoZWNrIG9yaWVudGF0aW9uLCBgICtcbiAgICAgICAgICBgcmVzb2x1dGlvbiwgb3IgdXNlIGFub3RoZXIgZGV0ZWN0b3Igb3IgbWF0Y2hpbmcgZnVuY3Rpb24uYFxuICAgICAgKTtcbiAgICB9XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0b3RhbENvdW50OyBpKyspIHtcbiAgICAgIG1hdGNoZXMucHVzaChtYXRjaGVzVmVjLmdldChpKSk7XG4gICAgfVxuXG4gICAgY29uc3QgaGFzR29vZE1hdGNoZXNGYWN0b3IgPVxuICAgICAgXy5pc0Z1bmN0aW9uKGdvb2RNYXRjaGVzRmFjdG9yKSB8fFxuICAgICAgKF8uaXNOdW1iZXIoZ29vZE1hdGNoZXNGYWN0b3IpICYmICFfLmlzTmFOKGdvb2RNYXRjaGVzRmFjdG9yKSk7XG5cbiAgICBpZiAoaGFzR29vZE1hdGNoZXNGYWN0b3IpIHtcbiAgICAgIGlmIChfLmlzRnVuY3Rpb24oZ29vZE1hdGNoZXNGYWN0b3IpKSB7XG4gICAgICAgIGNvbnN0IGRpc3RhbmNlcyA9IG1hdGNoZXMubWFwKChtYXRjaCkgPT4gbWF0Y2guZGlzdGFuY2UpO1xuICAgICAgICBjb25zdCBtaW5EaXN0YW5jZSA9IF8ubWluKGRpc3RhbmNlcyk7XG4gICAgICAgIGNvbnN0IG1heERpc3RhbmNlID0gXy5tYXgoZGlzdGFuY2VzKTtcbiAgICAgICAgbWF0Y2hlcyA9IG1hdGNoZXMuZmlsdGVyKChtYXRjaCkgPT5cbiAgICAgICAgICBnb29kTWF0Y2hlc0ZhY3RvcihtYXRjaC5kaXN0YW5jZSwgbWluRGlzdGFuY2UsIG1heERpc3RhbmNlKVxuICAgICAgICApO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKG1hdGNoZXMubGVuZ3RoID4gZ29vZE1hdGNoZXNGYWN0b3IpIHtcbiAgICAgICAgICBtYXRjaGVzID0gbWF0Y2hlc1xuICAgICAgICAgICAgLnNvcnQoKG1hdGNoMSwgbWF0Y2gyKSA9PiBtYXRjaDEuZGlzdGFuY2UgLSBtYXRjaDIuZGlzdGFuY2UpXG4gICAgICAgICAgICAuc2xpY2UoMCwgZ29vZE1hdGNoZXNGYWN0b3IpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgY29uc3QgZXh0cmFjdFBvaW50ID0gKGtleVBvaW50cywgaW5kZXhQcm9wZXJ0eU5hbWUpID0+IChtYXRjaCkgPT4ge1xuICAgICAgY29uc3Qge3B0LCBwb2ludH0gPSBrZXlQb2ludHMuZ2V0KG1hdGNoW2luZGV4UHJvcGVydHlOYW1lXSk7XG4gICAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vanVzdGFkdWRld2hvaGFja3Mvb3BlbmN2NG5vZGVqcy9pc3N1ZXMvNTg0XG4gICAgICByZXR1cm4gcHQgfHwgcG9pbnQ7XG4gICAgfTtcbiAgICBjb25zdCBwb2ludHMxID0gbWF0Y2hlcy5tYXAoZXh0cmFjdFBvaW50KHJlc3VsdDEua2V5UG9pbnRzLCAncXVlcnlJZHgnKSk7XG4gICAgY29uc3QgcmVjdDEgPSBjYWxjdWxhdGVNYXRjaGVkUmVjdChwb2ludHMxKTtcbiAgICBjb25zdCBwb2ludHMyID0gbWF0Y2hlcy5tYXAoZXh0cmFjdFBvaW50KHJlc3VsdDIua2V5UG9pbnRzLCAndHJhaW5JZHgnKSk7XG4gICAgY29uc3QgcmVjdDIgPSBjYWxjdWxhdGVNYXRjaGVkUmVjdChwb2ludHMyKTtcblxuICAgIGNvbnN0IHJlc3VsdCA9IHtcbiAgICAgIHBvaW50czEsXG4gICAgICByZWN0MSxcbiAgICAgIHBvaW50czIsXG4gICAgICByZWN0MixcbiAgICAgIHRvdGFsQ291bnQsXG4gICAgICBjb3VudDogbWF0Y2hlcy5sZW5ndGgsXG4gICAgfTtcbiAgICBpZiAodmlzdWFsaXplKSB7XG4gICAgICBjb25zdCBnb29kTWF0Y2hlc1ZlYyA9IG5ldyBjdi5ETWF0Y2hWZWN0b3IoKTtcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbWF0Y2hlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICBnb29kTWF0Y2hlc1ZlYy5wdXNoX2JhY2sobWF0Y2hlc1tpXSk7XG4gICAgICB9XG4gICAgICBjb25zdCB2aXN1YWxpemF0aW9uID0gbmV3IGN2Lk1hdCgpO1xuICAgICAgY29uc3QgY29sb3IgPSBuZXcgY3YuU2NhbGFyKDAsIDI1NSwgMCwgMjU1KTtcbiAgICAgIGN2LmRyYXdNYXRjaGVzKFxuICAgICAgICBpbWcxLFxuICAgICAgICByZXN1bHQxLmtleVBvaW50cyxcbiAgICAgICAgaW1nMixcbiAgICAgICAgcmVzdWx0Mi5rZXlQb2ludHMsXG4gICAgICAgIGdvb2RNYXRjaGVzVmVjLFxuICAgICAgICB2aXN1YWxpemF0aW9uLFxuICAgICAgICBjb2xvclxuICAgICAgKTtcbiAgICAgIGhpZ2hsaWdodFJlZ2lvbih2aXN1YWxpemF0aW9uLCByZWN0MSk7XG4gICAgICBoaWdobGlnaHRSZWdpb24odmlzdWFsaXphdGlvbiwge1xuICAgICAgICB4OiBpbWcxLmNvbHMgKyByZWN0Mi54LFxuICAgICAgICB5OiByZWN0Mi55LFxuICAgICAgICB3aWR0aDogcmVjdDIud2lkdGgsXG4gICAgICAgIGhlaWdodDogcmVjdDIuaGVpZ2h0LFxuICAgICAgfSk7XG4gICAgICByZXN1bHQudmlzdWFsaXphdGlvbiA9IGF3YWl0IGppbXBJbWdGcm9tQ3ZNYXQodmlzdWFsaXphdGlvbikuZ2V0QnVmZmVyQXN5bmMoSmltcC5NSU1FX1BORyk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfSBmaW5hbGx5IHtcbiAgICB0cnkge1xuICAgICAgaW1nMS5kZWxldGUoKTtcbiAgICAgIGltZzIuZGVsZXRlKCk7XG4gICAgICBkZXRlY3Rvci5kZWxldGUoKTtcbiAgICAgIHJlc3VsdDEua2V5UG9pbnRzLmRlbGV0ZSgpO1xuICAgICAgcmVzdWx0MS5kZXNjcmlwdG9yLmRlbGV0ZSgpO1xuICAgICAgcmVzdWx0Mi5rZXlQb2ludHMuZGVsZXRlKCk7XG4gICAgICByZXN1bHQyLmRlc2NyaXB0b3IuZGVsZXRlKCk7XG4gICAgICBtYXRjaGVyLmRlbGV0ZSgpO1xuICAgICAgbWF0Y2hlc1ZlYy5kZWxldGUoKTtcbiAgICB9IGNhdGNoIChpZ24pIHt9XG4gIH1cbn1cblxuLyoqXG4gKiBAdHlwZWRlZiBTaW1pbGFyaXR5T3B0aW9uc1xuICogQHByb3BlcnR5IHs/Ym9vbGVhbn0gdmlzdWFsaXplIFtmYWxzZV0gV2hldGhlciB0byByZXR1cm4gdGhlIHJlc3VsdGluZyB2aXNhbGl6YXRpb25cbiAqIGFzIGFuIGltYWdlICh1c2VmdWwgZm9yIGRlYnVnZ2luZyBwdXJwb3NlcylcbiAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBtZXRob2QgW1RNX0NDT0VGRl9OT1JNRURdIFRoZSBuYW1lIG9mIHRoZSB0ZW1wbGF0ZSBtYXRjaGluZyBtZXRob2QuXG4gKiBBY2NlcHRhYmxlIHZhbHVlcyBhcmU6XG4gKiAtIFRNX0NDT0VGRlxuICogLSBUTV9DQ09FRkZfTk9STUVEIChkZWZhdWx0KVxuICogLSBUTV9DQ09SUlxuICogLSBUTV9DQ09SUl9OT1JNRURcbiAqIC0gVE1fU1FESUZGXG4gKiAtIFRNX1NRRElGRl9OT1JNRURcbiAqIFJlYWQgaHR0cHM6Ly9kb2NzLm9wZW5jdi5vcmcvMy4wLWJldGEvZG9jL3B5X3R1dG9yaWFscy9weV9pbWdwcm9jL3B5X3RlbXBsYXRlX21hdGNoaW5nL3B5X3RlbXBsYXRlX21hdGNoaW5nLmh0bWxcbiAqIGZvciBtb3JlIGRldGFpbHMuXG4gKi9cblxuLyoqXG4gKiBAdHlwZWRlZiBTaW1pbGFyaXR5UmVzdWx0XG4gKiBAcHJvcGVydHkge251bWJlcn0gc2NvcmUgVGhlIHNpbWlsYXJpdHkgc2NvcmUgYXMgYSBmbG9hdCBudW1iZXIgaW4gcmFuZ2UgWzAuMCwgMS4wXS5cbiAqIDEuMCBpcyB0aGUgaGlnaGVzdCBzY29yZSAobWVhbnMgYm90aCBpbWFnZXMgYXJlIHRvdGFsbHkgZXF1YWwpLlxuICogQHByb3BlcnR5IHs/QnVmZmVyfSB2aXN1YWxpemF0aW9uIFRoZSB2aXN1YWxpemF0aW9uIG9mIHRoZSBtYXRjaGluZyByZXN1bHRcbiAqIHJlcHJlc2VudGVkIGFzIFBORyBpbWFnZSBidWZmZXIuIFRoaXMgaW1hZ2UgaW5jbHVkZXMgYm90aCBpbnB1dCBwaWN0dXJlcyB3aGVyZVxuICogZGlmZmVyZW5jZSByZWdpb25zIGFyZSBoaWdobGlnaHRlZCB3aXRoIHJlY3RhbmdsZXMuXG4gKi9cblxuLyoqXG4gKiBDYWxjdWxhdGVzIHRoZSBzaW1pbGFyaXR5IHNjb3JlIGJldHdlZW4gdHdvIGltYWdlcy5cbiAqIEl0IGlzIGV4cGVjdGVkLCB0aGF0IGJvdGggaW1hZ2VzIGhhdmUgdGhlIHNhbWUgcmVzb2x1dGlvbi5cbiAqXG4gKiBAcGFyYW0ge0J1ZmZlcn0gaW1nMURhdGEgVGhlIGRhdGEgb2YgdGhlIGZpcnN0IGltYWdlIHBhY2tlZCBpbnRvIGEgTm9kZUpTIGJ1ZmZlclxuICogQHBhcmFtIHtCdWZmZXJ9IGltZzJEYXRhIFRoZSBkYXRhIG9mIHRoZSBzZWNvbmQgaW1hZ2UgcGFja2VkIGludG8gYSBOb2RlSlMgYnVmZmVyXG4gKiBAcGFyYW0gez9TaW1pbGFyaXR5T3B0aW9uc30gb3B0aW9ucyBbe31dIFNldCBvZiBzaW1pbGFyaXR5IGNhbGN1bGF0aW9uIG9wdGlvbnNcbiAqXG4gKiBAcmV0dXJucyB7U2ltaWxhcml0eVJlc3VsdH0gVGhlIGNhbGN1bGF0aW9uIHJlc3VsdFxuICogQHRocm93cyB7RXJyb3J9IElmIHRoZSBnaXZlbiBpbWFnZXMgaGF2ZSBkaWZmZXJlbnQgcmVzb2x1dGlvbi5cbiAqL1xuYXN5bmMgZnVuY3Rpb24gZ2V0SW1hZ2VzU2ltaWxhcml0eShpbWcxRGF0YSwgaW1nMkRhdGEsIG9wdGlvbnMgPSB7fSkge1xuICBhd2FpdCBpbml0T3BlbkN2KCk7XG5cbiAgY29uc3Qge21ldGhvZCA9IERFRkFVTFRfTUFUQ0hJTkdfTUVUSE9ELCB2aXN1YWxpemUgPSBmYWxzZX0gPSBvcHRpb25zO1xuXG4gIGxldCB0ZW1wbGF0ZSwgcmVmZXJlbmNlLCBtYXRjaGVkO1xuICB0cnkge1xuICAgIFt0ZW1wbGF0ZSwgcmVmZXJlbmNlXSA9IGF3YWl0IEIuYWxsKFtjdk1hdEZyb21JbWFnZShpbWcxRGF0YSksIGN2TWF0RnJvbUltYWdlKGltZzJEYXRhKV0pO1xuICAgIGlmICh0ZW1wbGF0ZS5yb3dzICE9PSByZWZlcmVuY2Uucm93cyB8fCB0ZW1wbGF0ZS5jb2xzICE9PSByZWZlcmVuY2UuY29scykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAnQm90aCBpbWFnZXMgYXJlIGV4cGVjdGVkIHRvIGhhdmUgdGhlIHNhbWUgc2l6ZSBpbiBvcmRlciB0byAnICtcbiAgICAgICAgICAnY2FsY3VsYXRlIHRoZSBzaW1pbGFyaXR5IHNjb3JlLidcbiAgICAgICk7XG4gICAgfVxuICAgIHRlbXBsYXRlLmNvbnZlcnRUbyh0ZW1wbGF0ZSwgY3YuQ1ZfOFVDMyk7XG4gICAgcmVmZXJlbmNlLmNvbnZlcnRUbyhyZWZlcmVuY2UsIGN2LkNWXzhVQzMpO1xuXG4gICAgbWF0Y2hlZCA9IG5ldyBjdi5NYXQoKTtcbiAgICBjdi5tYXRjaFRlbXBsYXRlKHJlZmVyZW5jZSwgdGVtcGxhdGUsIG1hdGNoZWQsIHRvTWF0Y2hpbmdNZXRob2QobWV0aG9kKSk7XG4gICAgY29uc3QgbWluTWF4ID0gY3YubWluTWF4TG9jKG1hdGNoZWQpO1xuICAgIGNvbnN0IHJlc3VsdCA9IHtcbiAgICAgIHNjb3JlOiBtaW5NYXgubWF4VmFsLFxuICAgIH07XG5cbiAgICBpZiAodmlzdWFsaXplKSB7XG4gICAgICBsZXQgYm90aEltYWdlcywgcmVzdWx0TWF0LCBtYXNrLCBjb250b3VycywgaGllcmFyY2h5O1xuICAgICAgdHJ5IHtcbiAgICAgICAgcmVzdWx0TWF0ID0gbmV3IGN2Lk1hdCh0ZW1wbGF0ZS5yb3dzLCB0ZW1wbGF0ZS5jb2xzICogMiwgY3YuQ1ZfOFVDMyk7XG4gICAgICAgIGJvdGhJbWFnZXMgPSBuZXcgY3YuTWF0VmVjdG9yKCk7XG4gICAgICAgIGJvdGhJbWFnZXMucHVzaF9iYWNrKHJlZmVyZW5jZSk7XG4gICAgICAgIGJvdGhJbWFnZXMucHVzaF9iYWNrKHRlbXBsYXRlKTtcbiAgICAgICAgY3YuaGNvbmNhdChib3RoSW1hZ2VzLCByZXN1bHRNYXQpO1xuXG4gICAgICAgIG1hc2sgPSBuZXcgY3YuTWF0KCk7XG4gICAgICAgIGN2LmFic2RpZmYocmVmZXJlbmNlLCB0ZW1wbGF0ZSwgbWFzayk7XG4gICAgICAgIGN2LmN2dENvbG9yKG1hc2ssIG1hc2ssIGN2LkNPTE9SX0JHUjJHUkFZLCAwKTtcblxuICAgICAgICBjdi50aHJlc2hvbGQobWFzaywgbWFzaywgMTI4LCAyNTUsIGN2LlRIUkVTSF9CSU5BUlkgfCBjdi5USFJFU0hfT1RTVSk7XG4gICAgICAgIGNvbnRvdXJzID0gbmV3IGN2Lk1hdFZlY3RvcigpO1xuICAgICAgICBoaWVyYXJjaHkgPSBuZXcgY3YuTWF0KCk7XG4gICAgICAgIGN2LmZpbmRDb250b3VycyhtYXNrLCBjb250b3VycywgaGllcmFyY2h5LCBjdi5SRVRSX0VYVEVSTkFMLCBjdi5DSEFJTl9BUFBST1hfU0lNUExFKTtcblxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvbnRvdXJzLnNpemUoKTsgaSsrKSB7XG4gICAgICAgICAgY29uc3QgYm91bmRpbmdSZWN0ID0gY3YuYm91bmRpbmdSZWN0KGNvbnRvdXJzLmdldChpKSk7XG4gICAgICAgICAgaGlnaGxpZ2h0UmVnaW9uKHJlc3VsdE1hdCwgYm91bmRpbmdSZWN0KTtcbiAgICAgICAgICBoaWdobGlnaHRSZWdpb24ocmVzdWx0TWF0LCB7XG4gICAgICAgICAgICB4OiByZWZlcmVuY2UuY29scyArIGJvdW5kaW5nUmVjdC54LFxuICAgICAgICAgICAgeTogYm91bmRpbmdSZWN0LnksXG4gICAgICAgICAgICB3aWR0aDogYm91bmRpbmdSZWN0LndpZHRoLFxuICAgICAgICAgICAgaGVpZ2h0OiBib3VuZGluZ1JlY3QuaGVpZ2h0LFxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIHJlc3VsdC52aXN1YWxpemF0aW9uID0gYXdhaXQgamltcEltZ0Zyb21Ddk1hdChyZXN1bHRNYXQpLmdldEJ1ZmZlckFzeW5jKEppbXAuTUlNRV9QTkcpO1xuICAgICAgfSBmaW5hbGx5IHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBib3RoSW1hZ2VzLmRlbGV0ZSgpO1xuICAgICAgICAgIHJlc3VsdE1hdC5kZWxldGUoKTtcbiAgICAgICAgICBtYXNrLmRlbGV0ZSgpO1xuICAgICAgICAgIGNvbnRvdXJzLmRlbGV0ZSgpO1xuICAgICAgICAgIGhpZXJhcmNoeS5kZWxldGUoKTtcbiAgICAgICAgfSBjYXRjaCAoaWduKSB7fVxuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9IGZpbmFsbHkge1xuICAgIHRyeSB7XG4gICAgICB0ZW1wbGF0ZS5kZWxldGUoKTtcbiAgICAgIHJlZmVyZW5jZS5kZWxldGUoKTtcbiAgICAgIG1hdGNoZWQuZGVsZXRlKCk7XG4gICAgfSBjYXRjaCAoaWduKSB7fVxuICB9XG59XG5cbi8qKlxuICogQHR5cGVkZWYgT2NjdXJyZW5jZU9wdGlvbnNcbiAqIEBwcm9wZXJ0eSB7Ym9vbGVhbn0gW3Zpc3VhbGl6ZT1mYWxzZV0gV2hldGhlciB0byByZXR1cm4gdGhlIHJlc3VsdGluZyB2aXNhbGl6YXRpb25cbiAqIGFzIGFuIGltYWdlICh1c2VmdWwgZm9yIGRlYnVnZ2luZyBwdXJwb3NlcylcbiAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBbdGhyZXNob2xkPTAuNV0gQXQgd2hhdCBub3JtYWxpemVkIHRocmVzaG9sZCB0byByZWplY3RcbiAqIGEgbWF0Y2hcbiAqIEBwcm9wZXJ0eSB7bnVtYmVyfGJvb2xlYW59IFttdWx0aXBsZT1mYWxzZV0gZmluZCBtdWx0aXBsZSBtYXRjaGVzIGluIHRoZSBpbWFnZVxuICogQHByb3BlcnR5IHtudW1iZXJ9IFttYXRjaE5laWdoYm91clRocmVzaG9sZD0xMF0gVGhlIHBpeGVsIGRpc3RhbmNlIGJldHdlZW4gbWF0Y2hlcyB3ZSBjb25zaWRlclxuICogdG8gYmUgcGFydCBvZiB0aGUgc2FtZSB0ZW1wbGF0ZSBtYXRjaFxuICovXG5cbi8qKlxuICogQHR5cGVkZWYgeydUTV9DQ09FRkYnfCdUTV9DQ09FRkZfTk9STUVEfCdUTV9DQ09SUid8J1RNX0NDT1JSX05PUk1FRCd8J1RNX1NRRElGRid8J1RNU1FESUZGX05PUk1FRCd9IE9jY3VycmVuY2VSZXN1bHRNZXRob2RcbiAqL1xuXG4vKipcbiAqIEB0eXBlZGVmIE9jY3VycmVuY2VSZXN1bHRcbiAqIEBwcm9wZXJ0eSB7aW1wb3J0KCdAYXBwaXVtL3R5cGVzJykuUmVjdH0gcmVjdCBUaGUgcmVnaW9uIG9mIHRoZSBwYXJ0aWFsIGltYWdlIG9jY3VyZW5jZVxuICogb24gdGhlIGZ1bGwgaW1hZ2VcbiAqIEBwcm9wZXJ0eSB7QnVmZmVyfSB2aXN1YWxpemF0aW9uIFRoZSB2aXN1YWxpemF0aW9uIG9mIHRoZSBtYXRjaGluZyByZXN1bHRcbiAqIHJlcHJlc2VudGVkIGFzIFBORyBpbWFnZSBidWZmZXIuIE9uIHRoaXMgaW1hZ2UgdGhlIG1hdGNoaW5nXG4gKiByZWdpb24gaXMgaGlnaGxpZ2h0ZWQgd2l0aCBhIHJlY3RhbmdsZS4gSWYgdGhlIG11bHRpcGxlIG9wdGlvbiBpcyBwYXNzZWQsXG4gKiBhbGwgcmVzdWx0cyBhcmUgaGlnaGxpZ2h0ZWQgaGVyZS5cbiAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBzY29yZSBUaGUgc2ltaWxhcml0eSBzY29yZSBhcyBhIGZsb2F0IG51bWJlciBpbiByYW5nZSBbMC4wLCAxLjBdLlxuICogMS4wIGlzIHRoZSBoaWdoZXN0IHNjb3JlIChtZWFucyBib3RoIGltYWdlcyBhcmUgdG90YWxseSBlcXVhbCkuXG4gKiBAcHJvcGVydHkge09jY3VycmVuY2VSZXN1bHRbXX0gbXVsdGlwbGUgVGhlIGFycmF5IG9mIG1hdGNoaW5nIE9jY3VyZW5jZVJlc3VsdHNcbiAqIC0gb25seSB3aGVuIG11bHRpcGxlIG9wdGlvbiBpcyBwYXNzZWRcbiAqIEBwcm9wZXJ0eSB7T2NjdXJyZW5jZVJlc3VsdE1ldGhvZH0gW21ldGhvZD0nVE1fQ0NPRUZGX05PUk1FRCddIFRoZSBuYW1lIG9mIHRoZSB0ZW1wbGF0ZSBtYXRjaGluZyBtZXRob2QuXG4gKiBBY2NlcHRhYmxlIHZhbHVlcyBhcmU6XG4gKiAtIFRNX0NDT0VGRlxuICogLSBUTV9DQ09FRkZfTk9STUVEIChkZWZhdWx0KVxuICogLSBUTV9DQ09SUlxuICogLSBUTV9DQ09SUl9OT1JNRURcbiAqIC0gVE1fU1FESUZGXG4gKiAtIFRNX1NRRElGRl9OT1JNRURcbiAqIFJlYWQgaHR0cHM6Ly9kb2NzLm9wZW5jdi5vcmcvMy4wLWJldGEvZG9jL3B5X3R1dG9yaWFscy9weV9pbWdwcm9jL3B5X3RlbXBsYXRlX21hdGNoaW5nL3B5X3RlbXBsYXRlX21hdGNoaW5nLmh0bWxcbiAqIGZvciBtb3JlIGRldGFpbHMuXG4gKi9cblxuLyoqXG4gKiBDYWxjdWxhdGVzIHRoZSBvY2N1cnJlbmNlIHBvc2l0aW9uIG9mIGEgcGFydGlhbCBpbWFnZSBpbiB0aGUgZnVsbFxuICogaW1hZ2UuXG4gKlxuICogQHBhcmFtIHtCdWZmZXJ9IGZ1bGxJbWdEYXRhIFRoZSBkYXRhIG9mIHRoZSBmdWxsIGltYWdlIHBhY2tlZCBpbnRvIGEgTm9kZUpTIGJ1ZmZlclxuICogQHBhcmFtIHtCdWZmZXJ9IHBhcnRpYWxJbWdEYXRhIFRoZSBkYXRhIG9mIHRoZSBwYXJ0aWFsIGltYWdlIHBhY2tlZCBpbnRvIGEgTm9kZUpTIGJ1ZmZlclxuICogQHBhcmFtIHtPY2N1cnJlbmNlT3B0aW9ucz99IFtvcHRpb25zXSBTZXQgb2Ygb2NjdXJyZW5jZSBjYWxjdWxhdGlvbiBvcHRpb25zXG4gKlxuICogQHJldHVybnMge09jY3VycmVuY2VSZXN1bHR9XG4gKiBAdGhyb3dzIHtFcnJvcn0gSWYgbm8gb2NjdXJyZW5jZXMgb2YgdGhlIHBhcnRpYWwgaW1hZ2UgY2FuIGJlIGZvdW5kIGluIHRoZSBmdWxsIGltYWdlXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIGdldEltYWdlT2NjdXJyZW5jZShmdWxsSW1nRGF0YSwgcGFydGlhbEltZ0RhdGEsIG9wdGlvbnMgPSB7fSkge1xuICBhd2FpdCBpbml0T3BlbkN2KCk7XG5cbiAgY29uc3Qge1xuICAgIHZpc3VhbGl6ZSA9IGZhbHNlLFxuICAgIHRocmVzaG9sZCA9IERFRkFVTFRfTUFUQ0hfVEhSRVNIT0xELFxuICAgIG11bHRpcGxlID0gZmFsc2UsXG4gICAgbWF0Y2hOZWlnaGJvdXJUaHJlc2hvbGQgPSBNQVRDSF9ORUlHSEJPVVJfVEhSRVNIT0xELFxuICAgIG1ldGhvZCA9IERFRkFVTFRfTUFUQ0hJTkdfTUVUSE9ELFxuICB9ID0gb3B0aW9ucztcblxuICBsZXQgZnVsbEltZywgcGFydGlhbEltZywgbWF0Y2hlZDtcblxuICB0cnkge1xuICAgIFtmdWxsSW1nLCBwYXJ0aWFsSW1nXSA9IGF3YWl0IEIuYWxsKFtcbiAgICAgIGN2TWF0RnJvbUltYWdlKGZ1bGxJbWdEYXRhKSxcbiAgICAgIGN2TWF0RnJvbUltYWdlKHBhcnRpYWxJbWdEYXRhKSxcbiAgICBdKTtcbiAgICBtYXRjaGVkID0gbmV3IGN2Lk1hdCgpO1xuICAgIGNvbnN0IHJlc3VsdHMgPSBbXTtcbiAgICBsZXQgdmlzdWFsaXphdGlvbiA9IG51bGw7XG5cbiAgICB0cnkge1xuICAgICAgY3YubWF0Y2hUZW1wbGF0ZShmdWxsSW1nLCBwYXJ0aWFsSW1nLCBtYXRjaGVkLCB0b01hdGNoaW5nTWV0aG9kKG1ldGhvZCkpO1xuICAgICAgY29uc3QgbWluTWF4ID0gY3YubWluTWF4TG9jKG1hdGNoZWQpO1xuXG4gICAgICBpZiAobXVsdGlwbGUpIHtcbiAgICAgICAgY29uc3QgbWF0Y2hlcyA9IFtdO1xuICAgICAgICBmb3IgKGxldCByb3cgPSAwOyByb3cgPCBtYXRjaGVkLnJvd3M7IHJvdysrKSB7XG4gICAgICAgICAgZm9yIChsZXQgY29sID0gMDsgY29sIDwgbWF0Y2hlZC5jb2xzOyBjb2wrKykge1xuICAgICAgICAgICAgY29uc3Qgc2NvcmUgPSBtYXRjaGVkLmZsb2F0QXQocm93LCBjb2wpO1xuICAgICAgICAgICAgaWYgKHNjb3JlID49IHRocmVzaG9sZCkge1xuICAgICAgICAgICAgICBtYXRjaGVzLnB1c2goe3Njb3JlLCB4OiBjb2wsIHk6IHJvd30pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IG5lYXJNYXRjaGVzID0gZmlsdGVyTmVhck1hdGNoZXMobWF0Y2hlcywgbWF0Y2hOZWlnaGJvdXJUaHJlc2hvbGQpO1xuXG4gICAgICAgIGZvciAoY29uc3Qge3gsIHksIHNjb3JlfSBvZiBuZWFyTWF0Y2hlcykge1xuICAgICAgICAgIHJlc3VsdHMucHVzaCh7XG4gICAgICAgICAgICBzY29yZSxcbiAgICAgICAgICAgIHJlY3Q6IHtcbiAgICAgICAgICAgICAgeCxcbiAgICAgICAgICAgICAgeSxcbiAgICAgICAgICAgICAgd2lkdGg6IHBhcnRpYWxJbWcuY29scyxcbiAgICAgICAgICAgICAgaGVpZ2h0OiBwYXJ0aWFsSW1nLnJvd3MsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKG1pbk1heC5tYXhWYWwgPj0gdGhyZXNob2xkKSB7XG4gICAgICAgIGNvbnN0IHt4LCB5fSA9IG1ldGhvZC5pbmNsdWRlcygnU1FESUZGJykgPyBtaW5NYXgubWluTG9jIDogbWluTWF4Lm1heExvYztcbiAgICAgICAgcmVzdWx0cy5wdXNoKHtcbiAgICAgICAgICBzY29yZTogbWluTWF4Lm1heFZhbCxcbiAgICAgICAgICByZWN0OiB7XG4gICAgICAgICAgICB4LFxuICAgICAgICAgICAgeSxcbiAgICAgICAgICAgIHdpZHRoOiBwYXJ0aWFsSW1nLmNvbHMsXG4gICAgICAgICAgICBoZWlnaHQ6IHBhcnRpYWxJbWcucm93cyxcbiAgICAgICAgICB9LFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgaWYgKF8uaXNFbXB0eShyZXN1bHRzKSkge1xuICAgICAgICAvLyBCZWxvdyBlcnJvciBtZXNzYWdlLCBgQ2Fubm90IGZpbmQgYW55IG9jY3VycmVuY2VzYCBpcyByZWZlcmVuY2VkIGluIGZpbmQgYnkgaW1hZ2VcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgIGBNYXRjaCB0aHJlc2hvbGQ6ICR7dGhyZXNob2xkfS4gSGlnaGVzdCBtYXRjaCB2YWx1ZSBgICsgYGZvdW5kIHdhcyAke21pbk1heC5tYXhWYWx9YFxuICAgICAgICApO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIC8vIEJlbG93IGVycm9yIG1lc3NhZ2UsIGBDYW5ub3QgZmluZCBhbnkgb2NjdXJyZW5jZXNgIGlzIHJlZmVyZW5jZWQgaW4gZmluZCBieSBpbWFnZVxuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICBgQ2Fubm90IGZpbmQgYW55IG9jY3VycmVuY2VzIG9mIHRoZSBwYXJ0aWFsIGltYWdlIGluIHRoZSBmdWxsIGltYWdlLiBgICtcbiAgICAgICAgICBgT3JpZ2luYWwgZXJyb3I6ICR7ZS5tZXNzYWdlfWBcbiAgICAgICk7XG4gICAgfVxuXG4gICAgaWYgKHZpc3VhbGl6ZSkge1xuICAgICAgY29uc3QgZnVsbEhpZ2hsaWdodGVkSW1hZ2UgPSBmdWxsSW1nLmNsb25lKCk7XG5cbiAgICAgIGZvciAoY29uc3QgcmVzdWx0IG9mIHJlc3VsdHMpIHtcbiAgICAgICAgY29uc3Qgc2luZ2xlSGlnaGxpZ2h0ZWRJbWFnZSA9IGZ1bGxJbWcuY2xvbmUoKTtcblxuICAgICAgICBoaWdobGlnaHRSZWdpb24oc2luZ2xlSGlnaGxpZ2h0ZWRJbWFnZSwgcmVzdWx0LnJlY3QpO1xuICAgICAgICBoaWdobGlnaHRSZWdpb24oZnVsbEhpZ2hsaWdodGVkSW1hZ2UsIHJlc3VsdC5yZWN0KTtcbiAgICAgICAgcmVzdWx0LnZpc3VhbGl6YXRpb24gPSBhd2FpdCBqaW1wSW1nRnJvbUN2TWF0KHNpbmdsZUhpZ2hsaWdodGVkSW1hZ2UpLmdldEJ1ZmZlckFzeW5jKFxuICAgICAgICAgIEppbXAuTUlNRV9QTkdcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIHZpc3VhbGl6YXRpb24gPSBhd2FpdCBqaW1wSW1nRnJvbUN2TWF0KGZ1bGxIaWdobGlnaHRlZEltYWdlKS5nZXRCdWZmZXJBc3luYyhKaW1wLk1JTUVfUE5HKTtcbiAgICB9XG4gICAgcmV0dXJuIHtcbiAgICAgIHJlY3Q6IHJlc3VsdHNbMF0ucmVjdCxcbiAgICAgIHNjb3JlOiByZXN1bHRzWzBdLnNjb3JlLFxuICAgICAgdmlzdWFsaXphdGlvbixcbiAgICAgIG11bHRpcGxlOiByZXN1bHRzLFxuICAgIH07XG4gIH0gZmluYWxseSB7XG4gICAgdHJ5IHtcbiAgICAgIGZ1bGxJbWcuZGVsZXRlKCk7XG4gICAgICBwYXJ0aWFsSW1nLmRlbGV0ZSgpO1xuICAgICAgbWF0Y2hlZC5kZWxldGUoKTtcbiAgICB9IGNhdGNoIChpZ24pIHt9XG4gIH1cbn1cblxuLyoqXG4gKiBDb252ZXJ0IGFuIG9wZW5jdiBpbWFnZSBtYXRyaXggaW50byBhIEppbXAgaW1hZ2Ugb2JqZWN0XG4gKlxuICogQHBhcmFtIHtjdi5NYXR9IG1hdCB0aGUgaW1hZ2UgbWF0cml4XG4gKiBAcmV0dXJuIHtKaW1wfSB0aGUgSmltcCBpbWFnZVxuICovXG5mdW5jdGlvbiBqaW1wSW1nRnJvbUN2TWF0KG1hdCkge1xuICByZXR1cm4gbmV3IEppbXAoe1xuICAgIHdpZHRoOiBtYXQuY29scyxcbiAgICBoZWlnaHQ6IG1hdC5yb3dzLFxuICAgIGRhdGE6IEJ1ZmZlci5mcm9tKG1hdC5kYXRhKSxcbiAgfSk7XG59XG5cbi8qKlxuICogVGFrZSBhIGJpbmFyeSBpbWFnZSBidWZmZXIgYW5kIHJldHVybiBhIGN2Lk1hdFxuICpcbiAqIEBwYXJhbSB7QnVmZmVyfSBpbWcgdGhlIGltYWdlIGRhdGEgYnVmZmVyXG4gKiBAcmV0dXJuIHtjdi5NYXR9IHRoZSBvcGVuY3YgbWF0cml4XG4gKi9cbmFzeW5jIGZ1bmN0aW9uIGN2TWF0RnJvbUltYWdlKGltZykge1xuICBjb25zdCBqaW1wSW1nID0gYXdhaXQgSmltcC5yZWFkKGltZyk7XG4gIHJldHVybiBjdi5tYXRGcm9tSW1hZ2VEYXRhKGppbXBJbWcuYml0bWFwKTtcbn1cblxuLyoqXG4gKiBGaWx0ZXIgb3V0IG1hdGNoIHJlc3VsdHMgd2hpY2ggaGF2ZSBhIG1hdGNoZWQgbmVpZ2hib3VyXG4gKlxuICogQHBhcmFtIHtBcnJheTxQb2ludD59IG5vblplcm9NYXRjaFJlc3VsdHMgbWF0cml4IG9mIGltYWdlIG1hdGNoIHJlc3VsdHNcbiAqIEBwYXJhbSB7bnVtYmVyfSBtYXRjaE5laWdoYm91clRocmVzaG9sZCBUaGUgcGl4ZWwgZGlzdGFuY2Ugd2l0aGluIHdoaWNoIHdlXG4gKiBjb25zaWRlciBhbiBlbGVtZW50IGJlaW5nIGEgbmVpZ2hib3VyIG9mIGFuIGV4aXN0aW5nIG1hdGNoXG4gKiBAcmV0dXJuIHtBcnJheTxQb2ludD59IHRoZSBmaWx0ZXJlZCBhcnJheSBvZiBtYXRjaGVkIHBvaW50c1xuICovXG5mdW5jdGlvbiBmaWx0ZXJOZWFyTWF0Y2hlcyhub25aZXJvTWF0Y2hSZXN1bHRzLCBtYXRjaE5laWdoYm91clRocmVzaG9sZCkge1xuICByZXR1cm4gbm9uWmVyb01hdGNoUmVzdWx0cy5yZWR1Y2UoKGFjYywgZWxlbWVudCkgPT4ge1xuICAgIGlmICghYWNjLnNvbWUoKG1hdGNoKSA9PiBkaXN0YW5jZShtYXRjaCwgZWxlbWVudCkgPD0gbWF0Y2hOZWlnaGJvdXJUaHJlc2hvbGQpKSB7XG4gICAgICBhY2MucHVzaChlbGVtZW50KTtcbiAgICB9XG4gICAgcmV0dXJuIGFjYztcbiAgfSwgW10pO1xufVxuXG4vKipcbiAqIEZpbmQgdGhlIGRpc3RhbmNlIGJldHdlZW4gdHdvIHBvaW50c1xuICpcbiAqIEBwYXJhbSB7UG9pbnR9IHBvaW50MSBUaGUgZmlyc3QgcG9pbnRcbiAqIEBwYXJhbSB7UG9pbnR9IHBvaW50MiBUaGUgc2Vjb25kIHBvaW50XG4gKiBAcmV0dXJuIHtudW1iZXJ9IHRoZSBkaXN0YW5jZVxuICovXG5mdW5jdGlvbiBkaXN0YW5jZShwb2ludDEsIHBvaW50Mikge1xuICBjb25zdCBhMiA9IE1hdGgucG93KHBvaW50MS54IC0gcG9pbnQyLngsIDIpO1xuICBjb25zdCBiMiA9IE1hdGgucG93KHBvaW50MS55IC0gcG9pbnQyLnksIDIpO1xuICByZXR1cm4gTWF0aC5zcXJ0KGEyICsgYjIpO1xufVxuXG5leHBvcnQge2dldEltYWdlc01hdGNoZXMsIGdldEltYWdlc1NpbWlsYXJpdHksIGdldEltYWdlT2NjdXJyZW5jZSwgaW5pdE9wZW5Ddn07XG5cbi8qKlxuICogQHR5cGVkZWYgT3BlbkNWQmluZGluZ3NcbiAqIEBwcm9wZXJ0eSB7YW55fSBNYXRcbiAqIEBwcm9wZXJ0eSB7YW55fSBLZXlQb2ludFZlY3RvclxuICogQHByb3BlcnR5IHthbnl9IEZlYXR1cmVEZXRlY3RvclxuICovXG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7OztBQUFBOztBQUNBOztBQUNBOztBQUNBOzs7O0FBR0EsSUFBSUEsRUFBSjtBQXdCQSxNQUFNQyx1QkFBdUIsR0FBRyxHQUFoQztBQUNBLE1BQU1DLHlCQUF5QixHQUFHLEVBQWxDO0FBRUEsTUFBTUMsbUJBQW1CLEdBQUc7RUFDMUJDLEtBQUssRUFBRSxPQURtQjtFQUUxQkMsS0FBSyxFQUFFLHNCQUZtQjtFQUcxQkMsS0FBSyxFQUFFLE9BSG1CO0VBSTFCQyxJQUFJLEVBQUUscUJBSm9CO0VBSzFCQyxJQUFJLEVBQUUsY0FMb0I7RUFNMUJDLElBQUksRUFBRSxNQU5vQjtFQU8xQkMsSUFBSSxFQUFFLE1BUG9CO0VBUTFCQyxHQUFHLEVBQUU7QUFScUIsQ0FBNUI7QUFXQSxNQUFNQyw0QkFBNEIsR0FBRztFQUNuQ0MsVUFBVSxFQUFFLFlBRHVCO0VBRW5DQyxVQUFVLEVBQUUsWUFGdUI7RUFHbkNDLFlBQVksRUFBRSxlQUhxQjtFQUluQ0MsaUJBQWlCLEVBQUUsb0JBSmdCO0VBS25D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