"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.ExecuteDriverPlugin = void 0;

require("source-map-support/register");

var _plugin = require("appium/plugin");

var _lodash = _interopRequireDefault(require("lodash"));

var _child_process = _interopRequireDefault(require("child_process"));

var _support = require("appium/support");

var _bluebird = _interopRequireDefault(require("bluebird"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const FEAT_FLAG = 'execute_driver_script';
const DEFAULT_SCRIPT_TIMEOUT_MS = 1000 * 60 * 60;
const SCRIPT_TYPE_WDIO = 'webdriverio';

class ExecuteDriverPlugin extends _plugin.BasePlugin {
  static newMethodMap = {
    '/session/:sessionId/appium/execute_driver': {
      POST: {
        command: 'executeDriverScript',
        payloadParams: {
          required: ['script'],
          optional: ['type', 'timeout']
        }
      }
    }
  };

  async executeDriverScript(next, driver, script, scriptType = 'webdriverio', timeoutMs = DEFAULT_SCRIPT_TIMEOUT_MS) {
    if (!driver.isFeatureEnabled(FEAT_FLAG)) {
      throw new Error(`Execute driver script functionality is not available ` + `unless server is started with --allow-insecure including ` + `the '${FEAT_FLAG}' flag, e.g., --allow-insecure=${FEAT_FLAG}`);
    }

    if (scriptType !== SCRIPT_TYPE_WDIO) {
      throw new TypeError(`Only the '${SCRIPT_TYPE_WDIO}' script type is currently supported`);
    }

    if (!driver.serverHost || !driver.serverPort) {
      throw new Error('Address or port of running server were not defined; this ' + 'is required. This is probably a programming error in the driver');
    }

    if (!_lodash.default.isNumber(timeoutMs)) {
      throw new TypeError('Timeout parameter must be a number');
    }

    const driverOpts = {
      sessionId: driver.sessionId,
      protocol: 'http',
      hostname: driver.serverHost,
      port: driver.serverPort,
      path: driver.serverPath,
      isW3C: true,
      isMobile: true,
      capabilities: driver.caps
    };
    this.logger.info(`Constructed webdriverio driver options; W3C mode is ${driverOpts.isW3C ? 'on' : 'off'}`);

    const childScript = require.resolve('./execute-child.js');

    this.logger.info(`Forking process to run webdriver script as child using ${childScript}`);

    const scriptProc = _child_process.default.fork(childScript);

    let timeoutCanceled = false;

    try {
      const timer = new _support.timing.Timer();
      timer.start();

      const waitForResult = async () => {
        const res = await new _bluebird.default(res => {
          scriptProc.on('message', res);
        });
        this.logger.info('Received execute driver script result from child process, shutting it down');

        if (res.error) {
          throw new Error(res.error.message);
        }

        return res.success;
      };

      const waitForTimeout = async () => {
        while (!timeoutCanceled && timer.getDuration().asMilliSeconds < timeoutMs) {
          await _bluebird.default.delay(500);
        }

        if (timeoutCanceled) {
          return;
        }

        throw new Error(`Execute driver script timed out after ${timeoutMs}ms. ` + `You can adjust this with the 'timeout' parameter.`);
      };

      this.logger.info('Sending driver and script data to child');
      scriptProc.send({
        driverOpts,
        script,
        timeoutMs
      });
      return await _bluebird.default.race([waitForResult(), waitForTimeout()]);
    } catch (err) {
      throw new Error(`Could not execute driver script. Original error was: ${err}`);
    } finally {
      timeoutCanceled = true;

      if (scriptProc.connected) {
        this.logger.info('Disconnecting from child proc');
        scriptProc.disconnect();
      }

      if (scriptProc.exitCode === null) {
        this.logger.info('Disconnecting from and killing driver script child proc');
        scriptProc.kill();
      } else {
        this.logger.info('Script already ended on its own, no need to kill it');
      }
    }
  }

}

exports.ExecuteDriverPlugin = exports.default = ExecuteDriverPlugin;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJGRUFUX0ZMQUciLCJERUZBVUxUX1NDUklQVF9USU1FT1VUX01TIiwiU0NSSVBUX1RZUEVfV0RJTyIsIkV4ZWN1dGVEcml2ZXJQbHVnaW4iLCJCYXNlUGx1Z2luIiwibmV3TWV0aG9kTWFwIiwiUE9TVCIsImNvbW1hbmQiLCJwYXlsb2FkUGFyYW1zIiwicmVxdWlyZWQiLCJvcHRpb25hbCIsImV4ZWN1dGVEcml2ZXJTY3JpcHQiLCJuZXh0IiwiZHJpdmVyIiwic2NyaXB0Iiwic2NyaXB0VHlwZSIsInRpbWVvdXRNcyIsImlzRmVhdHVyZUVuYWJsZWQiLCJFcnJvciIsIlR5cGVFcnJvciIsInNlcnZlckhvc3QiLCJzZXJ2ZXJQb3J0IiwiXyIsImlzTnVtYmVyIiwiZHJpdmVyT3B0cyIsInNlc3Npb25JZCIsInByb3RvY29sIiwiaG9zdG5hbWUiLCJwb3J0IiwicGF0aCIsInNlcnZlclBhdGgiLCJpc1czQyIsImlzTW9iaWxlIiwiY2FwYWJpbGl0aWVzIiwiY2FwcyIsImxvZ2dlciIsImluZm8iLCJjaGlsZFNjcmlwdCIsInJlcXVpcmUiLCJyZXNvbHZlIiwic2NyaXB0UHJvYyIsImNwIiwiZm9yayIsInRpbWVvdXRDYW5jZWxlZCIsInRpbWVyIiwidGltaW5nIiwiVGltZXIiLCJzdGFydCIsIndhaXRGb3JSZXN1bHQiLCJyZXMiLCJCIiwib24iLCJlcnJvciIsIm1lc3NhZ2UiLCJzdWNjZXNzIiwid2FpdEZvclRpbWVvdXQiLCJnZXREdXJhdGlvbiIsImFzTWlsbGlTZWNvbmRzIiwiZGVsYXkiLCJzZW5kIiwicmFjZSIsImVyciIsImNvbm5lY3RlZCIsImRpc2Nvbm5lY3QiLCJleGl0Q29kZSIsImtpbGwiXSwic291cmNlcyI6WyIuLi8uLi9saWIvcGx1Z2luLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7QmFzZVBsdWdpbn0gZnJvbSAnYXBwaXVtL3BsdWdpbic7XG5pbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IGNwIGZyb20gJ2NoaWxkX3Byb2Nlc3MnO1xuaW1wb3J0IHt0aW1pbmd9IGZyb20gJ2FwcGl1bS9zdXBwb3J0JztcbmltcG9ydCBCIGZyb20gJ2JsdWViaXJkJztcblxuY29uc3QgRkVBVF9GTEFHID0gJ2V4ZWN1dGVfZHJpdmVyX3NjcmlwdCc7XG5jb25zdCBERUZBVUxUX1NDUklQVF9USU1FT1VUX01TID0gMTAwMCAqIDYwICogNjA7IC8vIGRlZmF1bHQgdG8gMSBob3VyIHRpbWVvdXRcbmNvbnN0IFNDUklQVF9UWVBFX1dESU8gPSAnd2ViZHJpdmVyaW8nO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBFeGVjdXRlRHJpdmVyUGx1Z2luIGV4dGVuZHMgQmFzZVBsdWdpbiB7XG4gIHN0YXRpYyBuZXdNZXRob2RNYXAgPSB7XG4gICAgJy9zZXNzaW9uLzpzZXNzaW9uSWQvYXBwaXVtL2V4ZWN1dGVfZHJpdmVyJzoge1xuICAgICAgUE9TVDoge1xuICAgICAgICBjb21tYW5kOiAnZXhlY3V0ZURyaXZlclNjcmlwdCcsXG4gICAgICAgIHBheWxvYWRQYXJhbXM6IHtyZXF1aXJlZDogWydzY3JpcHQnXSwgb3B0aW9uYWw6IFsndHlwZScsICd0aW1lb3V0J119LFxuICAgICAgfSxcbiAgICB9LFxuICB9O1xuXG4gIC8qKlxuICAgKiBUaGlzIG1ldGhvZCB0YWtlcyBhIHN0cmluZyB3aGljaCBpcyBleGVjdXRlZCBhcyBqYXZhc2NyaXB0IGluIHRoZSBjb250ZXh0IG9mXG4gICAqIGEgbmV3IG5vZGVqcyBWTSwgYW5kIHdoaWNoIGhhcyBhdmFpbGFibGUgYSB3ZWJkcml2ZXJpbyBkcml2ZXIgb2JqZWN0LCBoYXZpbmdcbiAgICogYWxyZWFkeSBiZWVuIGF0dGFjaGVkIHRvIHRoZSBjdXJyZW50bHkgcnVubmluZyBzZXNzaW9uLlxuICAgKlxuICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBuZXh0IC0gc3RhbmRhcmQgYmVoYXZpb3VyIGZvciBleGVjdXRlRHJpdmVyU2NyaXB0XG4gICAqIEBwYXJhbSB7QmFzZURyaXZlcn0gZHJpdmVyIC0gQXBwaXVtIGRyaXZlciBoYW5kbGluZyB0aGlzIGNvbW1hbmRcbiAgICogQHBhcmFtIHtzdHJpbmd9IHNjcmlwdCAtIHRoZSBzdHJpbmcgcmVwcmVzZW50aW5nIHRoZSBkcml2ZXIgc2NyaXB0IHRvIHJ1blxuICAgKiBAcGFyYW0ge3N0cmluZ30gW3NjcmlwdFR5cGU9J3dlYmRyaXZlcmlvJ10gLSB0aGUgbmFtZSBvZiB0aGUgZHJpdmVyIHNjcmlwdFxuICAgKiBsaWJyYXJ5IChjdXJyZW50bHkgb25seSB3ZWJkcml2ZXJpbyBpcyBzdXBwb3J0ZWQpXG4gICAqIEBwYXJhbSB7bnVtYmVyfSBbdGltZW91dE1zPTM2MDAwMDBdIC0gdGltZW91dCBmb3IgdGhlIHNjcmlwdCBwcm9jZXNzXG4gICAqXG4gICAqIEByZXR1cm5zIHtPYmplY3R9IC0gYSBKU09OaWZpYWJsZSBvYmplY3QgcmVwcmVzZW50aW5nIHRoZSByZXR1cm4gdmFsdWUgb2ZcbiAgICogdGhlIHNjcmlwdFxuICAgKi9cbiAgYXN5bmMgZXhlY3V0ZURyaXZlclNjcmlwdChcbiAgICBuZXh0LFxuICAgIGRyaXZlcixcbiAgICBzY3JpcHQsXG4gICAgc2NyaXB0VHlwZSA9ICd3ZWJkcml2ZXJpbycsXG4gICAgdGltZW91dE1zID0gREVGQVVMVF9TQ1JJUFRfVElNRU9VVF9NU1xuICApIHtcbiAgICBpZiAoIWRyaXZlci5pc0ZlYXR1cmVFbmFibGVkKEZFQVRfRkxBRykpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgYEV4ZWN1dGUgZHJpdmVyIHNjcmlwdCBmdW5jdGlvbmFsaXR5IGlzIG5vdCBhdmFpbGFibGUgYCArXG4gICAgICAgICAgYHVubGVzcyBzZXJ2ZXIgaXMgc3RhcnRlZCB3aXRoIC0tYWxsb3ctaW5zZWN1cmUgaW5jbHVkaW5nIGAgK1xuICAgICAgICAgIGB0aGUgJyR7RkVBVF9GTEFHfScgZmxhZywgZS5nLiwgLS1hbGxvdy1pbnNlY3VyZT0ke0ZFQVRfRkxBR31gXG4gICAgICApO1xuICAgIH1cblxuICAgIGlmIChzY3JpcHRUeXBlICE9PSBTQ1JJUFRfVFlQRV9XRElPKSB7XG4gICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKGBPbmx5IHRoZSAnJHtTQ1JJUFRfVFlQRV9XRElPfScgc2NyaXB0IHR5cGUgaXMgY3VycmVudGx5IHN1cHBvcnRlZGApO1xuICAgIH1cblxuICAgIGlmICghZHJpdmVyLnNlcnZlckhvc3QgfHwgIWRyaXZlci5zZXJ2ZXJQb3J0KSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICdBZGRyZXNzIG9yIHBvcnQgb2YgcnVubmluZyBzZXJ2ZXIgd2VyZSBub3QgZGVmaW5lZDsgdGhpcyAnICtcbiAgICAgICAgICAnaXMgcmVxdWlyZWQuIFRoaXMgaXMgcHJvYmFibHkgYSBwcm9ncmFtbWluZyBlcnJvciBpbiB0aGUgZHJpdmVyJ1xuICAgICAgKTtcbiAgICB9XG5cbiAgICBpZiAoIV8uaXNOdW1iZXIodGltZW91dE1zKSkge1xuICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignVGltZW91dCBwYXJhbWV0ZXIgbXVzdCBiZSBhIG51bWJlcicpO1xuICAgIH1cblxuICAgIGNvbnN0IGRyaXZlck9wdHMgPSB7XG4gICAgICBzZXNzaW9uSWQ6IGRyaXZlci5zZXNzaW9uSWQsXG4gICAgICAvLyBBcHBpdW0gcHJvYmFibHkgd29uJ3QgYmUgYmVoaW5kIHNzbCBsb2NhbGx5OyBpZiBpdCBldmVyIGlzLCBtaWdodCBuZWVkIHRvIHVwZGF0ZSB0aGlzIHRvXG4gICAgICAvLyBwcm92aWRlIGEgdXNlciBjb25maWd1cmFibGUgcGFyYW1ldGVyXG4gICAgICBwcm90b2NvbDogJ2h0dHAnLFxuICAgICAgaG9zdG5hbWU6IGRyaXZlci5zZXJ2ZXJIb3N0LFxuICAgICAgcG9ydDogZHJpdmVyLnNlcnZlclBvcnQsXG4gICAgICBwYXRoOiBkcml2ZXIuc2VydmVyUGF0aCxcbiAgICAgIGlzVzNDOiB0cnVlLFxuICAgICAgaXNNb2JpbGU6IHRydWUsXG4gICAgICBjYXBhYmlsaXRpZXM6IGRyaXZlci5jYXBzLFxuICAgIH07XG4gICAgdGhpcy5sb2dnZXIuaW5mbyhcbiAgICAgIGBDb25zdHJ1Y3RlZCB3ZWJkcml2ZXJpbyBkcml2ZXIgb3B0aW9uczsgVzNDIG1vZGUgaXMgJHtkcml2ZXJPcHRzLmlzVzNDID8gJ29uJyA6ICdvZmYnfWBcbiAgICApO1xuXG4gICAgLy8gZm9yayB0aGUgZXhlY3V0aW9uIHNjcmlwdCBhcyBhIGNoaWxkIHByb2Nlc3NcbiAgICBjb25zdCBjaGlsZFNjcmlwdCA9IHJlcXVpcmUucmVzb2x2ZSgnLi9leGVjdXRlLWNoaWxkLmpzJyk7XG4gICAgdGhpcy5sb2dnZXIuaW5mbyhgRm9ya2luZyBwcm9jZXNzIHRvIHJ1biB3ZWJkcml2ZXIgc2NyaXB0IGFzIGNoaWxkIHVzaW5nICR7Y2hpbGRTY3JpcHR9YCk7XG4gICAgY29uc3Qgc2NyaXB0UHJvYyA9IGNwLmZvcmsoY2hpbGRTY3JpcHQpO1xuXG4gICAgLy8ga2VlcCB0cmFjayBvZiB3aGV0aGVyIHdlIGhhdmUgY2FuY2VsZWQgdGhlIHNjcmlwdCB0aW1lb3V0LCBzbyB3ZSBjYW4gc3RvcFxuICAgIC8vIHdhaXRpbmcgZm9yIGl0IGFuZCBhbGxvdyB0aGlzIHByb2Nlc3MgdG8gZmluaXNoIGdyYWNlZnVsbHlcbiAgICBsZXQgdGltZW91dENhbmNlbGVkID0gZmFsc2U7XG5cbiAgICB0cnkge1xuICAgICAgY29uc3QgdGltZXIgPSBuZXcgdGltaW5nLlRpbWVyKCk7XG4gICAgICB0aW1lci5zdGFydCgpO1xuXG4gICAgICAvLyBwcm9taXNlIHRoYXQgZGVhbHMgd2l0aCB0aGUgcmVzdWx0IGZyb20gdGhlIGNoaWxkIHByb2Nlc3NcbiAgICAgIGNvbnN0IHdhaXRGb3JSZXN1bHQgPSBhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IG5ldyBCKChyZXMpID0+IHtcbiAgICAgICAgICBzY3JpcHRQcm9jLm9uKCdtZXNzYWdlJywgcmVzKTsgLy8gdGhpcyBpcyBub2RlIElQQ1xuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLmxvZ2dlci5pbmZvKFxuICAgICAgICAgICdSZWNlaXZlZCBleGVjdXRlIGRyaXZlciBzY3JpcHQgcmVzdWx0IGZyb20gY2hpbGQgcHJvY2Vzcywgc2h1dHRpbmcgaXQgZG93bidcbiAgICAgICAgKTtcblxuICAgICAgICBpZiAocmVzLmVycm9yKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKHJlcy5lcnJvci5tZXNzYWdlKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiByZXMuc3VjY2VzcztcbiAgICAgIH07XG5cbiAgICAgIC8vIHByb21pc2UgdGhhdCB3YWl0cyB1cCB0byB0aGUgdGltZW91dCBhbmQgdGhyb3dzIGFuIGVycm9yIGlmIHNvLCBvciBkb2VzXG4gICAgICAvLyBub3RoaW5nIGlmIHRoZSB0aW1lb3V0IGlzIGNhbmNlbGVkIGJlY2F1c2Ugd2UgZ290IGEgcmVzdWx0IGZyb20gdGhlXG4gICAgICAvLyBjaGlsZCBzY3JpcHRcbiAgICAgIGNvbnN0IHdhaXRGb3JUaW1lb3V0ID0gYXN5bmMgKCkgPT4ge1xuICAgICAgICB3aGlsZSAoIXRpbWVvdXRDYW5jZWxlZCAmJiB0aW1lci5nZXREdXJhdGlvbigpLmFzTWlsbGlTZWNvbmRzIDwgdGltZW91dE1zKSB7XG4gICAgICAgICAgYXdhaXQgQi5kZWxheSg1MDApO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRpbWVvdXRDYW5jZWxlZCkge1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICBgRXhlY3V0ZSBkcml2ZXIgc2NyaXB0IHRpbWVkIG91dCBhZnRlciAke3RpbWVvdXRNc31tcy4gYCArXG4gICAgICAgICAgICBgWW91IGNhbiBhZGp1c3QgdGhpcyB3aXRoIHRoZSAndGltZW91dCcgcGFyYW1ldGVyLmBcbiAgICAgICAgKTtcbiAgICAgIH07XG5cbiAgICAgIC8vIG5vdyB0aGF0IHRoZSBjaGlsZCBzY3JpcHQgaXMgYWxpdmUsIHNlbmQgaXQgdGhlIGRhdGEgaXQgbmVlZHMgdG8gc3RhcnRcbiAgICAgIC8vIHJ1bm5pbmcgdGhlIGRyaXZlciBzY3JpcHRcbiAgICAgIHRoaXMubG9nZ2VyLmluZm8oJ1NlbmRpbmcgZHJpdmVyIGFuZCBzY3JpcHQgZGF0YSB0byBjaGlsZCcpO1xuICAgICAgc2NyaXB0UHJvYy5zZW5kKHtkcml2ZXJPcHRzLCBzY3JpcHQsIHRpbWVvdXRNc30pO1xuXG4gICAgICAvLyBhbmQgc2V0IHVwIGEgcmFjZSBiZXR3ZWVuIHRoZSByZXNwb25zZSBmcm9tIHRoZSBjaGlsZCBhbmQgdGhlIHRpbWVvdXRcbiAgICAgIHJldHVybiBhd2FpdCBCLnJhY2UoW3dhaXRGb3JSZXN1bHQoKSwgd2FpdEZvclRpbWVvdXQoKV0pO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBDb3VsZCBub3QgZXhlY3V0ZSBkcml2ZXIgc2NyaXB0LiBPcmlnaW5hbCBlcnJvciB3YXM6ICR7ZXJyfWApO1xuICAgIH0gZmluYWxseSB7XG4gICAgICAvLyBlbnN1cmUgd2UgYWx3YXlzIGNhbmNlbCB0aGUgdGltZW91dCBzbyB0aGF0IHRoZSB0aW1lb3V0IHByb21pc2Ugc3RvcHNcbiAgICAgIC8vIHNwaW5uaW5nIGFuZCBhbGxvd3MgdGhpcyBwcm9jZXNzIHRvIGRpZSBncmFjZWZ1bGx5XG4gICAgICB0aW1lb3V0Q2FuY2VsZWQgPSB0cnVlO1xuXG4gICAgICBpZiAoc2NyaXB0UHJvYy5jb25uZWN0ZWQpIHtcbiAgICAgICAgdGhpcy5sb2dnZXIuaW5mbygnRGlzY29ubmVjdGluZyBmcm9tIGNoaWxkIHByb2MnKTtcbiAgICAgICAgc2NyaXB0UHJvYy5kaXNjb25uZWN0KCk7XG4gICAgICB9XG5cbiAgICAgIGlmIChzY3JpcHRQcm9jLmV4aXRDb2RlID09PSBudWxsKSB7XG4gICAgICAgIHRoaXMubG9nZ2VyLmluZm8oJ0Rpc2Nvbm5lY3RpbmcgZnJvbSBhbmQga2lsbGluZyBkcml2ZXIgc2NyaXB0IGNoaWxkIHByb2MnKTtcbiAgICAgICAgc2NyaXB0UHJvYy5raWxsKCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLmxvZ2dlci5pbmZvKCdTY3JpcHQgYWxyZWFkeSBlbmRlZCBvbiBpdHMgb3duLCBubyBuZWVkIHRvIGtpbGwgaXQnKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbn1cblxuZXhwb3J0IHtFeGVjdXRlRHJpdmVyUGx1Z2lufTtcbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7Ozs7QUFFQSxNQUFNQSxTQUFTLEdBQUcsdUJBQWxCO0FBQ0EsTUFBTUMseUJBQXlCLEdBQUcsT0FBTyxFQUFQLEdBQVksRUFBOUM7QUFDQSxNQUFNQyxnQkFBZ0IsR0FBRyxhQUF6Qjs7QUFFZSxNQUFNQyxtQkFBTixTQUFrQ0Msa0JBQWxDLENBQTZDO0VBQ3ZDLE9BQVpDLFlBQVksR0FBRztJQUNwQiw2Q0FBNkM7TUFDM0NDLElBQUksRUFBRTtRQUNKQyxPQUFPLEVBQUUscUJBREw7UUFFSkMsYUFBYSxFQUFFO1VBQUNDLFFBQVEsRUFBRSxDQUFDLFFBQUQsQ0FBWDtVQUF1QkMsUUFBUSxFQUFFLENBQUMsTUFBRCxFQUFTLFNBQVQ7UUFBakM7TUFGWDtJQURxQztFQUR6QixDQUFIOztFQXdCTSxNQUFuQkMsbUJBQW1CLENBQ3ZCQyxJQUR1QixFQUV2QkMsTUFGdUIsRUFHdkJDLE1BSHVCLEVBSXZCQyxVQUFVLEdBQUcsYUFKVSxFQUt2QkMsU0FBUyxHQUFHZix5QkFMVyxFQU12QjtJQUNBLElBQUksQ0FBQ1ksTUFBTSxDQUFDSSxnQkFBUCxDQUF3QmpCLFNBQXhCLENBQUwsRUFBeUM7TUFDdkMsTUFBTSxJQUFJa0IsS0FBSixDQUNILHVEQUFELEdBQ0csMkRBREgsR0FFRyxRQUFPbEIsU0FBVSxrQ0FBaUNBLFNBQVUsRUFIM0QsQ0FBTjtJQUtEOztJQUVELElBQUllLFVBQVUsS0FBS2IsZ0JBQW5CLEVBQXFDO01BQ25DLE1BQU0sSUFBSWlCLFNB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