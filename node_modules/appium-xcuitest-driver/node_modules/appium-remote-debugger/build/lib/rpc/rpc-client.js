"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
require("source-map-support/register");
var _remoteMessages = _interopRequireDefault(require("./remote-messages"));
var _asyncbox = require("asyncbox");
var _logger = _interopRequireDefault(require("../logger"));
var _lodash = _interopRequireDefault(require("lodash"));
var _bluebird = _interopRequireDefault(require("bluebird"));
var _rpcMessageHandler = _interopRequireDefault(require("./rpc-message-handler"));
var _support = require("appium/support");
const DATA_LOG_LENGTH = {
  length: 200
};
const WAIT_FOR_TARGET_TIMEOUT = 10000;
const WAIT_FOR_TARGET_INTERVAL = 1000;
const MIN_PLATFORM_FOR_TARGET_BASED = '12.2';

const MIN_PLATFORM_NO_TARGET_EXISTS = '13.4';
function isTargetBased(isSafari, platformVersion) {
  const isHighVersion = _support.util.compareVersions(platformVersion, '>=', MIN_PLATFORM_FOR_TARGET_BASED);
  _logger.default.debug(`Checking which communication style to use (${isSafari ? '' : 'non-'}Safari on platform version '${platformVersion}')`);
  _logger.default.debug(`Platform version equal or higher than '${MIN_PLATFORM_FOR_TARGET_BASED}': ${isHighVersion}`);
  return isHighVersion;
}
class RpcClient {
  constructor(opts = {}) {
    this._targets = [];
    this._shouldCheckForTarget = !!opts.shouldCheckForTarget;
    const {
      bundleId,
      platformVersion = {},
      isSafari = true,
      logAllCommunication = false,
      logAllCommunicationHexDump = false,
      webInspectorMaxFrameLength,
      socketChunkSize,
      fullPageInitialization = false
    } = opts;
    this.isSafari = isSafari;
    this.isConnected = false;
    this.connId = _support.util.uuidV4();
    this.senderId = _support.util.uuidV4();
    this.msgId = 0;
    this.logAllCommunication = logAllCommunication;
    this.logAllCommunicationHexDump = logAllCommunicationHexDump;
    this.socketChunkSize = socketChunkSize;
    this.webInspectorMaxFrameLength = webInspectorMaxFrameLength;
    this.fullPageInitialization = fullPageInitialization;
    this.bundleId = bundleId;
    this.platformVersion = platformVersion;
    this._contexts = [];
    this._targets = {};

    this.isTargetBased = isTargetBased(isSafari, this.platformVersion);
  }
  get contexts() {
    return this._contexts;
  }
  get needsTarget() {
    return this.shouldCheckForTarget && this.isTargetBased;
  }
  get targets() {
    return this._targets;
  }
  get shouldCheckForTarget() {
    return this._shouldCheckForTarget;
  }
  set shouldCheckForTarget(shouldCheckForTarget) {
    this._shouldCheckForTarget = !!shouldCheckForTarget;
  }
  get isConnected() {
    return this.connected;
  }
  set isConnected(connected) {
    this.connected = !!connected;
  }
  on(event, listener) {
    this.messageHandler.on(event, listener);
    return this;
  }
  once(event, listener) {
    this.messageHandler.once(event, listener);
    return this;
  }
  off(event, listener) {
    this.messageHandler.off(event, listener);
    return this;
  }
  set isTargetBased(isTargetBased) {
    _logger.default.warn(`Setting communication protocol: using ${isTargetBased ? 'Target-based' : 'full Web Inspector protocol'} communication`);
    this._isTargetBased = isTargetBased;
    if (!this.remoteMessages) {
      this.remoteMessages = new _remoteMessages.default(isTargetBased);
    } else {
      this.remoteMessages.isTargetBased = isTargetBased;
    }
    if (!this.messageHandler) {
      this.messageHandler = new _rpcMessageHandler.default(isTargetBased);

      this.messageHandler.on('Target.targetCreated', this.addTarget.bind(this));
      this.messageHandler.on('Target.didCommitProvisionalTarget', this.updateTarget.bind(this));
      this.messageHandler.on('Target.targetDestroyed', this.removeTarget.bind(this));
      this.messageHandler.on('Runtime.executionContextCreated', this.onExecutionContextCreated.bind(this));
      this.messageHandler.on('Heap.garbageCollected', this.onGarbageCollected.bind(this));
    } else {
      this.messageHandler.isTargetBased = isTargetBased;
    }
  }
  get isTargetBased() {
    return this._isTargetBased;
  }
  async waitForTarget(appIdKey, pageIdKey, force = false) {
    if (!force && !this.needsTarget) {
      return;
    }
    if (this.getTarget(appIdKey, pageIdKey)) {
      return;
    }

    try {
      await (0, _asyncbox.waitForCondition)(() => !_lodash.default.isEmpty(this.getTarget(appIdKey, pageIdKey)), {
        waitMs: WAIT_FOR_TARGET_TIMEOUT,
        intervalMs: WAIT_FOR_TARGET_INTERVAL,
        error: 'No targets found, unable to communicate with device'
      });
    } catch (err) {
      if (!err.message.includes('Condition unmet')) {
        throw err;
      }
      throw new Error('No targets found, unable to communicate with device');
    }
  }
  async send(command, opts = {}, waitForResponse = true) {
    const timer = new _support.timing.Timer().start();
    const {
      appIdKey,
      pageIdKey
    } = opts;
    try {
      if (!_lodash.default.isEmpty(appIdKey) && !_lodash.default.isEmpty(pageIdKey)) {
        await this.waitForTarget(appIdKey, pageIdKey);
      }
      return await this.sendToDevice(command, opts, waitForResponse);
    } catch (err) {
      let {
        message = ''
      } = err;
      message = message.toLowerCase();
      if (message.includes(`'target' domain was not found`)) {
        _logger.default.info('The target device does not support Target based communication. ' + 'Will follow non-target based communication.');
        this.isTargetBased = false;
        return await this.sendToDevice(command, opts, waitForResponse);
      } else if (message.includes(`domain was not found`) || message.includes(`some arguments of method`) || message.includes(`missing target`)) {
        this.isTargetBased = true;
        await this.waitForTarget(appIdKey, pageIdKey);
        return await this.sendToDevice(command, opts, waitForResponse);
      }
      throw err;
    } finally {
      _logger.default.debug(`Sending to Web Inspector took ${timer.getDuration().asMilliSeconds.toFixed(0)}ms`);
    }
  }
  async sendToDevice(command, opts = {}, waitForResponse = true) {
    return await new _bluebird.default(async (resolve, reject) => {
      var _cmd$__argument, _cmd$__argument2;

      const msgId = this.msgId++;
      let wrapperMsgId = msgId;
      if (this.isTargetBased) {
        wrapperMsgId = this.msgId++;
        this.messageHandler.on(wrapperMsgId.toString(), function (err) {
          if (err) {
            reject(err);
          }
        });
      }
      const appIdKey = opts.appIdKey;
      const pageIdKey = opts.pageIdKey;
      const targetId = this.getTarget(appIdKey, pageIdKey);

      const fullOpts = _lodash.default.defaults({
        connId: this.connId,
        senderId: this.senderId,
        targetId,
        id: msgId
      }, opts);
      const cmd = this.remoteMessages.getRemoteCommand(command, fullOpts);
      if (cmd !== null && cmd !== void 0 && (_cmd$__argument = cmd.__argument) !== null && _cmd$__argument !== void 0 && _cmd$__argument.WIRSocketDataKey) {
        if (_lodash.default.isNil(cmd.__argument.WIRSocketDataKey.id)) {
          cmd.__argument.WIRSocketDataKey.id = wrapperMsgId;
        }
        cmd.__argument.WIRSocketDataKey = Buffer.from(JSON.stringify(cmd.__argument.WIRSocketDataKey));
      }
      let messageHandled = true;
      if (!waitForResponse) {
        messageHandled = false;
        this.messageHandler.once(msgId.toString(), function (err) {
          if (err) {
            _logger.default.error(`Received error from send that is not being waited for (id: ${msgId}): '${_lodash.default.truncate(JSON.stringify(err), DATA_LOG_LENGTH)}'`);
            reject(err);
          }
        });
      } else if (this.messageHandler.listeners(cmd.__selector).length) {
        this.messageHandler.prependOnceListener(cmd.__selector, function (err, ...args) {
          if (err) {
            return reject(err);
          }
          _logger.default.debug(`Received response from send (id: ${msgId}): '${_lodash.default.truncate(JSON.stringify(args), DATA_LOG_LENGTH)}'`);
          resolve(args);
        });
      } else if (cmd !== null && cmd !== void 0 && (_cmd$__argument2 = cmd.__argument) !== null && _cmd$__argument2 !== void 0 && _cmd$__argument2.WIRSocketDataKey) {
        this.messageHandler.once(msgId.toString(), function (err, value) {
          if (err) {
            return reject(new Error(`Remote debugger error with code '${err.code}': ${err.message}`));
          }
          _logger.default.debug(`Received data response from send (id: ${msgId}): '${_lodash.default.truncate(JSON.stringify(value), DATA_LOG_LENGTH)}'`);
          resolve(value);
        });
      } else {
        messageHandled = false;
      }
      const msg = `Sending '${cmd.__selector}' message` + (fullOpts.appIdKey ? ` to app '${fullOpts.appIdKey}'` : '') + (fullOpts.pageIdKey ? `, page '${fullOpts.pageIdKey}'` : '') + (this.needsTarget && targetId ? `, target '${targetId}'` : '') + ` (id: ${msgId}): '${command}'`;
      _logger.default.debug(msg);
      try {
        const res = await this.sendMessage(cmd);
        if (!messageHandled) {
          resolve(res);
        }
      } catch (err) {
        return reject(err);
      }
    });
  }
  async connect() {
    throw new Error(`Sub-classes need to implement a 'connect' function`);
  }
  async disconnect() {
    this.messageHandler.removeAllListeners();
  }
  async sendMessage(
  ) {
    throw new Error(`Sub-classes need to implement a 'sendMessage' function`);
  }
  async receive(
  ) {
    throw new Error(`Sub-classes need to implement a 'receive' function`);
  }
  addTarget(err, app, targetInfo) {
    if (_lodash.default.isNil(targetInfo === null || targetInfo === void 0 ? void 0 : targetInfo.targetId)) {
      _logger.default.warn(`Received 'Target.targetCreated' event for app '${app}' with no target. Skipping`);
      return;
    }
    if (_lodash.default.isEmpty(this.pendingTargetNotification) && !targetInfo.isProvisional) {
      _logger.default.warn(`Received 'Target.targetCreated' event for app '${app}' with no pending request: ${JSON.stringify(targetInfo)}`);
      return;
    }
    if (targetInfo.isProvisional) {
      _logger.default.debug(`Provisional target created for app '${app}', '${targetInfo.targetId}'. Ignoring until target update event`);
      return;
    }
    const [appIdKey, pageIdKey] = this.pendingTargetNotification;
    _logger.default.debug(`Target created for app '${appIdKey}' and page '${pageIdKey}': ${JSON.stringify(targetInfo)}`);
    if (_lodash.default.has(this.targets[appIdKey], pageIdKey)) {
      _logger.default.debug(`There is already a target for this app and page ('${this.targets[appIdKey][pageIdKey]}'). This might cause problems`);
    }
    this.targets[app] = this.targets[app] || {};
    this.targets[appIdKey][pageIdKey] = targetInfo.targetId;
  }
  updateTarget(err, app, oldTargetId, newTargetId) {
    _logger.default.debug(`Target updated for app '${app}'. Old target: '${oldTargetId}', new target: '${newTargetId}'`);
    if (!this.targets[app]) {
      _logger.default.warn(`No existing target for app '${app}'. Not sure what to do`);
      return;
    }
    this.targets[app].provisional = {
      oldTargetId,
      newTargetId
    };
  }
  removeTarget(err, app, targetInfo) {
    var _this$targets$app, _this$targets$app$pro;
    if (_lodash.default.isNil(targetInfo === null || targetInfo === void 0 ? void 0 : targetInfo.targetId)) {
      _logger.default.debug(`Received 'Target.targetDestroyed' event with no target. Skipping`);
      return;
    }
    _logger.default.debug(`Target destroyed for app '${app}': ${targetInfo.targetId}`);

    if (((_this$targets$app = this.targets[app]) === null || _this$targets$app === void 0 ? void 0 : (_this$targets$app$pro = _this$targets$app.provisional) === null || _this$targets$app$pro === void 0 ? void 0 : _this$targets$app$pro.oldTargetId) === targetInfo.targetId) {
      const {
        oldTargetId,
        newTargetId
      } = this.targets[app].provisional;
      delete this.targets[app].provisional;

      const targets = this.targets[app];
      for (const [page, targetId] of _lodash.default.toPairs(targets)) {
        if (targetId === oldTargetId) {
          _logger.default.debug(`Found provisional target for app '${app}'. Old target: '${oldTargetId}', new target: '${newTargetId}'. Updating`);
          targets[page] = newTargetId;
          return;
        }
      }
      _logger.default.warn(`Provisional target for app '${app}' found, but no suitable existing target found. This may cause problems`);
      _logger.default.warn(`Old target: '${oldTargetId}', new target: '${newTargetId}'. Existing targets: ${JSON.stringify(targets)}`);
    }

    const targets = this.targets[app];
    for (const [page, targetId] of _lodash.default.toPairs(targets)) {
      if (targetId === targetInfo.targetId) {
        delete targets[page];
        return;
      }
    }
    _logger.default.debug(`Target '${targetInfo.targetId}' deleted for app '${app}', but no such target exists`);
  }
  getTarget(appIdKey, pageIdKey) {
    return (this.targets[appIdKey] || {})[pageIdKey];
  }
  async selectPage(appIdKey, pageIdKey) {
    this.pendingTargetNotification = [appIdKey, pageIdKey];
    this.shouldCheckForTarget = false;

    const sendOpts = {
      appIdKey,
      pageIdKey
    };

    for (const enabled of [true, false]) {
      await this.send('indicateWebView', Object.assign({
        enabled
      }, sendOpts), false);
    }
    await this.send('setSenderKey', sendOpts);
    _logger.default.debug('Sender key set');
    if (this.isTargetBased && _support.util.compareVersions(this.platformVersion, '<', MIN_PLATFORM_NO_TARGET_EXISTS)) {
      await this.send('Target.exists', sendOpts, false);
    }
    this.shouldCheckForTarget = true;
    if (this.fullPageInitialization) {
      await this.initializePageFull(appIdKey, pageIdKey);
    } else {
      await this.initializePage(appIdKey, pageIdKey);
    }
  }

  async initializePage(appIdKey, pageIdKey) {
    const sendOpts = {
      appIdKey,
      pageIdKey
    };
    await this.send('Inspector.enable', sendOpts, false);
    await this.send('Page.enable', sendOpts, false);

    await this.send('Network.enable', sendOpts, false);
    await this.send('Runtime.enable', sendOpts, false);
    await this.send('Heap.enable', sendOpts, false);
    await this.send('Debugger.enable', sendOpts, false);
    await this.send('Console.enable', sendOpts, false);
    await this.send('Inspector.initialized', sendOpts, false);
  }

  async initializePageFull(appIdKey, pageIdKey) {
    const sendOpts = {
      appIdKey,
      pageIdKey
    };
    await this.send('Inspector.enable', sendOpts, false);
    await this.send('Page.enable', sendOpts, false);

    await this.send('Page.getResourceTree', sendOpts, false);
    await this.send('Network.enable', sendOpts, false);
    await this.send('Network.setResourceCachingDisabled', Object.assign({
      disabled: false
    }, sendOpts), false);
    await this.send('DOMStorage.enable', sendOpts, false);
    await this.send('Database.enable', sendOpts, false);
    await this.send('IndexedDB.enable', sendOpts, false);
    await this.send('CSS.enable', sendOpts, false);
    await this.send('Runtime.enable', sendOpts, false);
    await this.send('Heap.enable', sendOpts, false);
    await this.send('Memory.enable', sendOpts, false);
    await this.send('ApplicationCache.enable', sendOpts, false);
    await this.send('ApplicationCache.getFramesWithManifests', sendOpts, false);
    await this.send('Timeline.setInstruments', Object.assign({
      instruments: ['Timeline', 'ScriptProfiler', 'CPU']
    }, sendOpts), false);
    await this.send('Timeline.setAutoCaptureEnabled', Object.assign({
      enabled: false
    }, sendOpts), false);
    await this.send('Debugger.enable', sendOpts, false);
    await this.send('Debugger.setBreakpointsActive', Object.assign({
      active: true
    }, sendOpts), false);
    await this.send('Debugger.setPauseOnExceptions', Object.assign({
      state: 'none'
    }, sendOpts), false);
    await this.send('Debugger.setPauseOnAssertions', Object.assign({
      enabled: false
    }, sendOpts), false);
    await this.send('Debugger.setAsyncStackTraceDepth', Object.assign({
      depth: 200
    }, sendOpts), false);
    await this.send('Debugger.setPauseForInternalScripts', Object.assign({
      shouldPause: false
    }, sendOpts), false);
    await this.send('LayerTree.enable', sendOpts, false);
    await this.send('Worker.enable', sendOpts, false);
    await this.send('Canvas.enable', sendOpts, false);
    await this.send('Console.enable', sendOpts, false);
    await this.send('DOM.getDocument', sendOpts, false);
    const loggingChannels = await this.send('Console.getLoggingChannels', sendOpts);
    for (const source of (loggingChannels.channels || []).map(entry => entry.source)) {
      await this.send('Console.setLoggingChannelLevel', Object.assign({
        source,
        level: 'verbose'
      }, sendOpts), false);
    }
    await this.send('Inspector.initialized', sendOpts, false);
  }
  async selectApp(appIdKey) {
    return await new _bluebird.default((resolve, reject) => {
      const onAppChange = (err, dict) => {
        if (err) {
          return reject(err);
        }
        const oldAppIdKey = dict.WIRHostApplicationIdentifierKey;
        const correctAppIdKey = dict.WIRApplicationIdentifierKey;

        if (oldAppIdKey && correctAppIdKey !== oldAppIdKey) {
          _logger.default.debug(`We were notified we might have connected to the wrong app. ` + `Using id ${correctAppIdKey} instead of ${oldAppIdKey}`);
        }
        reject(new Error('New application has connected'));
      };
      this.messageHandler.prependOnceListener('_rpc_applicationConnected:', onAppChange);

      return (async () => {
        let pageDict, connectedAppIdKey;
        try {
          [connectedAppIdKey, pageDict] = await this.send('connectToApp', {
            appIdKey
          });
        } catch (err) {
          _logger.default.warn(`Unable to connect to app: ${err.message}`);
          reject(err);
        }

        if (_lodash.default.isEmpty(pageDict)) {
          let msg = 'Empty page dictionary received';
          _logger.default.debug(msg);
          reject(new Error(msg));
        } else {
          resolve([connectedAppIdKey, pageDict]);
        }
      })();
    });
  }
  onExecutionContextCreated(err, context) {
    this.contexts.push(context.id);
  }
  onGarbageCollected() {
    _logger.default.debug(`Web Inspector garbage collected`);
  }
  onScriptParsed(err, scriptInfo) {
    _logger.default.debug(`Script parsed: ${JSON.stringify(scriptInfo)}`);
  }
}
exports.default = RpcClient;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJEQVRBX0xPR19MRU5HVEgiLCJsZW5ndGgiLCJXQUlUX0ZPUl9UQVJHRVRfVElNRU9VVCIsIldBSVRfRk9SX1RBUkdFVF9JTlRFUlZBTCIsIk1JTl9QTEFURk9STV9GT1JfVEFSR0VUX0JBU0VEIiwiTUlOX1BMQVRGT1JNX05PX1RBUkdFVF9FWElTVFMiLCJpc1RhcmdldEJhc2VkIiwiaXNTYWZhcmkiLCJwbGF0Zm9ybVZlcnNpb24iLCJpc0hpZ2hWZXJzaW9uIiwidXRpbCIsImNvbXBhcmVWZXJzaW9ucyIsImxvZyIsImRlYnVnIiwiUnBjQ2xpZW50IiwiY29uc3RydWN0b3IiLCJvcHRzIiwiX3RhcmdldHMiLCJfc2hvdWxkQ2hlY2tGb3JUYXJnZXQiLCJzaG91bGRDaGVja0ZvclRhcmdldCIsImJ1bmRsZUlkIiwibG9nQWxsQ29tbXVuaWNhdGlvbiIsImxvZ0FsbENvbW11bmljYXRpb25IZXhEdW1wIiwid2ViSW5zcGVjdG9yTWF4RnJhbWVMZW5ndGgiLCJzb2NrZXRDaHVua1NpemUiLCJmdWxsUGFnZUluaXRpYWxpemF0aW9uIiwiaXNDb25uZWN0ZWQiLCJjb25uSWQiLCJ1dWlkVjQiLCJzZW5kZXJJZCIsIm1zZ0lkIiwiX2NvbnRleHRzIiwiY29udGV4dHMiLCJuZWVkc1RhcmdldCIsInRhcmdldHMiLCJjb25uZWN0ZWQiLCJvbiIsImV2ZW50IiwibGlzdGVuZXIiLCJtZXNzYWdlSGFuZGxlciIsIm9uY2UiLCJvZmYiLCJ3YXJuIiwiX2lzVGFyZ2V0QmFzZWQiLCJyZW1vdGVNZXNzYWdlcyIsIlJlbW90ZU1lc3NhZ2VzIiwiUnBjTWVzc2FnZUhhbmRsZXIiLCJhZGRUYXJnZXQiLCJiaW5kIiwidXBkYXRlVGFyZ2V0IiwicmVtb3ZlVGFyZ2V0Iiwib25FeGVjdXRpb25Db250ZXh0Q3JlYXRlZCIsIm9uR2FyYmFnZUNvbGxlY3RlZCIsIndhaXRGb3JUYXJnZXQiLCJhcHBJZEtleSIsInBhZ2VJZEtleSIsImZvcmNlIiwiZ2V0VGFyZ2V0Iiwid2FpdEZvckNvbmRpdGlvbiIsIl8iLCJpc0VtcHR5Iiwid2FpdE1zIiwiaW50ZXJ2YWxNcyIsImVycm9yIiwiZXJyIiwibWVzc2FnZSIsImluY2x1ZGVzIiwiRXJyb3IiLCJzZW5kIiwiY29tbWFuZCIsIndhaXRGb3JSZXNwb25zZSIsInRpbWVyIiwidGltaW5nIiwiVGltZXIiLCJzdGFydCIsInNlbmRUb0RldmljZSIsInRvTG93ZXJDYXNlIiwiaW5mbyIsImdldER1cmF0aW9uIiwiYXNNaWxsaVNlY29uZHMiLCJ0b0ZpeGVkIiwiQiIsInJlc29sdmUiLCJyZWplY3QiLCJ3cmFwcGVyTXNnSWQiLCJ0b1N0cmluZyIsInRhcmdldElkIiwiZnVsbE9wdHMiLCJkZWZhdWx0cyIsImlkIiwiY21kIiwiZ2V0UmVtb3RlQ29tbWFuZCIsIl9fYXJndW1lbnQiLCJXSVJTb2NrZXREYXRhS2V5IiwiaXNOaWwiLCJCdWZmZXIiLCJmcm9tIiwiSlNPTiIsInN0cmluZ2lmeSIsIm1lc3NhZ2VIYW5kbGVkIiwidHJ1bmNhdGUiLCJsaXN0ZW5lcnMiLCJfX3NlbGVjdG9yIiwicHJlcGVuZE9uY2VMaXN0ZW5lciIsImFyZ3MiLCJ2YWx1ZSIsImNvZGUiLCJtc2ciLCJyZXMiLCJzZW5kTWVzc2FnZSIsImNvbm5lY3QiLCJkaXNjb25uZWN0IiwicmVtb3ZlQWxsTGlzdGVuZXJzIiwicmVjZWl2ZSIsImFwcCIsInRhcmdldEluZm8iLCJwZW5kaW5nVGFyZ2V0Tm90aWZpY2F0aW9uIiwiaXNQcm92aXNpb25hbCIsImhhcyIsIm9sZFRhcmdldElkIiwibmV3VGFyZ2V0SWQiLCJwcm92aXNpb25hbCIsInBhZ2UiLCJ0b1BhaXJzIiwic2VsZWN0UGFnZSIsInNlbmRPcHRzIiwiZW5hYmxlZCIsIk9iamVjdCIsImFzc2lnbiIsImluaXRpYWxpemVQYWdlRnVsbCIsImluaXRpYWxpemVQYWdlIiwiZGlzYWJsZWQiLCJpbnN0cnVtZW50cyIsImFjdGl2ZSIsInN0YXRlIiwiZGVwdGgiLCJzaG91bGRQYXVzZSIsImxvZ2dpbmdDaGFubmVscyIsInNvdXJjZSIsImNoYW5uZWxzIiwibWFwIiwiZW50cnkiLCJsZXZlbCIsInNlbGVjdEFwcCIsIm9uQXBwQ2hhbmdlIiwiZGljdCIsIm9sZEFwcElkS2V5IiwiV0lSSG9zdEFwcGxpY2F0aW9uSWRlbnRpZmllcktleSIsImNvcnJlY3RBcHBJZEtleSIsIldJUkFwcGxpY2F0aW9uSWRlbnRpZmllcktleSIsInBhZ2VEaWN0IiwiY29ubmVjdGVkQXBwSWRLZXkiLCJjb250ZXh0IiwicHVzaCIsIm9uU2NyaXB0UGFyc2VkIiwic2NyaXB0SW5mbyJdLCJzb3VyY2VzIjpbIi4uLy4uLy4uL2xpYi9ycGMvcnBjLWNsaWVudC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVtb3RlTWVzc2FnZXMgZnJvbSAnLi9yZW1vdGUtbWVzc2FnZXMnO1xuaW1wb3J0IHsgd2FpdEZvckNvbmRpdGlvbiB9IGZyb20gJ2FzeW5jYm94JztcbmltcG9ydCBsb2cgZnJvbSAnLi4vbG9nZ2VyJztcbmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgQiBmcm9tICdibHVlYmlyZCc7XG5pbXBvcnQgUnBjTWVzc2FnZUhhbmRsZXIgZnJvbSAnLi9ycGMtbWVzc2FnZS1oYW5kbGVyJztcbmltcG9ydCB7IHV0aWwsIHRpbWluZyB9IGZyb20gJ2FwcGl1bS9zdXBwb3J0JztcblxuXG5jb25zdCBEQVRBX0xPR19MRU5HVEggPSB7bGVuZ3RoOiAyMDB9O1xuXG5jb25zdCBXQUlUX0ZPUl9UQVJHRVRfVElNRU9VVCA9IDEwMDAwO1xuY29uc3QgV0FJVF9GT1JfVEFSR0VUX0lOVEVSVkFMID0gMTAwMDtcblxuY29uc3QgTUlOX1BMQVRGT1JNX0ZPUl9UQVJHRVRfQkFTRUQgPSAnMTIuMic7XG5cbi8vIGBUYXJnZXQuZXhpc3RzYCBwcm90b2NvbCBtZXRob2Qgd2FzIHJlbW92ZWQgZnJvbSBXZWJLaXRpbiAxMy40XG5jb25zdCBNSU5fUExBVEZPUk1fTk9fVEFSR0VUX0VYSVNUUyA9ICcxMy40JztcblxuZnVuY3Rpb24gaXNUYXJnZXRCYXNlZCAoaXNTYWZhcmksIHBsYXRmb3JtVmVyc2lvbikge1xuICAvLyBPbiBpT1MgMTIuMiB0aGUgbWVzc2FnZXMgZ2V0IHNlbnQgdGhyb3VnaCB0aGUgVGFyZ2V0IGRvbWFpblxuICAvLyBPbiBpT1MgMTMuMCssIFdLV2ViVmlldyBhbHNvIG5lZWRzIHRvIGZvbGxvdyB0aGUgVGFyZ2V0IGRvbWFpbixcbiAgLy8gc28gaGVyZSBvbmx5IGNoZWNrIHRoZSB0YXJnZXQgT1MgdmVyc2lvbiBhcyB0aGUgZGVmYXVsdCBiZWhhdmlvdXIuXG4gIGNvbnN0IGlzSGlnaFZlcnNpb24gPSB1dGlsLmNvbXBhcmVWZXJzaW9ucyhwbGF0Zm9ybVZlcnNpb24sICc+PScsIE1JTl9QTEFURk9STV9GT1JfVEFSR0VUX0JBU0VEKTtcbiAgbG9nLmRlYnVnKGBDaGVja2luZyB3aGljaCBjb21tdW5pY2F0aW9uIHN0eWxlIHRvIHVzZSAoJHtpc1NhZmFyaSA/ICcnIDogJ25vbi0nfVNhZmFyaSBvbiBwbGF0Zm9ybSB2ZXJzaW9uICcke3BsYXRmb3JtVmVyc2lvbn0nKWApO1xuICBsb2cuZGVidWcoYFBsYXRmb3JtIHZlcnNpb24gZXF1YWwgb3IgaGlnaGVyIHRoYW4gJyR7TUlOX1BMQVRGT1JNX0ZPUl9UQVJHRVRfQkFTRUR9JzogJHtpc0hpZ2hWZXJzaW9ufWApO1xuICByZXR1cm4gaXNIaWdoVmVyc2lvbjtcbn1cblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUnBjQ2xpZW50IHtcbiAgY29uc3RydWN0b3IgKG9wdHMgPSB7fSkge1xuICAgIHRoaXMuX3RhcmdldHMgPSBbXTtcbiAgICB0aGlzLl9zaG91bGRDaGVja0ZvclRhcmdldCA9ICEhb3B0cy5zaG91bGRDaGVja0ZvclRhcmdldDtcblxuICAgIGNvbnN0IHtcbiAgICAgIGJ1bmRsZUlkLFxuICAgICAgcGxhdGZvcm1WZXJzaW9uID0ge30sXG4gICAgICBpc1NhZmFyaSA9IHRydWUsXG4gICAgICBsb2dBbGxDb21tdW5pY2F0aW9uID0gZmFsc2UsXG4gICAgICBsb2dBbGxDb21tdW5pY2F0aW9uSGV4RHVtcCA9IGZhbHNlLFxuICAgICAgd2ViSW5zcGVjdG9yTWF4RnJhbWVMZW5ndGgsXG4gICAgICBzb2NrZXRDaHVua1NpemUsXG4gICAgICBmdWxsUGFnZUluaXRpYWxpemF0aW9uID0gZmFsc2UsXG4gICAgfSA9IG9wdHM7XG5cbiAgICB0aGlzLmlzU2FmYXJpID0gaXNTYWZhcmk7XG5cbiAgICB0aGlzLmlzQ29ubmVjdGVkID0gZmFsc2U7XG4gICAgdGhpcy5jb25uSWQgPSB1dGlsLnV1aWRWNCgpO1xuICAgIHRoaXMuc2VuZGVySWQgPSB1dGlsLnV1aWRWNCgpO1xuICAgIHRoaXMubXNnSWQgPSAwO1xuXG4gICAgdGhpcy5sb2dBbGxDb21tdW5pY2F0aW9uID0gbG9nQWxsQ29tbXVuaWNhdGlvbjtcbiAgICB0aGlzLmxvZ0FsbENvbW11bmljYXRpb25IZXhEdW1wID0gbG9nQWxsQ29tbXVuaWNhdGlvbkhleER1bXA7XG4gICAgdGhpcy5zb2NrZXRDaHVua1NpemUgPSBzb2NrZXRDaHVua1NpemU7XG4gICAgdGhpcy53ZWJJbnNwZWN0b3JNYXhGcmFtZUxlbmd0aCA9IHdlYkluc3BlY3Rvck1heEZyYW1lTGVuZ3RoO1xuXG4gICAgdGhpcy5mdWxsUGFnZUluaXRpYWxpemF0aW9uID0gZnVsbFBhZ2VJbml0aWFsaXphdGlvbjtcblxuICAgIHRoaXMuYnVuZGxlSWQgPSBidW5kbGVJZDtcbiAgICB0aGlzLnBsYXRmb3JtVmVyc2lvbiA9IHBsYXRmb3JtVmVyc2lvbjtcblxuICAgIHRoaXMuX2NvbnRleHRzID0gW107XG4gICAgdGhpcy5fdGFyZ2V0cyA9IHt9O1xuXG4gICAgLy8gc3RhcnQgd2l0aCBhIGJlc3QgZ3Vlc3MgZm9yIHRoZSBwcm90b2NvbFxuICAgIHRoaXMuaXNUYXJnZXRCYXNlZCA9IGlzVGFyZ2V0QmFzZWQoaXNTYWZhcmksIHRoaXMucGxhdGZvcm1WZXJzaW9uKTtcbiAgfVxuXG4gIGdldCBjb250ZXh0cyAoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2NvbnRleHRzO1xuICB9XG5cbiAgZ2V0IG5lZWRzVGFyZ2V0ICgpIHtcbiAgICByZXR1cm4gdGhpcy5zaG91bGRDaGVja0ZvclRhcmdldCAmJiB0aGlzLmlzVGFyZ2V0QmFzZWQ7XG4gIH1cblxuICBnZXQgdGFyZ2V0cyAoKSB7XG4gICAgcmV0dXJuIHRoaXMuX3RhcmdldHM7XG4gIH1cblxuICBnZXQgc2hvdWxkQ2hlY2tGb3JUYXJnZXQgKCkge1xuICAgIHJldHVybiB0aGlzLl9zaG91bGRDaGVja0ZvclRhcmdldDtcbiAgfVxuXG4gIHNldCBzaG91bGRDaGVja0ZvclRhcmdldCAoc2hvdWxkQ2hlY2tGb3JUYXJnZXQpIHtcbiAgICB0aGlzLl9zaG91bGRDaGVja0ZvclRhcmdldCA9ICEhc2hvdWxkQ2hlY2tGb3JUYXJnZXQ7XG4gIH1cblxuICBnZXQgaXNDb25uZWN0ZWQgKCkge1xuICAgIHJldHVybiB0aGlzLmNvbm5lY3RlZDtcbiAgfVxuXG4gIHNldCBpc0Nvbm5lY3RlZCAoY29ubmVjdGVkKSB7XG4gICAgdGhpcy5jb25uZWN0ZWQgPSAhIWNvbm5lY3RlZDtcbiAgfVxuXG4gIG9uIChldmVudCwgbGlzdGVuZXIpIHtcbiAgICB0aGlzLm1lc3NhZ2VIYW5kbGVyLm9uKGV2ZW50LCBsaXN0ZW5lcik7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBvbmNlIChldmVudCwgbGlzdGVuZXIpIHtcbiAgICB0aGlzLm1lc3NhZ2VIYW5kbGVyLm9uY2UoZXZlbnQsIGxpc3RlbmVyKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIG9mZiAoZXZlbnQsIGxpc3RlbmVyKSB7XG4gICAgdGhpcy5tZXNzYWdlSGFuZGxlci5vZmYoZXZlbnQsIGxpc3RlbmVyKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIHNldCBpc1RhcmdldEJhc2VkIChpc1RhcmdldEJhc2VkKSB7XG4gICAgbG9nLndhcm4oYFNldHRpbmcgY29tbXVuaWNhdGlvbiBwcm90b2NvbDogdXNpbmcgJHtpc1RhcmdldEJhc2VkID8gJ1RhcmdldC1iYXNlZCcgOiAnZnVsbCBXZWIgSW5zcGVjdG9yIHByb3RvY29sJ30gY29tbXVuaWNhdGlvbmApO1xuICAgIHRoaXMuX2lzVGFyZ2V0QmFzZWQgPSBpc1RhcmdldEJhc2VkO1xuXG4gICAgaWYgKCF0aGlzLnJlbW90ZU1lc3NhZ2VzKSB7XG4gICAgICB0aGlzLnJlbW90ZU1lc3NhZ2VzID0gbmV3IFJlbW90ZU1lc3NhZ2VzKGlzVGFyZ2V0QmFzZWQpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnJlbW90ZU1lc3NhZ2VzLmlzVGFyZ2V0QmFzZWQgPSBpc1RhcmdldEJhc2VkO1xuICAgIH1cblxuICAgIGlmICghdGhpcy5tZXNzYWdlSGFuZGxlcikge1xuICAgICAgdGhpcy5tZXNzYWdlSGFuZGxlciA9IG5ldyBScGNNZXNzYWdlSGFuZGxlcihpc1RhcmdldEJhc2VkKTtcblxuICAgICAgLy8gYWRkIGhhbmRsZXJzIGZvciBpbnRlcm5hbCBldmVudHNcbiAgICAgIHRoaXMubWVzc2FnZUhhbmRsZXIub24oJ1RhcmdldC50YXJnZXRDcmVhdGVkJywgdGhpcy5hZGRUYXJnZXQuYmluZCh0aGlzKSk7XG4gICAgICB0aGlzLm1lc3NhZ2VIYW5kbGVyLm9uKCdUYXJnZXQuZGlkQ29tbWl0UHJvdmlzaW9uYWxUYXJnZXQnLCB0aGlzLnVwZGF0ZVRhcmdldC5iaW5kKHRoaXMpKTtcbiAgICAgIHRoaXMubWVzc2FnZUhhbmRsZXIub24oJ1RhcmdldC50YXJnZXREZXN0cm95ZWQnLCB0aGlzLnJlbW92ZVRhcmdldC5iaW5kKHRoaXMpKTtcbiAgICAgIHRoaXMubWVzc2FnZUhhbmRsZXIub24oJ1J1bnRpbWUuZXhlY3V0aW9uQ29udGV4dENyZWF0ZWQnLCB0aGlzLm9uRXhlY3V0aW9uQ29udGV4dENyZWF0ZWQuYmluZCh0aGlzKSk7XG4gICAgICB0aGlzLm1lc3NhZ2VIYW5kbGVyLm9uKCdIZWFwLmdhcmJhZ2VDb2xsZWN0ZWQnLCB0aGlzLm9uR2FyYmFnZUNvbGxlY3RlZC5iaW5kKHRoaXMpKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5tZXNzYWdlSGFuZGxlci5pc1RhcmdldEJhc2VkID0gaXNUYXJnZXRCYXNlZDtcbiAgICB9XG4gIH1cblxuICBnZXQgaXNUYXJnZXRCYXNlZCAoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2lzVGFyZ2V0QmFzZWQ7XG4gIH1cblxuICBhc3luYyB3YWl0Rm9yVGFyZ2V0IChhcHBJZEtleSwgcGFnZUlkS2V5LCBmb3JjZSA9IGZhbHNlKSB7XG4gICAgaWYgKCFmb3JjZSAmJiAhdGhpcy5uZWVkc1RhcmdldCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmICh0aGlzLmdldFRhcmdldChhcHBJZEtleSwgcGFnZUlkS2V5KSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIG90aGVyd2lzZSB3YWl0aW5nIGlzIG5lY2Vzc2FyeSB0byBzZWUgd2hhdCB0aGUgdGFyZ2V0IGlzXG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHdhaXRGb3JDb25kaXRpb24oKCkgPT4gIV8uaXNFbXB0eSh0aGlzLmdldFRhcmdldChhcHBJZEtleSwgcGFnZUlkS2V5KSksIHtcbiAgICAgICAgd2FpdE1zOiBXQUlUX0ZPUl9UQVJHRVRfVElNRU9VVCxcbiAgICAgICAgaW50ZXJ2YWxNczogV0FJVF9GT1JfVEFSR0VUX0lOVEVSVkFMLFxuICAgICAgICBlcnJvcjogJ05vIHRhcmdldHMgZm91bmQsIHVuYWJsZSB0byBjb21tdW5pY2F0ZSB3aXRoIGRldmljZScsXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGlmICghZXJyLm1lc3NhZ2UuaW5jbHVkZXMoJ0NvbmRpdGlvbiB1bm1ldCcpKSB7XG4gICAgICAgIHRocm93IGVycjtcbiAgICAgIH1cbiAgICAgIHRocm93IG5ldyBFcnJvcignTm8gdGFyZ2V0cyBmb3VuZCwgdW5hYmxlIHRvIGNvbW11bmljYXRlIHdpdGggZGV2aWNlJyk7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgc2VuZCAoY29tbWFuZCwgb3B0cyA9IHt9LCB3YWl0Rm9yUmVzcG9uc2UgPSB0cnVlKSB7XG4gICAgY29uc3QgdGltZXIgPSBuZXcgdGltaW5nLlRpbWVyKCkuc3RhcnQoKTtcbiAgICBjb25zdCB7XG4gICAgICBhcHBJZEtleSxcbiAgICAgIHBhZ2VJZEtleVxuICAgIH0gPSBvcHRzO1xuICAgIHRyeSB7XG4gICAgICBpZiAoIV8uaXNFbXB0eShhcHBJZEtleSkgJiYgIV8uaXNFbXB0eShwYWdlSWRLZXkpKSB7XG4gICAgICAgIGF3YWl0IHRoaXMud2FpdEZvclRhcmdldChhcHBJZEtleSwgcGFnZUlkS2V5KTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBhd2FpdCB0aGlzLnNlbmRUb0RldmljZShjb21tYW5kLCBvcHRzLCB3YWl0Rm9yUmVzcG9uc2UpO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgbGV0IHsgbWVzc2FnZSA9ICcnIH0gPSBlcnI7XG4gICAgICBtZXNzYWdlID0gbWVzc2FnZS50b0xvd2VyQ2FzZSgpO1xuICAgICAgaWYgKG1lc3NhZ2UuaW5jbHVkZXMoYCd0YXJnZXQnIGRvbWFpbiB3YXMgbm90IGZvdW5kYCkpIHtcbiAgICAgICAgbG9nLmluZm8oJ1RoZSB0YXJnZXQgZGV2aWNlIGRvZXMgbm90IHN1cHBvcnQgVGFyZ2V0IGJhc2VkIGNvbW11bmljYXRpb24uICcgK1xuICAgICAgICAgICdXaWxsIGZvbGxvdyBub24tdGFyZ2V0IGJhc2VkIGNvbW11bmljYXRpb24uJyk7XG4gICAgICAgIHRoaXMuaXNUYXJnZXRCYXNlZCA9IGZhbHNlO1xuICAgICAgICByZXR1cm4gYXdhaXQgdGhpcy5zZW5kVG9EZXZpY2UoY29tbWFuZCwgb3B0cywgd2FpdEZvclJlc3BvbnNlKTtcbiAgICAgIH0gZWxzZSBpZiAobWVzc2FnZS5pbmNsdWRlcyhgZG9tYWluIHdhcyBub3QgZm91bmRgKSB8fFxuICAgICAgICAgIG1lc3NhZ2UuaW5jbHVkZXMoYHNvbWUgYXJndW1lbnRzIG9mIG1ldGhvZGApIHx8XG4gICAgICAgICAgbWVzc2FnZS5pbmNsdWRlcyhgbWlzc2luZyB0YXJnZXRgKSkge1xuICAgICAgICB0aGlzLmlzVGFyZ2V0QmFzZWQgPSB0cnVlO1xuICAgICAgICBhd2FpdCB0aGlzLndhaXRGb3JUYXJnZXQoYXBwSWRLZXksIHBhZ2VJZEtleSk7XG4gICAgICAgIHJldHVybiBhd2FpdCB0aGlzLnNlbmRUb0RldmljZShjb21tYW5kLCBvcHRzLCB3YWl0Rm9yUmVzcG9uc2UpO1xuICAgICAgfVxuICAgICAgdGhyb3cgZXJyO1xuICAgIH0gZmluYWxseSB7XG4gICAgICBsb2cuZGVidWcoYFNlbmRpbmcgdG8gV2ViIEluc3BlY3RvciB0b29rICR7dGltZXIuZ2V0RHVyYXRpb24oKS5hc01pbGxpU2Vjb25kcy50b0ZpeGVkKDApfW1zYCk7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgc2VuZFRvRGV2aWNlIChjb21tYW5kLCBvcHRzID0ge30sIHdhaXRGb3JSZXNwb25zZSA9IHRydWUpIHtcbiAgICByZXR1cm4gYXdhaXQgbmV3IEIoYXN5bmMgKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgLy8gcHJvbWlzZSB0byBiZSByZXNvbHZlZCB3aGVuZXZlciByZW1vdGUgZGVidWdnZXJcbiAgICAgIC8vIHJlcGxpZXMgdG8gb3VyIHJlcXVlc3RcblxuICAgICAgLy8ga2VlcCB0cmFjayBvZiB0aGUgbWVzc2FnZXMgY29taW5nIGFuZCBnb2luZyB1c2luZyBhIHNpbXBsZSBzZXF1ZW50aWFsIGlkXG4gICAgICBjb25zdCBtc2dJZCA9IHRoaXMubXNnSWQrKztcbiAgICAgIGxldCB3cmFwcGVyTXNnSWQgPSBtc2dJZDtcbiAgICAgIGlmICh0aGlzLmlzVGFyZ2V0QmFzZWQpIHtcbiAgICAgICAgLy8gZm9yIHRhcmdldC1iYXNlIGNvbW11bmljYXRpb24sIGV2ZXJ5dGhpbmcgaXMgd3JhcHBlZCB1cFxuICAgICAgICB3cmFwcGVyTXNnSWQgPSB0aGlzLm1zZ0lkKys7XG4gICAgICAgIC8vIGFja25vd2xlZGdlIHdyYXBwZXIgbWVzc2FnZVxuICAgICAgICB0aGlzLm1lc3NhZ2VIYW5kbGVyLm9uKHdyYXBwZXJNc2dJZC50b1N0cmluZygpLCBmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgICAgcmVqZWN0KGVycik7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgYXBwSWRLZXkgPSBvcHRzLmFwcElkS2V5O1xuICAgICAgY29uc3QgcGFnZUlkS2V5ID0gb3B0cy5wYWdlSWRLZXk7XG4gICAgICBjb25zdCB0YXJnZXRJZCA9IHRoaXMuZ2V0VGFyZ2V0KGFwcElkS2V5LCBwYWdlSWRLZXkpO1xuXG4gICAgICAvLyByZXRyaWV2ZSB0aGUgY29ycmVjdCBjb21tYW5kIHRvIHNlbmRcbiAgICAgIGNvbnN0IGZ1bGxPcHRzID0gXy5kZWZhdWx0cyh7XG4gICAgICAgIGNvbm5JZDogdGhpcy5jb25uSWQsXG4gICAgICAgIHNlbmRlcklkOiB0aGlzLnNlbmRlcklkLFxuICAgICAgICB0YXJnZXRJZCxcbiAgICAgICAgaWQ6IG1zZ0lkLFxuICAgICAgfSwgb3B0cyk7XG4gICAgICBjb25zdCBjbWQgPSB0aGlzLnJlbW90ZU1lc3NhZ2VzLmdldFJlbW90ZUNvbW1hbmQoY29tbWFuZCwgZnVsbE9wdHMpO1xuXG4gICAgICBpZiAoY21kPy5fX2FyZ3VtZW50Py5XSVJTb2NrZXREYXRhS2V5KSB7XG4gICAgICAgIC8vIG1ha2Ugc3VyZSB0aGUgbWVzc2FnZSBiZWluZyBzZW50IGhhcyBhbGwgdGhlIGluZm9ybWF0aW9uIHRoYXQgaXMgbmVlZGVkXG4gICAgICAgIGlmIChfLmlzTmlsKGNtZC5fX2FyZ3VtZW50LldJUlNvY2tldERhdGFLZXkuaWQpKSB7XG4gICAgICAgICAgY21kLl9fYXJndW1lbnQuV0lSU29ja2V0RGF0YUtleS5pZCA9IHdyYXBwZXJNc2dJZDtcbiAgICAgICAgfVxuICAgICAgICBjbWQuX19hcmd1bWVudC5XSVJTb2NrZXREYXRhS2V5ID1cbiAgICAgICAgICBCdWZmZXIuZnJvbShKU09OLnN0cmluZ2lmeShjbWQuX19hcmd1bWVudC5XSVJTb2NrZXREYXRhS2V5KSk7XG4gICAgICB9XG5cbiAgICAgIGxldCBtZXNzYWdlSGFuZGxlZCA9IHRydWU7XG4gICAgICBpZiAoIXdhaXRGb3JSZXNwb25zZSkge1xuICAgICAgICAvLyB0aGUgcHJvbWlzZSB3aWxsIGJlIHJlc29sdmVkIGFzIHNvb24gYXMgdGhlIHNvY2tldCBoYXMgYmVlbiBzZW50XG4gICAgICAgIG1lc3NhZ2VIYW5kbGVkID0gZmFsc2U7XG4gICAgICAgIC8vIGRvIG5vdCBsb2cgcmVjZWlwdHNcbiAgICAgICAgdGhpcy5tZXNzYWdlSGFuZGxlci5vbmNlKG1zZ0lkLnRvU3RyaW5nKCksIGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgICAvLyB3ZSBhcmUgbm90IHdhaXRpbmcgZm9yIHRoaXMsIGFuZCBpZiBpdCBlcnJvcnMgaXQgaXMgbW9zdCBsaWtlbHlcbiAgICAgICAgICAgIC8vIGEgcHJvdG9jb2wgY2hhbmdlLiBMb2cgYW5kIGNoZWNrIGR1cmluZyB0ZXN0aW5nXG4gICAgICAgICAgICBsb2cuZXJyb3IoYFJlY2VpdmVkIGVycm9yIGZyb20gc2VuZCB0aGF0IGlzIG5vdCBiZWluZyB3YWl0ZWQgZm9yIChpZDogJHttc2dJZH0pOiAnJHtfLnRydW5jYXRlKEpTT04uc3RyaW5naWZ5KGVyciksIERBVEFfTE9HX0xFTkdUSCl9J2ApO1xuICAgICAgICAgICAgLy8gcmVqZWN0LCB0aG91Z2ggaXQgaXMgdmVyeSByYXJlIHRoYXQgdGhpcyB3aWxsIGJlIHRyaWdnZXJlZCwgc2luY2VcbiAgICAgICAgICAgIC8vIHRoZSBwcm9taXNlIGlzIHJlc29sdmVkIGRpcmVjdGx0eSBhZnRlciBzZW5kLiBPbiB0aGUgb2ZmIGNoYW5jZSxcbiAgICAgICAgICAgIC8vIHRob3VnaCwgaXQgd2lsbCBhbGVydCBvZiBhIHByb3RvY29sIGNoYW5nZS5cbiAgICAgICAgICAgIHJlamVjdChlcnIpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9IGVsc2UgaWYgKHRoaXMubWVzc2FnZUhhbmRsZXIubGlzdGVuZXJzKGNtZC5fX3NlbGVjdG9yKS5sZW5ndGgpIHtcbiAgICAgICAgdGhpcy5tZXNzYWdlSGFuZGxlci5wcmVwZW5kT25jZUxpc3RlbmVyKGNtZC5fX3NlbGVjdG9yLCBmdW5jdGlvbiAoZXJyLCAuLi5hcmdzKSB7XG4gICAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgICAgcmV0dXJuIHJlamVjdChlcnIpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBsb2cuZGVidWcoYFJlY2VpdmVkIHJlc3BvbnNlIGZyb20gc2VuZCAoaWQ6ICR7bXNnSWR9KTogJyR7Xy50cnVuY2F0ZShKU09OLnN0cmluZ2lmeShhcmdzKSwgREFUQV9MT0dfTEVOR1RIKX0nYCk7XG4gICAgICAgICAgcmVzb2x2ZShhcmdzKTtcbiAgICAgICAgfSk7XG4gICAgICB9IGVsc2UgaWYgKGNtZD8uX19hcmd1bWVudD8uV0lSU29ja2V0RGF0YUtleSkge1xuICAgICAgICB0aGlzLm1lc3NhZ2VIYW5kbGVyLm9uY2UobXNnSWQudG9TdHJpbmcoKSwgZnVuY3Rpb24gKGVyciwgdmFsdWUpIHtcbiAgICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgICByZXR1cm4gcmVqZWN0KG5ldyBFcnJvcihgUmVtb3RlIGRlYnVnZ2VyIGVycm9yIHdpdGggY29kZSAnJHtlcnIuY29kZX0nOiAke2Vyci5tZXNzYWdlfWApKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgbG9nLmRlYnVnKGBSZWNlaXZlZCBkYXRhIHJlc3BvbnNlIGZyb20gc2VuZCAoaWQ6ICR7bXNnSWR9KTogJyR7Xy50cnVuY2F0ZShKU09OLnN0cmluZ2lmeSh2YWx1ZSksIERBVEFfTE9HX0xFTkdUSCl9J2ApO1xuICAgICAgICAgIHJlc29sdmUodmFsdWUpO1xuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIG5vdGhpbmcgZWxzZSBpcyBoYW5kbGluZyB0aGluZ3MsIHNvIGp1c3QgcmVzb2x2ZSB3aGVuIHRoZSBtZXNzYWdlIGlzIHNlbnRcbiAgICAgICAgbWVzc2FnZUhhbmRsZWQgPSBmYWxzZTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgbXNnID0gYFNlbmRpbmcgJyR7Y21kLl9fc2VsZWN0b3J9JyBtZXNzYWdlYCArXG4gICAgICAgIChmdWxsT3B0cy5hcHBJZEtleSA/IGAgdG8gYXBwICcke2Z1bGxPcHRzLmFwcElkS2V5fSdgIDogJycpICtcbiAgICAgICAgKGZ1bGxPcHRzLnBhZ2VJZEtleSA/IGAsIHBhZ2UgJyR7ZnVsbE9wdHMucGFnZUlkS2V5fSdgIDogJycpICtcbiAgICAgICAgKHRoaXMubmVlZHNUYXJnZXQgJiYgdGFyZ2V0SWQgPyBgLCB0YXJnZXQgJyR7dGFyZ2V0SWR9J2AgOiAnJykgK1xuICAgICAgICBgIChpZDogJHttc2dJZH0pOiAnJHtjb21tYW5kfSdgO1xuICAgICAgbG9nLmRlYnVnKG1zZyk7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCByZXMgPSBhd2FpdCB0aGlzLnNlbmRNZXNzYWdlKGNtZCk7XG4gICAgICAgIGlmICghbWVzc2FnZUhhbmRsZWQpIHtcbiAgICAgICAgICAvLyBUaGVyZSBhcmUgbm8gaGFuZGxlcnMgd2FpdGluZyBmb3IgYSByZXNwb25zZSBiZWZvcmUgcmVzb2x2aW5nLFxuICAgICAgICAgIC8vIGFuZCBubyBlcnJvcnMgc2VuZGluZyB0aGUgbWVzc2FnZSBvdmVyIHRoZSBzb2NrZXQsIHNvIHJlc29sdmVcbiAgICAgICAgICByZXNvbHZlKHJlcyk7XG4gICAgICAgIH1cbiAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICByZXR1cm4gcmVqZWN0KGVycik7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICBhc3luYyBjb25uZWN0ICgpIHsgLy8gZXNsaW50LWRpc2FibGUtbGluZSByZXF1aXJlLWF3YWl0XG4gICAgdGhyb3cgbmV3IEVycm9yKGBTdWItY2xhc3NlcyBuZWVkIHRvIGltcGxlbWVudCBhICdjb25uZWN0JyBmdW5jdGlvbmApO1xuICB9XG5cbiAgYXN5bmMgZGlzY29ubmVjdCAoKSB7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgcmVxdWlyZS1hd2FpdFxuICAgIHRoaXMubWVzc2FnZUhhbmRsZXIucmVtb3ZlQWxsTGlzdGVuZXJzKCk7XG4gIH1cblxuICBhc3luYyBzZW5kTWVzc2FnZSAoLyogY29tbWFuZCAqLykgeyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIHJlcXVpcmUtYXdhaXRcbiAgICB0aHJvdyBuZXcgRXJyb3IoYFN1Yi1jbGFzc2VzIG5lZWQgdG8gaW1wbGVtZW50IGEgJ3NlbmRNZXNzYWdlJyBmdW5jdGlvbmApO1xuICB9XG5cbiAgYXN5bmMgcmVjZWl2ZSAoLyogZGF0YSAqLykgeyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIHJlcXVpcmUtYXdhaXRcbiAgICB0aHJvdyBuZXcgRXJyb3IoYFN1Yi1jbGFzc2VzIG5lZWQgdG8gaW1wbGVtZW50IGEgJ3JlY2VpdmUnIGZ1bmN0aW9uYCk7XG4gIH1cblxuICBhZGRUYXJnZXQgKGVyciwgYXBwLCB0YXJnZXRJbmZvKSB7XG4gICAgaWYgKF8uaXNOaWwodGFyZ2V0SW5mbz8udGFyZ2V0SWQpKSB7XG4gICAgICBsb2cud2FybihgUmVjZWl2ZWQgJ1RhcmdldC50YXJnZXRDcmVhdGVkJyBldmVudCBmb3IgYXBwICcke2FwcH0nIHdpdGggbm8gdGFyZ2V0LiBTa2lwcGluZ2ApO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAoXy5pc0VtcHR5KHRoaXMucGVuZGluZ1RhcmdldE5vdGlmaWNhdGlvbikgJiYgIXRhcmdldEluZm8uaXNQcm92aXNpb25hbCkge1xuICAgICAgbG9nLndhcm4oYFJlY2VpdmVkICdUYXJnZXQudGFyZ2V0Q3JlYXRlZCcgZXZlbnQgZm9yIGFwcCAnJHthcHB9JyB3aXRoIG5vIHBlbmRpbmcgcmVxdWVzdDogJHtKU09OLnN0cmluZ2lmeSh0YXJnZXRJbmZvKX1gKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAodGFyZ2V0SW5mby5pc1Byb3Zpc2lvbmFsKSB7XG4gICAgICBsb2cuZGVidWcoYFByb3Zpc2lvbmFsIHRhcmdldCBjcmVhdGVkIGZvciBhcHAgJyR7YXBwfScsICcke3RhcmdldEluZm8udGFyZ2V0SWR9Jy4gSWdub3JpbmcgdW50aWwgdGFyZ2V0IHVwZGF0ZSBldmVudGApO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IFthcHBJZEtleSwgcGFnZUlkS2V5XSA9IHRoaXMucGVuZGluZ1RhcmdldE5vdGlmaWNhdGlvbjtcblxuICAgIGxvZy5kZWJ1ZyhgVGFyZ2V0IGNyZWF0ZWQgZm9yIGFwcCAnJHthcHBJZEtleX0nIGFuZCBwYWdlICcke3BhZ2VJZEtleX0nOiAke0pTT04uc3RyaW5naWZ5KHRhcmdldEluZm8pfWApO1xuICAgIGlmIChfLmhhcyh0aGlzLnRhcmdldHNbYXBwSWRLZXldLCBwYWdlSWRLZXkpKSB7XG4gICAgICBsb2cuZGVidWcoYFRoZXJlIGlzIGFscmVhZHkgYSB0YXJnZXQgZm9yIHRoaXMgYXBwIGFuZCBwYWdlICgnJHt0aGlzLnRhcmdldHNbYXBwSWRLZXldW3BhZ2VJZEtleV19JykuIFRoaXMgbWlnaHQgY2F1c2UgcHJvYmxlbXNgKTtcbiAgICB9XG4gICAgdGhpcy50YXJnZXRzW2FwcF0gPSB0aGlzLnRhcmdldHNbYXBwXSB8fCB7fTtcbiAgICB0aGlzLnRhcmdldHNbYXBwSWRLZXldW3BhZ2VJZEtleV0gPSB0YXJnZXRJbmZvLnRhcmdldElkO1xuICB9XG5cbiAgdXBkYXRlVGFyZ2V0IChlcnIsIGFwcCwgb2xkVGFyZ2V0SWQsIG5ld1RhcmdldElkKSB7XG4gICAgbG9nLmRlYnVnKGBUYXJnZXQgdXBkYXRlZCBmb3IgYXBwICcke2FwcH0nLiBPbGQgdGFyZ2V0OiAnJHtvbGRUYXJnZXRJZH0nLCBuZXcgdGFyZ2V0OiAnJHtuZXdUYXJnZXRJZH0nYCk7XG4gICAgaWYgKCF0aGlzLnRhcmdldHNbYXBwXSkge1xuICAgICAgbG9nLndhcm4oYE5vIGV4aXN0aW5nIHRhcmdldCBmb3IgYXBwICcke2FwcH0nLiBOb3Qgc3VyZSB3aGF0IHRvIGRvYCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIC8vIHNhdmUgdGhpcywgdG8gYmUgdXNlZCBpZi93aGVuIHRoZSBleGlzdGluZyB0YXJnZXQgaXMgZGVzdHJveWVkXG4gICAgdGhpcy50YXJnZXRzW2FwcF0ucHJvdmlzaW9uYWwgPSB7XG4gICAgICBvbGRUYXJnZXRJZCxcbiAgICAgIG5ld1RhcmdldElkLFxuICAgIH07XG4gIH1cblxuICByZW1vdmVUYXJnZXQgKGVyciwgYXBwLCB0YXJnZXRJbmZvKSB7XG4gICAgaWYgKF8uaXNOaWwodGFyZ2V0SW5mbz8udGFyZ2V0SWQpKSB7XG4gICAgICBsb2cuZGVidWcoYFJlY2VpdmVkICdUYXJnZXQudGFyZ2V0RGVzdHJveWVkJyBldmVudCB3aXRoIG5vIHRhcmdldC4gU2tpcHBpbmdgKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBsb2cuZGVidWcoYFRhcmdldCBkZXN0cm95ZWQgZm9yIGFwcCAnJHthcHB9JzogJHt0YXJnZXRJbmZvLnRhcmdldElkfWApO1xuXG4gICAgLy8gZ28gdGhyb3VnaCB0aGUgdGFyZ2V0cyBhbmQgZmluZCB0aGUgb25lIHRoYXQgaGFzIGEgd2FpdGluZyBwcm92aXNpb25hbCB0YXJnZXRcbiAgICBpZiAodGhpcy50YXJnZXRzW2FwcF0/LnByb3Zpc2lvbmFsPy5vbGRUYXJnZXRJZCA9PT0gdGFyZ2V0SW5mby50YXJnZXRJZCkge1xuICAgICAgY29uc3Qge29sZFRhcmdldElkLCBuZXdUYXJnZXRJZH0gPSB0aGlzLnRhcmdldHNbYXBwXS5wcm92aXNpb25hbDtcbiAgICAgIGRlbGV0ZSB0aGlzLnRhcmdldHNbYXBwXS5wcm92aXNpb25hbDtcblxuICAgICAgLy8gd2UgZG8gbm90IGtub3cgdGhlIHBhZ2UsIHNvIGdvIHRocm91Z2ggYW5kIGZpbmQgdGhlIGV4aXN0aW5nIHRhcmdldFxuICAgICAgY29uc3QgdGFyZ2V0cyA9IHRoaXMudGFyZ2V0c1thcHBdO1xuICAgICAgZm9yIChjb25zdCBbcGFnZSwgdGFyZ2V0SWRdIG9mIF8udG9QYWlycyh0YXJnZXRzKSkge1xuICAgICAgICBpZiAodGFyZ2V0SWQgPT09IG9sZFRhcmdldElkKSB7XG4gICAgICAgICAgbG9nLmRlYnVnKGBGb3VuZCBwcm92aXNpb25hbCB0YXJnZXQgZm9yIGFwcCAnJHthcHB9Jy4gT2xkIHRhcmdldDogJyR7b2xkVGFyZ2V0SWR9JywgbmV3IHRhcmdldDogJyR7bmV3VGFyZ2V0SWR9Jy4gVXBkYXRpbmdgKTtcbiAgICAgICAgICB0YXJnZXRzW3BhZ2VdID0gbmV3VGFyZ2V0SWQ7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBsb2cud2FybihgUHJvdmlzaW9uYWwgdGFyZ2V0IGZvciBhcHAgJyR7YXBwfScgZm91bmQsIGJ1dCBubyBzdWl0YWJsZSBleGlzdGluZyB0YXJnZXQgZm91bmQuIFRoaXMgbWF5IGNhdXNlIHByb2JsZW1zYCk7XG4gICAgICBsb2cud2FybihgT2xkIHRhcmdldDogJyR7b2xkVGFyZ2V0SWR9JywgbmV3IHRhcmdldDogJyR7bmV3VGFyZ2V0SWR9Jy4gRXhpc3RpbmcgdGFyZ2V0czogJHtKU09OLnN0cmluZ2lmeSh0YXJnZXRzKX1gKTtcbiAgICB9XG5cbiAgICAvLyBpZiB0aGVyZSBpcyBubyB3YWl0aW5nIHByb3Zpc2lvbmFsIHRhcmdldCwganVzdCBnZXQgcmlkIG9mIHRoZSBleGlzdGluZyBvbmVcbiAgICBjb25zdCB0YXJnZXRzID0gdGhpcy50YXJnZXRzW2FwcF07XG4gICAgZm9yIChjb25zdCBbcGFnZSwgdGFyZ2V0SWRdIG9mIF8udG9QYWlycyh0YXJnZXRzKSkge1xuICAgICAgaWYgKHRhcmdldElkID09PSB0YXJnZXRJbmZvLnRhcmdldElkKSB7XG4gICAgICAgIGRlbGV0ZSB0YXJnZXRzW3BhZ2VdO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgfVxuICAgIGxvZy5kZWJ1ZyhgVGFyZ2V0ICcke3RhcmdldEluZm8udGFyZ2V0SWR9JyBkZWxldGVkIGZvciBhcHAgJyR7YXBwfScsIGJ1dCBubyBzdWNoIHRhcmdldCBleGlzdHNgKTtcbiAgfVxuXG4gIGdldFRhcmdldCAoYXBwSWRLZXksIHBhZ2VJZEtleSkge1xuICAgIHJldHVybiAodGhpcy50YXJnZXRzW2FwcElkS2V5XSB8fCB7fSlbcGFnZUlkS2V5XTtcbiAgfVxuXG4gIGFzeW5jIHNlbGVjdFBhZ2UgKGFwcElkS2V5LCBwYWdlSWRLZXkpIHtcbiAgICB0aGlzLnBlbmRpbmdUYXJnZXROb3RpZmljYXRpb24gPSBbYXBwSWRLZXksIHBhZ2VJZEtleV07XG4gICAgdGhpcy5zaG91bGRDaGVja0ZvclRhcmdldCA9IGZhbHNlO1xuXG4gICAgLy8gZ28gdGhyb3VnaCB0aGUgc3RlcHMgdGhhdCB0aGUgRGVza3RvcCBTYWZhcmkgc3lzdGVtXG4gICAgLy8gZ29lcyB0aHJvdWdoIHRvIGluaXRpYWxpemUgdGhlIFdlYiBJbnNwZWN0b3Igc2Vzc2lvblxuXG4gICAgY29uc3Qgc2VuZE9wdHMgPSB7XG4gICAgICBhcHBJZEtleSxcbiAgICAgIHBhZ2VJZEtleSxcbiAgICB9O1xuXG4gICAgLy8gaGlnaGxpZ2h0IGFuZCB0aGVuIHVuLWhpZ2hsaWdodCB0aGUgd2Vidmlld1xuICAgIGZvciAoY29uc3QgZW5hYmxlZCBvZiBbdHJ1ZSwgZmFsc2VdKSB7XG4gICAgICBhd2FpdCB0aGlzLnNlbmQoJ2luZGljYXRlV2ViVmlldycsIE9iamVjdC5hc3NpZ24oe1xuICAgICAgICBlbmFibGVkLFxuICAgICAgfSwgc2VuZE9wdHMpLCBmYWxzZSk7XG4gICAgfVxuXG4gICAgYXdhaXQgdGhpcy5zZW5kKCdzZXRTZW5kZXJLZXknLCBzZW5kT3B0cyk7XG4gICAgbG9nLmRlYnVnKCdTZW5kZXIga2V5IHNldCcpO1xuXG4gICAgaWYgKHRoaXMuaXNUYXJnZXRCYXNlZCAmJiB1dGlsLmNvbXBhcmVWZXJzaW9ucyh0aGlzLnBsYXRmb3JtVmVyc2lvbiwgJzwnLCBNSU5fUExBVEZPUk1fTk9fVEFSR0VUX0VYSVNUUykpIHtcbiAgICAgIGF3YWl0IHRoaXMuc2VuZCgnVGFyZ2V0LmV4aXN0cycsIHNlbmRPcHRzLCBmYWxzZSk7XG4gICAgfVxuXG4gICAgdGhpcy5zaG91bGRDaGVja0ZvclRhcmdldCA9IHRydWU7XG5cbiAgICBpZiAodGhpcy5mdWxsUGFnZUluaXRpYWxpemF0aW9uKSB7XG4gICAgICBhd2FpdCB0aGlzLmluaXRpYWxpemVQYWdlRnVsbChhcHBJZEtleSwgcGFnZUlkS2V5KTtcbiAgICB9IGVsc2Uge1xuICAgICAgYXdhaXQgdGhpcy5pbml0aWFsaXplUGFnZShhcHBJZEtleSwgcGFnZUlkS2V5KTtcbiAgICB9XG4gIH1cblxuICAvKlxuICAgKiBQZXJmb3JtIHRoZSBtaW5pbWFsIGluaXRpYWxpemF0aW9uIHRvIGdldCB0aGUgV2ViIEluc3BlY3RvciB3b3JraW5nXG4gICAqL1xuICBhc3luYyBpbml0aWFsaXplUGFnZSAoYXBwSWRLZXksIHBhZ2VJZEtleSkge1xuICAgIGNvbnN0IHNlbmRPcHRzID0ge1xuICAgICAgYXBwSWRLZXksXG4gICAgICBwYWdlSWRLZXksXG4gICAgfTtcblxuICAgIGF3YWl0IHRoaXMuc2VuZCgnSW5zcGVjdG9yLmVuYWJsZScsIHNlbmRPcHRzLCBmYWxzZSk7XG4gICAgYXdhaXQgdGhpcy5zZW5kKCdQYWdlLmVuYWJsZScsIHNlbmRPcHRzLCBmYWxzZSk7XG5cbiAgICAvLyBnbyB0aHJvdWdoIHRoZSB0YXNrcyB0byBpbml0aWFsaXplXG4gICAgYXdhaXQgdGhpcy5zZW5kKCdOZXR3b3JrLmVuYWJsZScsIHNlbmRPcHRzLCBmYWxzZSk7XG4gICAgYXdhaXQgdGhpcy5zZW5kKCdSdW50aW1lLmVuYWJsZScsIHNlbmRPcHRzLCBmYWxzZSk7XG4gICAgYXdhaXQgdGhpcy5zZW5kKCdIZWFwLmVuYWJsZScsIHNlbmRPcHRzLCBmYWxzZSk7XG4gICAgYXdhaXQgdGhpcy5zZW5kKCdEZWJ1Z2dlci5lbmFibGUnLCBzZW5kT3B0cywgZmFsc2UpO1xuICAgIGF3YWl0IHRoaXMuc2VuZCgnQ29uc29sZS5lbmFibGUnLCBzZW5kT3B0cywgZmFsc2UpO1xuICAgIGF3YWl0IHRoaXMuc2VuZCgnSW5zcGVjdG9yLmluaXRpYWxpemVkJywgc2VuZE9wdHMsIGZhbHNlKTtcbiAgfVxuXG4gIC8qXG4gICAqIE1pbWljIGV2ZXJ5IHN0ZXAgdGhhdCBEZXNrdG9wIFNhZmFyaSBEZXZlbG9wIHRvb2xzIHVzZXMgdG8gaW5pdGlhbGl6ZSBhXG4gICAqIFdlYiBJbnNwZWN0b3Igc2Vzc2lvblxuICAgKi9cbiAgYXN5bmMgaW5pdGlhbGl6ZVBhZ2VGdWxsIChhcHBJZEtleSwgcGFnZUlkS2V5KSB7XG4gICAgY29uc3Qgc2VuZE9wdHMgPSB7XG4gICAgICBhcHBJZEtleSxcbiAgICAgIHBhZ2VJZEtleSxcbiAgICB9O1xuXG4gICAgYXdhaXQgdGhpcy5zZW5kKCdJbnNwZWN0b3IuZW5hYmxlJywgc2VuZE9wdHMsIGZhbHNlKTtcbiAgICBhd2FpdCB0aGlzLnNlbmQoJ1BhZ2UuZW5hYmxlJywgc2VuZE9wdHMsIGZhbHNlKTtcblxuICAgIC8vIGdvIHRocm91Z2ggdGhlIHRhc2tzIHRvIGluaXRpYWxpemVcbiAgICBhd2FpdCB0aGlzLnNlbmQoJ1BhZ2UuZ2V0UmVzb3VyY2VUcmVlJywgc2VuZE9wdHMsIGZhbHNlKTtcbiAgICBhd2FpdCB0aGlzLnNlbmQoJ05ldHdvcmsuZW5hYmxlJywgc2VuZE9wdHMsIGZhbHNlKTtcbiAgICBhd2FpdCB0aGlzLnNlbmQoJ05ldHdvcmsuc2V0UmVzb3VyY2VDYWNoaW5nRGlzYWJsZWQnLCBPYmplY3QuYXNzaWduKHtcbiAgICAgIGRpc2FibGVkOiBmYWxzZSxcbiAgICB9LCBzZW5kT3B0cyksIGZhbHNlKTtcbiAgICBhd2FpdCB0aGlzLnNlbmQoJ0RPTVN0b3JhZ2UuZW5hYmxlJywgc2VuZE9wdHMsIGZhbHNlKTtcbiAgICBhd2FpdCB0aGlzLnNlbmQoJ0RhdGFiYXNlLmVuYWJsZScsIHNlbmRPcHRzLCBmYWxzZSk7XG4gICAgYXdhaXQgdGhpcy5zZW5kKCdJbmRleGVkREIuZW5hYmxlJywgc2VuZE9wdHMsIGZhbHNlKTtcbiAgICBhd2FpdCB0aGlzLnNlbmQoJ0NTUy5lbmFibGUnLCBzZW5kT3B0cywgZmFsc2UpO1xuICAgIGF3YWl0IHRoaXMuc2VuZCgnUnVudGltZS5lbmFibGUnLCBzZW5kT3B0cywgZmFsc2UpO1xuICAgIGF3YWl0IHRoaXMuc2VuZCgnSGVhcC5lbmFibGUnLCBzZW5kT3B0cywgZmFsc2UpO1xuICAgIGF3YWl0IHRoaXMuc2VuZCgnTWVtb3J5LmVuYWJsZScsIHNlbmRPcHRzLCBmYWxzZSk7XG4gICAgYXdhaXQgdGhpcy5zZW5kKCdBcHBsaWNhdGlvbkNhY2hlLmVuYWJsZScsIHNlbmRPcHRzLCBmYWxzZSk7XG4gICAgYXdhaXQgdGhpcy5zZW5kKCdBcHBsaWNhdGlvbkNhY2hlLmdldEZyYW1lc1dpdGhNYW5pZmVzdHMnLCBzZW5kT3B0cywgZmFsc2UpO1xuICAgIGF3YWl0IHRoaXMuc2VuZCgnVGltZWxpbmUuc2V0SW5zdHJ1bWVudHMnLCBPYmplY3QuYXNzaWduKHtcbiAgICAgIGluc3RydW1lbnRzOiBbJ1RpbWVsaW5lJywgJ1NjcmlwdFByb2ZpbGVyJywgJ0NQVSddLFxuICAgIH0sIHNlbmRPcHRzKSwgZmFsc2UpO1xuICAgIGF3YWl0IHRoaXMuc2VuZCgnVGltZWxpbmUuc2V0QXV0b0NhcHR1cmVFbmFibGVkJywgT2JqZWN0LmFzc2lnbih7XG4gICAgICBlbmFibGVkOiBmYWxzZSxcbiAgICB9LCBzZW5kT3B0cyksIGZhbHNlKTtcbiAgICBhd2FpdCB0aGlzLnNlbmQoJ0RlYnVnZ2VyLmVuYWJsZScsIHNlbmRPcHRzLCBmYWxzZSk7XG4gICAgYXdhaXQgdGhpcy5zZW5kKCdEZWJ1Z2dlci5zZXRCcmVha3BvaW50c0FjdGl2ZScsIE9iamVjdC5hc3NpZ24oe1xuICAgICAgYWN0aXZlOiB0cnVlLFxuICAgIH0sIHNlbmRPcHRzKSwgZmFsc2UpO1xuICAgIGF3YWl0IHRoaXMuc2VuZCgnRGVidWdnZXIuc2V0UGF1c2VPbkV4Y2VwdGlvbnMnLCBPYmplY3QuYXNzaWduKHtcbiAgICAgIHN0YXRlOiAnbm9uZScsXG4gICAgfSwgc2VuZE9wdHMpLCBmYWxzZSk7XG4gICAgYXdhaXQgdGhpcy5zZW5kKCdEZWJ1Z2dlci5zZXRQYXVzZU9uQXNzZXJ0aW9ucycsIE9iamVjdC5hc3NpZ24oe1xuICAgICAgZW5hYmxlZDogZmFsc2UsXG4gICAgfSwgc2VuZE9wdHMpLCBmYWxzZSk7XG4gICAgYXdhaXQgdGhpcy5zZW5kKCdEZWJ1Z2dlci5zZXRBc3luY1N0YWNrVHJhY2VEZXB0aCcsIE9iamVjdC5hc3NpZ24oe1xuICAgICAgZGVwdGg6IDIwMCxcbiAgICB9LCBzZW5kT3B0cyksIGZhbHNlKTtcbiAgICBhd2FpdCB0aGlzLnNlbmQoJ0RlYnVnZ2VyLnNldFBhdXNlRm9ySW50ZXJuYWxTY3JpcHRzJywgT2JqZWN0LmFzc2lnbih7XG4gICAgICBzaG91bGRQYXVzZTogZmFsc2UsXG4gICAgfSwgc2VuZE9wdHMpLCBmYWxzZSk7XG5cbiAgICBhd2FpdCB0aGlzLnNlbmQoJ0xheWVyVHJlZS5lbmFibGUnLCBzZW5kT3B0cywgZmFsc2UpO1xuICAgIGF3YWl0IHRoaXMuc2VuZCgnV29ya2VyLmVuYWJsZScsIHNlbmRPcHRzLCBmYWxzZSk7XG4gICAgYXdhaXQgdGhpcy5zZW5kKCdDYW52YXMuZW5hYmxlJywgc2VuZE9wdHMsIGZhbHNlKTtcbiAgICBhd2FpdCB0aGlzLnNlbmQoJ0NvbnNvbGUuZW5hYmxlJywgc2VuZE9wdHMsIGZhbHNlKTtcbiAgICBhd2FpdCB0aGlzLnNlbmQoJ0RPTS5nZXREb2N1bWVudCcsIHNlbmRPcHRzLCBmYWxzZSk7XG4gICAgY29uc3QgbG9nZ2luZ0NoYW5uZWxzID0gYXdhaXQgdGhpcy5zZW5kKCdDb25zb2xlLmdldExvZ2dpbmdDaGFubmVscycsIHNlbmRPcHRzKTtcbiAgICBmb3IgKGNvbnN0IHNvdXJjZSBvZiAobG9nZ2luZ0NoYW5uZWxzLmNoYW5uZWxzIHx8IFtdKS5tYXAoKGVudHJ5KSA9PiBlbnRyeS5zb3VyY2UpKSB7XG4gICAgICBhd2FpdCB0aGlzLnNlbmQoJ0NvbnNvbGUuc2V0TG9nZ2luZ0NoYW5uZWxMZXZlbCcsIE9iamVjdC5hc3NpZ24oe1xuICAgICAgICBzb3VyY2UsXG4gICAgICAgIGxldmVsOiAndmVyYm9zZScsXG4gICAgICB9LCBzZW5kT3B0cyksIGZhbHNlKTtcbiAgICB9XG5cbiAgICBhd2FpdCB0aGlzLnNlbmQoJ0luc3BlY3Rvci5pbml0aWFsaXplZCcsIHNlbmRPcHRzLCBmYWxzZSk7XG4gIH1cblxuICBhc3luYyBzZWxlY3RBcHAgKGFwcElkS2V5KSB7XG4gICAgcmV0dXJuIGF3YWl0IG5ldyBCKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgIC8vIGxvY2FsIGNhbGxiYWNrLCB0ZW1wb3JhcmlseSBhZGRlZCBhcyBjYWxsYmFjayB0b1xuICAgICAgLy8gYF9ycGNfYXBwbGljYXRpb25Db25uZWN0ZWQ6YCByZW1vdGUgZGVidWdnZXIgcmVzcG9uc2VcbiAgICAgIC8vIHRvIGhhbmRsZSB0aGUgaW5pdGlhbCBjb25uZWN0aW9uXG4gICAgICBjb25zdCBvbkFwcENoYW5nZSA9IChlcnIsIGRpY3QpID0+IHtcbiAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgIHJldHVybiByZWplY3QoZXJyKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBmcm9tIHRoZSBkaWN0aW9uYXJ5IHJldHVybmVkLCBnZXQgdGhlIGlkc1xuICAgICAgICBjb25zdCBvbGRBcHBJZEtleSA9IGRpY3QuV0lSSG9zdEFwcGxpY2F0aW9uSWRlbnRpZmllcktleTtcbiAgICAgICAgY29uc3QgY29ycmVjdEFwcElkS2V5ID0gZGljdC5XSVJBcHBsaWNhdGlvbklkZW50aWZpZXJLZXk7XG5cbiAgICAgICAgLy8gaWYgdGhpcyBpcyBhIHJlcG9ydCBvZiBhIHByb3h5IHJlZGlyZWN0IGZyb20gdGhlIHJlbW90ZSBkZWJ1Z2dlclxuICAgICAgICAvLyB3ZSB3YW50IHRvIHVwZGF0ZSBvdXIgZGljdGlvbmFyeSBhbmQgZ2V0IGEgbmV3IGFwcCBpZFxuICAgICAgICBpZiAob2xkQXBwSWRLZXkgJiYgY29ycmVjdEFwcElkS2V5ICE9PSBvbGRBcHBJZEtleSkge1xuICAgICAgICAgIGxvZy5kZWJ1ZyhgV2Ugd2VyZSBub3RpZmllZCB3ZSBtaWdodCBoYXZlIGNvbm5lY3RlZCB0byB0aGUgd3JvbmcgYXBwLiBgICtcbiAgICAgICAgICAgICAgICAgICAgYFVzaW5nIGlkICR7Y29ycmVjdEFwcElkS2V5fSBpbnN0ZWFkIG9mICR7b2xkQXBwSWRLZXl9YCk7XG4gICAgICAgIH1cblxuICAgICAgICByZWplY3QobmV3IEVycm9yKCdOZXcgYXBwbGljYXRpb24gaGFzIGNvbm5lY3RlZCcpKTtcbiAgICAgIH07XG4gICAgICB0aGlzLm1lc3NhZ2VIYW5kbGVyLnByZXBlbmRPbmNlTGlzdGVuZXIoJ19ycGNfYXBwbGljYXRpb25Db25uZWN0ZWQ6Jywgb25BcHBDaGFuZ2UpO1xuXG4gICAgICAvLyBkbyB0aGUgYWN0dWFsIGNvbm5lY3RpbmcgdG8gdGhlIGFwcFxuICAgICAgcmV0dXJuIChhc3luYyAoKSA9PiB7XG4gICAgICAgIGxldCBwYWdlRGljdCwgY29ubmVjdGVkQXBwSWRLZXk7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgKFtjb25uZWN0ZWRBcHBJZEtleSwgcGFnZURpY3RdID0gYXdhaXQgdGhpcy5zZW5kKCdjb25uZWN0VG9BcHAnLCB7XG4gICAgICAgICAgICBhcHBJZEtleVxuICAgICAgICAgIH0pKTtcbiAgICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgbG9nLndhcm4oYFVuYWJsZSB0byBjb25uZWN0IHRvIGFwcDogJHtlcnIubWVzc2FnZX1gKTtcbiAgICAgICAgICByZWplY3QoZXJyKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIHNvbWV0aW1lcyB0aGUgY29ubmVjdCBsb2dpYyBoYXBwZW5zLCBidXQgd2l0aCBhbiBlbXB0eSBkaWN0aW9uYXJ5XG4gICAgICAgIC8vIHdoaWNoIGxlYWRzIHRvIHRoZSByZW1vdGUgZGVidWdnZXIgZ2V0dGluZyBkaXNjb25uZWN0ZWQsIGFuZCBpbnRvIGEgbG9vcFxuICAgICAgICBpZiAoXy5pc0VtcHR5KHBhZ2VEaWN0KSkge1xuICAgICAgICAgIGxldCBtc2cgPSAnRW1wdHkgcGFnZSBkaWN0aW9uYXJ5IHJlY2VpdmVkJztcbiAgICAgICAgICBsb2cuZGVidWcobXNnKTtcbiAgICAgICAgICByZWplY3QobmV3IEVycm9yKG1zZykpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJlc29sdmUoW2Nvbm5lY3RlZEFwcElkS2V5LCBwYWdlRGljdF0pO1xuICAgICAgICB9XG4gICAgICB9KSgpO1xuICAgIH0pO1xuICB9XG5cbiAgb25FeGVjdXRpb25Db250ZXh0Q3JlYXRlZCAoZXJyLCBjb250ZXh0KSB7XG4gICAgLy8geyBpZDogMiwgaXNQYWdlQ29udGV4dDogdHJ1ZSwgbmFtZTogJycsIGZyYW1lSWQ6ICcwLjEnIH1cbiAgICAvLyByaWdodCBub3cgd2UgaGF2ZSBubyB3YXkgdG8gbWFwIGNvbnRleHRzIHRvIGFwcHMvcGFnZXNcbiAgICAvLyBzbyBqdXN0IHN0b3JlXG4gICAgdGhpcy5jb250ZXh0cy5wdXNoKGNvbnRleHQuaWQpO1xuICB9XG5cbiAgb25HYXJiYWdlQ29sbGVjdGVkICgpIHtcbiAgICAvLyBqdXN0IHdhbnQgdG8gbG9nIHRoYXQgdGhpcyBpcyBoYXBwZW5pbmcsIGFzIGl0IGNhbiBhZmZlY3Qgb3BlcnRpb25cbiAgICBsb2cuZGVidWcoYFdlYiBJbnNwZWN0b3IgZ2FyYmFnZSBjb2xsZWN0ZWRgKTtcbiAgfVxuXG4gIG9uU2NyaXB0UGFyc2VkIChlcnIsIHNjcmlwdEluZm8pIHtcbiAgICAvLyB7IHNjcmlwdElkOiAnMTMnLCB1cmw6ICcnLCBzdGFydExpbmU6IDAsIHN0YXJ0Q29sdW1uOiAwLCBlbmRMaW5lOiA4MiwgZW5kQ29sdW1uOiAzIH1cbiAgICBsb2cuZGVidWcoYFNjcmlwdCBwYXJzZWQ6ICR7SlNPTi5zdHJpbmdpZnkoc2NyaXB0SW5mbyl9YCk7XG4gIH1cbn1cbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUdBLE1BQU1BLGVBQWUsR0FBRztFQUFDQyxNQUFNLEVBQUU7QUFBRyxDQUFDO0FBRXJDLE1BQU1DLHVCQUF1QixHQUFHLEtBQUs7QUFDckMsTUFBTUMsd0JBQXdCLEdBQUcsSUFBSTtBQUVyQyxNQUFNQyw2QkFBNkIsR0FBRyxNQUFNOztBQUc1QyxNQUFNQyw2QkFBNkIsR0FBRyxNQUFNO0FBRTVDLFNBQVNDLGFBQWEsQ0FBRUMsUUFBUSxFQUFFQyxlQUFlLEVBQUU7RUFJakQsTUFBTUMsYUFBYSxHQUFHQyxhQUFJLENBQUNDLGVBQWUsQ0FBQ0gsZUFBZSxFQUFFLElBQUksRUFBRUosNkJBQTZCLENBQUM7RUFDaEdRLGVBQUcsQ0FBQ0MsS0FBSyxDQUFFLDhDQUE2Q04sUUFBUSxHQUFHLEVBQUUsR0FBRyxNQUFPLCtCQUE4QkMsZUFBZ0IsSUFBRyxDQUFDO0VBQ2pJSSxlQUFHLENBQUNDLEtBQUssQ0FBRSwwQ0FBeUNULDZCQUE4QixNQUFLSyxhQUFjLEVBQUMsQ0FBQztFQUN2RyxPQUFPQSxhQUFhO0FBQ3RCO0FBRWUsTUFBTUssU0FBUyxDQUFDO0VBQzdCQyxXQUFXLENBQUVDLElBQUksR0FBRyxDQUFDLENBQUMsRUFBRTtJQUN0QixJQUFJLENBQUNDLFFBQVEsR0FBRyxFQUFFO0lBQ2xCLElBQUksQ0FBQ0MscUJBQXFCLEdBQUcsQ0FBQyxDQUFDRixJQUFJLENBQUNHLG9CQUFvQjtJQUV4RCxNQUFNO01BQ0pDLFFBQVE7TUFDUlosZUFBZSxHQUFHLENBQUMsQ0FBQztNQUNwQkQsUUFBUSxHQUFHLElBQUk7TUFDZmMsbUJBQW1CLEdBQUcsS0FBSztNQUMzQkMsMEJBQTBCLEdBQUcs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