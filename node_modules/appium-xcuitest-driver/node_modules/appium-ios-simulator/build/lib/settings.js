"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.read = read;
exports.readSettings = readSettings;
exports.setReduceMotion = setReduceMotion;
exports.stub = stub;
exports.update = update;
exports.updateLocale = updateLocale;
exports.updateLocationSettings = updateLocationSettings;
exports.updateSafariGlobalSettings = updateSafariGlobalSettings;
exports.updateSafariUserSettings = updateSafariUserSettings;
exports.updateSettings = updateSettings;

require("source-map-support/register");

var _lodash = _interopRequireDefault(require("lodash"));

var _support = require("@appium/support");

var _path = _interopRequireDefault(require("path"));

var _logger = _interopRequireDefault(require("./logger"));

var _semver = _interopRequireDefault(require("semver"));

var _bluebird = _interopRequireDefault(require("bluebird"));

async function plistPaths(sim, identifier) {
  let paths = [];
  let simDirectory = sim.getDir();

  switch (identifier) {
    case 'webInspector':
      paths.push(_path.default.resolve(simDirectory, 'Library', 'Preferences', 'com.apple.webInspector.plist'));
      break;

    case 'mobileSafari':
      paths.push(_path.default.resolve(await sim.getAppDir('com.apple.mobilesafari'), 'Library', 'Preferences', 'com.apple.mobilesafari.plist'));
      break;

    case 'globalMobileSafari':
      paths.push(_path.default.resolve(simDirectory, 'Library', 'Preferences', 'com.apple.mobilesafari.plist'));
      break;

    case 'webUI':
      paths.push(_path.default.resolve(simDirectory, 'Library', 'Preferences', 'com.apple.WebUI.plist'));
      break;

    case 'webFoundation':
      paths.push(_path.default.resolve(simDirectory, 'Library', 'Preferences', 'com.apple.WebFoundation.plist'));
      break;

    case 'preferences':
      paths.push(_path.default.resolve(simDirectory, 'Library', 'Preferences', 'com.apple.Preferences.plist'));
      break;

    case 'locationServices':
      paths.push(_path.default.resolve(simDirectory, 'Library', 'Preferences', 'com.apple.locationd.plist'));
      break;

    case 'locationClients':
      paths.push(_path.default.resolve(simDirectory, 'Library', 'Caches', 'locationd', 'clients.plist'));
      break;

    case 'locationCache':
      paths.push(_path.default.resolve(simDirectory, 'Library', 'Caches', 'locationd', 'cache.plist'));
      paths.push(_path.default.resolve(simDirectory, 'Library', 'Preferences', 'com.apple.locationd.plist'));
      break;

    case 'userSettings':
      if (_semver.default.lt(_semver.default.coerce(sim.xcodeVersion.versionString), _semver.default.coerce('7.3'))) {
        paths.push(_path.default.resolve(simDirectory, 'Library', 'ConfigurationProfiles', 'UserSettings.plist'));
        paths.push(_path.default.resolve(simDirectory, 'Library', 'ConfigurationProfiles', 'EffectiveUserSettings.plist'));
        paths.push(_path.default.resolve(simDirectory, 'Library', 'ConfigurationProfiles', 'PublicInfo', 'PublicEffectiveUserSettings.plist'));
      } else {
        paths.push(_path.default.resolve(simDirectory, 'Library', 'UserConfigurationProfiles', 'UserSettings.plist'));
        paths.push(_path.default.resolve(simDirectory, 'Library', 'UserConfigurationProfiles', 'EffectiveUserSettings.plist'));
        paths.push(_path.default.resolve(simDirectory, 'Library', 'UserConfigurationProfiles', 'PublicInfo', 'PublicEffectiveUserSettings.plist'));
      }

      break;

    case 'effectiveUserSettings':
      paths.push(_path.default.resolve(simDirectory, 'Library', 'ConfigurationProfiles', 'EffectiveUserSettings.plist'));
      paths.push(_path.default.resolve(simDirectory, 'Library', 'ConfigurationProfiles', 'PublicInfo', 'PublicEffectiveUserSettings.plist'));
      break;

    case 'accessibilitySettings':
      paths.push(_path.default.resolve(simDirectory, 'Library', 'Preferences', 'com.apple.Accessibility.plist'));
      break;

    case 'uiStyleSettings':
      paths.push(_path.default.resolve(simDirectory, 'Library', 'Preferences', 'com.apple.uikitservices.userInterfaceStyleMode.plist'));
      break;
  }

  return paths;
}

async function updateSettings(sim, plist, updates) {
  return await _bluebird.default.reduce(await plistPaths(sim, plist), async function reducer(updated, path) {
    return (await update(path, updates)) || updated;
  }, false);
}

async function update(pathToPlist, updates) {
  const currentSettings = await read(pathToPlist);
  const newSettings = Object.assign({}, currentSettings, updates);

  if (_lodash.default.isEqual(currentSettings, newSettings)) {
    return false;
  }

  await _support.plist.updatePlistFile(pathToPlist, newSettings, true, false);
  return true;
}

async function readSettings(sim, plist) {
  let settings = {};

  for (let path of await plistPaths(sim, plist)) {
    settings[path] = await read(path);
  }

  return settings;
}

async function read(pathToPlist) {
  return await _support.plist.parsePlistFile(pathToPlist, false);
}

async function updateLocationSettings(sim, bundleId, authorized) {
  const newCachePrefs = {
    LastFenceActivityTimestamp: 412122103.232983,
    CleanShutdown: true
  };
  let updated = await updateSettings(sim, 'locationCache', {
    [bundleId]: newCachePrefs
  });
  const newClientPrefs = {
    BundleId: bundleId,
    Authorized: !!authorized,
    Whitelisted: false
  };

  for (const file of await plistPaths(sim, 'locationClients')) {
    _logger.default.debug(`Updating location client file: ${file}`);

    let updates = {};
    const plist = await read(file);
    const weirdLocKey = 'com.apple.locationd.bundle-/System/Library/' + 'PrivateFrameworks/AOSNotification.framework';

    if (!_lodash.default.has(plist, weirdLocKey)) {
      updates[weirdLocKey] = {
        BundlePath: '/System/Library/PrivateFrameworks/AOSNotification.framework',
        Whitelisted: false,
        Executable: '',
        Registered: ''
      };
    }

    const baseSetting = _lodash.default.has(plist, bundleId) ? plist[bundleId] : {};
    updates[bundleId] = _lodash.default.defaults(newClientPrefs, baseSetting);
    updates[bundleId].Executable = updates[bundleId].Executable || '';
    updates[bundleId].Registered = updates[bundleId].Registered || '';
    updated = (await update(file, updates)) || updated;
  }

  return updated;
}

async function setReduceMotion(sim, reduceMotion = true) {
  _logger.default.debug(`Updating reduce motion. Setting to ${reduceMotion}.`);

  const paths = await plistPaths(sim, 'accessibilitySettings');

  for (const file of paths) {
    await update(file, {
      ReduceMotionEnabled: reduceMotion ? 1 : 0
    });
  }
}

async function updateSafariGlobalSettings(sim, settingSet) {
  _logger.default.debug('Updating Safari global settings');

  let updated = false;

  for (const [file, safariSettingSet] of _lodash.default.toPairs(await readSettings(sim, 'globalMobileSafari'))) {
    let newSettings = {};

    for (const [key, value] of _lodash.default.toPairs(settingSet)) {
      if (safariSettingSet[key] !== value) {
        newSettings[key] = value;
      }
    }

    if (_lodash.default.isEmpty(newSettings)) {
      continue;
    }

    updated = (await update(file, newSettings)) || updated;
  }

  return updated;
}

async function updateSafariUserSettings(sim, settingSet) {
  _logger.default.debug('Updating Safari user settings');

  let newUserSettings = {};

  if (_lodash.default.has(settingSet, 'WebKitJavaScriptEnabled')) {
    newUserSettings.safariAllowJavaScript = settingSet.WebKitJavaScriptEnabled;
  }

  if (_lodash.default.has(settingSet, 'WebKitJavaScriptCanOpenWindowsAutomatically')) {
    newUserSettings.safariAllowPopups = settingSet.WebKitJavaScriptCanOpenWindowsAutomatically;
  }

  if (_lodash.default.has(settingSet, 'WarnAboutFraudulentWebsites')) {
    newUserSettings.safariForceFraudWarning = !settingSet.WarnAboutFraudulentWebsites;
  }

  if (_lodash.default.isEmpty(newUserSettings)) {
    return false;
  }

  let updated = false;

  for (const [file, userSettingSet] of _lodash.default.toPairs(await readSettings(sim, 'userSettings'))) {
    if (!_lodash.default.has(userSettingSet, 'restrictedBool')) {
      userSettingSet.restrictedBool = {};
    }

    for (let [key, value] of _lodash.default.toPairs(newUserSettings)) {
      userSettingSet.restrictedBool[key] = {
        value
      };
    }

    updated = (await update(file, userSettingSet)) || updated;
  }

  return updated;
}

async function updateLocale(sim, language, locale, calendarFormat) {
  let globalPrefs = _path.default.resolve(sim.getDir(), 'Library', 'Preferences', '.GlobalPreferences.plist');

  let data = await read(globalPrefs);
  let updates = {};

  if (language) {
    _logger.default.debug(`New language: ${language}`);

    let supportedLangs = data.AppleLanguages || [];

    if (supportedLangs.indexOf(language) !== 0) {
      updates.AppleLanguages = [language].concat(_lodash.default.without(supportedLangs, language));
    }
  }

  if (locale || calendarFormat) {
    let calSplit = '@calendar=';
    let curLocaleAndCal = data.AppleLocale || language || 'en';
    let split = curLocaleAndCal.split(calSplit);
    let curLoc = split[0];

    if (calendarFormat || split[1]) {
      calendarFormat = `${calSplit}${calendarFormat || split[1] || ''}`;
    }

    calendarFormat = calendarFormat || '';
    let newLocaleAndCal = locale ? locale : curLoc;

    if (calendarFormat) {
      newLocaleAndCal = `${newLocaleAndCal}${calendarFormat}`;
    }

    if (newLocaleAndCal !== curLocaleAndCal) {
      _logger.default.debug(`New locale: ${newLocaleAndCal}`);

      updates.AppleLocale = newLocaleAndCal;
    }
  }

  if (_lodash.default.size(updates) === 0) {
    _logger.default.debug('No locale updates necessary.');

    return false;
  }

  _logger.default.debug('Writing new locale plist data');

  await update(globalPrefs, updates);
  return true;
}

async function stub() {
  return await plistPaths;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJwbGlzdFBhdGhzIiwic2ltIiwiaWRlbnRpZmllciIsInBhdGhzIiwic2ltRGlyZWN0b3J5IiwiZ2V0RGlyIiwicHVzaCIsInBhdGgiLCJyZXNvbHZlIiwiZ2V0QXBwRGlyIiwic2VtdmVyIiwibHQiLCJjb2VyY2UiLCJ4Y29kZVZlcnNpb24iLCJ2ZXJzaW9uU3RyaW5nIiwidXBkYXRlU2V0dGluZ3MiLCJwbGlzdCIsInVwZGF0ZXMiLCJCIiwicmVkdWNlIiwicmVkdWNlciIsInVwZGF0ZWQiLCJ1cGRhdGUiLCJwYXRoVG9QbGlzdCIsImN1cnJlbnRTZXR0aW5ncyIsInJlYWQiLCJuZXdTZXR0aW5ncyIsIk9iamVjdCIsImFzc2lnbiIsIl8iLCJpc0VxdWFsIiwidXBkYXRlUGxpc3RGaWxlIiwicmVhZFNldHRpbmdzIiwic2V0dGluZ3MiLCJwYXJzZVBsaXN0RmlsZSIsInVwZGF0ZUxvY2F0aW9uU2V0dGluZ3MiLCJidW5kbGVJZCIsImF1dGhvcml6ZWQiLCJuZXdDYWNoZVByZWZzIiwiTGFzdEZlbmNlQWN0aXZpdHlUaW1lc3RhbXAiLCJDbGVhblNodXRkb3duIiwibmV3Q2xpZW50UHJlZnMiLCJCdW5kbGVJZCIsIkF1dGhvcml6ZWQiLCJXaGl0ZWxpc3RlZCIsImZpbGUiLCJsb2ciLCJkZWJ1ZyIsIndlaXJkTG9jS2V5IiwiaGFzIiwiQnVuZGxlUGF0aCIsIkV4ZWN1dGFibGUiLCJSZWdpc3RlcmVkIiwiYmFzZVNldHRpbmciLCJkZWZhdWx0cyIsInNldFJlZHVjZU1vdGlvbiIsInJlZHVjZU1vdGlvbiIsIlJlZHVjZU1vdGlvbkVuYWJsZWQiLCJ1cGRhdGVTYWZhcmlHbG9iYWxTZXR0aW5ncyIsInNldHRpbmdTZXQiLCJzYWZhcmlTZXR0aW5nU2V0IiwidG9QYWlycyIsImtleSIsInZhbHVlIiwiaXNFbXB0eSIsInVwZGF0ZVNhZmFyaVVzZXJTZXR0aW5ncyIsIm5ld1VzZXJTZXR0aW5ncyIsInNhZmFyaUFsbG93SmF2YVNjcmlwdCIsIldlYktpdEphdmFTY3JpcHRFbmFibGVkIiwic2FmYXJpQWxsb3dQb3B1cHMiLCJXZWJLaXRKYXZhU2NyaXB0Q2FuT3BlbldpbmRvd3NBdXRvbWF0aWNhbGx5Iiwic2FmYXJpRm9yY2VGcmF1ZFdhcm5pbmciLCJXYXJuQWJvdXRGcmF1ZHVsZW50V2Vic2l0ZXMiLCJ1c2VyU2V0dGluZ1NldCIsInJlc3RyaWN0ZWRCb29sIiwidXBkYXRlTG9jYWxlIiwibGFuZ3VhZ2UiLCJsb2NhbGUiLCJjYWxlbmRhckZvcm1hdCIsImdsb2JhbFByZWZzIiwiZGF0YSIsInN1cHBvcnRlZExhbmdzIiwiQXBwbGVMYW5ndWFnZXMiLCJpbmRleE9mIiwiY29uY2F0Iiwid2l0aG91dCIsImNhbFNwbGl0IiwiY3VyTG9jYWxlQW5kQ2FsIiwiQXBwbGVMb2NhbGUiLCJzcGxpdCIsImN1ckxvYyIsIm5ld0xvY2FsZUFuZENhbCIsInNpemUiLCJzdHViIl0sInNvdXJjZXMiOlsiLi4vLi4vbGliL3NldHRpbmdzLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgeyBwbGlzdCB9IGZyb20gJ0BhcHBpdW0vc3VwcG9ydCc7XG5pbXBvcnQgcGF0aCBmcm9tICdwYXRoJztcbmltcG9ydCBsb2cgZnJvbSAnLi9sb2dnZXInO1xuaW1wb3J0IHNlbXZlciBmcm9tICdzZW12ZXInO1xuaW1wb3J0IEIgZnJvbSAnYmx1ZWJpcmQnO1xuXG5cbi8vIHJldHVybnMgcGF0aCB0byBwbGlzdCBiYXNlZCBvbiBpZCBmb3IgcGxpc3QuXG4vLyB0aGVzZSBpZHMgYXJlIGFwcGl1bSB0ZXJtc1xuYXN5bmMgZnVuY3Rpb24gcGxpc3RQYXRocyAoc2ltLCBpZGVudGlmaWVyKSB7XG4gIGxldCBwYXRocyA9IFtdO1xuICBsZXQgc2ltRGlyZWN0b3J5ID0gc2ltLmdldERpcigpO1xuXG4gIHN3aXRjaCAoaWRlbnRpZmllcikge1xuICAgIGNhc2UgJ3dlYkluc3BlY3Rvcic6XG4gICAgICBwYXRocy5wdXNoKHBhdGgucmVzb2x2ZShzaW1EaXJlY3RvcnksICdMaWJyYXJ5JywgJ1ByZWZlcmVuY2VzJywgJ2NvbS5hcHBsZS53ZWJJbnNwZWN0b3IucGxpc3QnKSk7XG4gICAgICBicmVhaztcbiAgICBjYXNlICdtb2JpbGVTYWZhcmknOlxuICAgICAgcGF0aHMucHVzaChwYXRoLnJlc29sdmUoYXdhaXQgc2ltLmdldEFwcERpcignY29tLmFwcGxlLm1vYmlsZXNhZmFyaScpLCAnTGlicmFyeScsICdQcmVmZXJlbmNlcycsICdjb20uYXBwbGUubW9iaWxlc2FmYXJpLnBsaXN0JykpO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSAnZ2xvYmFsTW9iaWxlU2FmYXJpJzpcbiAgICAgIHBhdGhzLnB1c2gocGF0aC5yZXNvbHZlKHNpbURpcmVjdG9yeSwgJ0xpYnJhcnknLCAnUHJlZmVyZW5jZXMnLCAnY29tLmFwcGxlLm1vYmlsZXNhZmFyaS5wbGlzdCcpKTtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgJ3dlYlVJJzpcbiAgICAgIHBhdGhzLnB1c2gocGF0aC5yZXNvbHZlKHNpbURpcmVjdG9yeSwgJ0xpYnJhcnknLCAnUHJlZmVyZW5jZXMnLCAnY29tLmFwcGxlLldlYlVJLnBsaXN0JykpO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSAnd2ViRm91bmRhdGlvbic6XG4gICAgICBwYXRocy5wdXNoKHBhdGgucmVzb2x2ZShzaW1EaXJlY3RvcnksICdMaWJyYXJ5JywgJ1ByZWZlcmVuY2VzJywgJ2NvbS5hcHBsZS5XZWJGb3VuZGF0aW9uLnBsaXN0JykpO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSAncHJlZmVyZW5jZXMnOlxuICAgICAgcGF0aHMucHVzaChwYXRoLnJlc29sdmUoc2ltRGlyZWN0b3J5LCAnTGlicmFyeScsICdQcmVmZXJlbmNlcycsICdjb20uYXBwbGUuUHJlZmVyZW5jZXMucGxpc3QnKSk7XG4gICAgICBicmVhaztcbiAgICBjYXNlICdsb2NhdGlvblNlcnZpY2VzJzpcbiAgICAgIHBhdGhzLnB1c2gocGF0aC5yZXNvbHZlKHNpbURpcmVjdG9yeSwgJ0xpYnJhcnknLCAnUHJlZmVyZW5jZXMnLCAnY29tLmFwcGxlLmxvY2F0aW9uZC5wbGlzdCcpKTtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgJ2xvY2F0aW9uQ2xpZW50cyc6XG4gICAgICBwYXRocy5wdXNoKHBhdGgucmVzb2x2ZShzaW1EaXJlY3RvcnksICdMaWJyYXJ5JywgJ0NhY2hlcycsICdsb2NhdGlvbmQnLCAnY2xpZW50cy5wbGlzdCcpKTtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgJ2xvY2F0aW9uQ2FjaGUnOlxuICAgICAgcGF0aHMucHVzaChwYXRoLnJlc29sdmUoc2ltRGlyZWN0b3J5LCAnTGlicmFyeScsICdDYWNoZXMnLCAnbG9jYXRpb25kJywgJ2NhY2hlLnBsaXN0JykpO1xuICAgICAgcGF0aHMucHVzaChwYXRoLnJlc29sdmUoc2ltRGlyZWN0b3J5LCAnTGlicmFyeScsICdQcmVmZXJlbmNlcycsICdjb20uYXBwbGUubG9jYXRpb25kLnBsaXN0JykpO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSAndXNlclNldHRpbmdzJzpcbiAgICAgIGlmIChzZW12ZXIubHQoc2VtdmVyLmNvZXJjZShzaW0ueGNvZGVWZXJzaW9uLnZlcnNpb25TdHJpbmcpLCBzZW12ZXIuY29lcmNlKCc3LjMnKSkpIHtcbiAgICAgICAgcGF0aHMucHVzaChwYXRoLnJlc29sdmUoc2ltRGlyZWN0b3J5LCAnTGlicmFyeScsICdDb25maWd1cmF0aW9uUHJvZmlsZXMnLCAnVXNlclNldHRpbmdzLnBsaXN0JykpO1xuICAgICAgICBwYXRocy5wdXNoKHBhdGgucmVzb2x2ZShzaW1EaXJlY3RvcnksICdMaWJyYXJ5JywgJ0NvbmZpZ3VyYXRpb25Qcm9maWxlcycsICdFZmZlY3RpdmVVc2VyU2V0dGluZ3MucGxpc3QnKSk7XG4gICAgICAgIHBhdGhzLnB1c2gocGF0aC5yZXNvbHZlKHNpbURpcmVjdG9yeSwgJ0xpYnJhcnknLCAnQ29uZmlndXJhdGlvblByb2ZpbGVzJywgJ1B1YmxpY0luZm8nLCAnUHVibGljRWZmZWN0aXZlVXNlclNldHRpbmdzLnBsaXN0JykpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcGF0aHMucHVzaChwYXRoLnJlc29sdmUoc2ltRGlyZWN0b3J5LCAnTGlicmFyeScsICdVc2VyQ29uZmlndXJhdGlvblByb2ZpbGVzJywgJ1VzZXJTZXR0aW5ncy5wbGlzdCcpKTtcbiAgICAgICAgcGF0aHMucHVzaChwYXRoLnJlc29sdmUoc2ltRGlyZWN0b3J5LCAnTGlicmFyeScsICdVc2VyQ29uZmlndXJhdGlvblByb2ZpbGVzJywgJ0VmZmVjdGl2ZVVzZXJTZXR0aW5ncy5wbGlzdCcpKTtcbiAgICAgICAgcGF0aHMucHVzaChwYXRoLnJlc29sdmUoc2ltRGlyZWN0b3J5LCAnTGlicmFyeScsICdVc2VyQ29uZmlndXJhdGlvblByb2ZpbGVzJywgJ1B1YmxpY0luZm8nLCAnUHVibGljRWZmZWN0aXZlVXNlclNldHRpbmdzLnBsaXN0JykpO1xuICAgICAgfVxuICAgICAgYnJlYWs7XG4gICAgY2FzZSAnZWZmZWN0aXZlVXNlclNldHRpbmdzJzpcbiAgICAgIHBhdGhzLnB1c2gocGF0aC5yZXNvbHZlKHNpbURpcmVjdG9yeSwgJ0xpYnJhcnknLCAnQ29uZmlndXJhdGlvblByb2ZpbGVzJywgJ0VmZmVjdGl2ZVVzZXJTZXR0aW5ncy5wbGlzdCcpKTtcbiAgICAgIHBhdGhzLnB1c2gocGF0aC5yZXNvbHZlKHNpbURpcmVjdG9yeSwgJ0xpYnJhcnknLCAnQ29uZmlndXJhdGlvblByb2ZpbGVzJywgJ1B1YmxpY0luZm8nLCAnUHVibGljRWZmZWN0aXZlVXNlclNldHRpbmdzLnBsaXN0JykpO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSAnYWNjZXNzaWJpbGl0eVNldHRpbmdzJzpcbiAgICAgIHBhdGhzLnB1c2gocGF0aC5yZXNvbHZlKHNpbURpcmVjdG9yeSwgJ0xpYnJhcnknLCAnUHJlZmVyZW5jZXMnLCAnY29tLmFwcGxlLkFjY2Vzc2liaWxpdHkucGxpc3QnKSk7XG4gICAgICBicmVhaztcbiAgICBjYXNlICd1aVN0eWxlU2V0dGluZ3MnOlxuICAgICAgcGF0aHMucHVzaChwYXRoLnJlc29sdmUoc2ltRGlyZWN0b3J5LCAnTGlicmFyeScsICdQcmVmZXJlbmNlcycsICdjb20uYXBwbGUudWlraXRzZXJ2aWNlcy51c2VySW50ZXJmYWNlU3R5bGVNb2RlLnBsaXN0JykpO1xuICAgICAgYnJlYWs7XG4gIH1cblxuICByZXR1cm4gcGF0aHM7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIHVwZGF0ZVNldHRpbmdzIChzaW0sIHBsaXN0LCB1cGRhdGVzKSB7XG4gIHJldHVybiBhd2FpdCBCLnJlZHVjZShhd2FpdCBwbGlzdFBhdGhzKHNpbSwgcGxpc3QpLCBhc3luYyBmdW5jdGlvbiByZWR1Y2VyICh1cGRhdGVkLCBwYXRoKSB7XG4gICAgcmV0dXJuIGF3YWl0IHVwZGF0ZShwYXRoLCB1cGRhdGVzKSB8fCB1cGRhdGVkO1xuICB9LCBmYWxzZSk7XG59XG5cbi8vIHVwZGF0ZSBhIHBsaXN0IGZpbGUsIGxvY2F0ZWQgYXQgcGF0aFRvUGxpc3Rcbi8vIHBhc3MgaW4gYW4gb2JqZWN0LCBhbGwgc2V0dGluZ3Mgc3BlY2lmaWVkIGluIHRoZSBvYmplY3Qgd2lsbCBiZVxuLy8gdXBkYXRlZCBvbiB0aGUgcGxpc3QsIGFsbCBvdGhlcnMgbGVmdCBhcy1pc1xuYXN5bmMgZnVuY3Rpb24gdXBkYXRlIChwYXRoVG9QbGlzdCwgdXBkYXRlcykge1xuICBjb25zdCBjdXJyZW50U2V0dGluZ3MgPSBhd2FpdCByZWFkKHBhdGhUb1BsaXN0KTtcbiAgY29uc3QgbmV3U2V0dGluZ3MgPSBPYmplY3QuYXNzaWduKHt9LCBjdXJyZW50U2V0dGluZ3MsIHVwZGF0ZXMpO1xuXG4gIGlmIChfLmlzRXF1YWwoY3VycmVudFNldHRpbmdzLCBuZXdTZXR0aW5ncykpIHtcbiAgICAvLyBubyBzZXR0aW5nIGNoYW5nZXMsIHNvIGRvIG5vdGhpbmdcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBhd2FpdCBwbGlzdC51cGRhdGVQbGlzdEZpbGUocGF0aFRvUGxpc3QsIG5ld1NldHRpbmdzLCB0cnVlLCBmYWxzZSk7XG4gIHJldHVybiB0cnVlO1xufVxuXG5hc3luYyBmdW5jdGlvbiByZWFkU2V0dGluZ3MgKHNpbSwgcGxpc3QpIHtcbiAgbGV0IHNldHRpbmdzID0ge307XG4gIGZvciAobGV0IHBhdGggb2YgYXdhaXQgcGxpc3RQYXRocyhzaW0sIHBsaXN0KSkge1xuICAgIHNldHRpbmdzW3BhdGhdID0gYXdhaXQgcmVhZChwYXRoKTtcbiAgfVxuICByZXR1cm4gc2V0dGluZ3M7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIHJlYWQgKHBhdGhUb1BsaXN0KSB7XG4gIHJldHVybiBhd2FpdCBwbGlzdC5wYXJzZVBsaXN0RmlsZShwYXRoVG9QbGlzdCwgZmFsc2UpO1xufVxuXG5hc3luYyBmdW5jdGlvbiB1cGRhdGVMb2NhdGlvblNldHRpbmdzIChzaW0sIGJ1bmRsZUlkLCBhdXRob3JpemVkKSB7XG4gIC8vIHVwZGF0ZSBsb2NhdGlvbiBjYWNoZVxuICBjb25zdCBuZXdDYWNoZVByZWZzID0ge1xuICAgIExhc3RGZW5jZUFjdGl2aXR5VGltZXN0YW1wOiA0MTIxMjIxMDMuMjMyOTgzLFxuICAgIENsZWFuU2h1dGRvd246IHRydWVcbiAgfTtcbiAgbGV0IHVwZGF0ZWQgPSBhd2FpdCB1cGRhdGVTZXR0aW5ncyhzaW0sICdsb2NhdGlvbkNhY2hlJywge1tidW5kbGVJZF06IG5ld0NhY2hlUHJlZnN9KTtcblxuICAvLyB1cGRhdGUgbG9jYXRpb24gY2xpZW50c1xuICBjb25zdCBuZXdDbGllbnRQcmVmcyA9IHtcbiAgICBCdW5kbGVJZDogYnVuZGxlSWQsXG4gICAgQXV0aG9yaXplZDogISFhdXRob3JpemVkLFxuICAgIFdoaXRlbGlzdGVkOiBmYWxzZSxcbiAgfTtcbiAgZm9yIChjb25zdCBmaWxlIG9mIGF3YWl0IHBsaXN0UGF0aHMoc2ltLCAnbG9jYXRpb25DbGllbnRzJykpIHtcbiAgICBsb2cuZGVidWcoYFVwZGF0aW5nIGxvY2F0aW9uIGNsaWVudCBmaWxlOiAke2ZpbGV9YCk7XG5cbiAgICBsZXQgdXBkYXRlcyA9IHt9O1xuXG4gICAgLy8gc2VlIGlmIHRoZSBidW5kbGUgaXMgYWxyZWFkeSB0aGVyZVxuICAgIGNvbnN0IHBsaXN0ID0gYXdhaXQgcmVhZChmaWxlKTtcblxuICAgIC8vIHJhbmRvbSBkYXRhIHRoYXQgYWx3YXlzIHNlZW1zIHRvIGJlIGluIHRoZSBjbGllbnRzLnBsaXN0XG4gICAgY29uc3Qgd2VpcmRMb2NLZXkgPSAnY29tLmFwcGxlLmxvY2F0aW9uZC5idW5kbGUtL1N5c3RlbS9MaWJyYXJ5LycgK1xuICAgICAgICAgICAgICAgICAgICAgICAgJ1ByaXZhdGVGcmFtZXdvcmtzL0FPU05vdGlmaWNhdGlvbi5mcmFtZXdvcmsnO1xuICAgIGlmICghXy5oYXMocGxpc3QsIHdlaXJkTG9jS2V5KSkge1xuICAgICAgdXBkYXRlc1t3ZWlyZExvY0tleV0gPSB7XG4gICAgICAgIEJ1bmRsZVBhdGg6ICcvU3lzdGVtL0xpYnJhcnkvUHJpdmF0ZUZyYW1ld29ya3MvQU9TTm90aWZpY2F0aW9uLmZyYW1ld29yaycsXG4gICAgICAgIFdoaXRlbGlzdGVkOiBmYWxzZSxcbiAgICAgICAgRXhlY3V0YWJsZTogJycsXG4gICAgICAgIFJlZ2lzdGVyZWQ6ICcnXG4gICAgICB9O1xuICAgIH1cblxuICAgIC8vIGNyZWF0ZSB0aGUgdXBkYXRlLCBhbmQgbWFrZSBzdXJlIGl0IGhhcyBzZW5zaWJsZSB2YWx1ZXNcbiAgICBjb25zdCBiYXNlU2V0dGluZyA9IF8uaGFzKHBsaXN0LCBidW5kbGVJZCkgPyBwbGlzdFtidW5kbGVJZF0gOiB7fTtcbiAgICB1cGRhdGVzW2J1bmRsZUlkXSA9IF8uZGVmYXVsdHMobmV3Q2xpZW50UHJlZnMsIGJhc2VTZXR0aW5nKTtcbiAgICB1cGRhdGVzW2J1bmRsZUlkXS5FeGVjdXRhYmxlID0gdXBkYXRlc1tidW5kbGVJZF0uRXhlY3V0YWJsZSB8fCAnJztcbiAgICB1cGRhdGVzW2J1bmRsZUlkXS5SZWdpc3RlcmVkID0gdXBkYXRlc1tidW5kbGVJZF0uUmVnaXN0ZXJlZCB8fCAnJztcblxuICAgIHVwZGF0ZWQgPSBhd2FpdCB1cGRhdGUoZmlsZSwgdXBkYXRlcykgfHwgdXBkYXRlZDtcbiAgfVxuXG4gIHJldHVybiB1cGRhdGVkO1xufVxuXG5hc3luYyBmdW5jdGlvbiBzZXRSZWR1Y2VNb3Rpb24gKHNpbSwgcmVkdWNlTW90aW9uID0gdHJ1ZSkge1xuICBsb2cuZGVidWcoYFVwZGF0aW5nIHJlZHVjZSBtb3Rpb24uIFNldHRpbmcgdG8gJHtyZWR1Y2VNb3Rpb259LmApO1xuICBjb25zdCBwYXRocyA9IGF3YWl0IHBsaXN0UGF0aHMoc2ltLCAnYWNjZXNzaWJpbGl0eVNldHRpbmdzJyk7XG4gIGZvciAoY29uc3QgZmlsZSBvZiBwYXRocykge1xuICAgIGF3YWl0IHVwZGF0ZShmaWxlLCB7XG4gICAgICBSZWR1Y2VNb3Rpb25FbmFibGVkOiByZWR1Y2VNb3Rpb24gPyAxIDogMFxuICAgIH0pO1xuICB9XG59XG5cbmFzeW5jIGZ1bmN0aW9uIHVwZGF0ZVNhZmFyaUdsb2JhbFNldHRpbmdzIChzaW0sIHNldHRpbmdTZXQpIHtcbiAgbG9nLmRlYnVnKCdVcGRhdGluZyBTYWZhcmkgZ2xvYmFsIHNldHRpbmdzJyk7XG5cbiAgbGV0IHVwZGF0ZWQgPSBmYWxzZTtcbiAgZm9yIChjb25zdCBbZmlsZSwgc2FmYXJpU2V0dGluZ1NldF0gb2YgXy50b1BhaXJzKGF3YWl0IHJlYWRTZXR0aW5ncyhzaW0sICdnbG9iYWxNb2JpbGVTYWZhcmknKSkpIHtcbiAgICBsZXQgbmV3U2V0dGluZ3MgPSB7fTtcbiAgICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiBfLnRvUGFpcnMoc2V0dGluZ1NldCkpIHtcbiAgICAgIGlmIChzYWZhcmlTZXR0aW5nU2V0W2tleV0gIT09IHZhbHVlKSB7XG4gICAgICAgIG5ld1NldHRpbmdzW2tleV0gPSB2YWx1ZTtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKF8uaXNFbXB0eShuZXdTZXR0aW5ncykpIHtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cblxuICAgIHVwZGF0ZWQgPSBhd2FpdCB1cGRhdGUoZmlsZSwgbmV3U2V0dGluZ3MpIHx8IHVwZGF0ZWQ7XG4gIH1cbiAgcmV0dXJuIHVwZGF0ZWQ7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIHVwZGF0ZVNhZmFyaVVzZXJTZXR0aW5ncyAoc2ltLCBzZXR0aW5nU2V0KSB7XG4gIGxvZy5kZWJ1ZygnVXBkYXRpbmcgU2FmYXJpIHVzZXIgc2V0dGluZ3MnKTtcblxuICAvLyBhZGQgZXh0cmEgc3R1ZmYgdG8gVXNlclNldHRpbmdzLnBsaXN0IGFuZCBFZmZlY3RpdmVVc2VyU2V0dGluZ3MucGxpc3RcbiAgbGV0IG5ld1VzZXJTZXR0aW5ncyA9IHt9O1xuICBpZiAoXy5oYXMoc2V0dGluZ1NldCwgJ1dlYktpdEphdmFTY3JpcHRFbmFibGVkJykpIHtcbiAgICBuZXdVc2VyU2V0dGluZ3Muc2FmYXJpQWxsb3dKYXZhU2NyaXB0ID0gc2V0dGluZ1NldC5XZWJLaXRKYXZhU2NyaXB0RW5hYmxlZDtcbiAgfVxuICBpZiAoXy5oYXMoc2V0dGluZ1NldCwgJ1dlYktpdEphdmFTY3JpcHRDYW5PcGVuV2luZG93c0F1dG9tYXRpY2FsbHknKSkge1xuICAgIG5ld1VzZXJTZXR0aW5ncy5zYWZhcmlBbGxvd1BvcHVwcyA9IHNldHRpbmdTZXQuV2ViS2l0SmF2YVNjcmlwdENhbk9wZW5XaW5kb3dzQXV0b21hdGljYWxseTtcbiAgfVxuICBpZiAoXy5oYXMoc2V0dGluZ1NldCwgJ1dhcm5BYm91dEZyYXVkdWxlbnRXZWJzaXRlcycpKSB7XG4gICAgbmV3VXNlclNldHRpbmdzLnNhZmFyaUZvcmNlRnJhdWRXYXJuaW5nID0gIXNldHRpbmdTZXQuV2FybkFib3V0RnJhdWR1bGVudFdlYnNpdGVzO1xuICB9XG5cbiAgaWYgKF8uaXNFbXB0eShuZXdVc2VyU2V0dGluZ3MpKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgbGV0IHVwZGF0ZWQgPSBmYWxzZTtcbiAgZm9yIChjb25zdCBbZmlsZSwgdXNlclNldHRpbmdTZXRdIG9mIF8udG9QYWlycyhhd2FpdCByZWFkU2V0dGluZ3Moc2ltLCAndXNlclNldHRpbmdzJykpKSB7XG4gICAgLy8gdGhlIHVzZXIgc2V0dGluZ3MgcGxpc3QgaGFzIHR3byBidWNrZXRzLCBvbmUgZm9yXG4gICAgLy8gYm9vbGVhbiBzZXR0aW5ncyAoYHJlc3RyaWN0ZWRCb29sYCkgYW5kIG9uZSBmb3JcbiAgICAvLyBvdGhlciB2YWx1ZSBzZXR0aW5ncyAoYHJlc3RyaWN0ZWRWYWx1ZWApLiBJbiBlYWNoLCB0aGUgdmFsdWVcbiAgICAvLyBpcyBpbiBhIGB2YWx1ZWAgc3ViLWZpZWxkLlxuICAgIGlmICghXy5oYXModXNlclNldHRpbmdTZXQsICdyZXN0cmljdGVkQm9vbCcpKSB7XG4gICAgICB1c2VyU2V0dGluZ1NldC5yZXN0cmljdGVkQm9vbCA9IHt9O1xuICAgIH1cbiAgICBmb3IgKGxldCBba2V5LCB2YWx1ZV0gb2YgXy50b1BhaXJzKG5ld1VzZXJTZXR0aW5ncykpIHtcbiAgICAgIHVzZXJTZXR0aW5nU2V0LnJlc3RyaWN0ZWRCb29sW2tleV0gPSB7dmFsdWV9O1xuICAgIH1cblxuICAgIC8vIGFjdHVhbGx5IGRvIHRoZSB1cGRhdGVcbiAgICB1cGRhdGVkID0gYXdhaXQgdXBkYXRlKGZpbGUsIHVzZXJTZXR0aW5nU2V0KSB8fCB1cGRhdGVkO1xuICB9XG5cbiAgcmV0dXJuIHVwZGF0ZWQ7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIHVwZGF0ZUxvY2FsZSAoc2ltLCBsYW5ndWFnZSwgbG9jYWxlLCBjYWxlbmRhckZvcm1hdCkge1xuICBsZXQgZ2xvYmFsUHJlZnMgPSBwYXRoLnJlc29sdmUoc2ltLmdldERpcigpLCAnTGlicmFyeScsICdQcmVmZXJlbmNlcycsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnLkdsb2JhbFByZWZlcmVuY2VzLnBsaXN0Jyk7XG5cbiAgLy8gZ2V0IHRoZSBjdXJyZW50IGRhdGFcbiAgbGV0IGRhdGEgPSBhd2FpdCByZWFkKGdsb2JhbFByZWZzKTtcbiAgbGV0IHVwZGF0ZXMgPSB7fTtcblxuICAvLyBpZiB3ZSBhcmUgc2V0dGluZyB0aGUgbGFuZ3VhZ2UsIGFkZCBpdCB0byB0aGUgYmVnaW5uaW5nIG9mIHRoZSBsaXN0IG9mIGxhbmd1YWdlc1xuICBpZiAobGFuZ3VhZ2UpIHtcbiAgICBsb2cuZGVidWcoYE5ldyBsYW5ndWFnZTogJHtsYW5ndWFnZX1gKTtcbiAgICBsZXQgc3VwcG9ydGVkTGFuZ3MgPSBkYXRhLkFwcGxlTGFuZ3VhZ2VzIHx8IFtdO1xuICAgIC8vIGlmIHRoZSBsYW5ndWFnZSBpcyBmaXJzdCwgd2UgZG9uJ3QgbmVlZCB0byBkbyBhbnl0aGluZ1xuICAgIGlmIChzdXBwb3J0ZWRMYW5ncy5pbmRleE9mKGxhbmd1YWdlKSAhPT0gMCkge1xuICAgICAgdXBkYXRlcy5BcHBsZUxhbmd1YWdlcyA9IFtsYW5ndWFnZV0uY29uY2F0KF8ud2l0aG91dChzdXBwb3J0ZWRMYW5ncywgbGFuZ3VhZ2UpKTtcbiAgICB9XG4gIH1cbiAgLy8gaWYgd2UgYXJlIHNldHRpbmcgdGhlIGxvY2FsZSBvciBjYWxlbmRhciBmb3JtYXQsIHNldCB0aGVtIGFzIGFwcHJvcHJpYXRlXG4gIGlmIChsb2NhbGUgfHwgY2FsZW5kYXJGb3JtYXQpIHtcbiAgICBsZXQgY2FsU3BsaXQgPSAnQGNhbGVuZGFyPSc7XG4gICAgbGV0IGN1ckxvY2FsZUFuZENhbCA9IGRhdGEuQXBwbGVMb2NhbGUgfHwgbGFuZ3VhZ2UgfHwgJ2VuJztcblxuICAgIGxldCBzcGxpdCA9IGN1ckxvY2FsZUFuZENhbC5zcGxpdChjYWxTcGxpdCk7XG4gICAgbGV0IGN1ckxvYyA9IHNwbGl0WzBdO1xuICAgIGlmIChjYWxlbmRhckZvcm1hdCB8fCBzcGxpdFsxXSkge1xuICAgICAgY2FsZW5kYXJGb3JtYXQgPSBgJHtjYWxTcGxpdH0ke2NhbGVuZGFyRm9ybWF0IHx8IHNwbGl0WzFdIHx8ICcnfWA7XG4gICAgfVxuICAgIGNhbGVuZGFyRm9ybWF0ID0gY2FsZW5kYXJGb3JtYXQgfHwgJyc7XG4gICAgbGV0IG5ld0xvY2FsZUFuZENhbCA9IGxvY2FsZSA/IGxvY2FsZSA6IGN1ckxvYztcbiAgICBpZiAoY2FsZW5kYXJGb3JtYXQpIHtcbiAgICAgIG5ld0xvY2FsZUFuZENhbCA9IGAke25ld0xvY2FsZUFuZENhbH0ke2NhbGVuZGFyRm9ybWF0fWA7XG4gICAgfVxuICAgIC8vIG9ubHkgbmVlZCB0byB1cGRhdGUgaWYgaXQgaGFzIGNoYW5nZWRcbiAgICBpZiAobmV3TG9jYWxlQW5kQ2FsICE9PSBjdXJMb2NhbGVBbmRDYWwpIHtcbiAgICAgIGxvZy5kZWJ1ZyhgTmV3IGxvY2FsZTogJHtuZXdMb2NhbGVBbmRDYWx9YCk7XG4gICAgICB1cGRhdGVzLkFwcGxlTG9jYWxlID0gbmV3TG9jYWxlQW5kQ2FsO1xuICAgIH1cbiAgfVxuXG4gIGlmIChfLnNpemUodXBkYXRlcykgPT09IDApIHtcbiAgICBsb2cuZGVidWcoJ05vIGxvY2FsZSB1cGRhdGVzIG5lY2Vzc2FyeS4nKTtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBsb2cuZGVidWcoJ1dyaXRpbmcgbmV3IGxvY2FsZSBwbGlzdCBkYXRhJyk7XG4gIGF3YWl0IHVwZGF0ZShnbG9iYWxQcmVmcywgdXBkYXRlcyk7XG4gIHJldHVybiB0cnVlO1xufVxuXG5hc3luYyBmdW5jdGlvbiBzdHViICgpIHtcbiAgcmV0dXJuIGF3YWl0IHBsaXN0UGF0aHM7XG59XG5cbmV4cG9ydCB7XG4gIHVwZGF0ZSwgdXBkYXRlU2V0dGluZ3MsIHVwZGF0ZUxvY2F0aW9uU2V0dGluZ3MsIHNldFJlZHVjZU1vdGlvbixcbiAgdXBkYXRlU2FmYXJpVXNlclNldHRpbmdzLCB1cGRhdGVTYWZhcmlHbG9iYWxTZXR0aW5ncywgdXBkYXRlTG9jYWxlLCByZWFkLFxuICByZWFkU2V0dGluZ3MsIHN0dWIsXG59O1xuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBOztBQUNBOztBQUNBOztBQUNB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