"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.SimulatorXcode6 = exports.SPRINGBOARD_BUNDLE_ID = exports.BOOT_COMPLETED_EVENT = void 0;

require("source-map-support/register");

var _path = _interopRequireDefault(require("path"));

var _appiumXcode = _interopRequireWildcard(require("appium-xcode"));

var _logger = _interopRequireDefault(require("./logger"));

var _support = require("@appium/support");

var _bluebird = _interopRequireDefault(require("bluebird"));

var _lodash = _interopRequireDefault(require("lodash"));

var _asyncLock = _interopRequireDefault(require("async-lock"));

var _utils = require("./utils.js");

var _asyncbox = require("asyncbox");

var settings = _interopRequireWildcard(require("./settings"));

var _teen_process = require("teen_process");

var _tailUntil = require("./tail-until.js");

var _index = _interopRequireDefault(require("./extensions/index"));

var _events = require("events");

var _calendar = _interopRequireDefault(require("./calendar"));

var _permissions = _interopRequireDefault(require("./permissions"));

var _nodeSimctl = _interopRequireDefault(require("node-simctl"));

function _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== "function") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function (nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }

function _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

const STARTUP_TIMEOUT = 60 * 1000;
const EXTRA_STARTUP_TIME = 2000;
const UI_CLIENT_ACCESS_GUARD = new _asyncLock.default();
const UI_CLIENT_BUNDLE_ID = 'com.apple.iphonesimulator';
const SPRINGBOARD_BUNDLE_ID = 'com.apple.SpringBoard';
exports.SPRINGBOARD_BUNDLE_ID = SPRINGBOARD_BUNDLE_ID;
const BOOT_COMPLETED_EVENT = 'bootCompleted';
exports.BOOT_COMPLETED_EVENT = BOOT_COMPLETED_EVENT;

class SimulatorXcode6 extends _events.EventEmitter {
  constructor(udid, xcodeVersion) {
    super();
    this.udid = String(udid);
    this.simctl = new _nodeSimctl.default({
      udid: this.udid
    });
    this.xcodeVersion = xcodeVersion;
    this._platformVersion = null;
    this.keychainPath = _path.default.resolve(this.getDir(), 'Library', 'Keychains');
    this.simulatorApp = 'iOS Simulator.app';
    this.appDataBundlePaths = {};
    this.isFreshFiles = ['Library/ConfigurationProfiles', 'Library/Cookies', 'Library/Preferences/.GlobalPreferences.plist', 'Library/Preferences/com.apple.springboard.plist', 'var/run/syslog.pid'];
    this.extraStartupTime = EXTRA_STARTUP_TIME;
    this.calendar = new _calendar.default(xcodeVersion, this.getDir());
    this.permissions = new _permissions.default(xcodeVersion, this.getDir(), this.udid);
  }

  get uiClientBundleId() {
    return UI_CLIENT_BUNDLE_ID;
  }

  get devicesSetPath() {
    return this.simctl.devicesSetPath;
  }

  set devicesSetPath(value) {
    this.simctl.devicesSetPath = value;
  }

  async getUIClientPid() {
    let stdout;

    try {
      ({
        stdout
      } = await (0, _teen_process.exec)('pgrep', ['-fn', `${this.simulatorApp}/Contents/MacOS/`]));
    } catch (e) {
      return null;
    }

    if (isNaN(parseInt(stdout, 10))) {
      return null;
    }

    stdout = stdout.trim();

    _logger.default.debug(`Got Simulator UI client PID: ${stdout}`);

    return stdout;
  }

  async isUIClientRunning() {
    return !_lodash.default.isNull(await this.getUIClientPid());
  }

  get startupTimeout() {
    return STARTUP_TIMEOUT;
  }

  async getPlatformVersion() {
    if (!this._platformVersion) {
      let {
        sdk
      } = await this.stat();
      this._platformVersion = sdk;
    }

    return this._platformVersion;
  }

  getRootDir() {
    let home = process.env.HOME;
    return _path.default.resolve(home, 'Library', 'Developer', 'CoreSimulator', 'Devices');
  }

  getDir() {
    return _path.default.resolve(this.getRootDir(), this.udid, 'data');
  }

  getLogDir() {
    let home = process.env.HOME;
    return _path.default.resolve(home, 'Library', 'Logs', 'CoreSimulator', this.udid);
  }

  async installApp(app) {
    return await this.simctl.installApp(app);
  }

  async isAppInstalled(bundleId, appFile = null) {
    let appDirs = await this.getAppDirs(appFile, bundleId);
    return appDirs.length !== 0;
  }

  async getUserInstalledBundleIdsByBundleName(bundleName) {
    const rootUserAppDir = await this.buildBundlePathMap('Bundle');
    const bundleIds = [];

    if (_lodash.default.isEmpty(rootUserAppDir)) {
      return bundleIds;
    }

    for (const [bundleId, userAppDirPath] of Object.entries(rootUserAppDir)) {
      const appFile = (await _support.fs.readdir(userAppDirPath)).find(file => _path.default.extname(file).toLowerCase() === '.app');

      const infoPlistPath = _path.default.resolve(userAppDirPath, appFile, 'Info.plist');

      if (!(await _support.fs.exists(infoPlistPath))) {
        continue;
      }

      try {
        const infoPlist = await _support.plist.parsePlistFile(infoPlistPath, false);

        if (infoPlist.CFBundleName === bundleName) {
          bundleIds.push(bundleId);
        }
      } catch (err) {
        _logger.default.warn(`Failed to read plist ${infoPlistPath}. Original error '${err.message}'`);

        continue;
      }
    }

    _logger.default.debug(`The simulator has '${bundleIds.length}' bundles which have '${bundleName}' as their 'CFBundleName':`);

    for (const bundleId of bundleIds) {
      _logger.default.debug(`    '${bundleId}'`);
    }

    return bundleIds;
  }

  async getAppDir(id, subDir = 'Data') {
    this.appDataBundlePaths[subDir] = this.appDataBundlePaths[subDir] || {};

    if (_lodash.default.isEmpty(this.appDataBundlePaths[subDir]) && !(await this.isFresh())) {
      this.appDataBundlePaths[subDir] = await this.buildBundlePathMap(subDir);
    }

    return this.appDataBundlePaths[subDir][id];
  }

  async buildBundlePathMap(subDir = 'Data') {
    _logger.default.debug('Building bundle path map');

    let applicationList;
    let pathBundlePair;

    if ((await this.getPlatformVersion()) === '7.1') {
      applicationList = _path.default.resolve(this.getDir(), 'Applications');

      pathBundlePair = async dir => {
        dir = _path.default.resolve(applicationList, dir);
        let appFiles = await _support.fs.glob(`${dir}/*.app`);
        let bundleId = appFiles[0].match(/.*\/(.*)\.app/)[1];
        return {
          path: dir,
          bundleId
        };
      };
    } else {
      applicationList = _path.default.resolve(this.getDir(), 'Containers', subDir, 'Application');

      let readBundleId = async dir => {
        let plist = _path.default.resolve(dir, '.com.apple.mobile_container_manager.metadata.plist');

        let metadata = await settings.read(plist);
        return metadata.MCMMetadataIdentifier;
      };

      pathBundlePair = async dir => {
        dir = _path.default.resolve(applicationList, dir);
        let bundleId = await readBundleId(dir);
        return {
          path: dir,
          bundleId
        };
      };
    }

    if (!(await _support.fs.exists(applicationList))) {
      _logger.default.warn(`No directory path '${applicationList}'`);

      return {};
    }

    let bundlePathDirs = await _support.fs.readdir(applicationList);
    let bundlePathPairs = await (0, _asyncbox.asyncmap)(bundlePathDirs, async function (dir) {
      return await pathBundlePair(dir);
    }, false);
    return bundlePathPairs.reduce((bundleMap, bundlePath) => {
      bundleMap[bundlePath.bundleId] = bundlePath.path;
      return bundleMap;
    }, {});
  }

  async stat() {
    for (let [sdk, deviceArr] of _lodash.default.toPairs(await this.simctl.getDevices())) {
      for (let device of deviceArr) {
        if (device.udid === this.udid) {
          device.sdk = sdk;
          return device;
        }
      }
    }

    return {};
  }

  async isFresh() {
    let files = this.isFreshFiles;
    let pv = await this.getPlatformVersion();

    if (pv !== '7.1') {
      files.push('Library/Preferences/com.apple.Preferences.plist');
    } else {
      files.push('Applications');
    }

    const dir = this.getDir();
    files = files.map(s => _path.default.resolve(dir, s));
    const existences = await (0, _asyncbox.asyncmap)(files, async f => await _support.fs.hasAccess(f));
    const fresh = _lodash.default.compact(existences).length !== files.length;

    _logger.default.debug(`Checking whether simulator has been run before: ${fresh ? 'no' : 'yes'}`);

    return fresh;
  }

  async isRunning() {
    try {
      await this.simctl.getEnv('dummy');
      return true;
    } catch (e) {
      return false;
    }
  }

  async isShutdown() {
    try {
      await this.simctl.getEnv('dummy');
      return false;
    } catch (e) {
      return _lodash.default.includes(e.stderr, 'Current state: Shutdown');
    }
  }

  async waitForBoot(startupTimeout) {
    let bootedIndicator = await this.getBootedIndicatorString();
    await this.tailLogsUntil(bootedIndicator, startupTimeout);

    _logger.default.debug(`Waiting an extra ${this.extraStartupTime}ms for the simulator to really finish booting`);

    await _bluebird.default.delay(this.extraStartupTime);

    _logger.default.debug('Done waiting extra time for simulator');

    this.emit(BOOT_COMPLETED_EVENT);
  }

  async getBootedIndicatorString() {
    let indicator;
    let platformVersion = await this.getPlatformVersion();

    switch (platformVersion) {
      case '7.1':
      case '8.1':
      case '8.2':
      case '8.3':
      case '8.4':
        indicator = 'profiled: Service starting...';
        break;

      case '9.0':
      case '9.1':
      case '9.2':
      case '9.3':
        indicator = 'System app "com.apple.springboard" finished startup';
        break;

      case '10.0':
        indicator = 'Switching to keyboard';
        break;

      default:
        _logger.default.warn(`No boot indicator case for platform version '${platformVersion}'`);

        indicator = 'no boot indicator string available';
    }

    return indicator;
  }

  async startUIClient(opts = {}) {
    opts = _lodash.default.cloneDeep(opts);

    _lodash.default.defaultsDeep(opts, {
      scaleFactor: null,
      startupTimeout: this.startupTimeout
    });

    const simulatorApp = _path.default.resolve(await (0, _appiumXcode.getPath)(), 'Applications', this.simulatorApp);

    const args = ['-Fn', simulatorApp, '--args', '-CurrentDeviceUDID', this.udid];

    if (opts.scaleFactor) {
      const {
        name
      } = await this.stat();
      const formattedDeviceName = name.replace(/\s+/g, '-');
      const argumentName = `-SimulatorWindowLastScale-com.apple.CoreSimulator.SimDeviceType.${formattedDeviceName}`;
      args.push(argumentName, opts.scaleFactor);
    }

    _logger.default.info(`Starting Simulator UI with command: open ${args.join(' ')}`);

    try {
      await (0, _teen_process.exec)('open', args, {
        timeout: opts.startupTimeout
      });
    } catch (err) {
      if (!(err.stdout || '').includes('-10825') && !(err.stderr || '').includes('-10825')) {
        throw err;
      }

      _logger.default.warn(`Error while opening UI: ${err.stdout || err.stderr}. Continuing`);
    }
  }

  async run(opts = {}) {
    opts = Object.assign({
      startupTimeout: this.startupTimeout
    }, opts);
    const isServerRunning = await this.isRunning();
    const isUIClientRunning = await this.isUIClientRunning();

    if (isServerRunning && isUIClientRunning) {
      _logger.default.info(`Both Simulator with UDID ${this.udid} and the UI client are currently running`);

      return;
    }

    const timer = new _support.timing.Timer().start();

    try {
      await this.shutdown();
    } catch (err) {
      _logger.default.warn(`Error on Simulator shutdown: ${err.message}`);
    }

    await this.startUIClient(opts);
    await this.waitForBoot(opts.startupTimeout);

    _logger.default.info(`Simulator with UDID ${this.udid} booted in ${timer.getDuration().asSeconds.toFixed(3)}s`);
  }

  async clean() {
    await this.endSimulatorDaemon();

    _logger.default.info(`Cleaning simulator ${this.udid}`);

    await this.simctl.eraseDevice(10000);
  }

  async scrubCustomApp(appFile, appBundleId) {
    return await this.cleanCustomApp(appFile, appBundleId, true);
  }

  async cleanCustomApp(appFile, appBundleId, scrub = false) {
    _logger.default.debug(`Cleaning app data files for '${appFile}', '${appBundleId}'`);

    if (!scrub) {
      _logger.default.debug(`Deleting app altogether`);
    }

    let appDirs = await this.getAppDirs(appFile, appBundleId, scrub);

    if (appDirs.length === 0) {
      _logger.default.debug('Could not find app directories to delete. It is probably not installed');

      return;
    }

    let deletePromises = [];

    for (let dir of appDirs) {
      _logger.default.debug(`Deleting directory: '${dir}'`);

      deletePromises.push(_support.fs.rimraf(dir));
    }

    if ((await this.getPlatformVersion()) >= 8) {
      let relRmPath = `Library/Preferences/${appBundleId}.plist`;

      let rmPath = _path.default.resolve(this.getRootDir(), relRmPath);

      _logger.default.debug(`Deleting file: '${rmPath}'`);

      deletePromises.push(_support.fs.rimraf(rmPath));
    }

    await _bluebird.default.all(deletePromises);
  }

  async getAppDirs(appFile, appBundleId, scrub = false) {
    let dirs = [];

    if ((await this.getPlatformVersion()) >= 8) {
      let data = await this.getAppDir(appBundleId);
      if (!data) return dirs;
      let bundle = !scrub ? await this.getAppDir(appBundleId, 'Bundle') : undefined;

      for (let src of [data, bundle]) {
        if (src) {
          dirs.push(src);
        }
      }
    } else {
      let data = await this.getAppDir(appFile);

      if (data) {
        dirs.push(data);
      }
    }

    return dirs;
  }

  async launchAndQuit(safari = false, startupTimeout = this.startupTimeout) {
    _logger.default.debug('Attempting to launch and quit the simulator to create the directory structure');

    await this.run({
      startupTimeout
    });

    if (safari) {
      _logger.default.debug('Spawning Safari browser in order to create the necessary file system items');

      await (0, _utils.launchApp)(this.simctl, _utils.MOBILE_SAFARI_BUNDLE_ID);
    }

    try {
      await (0, _asyncbox.retryInterval)(60, 250, async () => {
        if (await this.isFresh()) {
          throw new Error('Simulator files not fully created. Waiting a bit');
        }
      });
    } catch (err) {
      _logger.default.warn(`Timeout waiting for simulator files to be created. Continuing`);
    }

    await this.shutdown();
  }

  async endSimulatorDaemon() {
    _logger.default.debug(`Killing any simulator daemons for ${this.udid}`);

    let launchctlCmd = `launchctl list | grep ${this.udid} | cut -f 3 | xargs -n 1 launchctl`;

    try {
      let stopCmd = `${launchctlCmd} stop`;
      await (0, _teen_process.exec)('bash', ['-c', stopCmd]);
    } catch (err) {
      _logger.default.warn(`Could not stop simulator daemons: ${err.message}`);

      _logger.default.debug('Carrying on anyway!');
    }

    try {
      let removeCmd = `${launchctlCmd} remove`;
      await (0, _teen_process.exec)('bash', ['-c', removeCmd]);
    } catch (err) {
      _logger.default.warn(`Could not remove simulator daemons: ${err.message}`);

      _logger.default.debug('Carrying on anyway!');
    }

    try {
      await (0, _asyncbox.waitForCondition)(async () => {
        let {
          stdout
        } = await (0, _teen_process.exec)('bash', ['-c', `ps -e  | grep ${this.udid} | grep launchd_sim | grep -v bash | grep -v grep | awk {'print$1'}`]);
        return stdout.trim().length === 0;
      }, {
        waitMs: 10000,
        intervalMs: 500
      });
    } catch (err) {
      _logger.default.warn(`Could not end simulator daemon for ${this.udid}: ${err.message}`);

      _logger.default.debug('Carrying on anyway!');
    }
  }

  async shutdown(opts = {}) {
    if (await this.isShutdown()) {
      return;
    }

    await (0, _asyncbox.retryInterval)(5, 500, this.simctl.shutdownDevice.bind(this.simctl));
    const waitMs = parseInt(opts.timeout, 10);

    if (waitMs > 0) {
      try {
        await (0, _asyncbox.waitForCondition)(async () => await this.isShutdown(), {
          waitMs,
          intervalMs: 100
        });
      } catch (err) {
        throw new Error(`Simulator is not in 'Shutdown' state after ${waitMs}ms`);
      }
    }
  }

  async delete() {
    await this.simctl.deleteDevice();
  }

  async updateSettings(plist, updates) {
    return await settings.updateSettings(this, plist, updates);
  }

  async updateLocationSettings(bundleId, authorized) {
    return await settings.updateLocationSettings(this, bundleId, authorized);
  }

  async setReduceMotion(reduceMotion = true) {
    if (await this.isFresh()) {
      await this.launchAndQuit(false, STARTUP_TIMEOUT);
    }

    await settings.setReduceMotion(this, reduceMotion);
  }

  async setAppearance() {
    throw new Error(`Xcode SDK '${this.xcodeVersion}' is too old to set UI appearance`);
  }

  async getAppearance() {
    throw new Error(`Xcode SDK '${this.xcodeVersion}' is too old to get UI appearance`);
  }

  async updateSafariSettings(updates) {
    let updated = await settings.updateSafariUserSettings(this, updates);
    return (await settings.updateSettings(this, 'mobileSafari', updates)) || updated;
  }

  async updateSafariGlobalSettings(updates) {
    return await settings.updateSafariGlobalSettings(this, updates);
  }

  async updateLocale(language, locale, calendarFormat) {
    return await settings.updateLocale(this, language, locale, calendarFormat);
  }

  async deleteSafari() {
    _logger.default.debug('Deleting Safari apps from simulator');

    let dirs = [];
    dirs.push(await this.getAppDir(_utils.MOBILE_SAFARI_BUNDLE_ID));
    let pv = await this.getPlatformVersion();

    if (pv >= 8) {
      dirs.push(await this.getAppDir(_utils.MOBILE_SAFARI_BUNDLE_ID, 'Bundle'));
    }

    let deletePromises = [];

    for (let dir of _lodash.default.compact(dirs)) {
      _logger.default.debug(`Deleting directory: '${dir}'`);

      deletePromises.push(_support.fs.rimraf(dir));
    }

    await _bluebird.default.all(deletePromises);
  }

  async cleanSafari(keepPrefs = true) {
    _logger.default.debug('Cleaning mobile safari data files');

    if (await this.isFresh()) {
      _logger.default.info('Could not find Safari support directories to clean out old ' + 'data. Probably there is nothing to clean out');

      return;
    }

    let libraryDir = _path.default.resolve(this.getDir(), 'Library');

    let safariRoot = await this.getAppDir(_utils.MOBILE_SAFARI_BUNDLE_ID);

    if (!safariRoot) {
      _logger.default.info('Could not find Safari support directories to clean out old ' + 'data. Probably there is nothing to clean out');

      return;
    }

    let safariLibraryDir = _path.default.resolve(safariRoot, 'Library');

    let filesToDelete = [`Caches/Snapshots/${_utils.MOBILE_SAFARI_BUNDLE_ID}`, `Caches/${_utils.MOBILE_SAFARI_BUNDLE_ID}/*`, 'Caches/com.apple.WebAppCache/*', 'Caches/com.apple.WebKit.Networking/*', 'Caches/com.apple.WebKit.WebContent/*', 'Image Cache/*', `WebKit/${_utils.MOBILE_SAFARI_BUNDLE_ID}/*`, 'WebKit/GeolocationSites.plist', 'WebKit/LocalStorage/*.*', 'Safari/*', 'Cookies/*.binarycookies', 'Caches/com.apple.UIStatusBar/*', 'Caches/com.apple.keyboards/images/*', 'Caches/com.apple.Safari.SafeBrowsing/*', `../tmp/${_utils.MOBILE_SAFARI_BUNDLE_ID}/*`];
    let deletePromises = [];

    for (let file of filesToDelete) {
      deletePromises.push(_support.fs.rimraf(_path.default.resolve(libraryDir, file)));
      deletePromises.push(_support.fs.rimraf(_path.default.resolve(safariLibraryDir, file)));
    }

    if (!keepPrefs) {
      deletePromises.push(_support.fs.rimraf(_path.default.resolve(safariLibraryDir, 'Preferences/*.plist')));
    }

    await _bluebird.default.all(deletePromises);
  }

  async removeApp(bundleId) {
    await this.simctl.removeApp(bundleId);
  }

  async moveBuiltInApp(appName, appPath, newAppPath) {
    await (0, _utils.safeRimRaf)(newAppPath);
    await _support.fs.copyFile(appPath, newAppPath);

    _logger.default.debug(`Copied '${appName}' to '${newAppPath}'`);

    await _support.fs.rimraf(appPath);

    _logger.default.debug(`Temporarily deleted original app at '${appPath}'`);

    return [newAppPath, appPath];
  }

  async openUrl(url) {
    const SAFARI_BOOTED_INDICATOR = 'MobileSafari[';
    const SAFARI_STARTUP_TIMEOUT = 15 * 1000;
    const EXTRA_STARTUP_TIME = 3 * 1000;

    if (await this.isRunning()) {
      await (0, _asyncbox.retry)(5000, this.simctl.openUrl.bind(this.simctl), url);
      await this.tailLogsUntil(SAFARI_BOOTED_INDICATOR, SAFARI_STARTUP_TIMEOUT);

      _logger.default.debug(`Safari started, waiting ${EXTRA_STARTUP_TIME}ms for it to fully start`);

      await _bluebird.default.delay(EXTRA_STARTUP_TIME);

      _logger.default.debug('Done waiting for Safari');

      return;
    } else {
      throw new Error('Tried to open a url, but the Simulator is not Booted');
    }
  }

  async clearCaches(...folderNames) {
    const cachesRoot = _path.default.resolve(this.getDir(), 'Library', 'Caches');

    if (!(await _support.fs.hasAccess(cachesRoot))) {
      _logger.default.debug(`Caches root at '${cachesRoot}' does not exist or is not accessible. Nothing to do there`);

      return 0;
    }

    let itemsToRemove = folderNames.length ? folderNames : await _support.fs.readdir(cachesRoot);
    itemsToRemove = itemsToRemove.map(x => _path.default.resolve(cachesRoot, x));

    if (folderNames.length) {
      itemsToRemove = await _bluebird.default.filter(itemsToRemove, x => _support.fs.hasAccess(x));
    }

    itemsToRemove = await _bluebird.default.filter(itemsToRemove, async x => (await _support.fs.stat(x)).isDirectory());

    if (!itemsToRemove.length) {
      _logger.default.debug(`No Simulator cache items for cleanup were matched in '${cachesRoot}'`);

      return 0;
    }

    _logger.default.debug(`Matched ${_support.util.pluralize('simulator cache item', itemsToRemove.length, true)} ` + `for cleanup: ${itemsToRemove}`);

    try {
      await _bluebird.default.all(itemsToRemove, x => _support.fs.rimraf(x));
    } catch (e) {
      _logger.default.warn(`Got an exception while cleaning Simulator caches: ${e.message}`);
    }

    return itemsToRemove.length;
  }

  async tailLogsUntil(bootedIndicator, timeoutMs) {
    let simLog = _path.default.resolve(this.getLogDir(), 'system.log');

    await (0, _asyncbox.retryInterval)(200, 200, async () => {
      let exists = await _support.fs.exists(simLog);

      if (!exists) {
        throw new Error(`Could not find Simulator log: '${simLog}'`);
      }
    });

    _logger.default.info(`Simulator log at '${simLog}'`);

    _logger.default.info(`Tailing simulator logs until we encounter the string "${bootedIndicator}"`);

    _logger.default.info(`We will time out after ${timeoutMs}ms`);

    try {
      await (0, _tailUntil.tailUntil)(simLog, bootedIndicator, timeoutMs);
    } catch (err) {
      _logger.default.debug('Simulator startup timed out. Continuing anyway.');
    }
  }

  async enableCalendarAccess(bundleID) {
    await this.calendar.enableCalendarAccess(bundleID);
  }

  async disableCalendarAccess(bundleID) {
    await this.calendar.disableCalendarAccess(bundleID);
  }

  async hasCalendarAccess(bundleID) {
    return await this.calendar.hasCalendarAccess(bundleID);
  }

  async _activateWindow() {
    const pid = await this.getUIClientPid();

    if (pid) {
      try {
        return await (0, _utils.activateApp)(pid);
      } catch (e) {
        _logger.default.debug(e.stderr || e.message);
      }
    }

    return `
      tell application "System Events"
        tell process "Simulator"
          set frontmost to false
          set frontmost to true
        end tell
      end tell
    `;
  }

  async executeUIClientScript(appleScript) {
    const windowActivationScript = await this._activateWindow();
    const resultScript = `${windowActivationScript ? windowActivationScript + '\n' : ''}${appleScript}`;

    _logger.default.debug(`Executing UI Apple Script on Simulator with UDID ${this.udid}: ${resultScript}`);

    return await UI_CLIENT_ACCESS_GUARD.acquire(this.simulatorApp, async () => {
      try {
        const {
          stdout
        } = await (0, _teen_process.exec)('osascript', ['-e', resultScript]);
        return stdout;
      } catch (err) {
        _logger.default.errorAndThrow(`Could not complete operation. Make sure Simulator UI is running and the parent Appium application (e. g. Appium.app or Terminal.app) ` + `is present in System Preferences > Security & Privacy > Privacy > Accessibility list. If the operation is still unsuccessful then ` + `it is not supported by this Simulator. ` + `Original error: ${err.message}`);
      }
    });
  }

  async isBiometricEnrolled() {
    const output = await this.executeUIClientScript(`
      tell application "System Events"
        tell process "Simulator"
          set dstMenuItem to menu item "Touch ID Enrolled" of menu 1 of menu bar item "Hardware" of menu bar 1
          set isChecked to (value of attribute "AXMenuItemMarkChar" of dstMenuItem) is "✓"
        end tell
      end tell
    `);

    _logger.default.debug(`Touch ID enrolled state: ${output}`);

    return _lodash.default.isString(output) && output.trim() === 'true';
  }

  async enrollBiometric(isEnabled = true) {
    await this.executeUIClientScript(`
      tell application "System Events"
        tell process "Simulator"
          set dstMenuItem to menu item "Touch ID Enrolled" of menu 1 of menu bar item "Hardware" of menu bar 1
          set isChecked to (value of attribute "AXMenuItemMarkChar" of dstMenuItem) is "✓"
          if ${isEnabled ? 'not ' : ''}isChecked then
            click dstMenuItem
          end if
        end tell
      end tell
    `);
  }

  async sendBiometricMatch(shouldMatch = true) {
    await this.executeUIClientScript(`
      tell application "System Events"
        tell process "Simulator"
          set dstMenuItem to menu item "${shouldMatch ? 'Matching' : 'Non-matching'}" of menu 1 of menu item "Simulate Finger Touch" of menu 1 of menu bar item "Hardware" of menu bar 1
          click dstMenuItem
        end tell
      end tell
    `);
  }

  async dismissDatabaseAlert(increase = true) {
    let button = increase ? 'Increase' : 'Cancel';

    _logger.default.debug(`Attempting to dismiss database alert with '${button}' button`);

    await this.executeUIClientScript(`
      tell application "System Events"
        tell process "Simulator"
          click button "${button}" of window 1
        end tell
      end tell
    `);
  }

  async backupKeychains() {
    if (!(await _support.fs.exists(this.keychainPath))) {
      return false;
    }

    const backupPath = await _support.tempDir.path({
      prefix: `keychains_backup_${Math.floor((1 + Math.random()) * 0x10000).toString(16).substring(1)}`,
      suffix: '.zip'
    });
    const zipArgs = ['-r', backupPath, `${this.keychainPath}${_path.default.sep}`];

    _logger.default.debug(`Creating keychains backup with 'zip ${zipArgs.join(' ')}' command`);

    await (0, _teen_process.exec)('zip', zipArgs);

    if (_lodash.default.isString(this._keychainsBackupPath) && (await _support.fs.exists(this._keychainsBackupPath))) {
      await _support.fs.unlink(this._keychainsBackupPath);
    }

    this._keychainsBackupPath = backupPath;
    return true;
  }

  async restoreKeychains(excludePatterns = []) {
    if (!_lodash.default.isString(this._keychainsBackupPath) || !(await _support.fs.exists(this._keychainsBackupPath))) {
      throw new Error(`The keychains backup archive does not exist. ` + `Are you sure it was created before?`);
    }

    if (_lodash.default.isString(excludePatterns)) {
      excludePatterns = excludePatterns.split(',').map(x => x.trim());
    }

    const isServerRunning = await this.isRunning();
    let plistPath;

    if (isServerRunning) {
      plistPath = _path.default.resolve(await this.getLaunchDaemonsRoot(), 'com.apple.securityd.plist');

      if (!(await _support.fs.exists(plistPath))) {
        throw new Error(`Cannot clear keychains because '${plistPath}' does not exist`);
      }

      await this.simctl.spawnProcess(['launchctl', 'unload', plistPath]);
    }

    try {
      await _support.fs.rimraf(this.keychainPath);
      await (0, _support.mkdirp)(this.keychainPath);
      const unzipArgs = ['-o', this._keychainsBackupPath, ..._lodash.default.flatMap(excludePatterns.map(x => ['-x', x])), '-d', '/'];

      _logger.default.debug(`Restoring keychains with 'unzip ${unzipArgs.join(' ')}' command`);

      await (0, _teen_process.exec)('unzip', unzipArgs);
      await _support.fs.unlink(this._keychainsBackupPath);
      this._keychainsBackupPath = null;
    } finally {
      if (isServerRunning && plistPath) {
        await this.simctl.spawnProcess(['launchctl', 'load', plistPath]);
      }
    }

    return true;
  }

  async clearKeychains() {
    const plistPath = _path.default.resolve(await this.getLaunchDaemonsRoot(), 'com.apple.securityd.plist');

    if (!(await _support.fs.exists(plistPath))) {
      throw new Error(`Cannot clear keychains because '${plistPath}' does not exist`);
    }

    await this.simctl.spawnProcess(['launchctl', 'unload', plistPath]);

    try {
      if (await _support.fs.exists(this.keychainPath)) {
        await _support.fs.rimraf(this.keychainPath);
        await (0, _support.mkdirp)(this.keychainPath);
      }
    } finally {
      await this.simctl.spawnProcess(['launchctl', 'load', plistPath]);
    }
  }

  async ps() {
    const {
      stdout
    } = await this.simctl.spawnProcess(['launchctl', 'print', 'system']);
    const servicesMatch = /^\s*services\s*=\s*{([^}]+)/m.exec(stdout);

    if (!servicesMatch) {
      _logger.default.debug(stdout);

      throw new Error(`The list of active processes cannot be retrieved`);
    }

    const result = [];
    const pattern = /^\s*(\d+)\s+[\d-]+\s+([\w\-.]+:)?([\w\-.]+)/gm;
    let match;

    while (match = pattern.exec(servicesMatch[1])) {
      result.push({
        pid: parseInt(match[1], 10),
        group: _lodash.default.trimEnd(match[2], ':') || null,
        name: match[3]
      });
    }

    return result;
  }

  async setPermission(bundleId, permission, value) {
    await this.setPermissions(bundleId, {
      [permission]: value
    });
  }

  async setPermissions(bundleId, permissionsMapping) {
    _logger.default.debug(`Setting access for '${bundleId}': ` + JSON.stringify(permissionsMapping, null, 2));

    await this.permissions.setAccess(bundleId, permissionsMapping);
  }

  async getPermission(bundleId, serviceName) {
    const result = await this.permissions.getAccess(bundleId, serviceName);

    _logger.default.debug(`Got ${serviceName} access status for '${bundleId}': ${result}`);

    return result;
  }

  async addCertificate(payload) {
    if (await (0, _utils.hasSSLCert)(payload, this.udid)) {
      _logger.default.info(`SSL certificate '${_lodash.default.truncate(payload, {
        length: 20
      })}' already installed`);

      return false;
    }

    _logger.default.info(`Installing SSL root certificate '${_lodash.default.truncate(payload, {
      length: 20
    })}'`);

    await (0, _utils.installSSLCert)(payload, this.udid);
    return true;
  }

  async pushNotification() {
    throw new Error(`Xcode SDK '${this.xcodeVersion}' is too old to push notifications`);
  }

  async getLaunchDaemonsRoot() {
    const devRoot = await (0, _utils.getDeveloperRoot)();
    return _path.default.resolve(devRoot, 'Platforms/iPhoneSimulator.platform/Developer/SDKs/iPhoneSimulator.sdk/System/Library/LaunchDaemons');
  }

  static async _getDeviceStringPlatformVersion(platformVersion) {
    let reqVersion = platformVersion;

    if (!reqVersion) {
      reqVersion = await _appiumXcode.default.getMaxIOSSDK();

      _logger.default.warn(`No platform version set. Using max SDK version: ${reqVersion}`);

      if (!_lodash.default.isString(reqVersion)) {
        reqVersion = reqVersion % 1 ? String(reqVersion) : `${reqVersion}.0`;
      }
    }

    return reqVersion;
  }

  static async _getDeviceStringVersionString(platformVersion) {
    let reqVersion = await this._getDeviceStringPlatformVersion(platformVersion);
    return `(${reqVersion} Simulator)`;
  }

  static _getDeviceStringConfigFix() {
    return {
      'iPad Simulator (7.1 Simulator)': 'iPad 2 (7.1 Simulator)',
      'iPad Simulator (8.0 Simulator)': 'iPad 2 (8.0 Simulator)',
      'iPad Simulator (8.1 Simulator)': 'iPad 2 (8.1 Simulator)',
      'iPad Simulator (8.2 Simulator)': 'iPad 2 (8.2 Simulator)',
      'iPad Simulator (8.3 Simulator)': 'iPad 2 (8.3 Simulator)',
      'iPad Simulator (8.4 Simulator)': 'iPad 2 (8.4 Simulator)',
      'iPhone Simulator (7.1 Simulator)': 'iPhone 5s (7.1 Simulator)',
      'iPhone Simulator (8.4 Simulator)': 'iPhone 6 (8.4 Simulator)',
      'iPhone Simulator (8.3 Simulator)': 'iPhone 6 (8.3 Simulator)',
      'iPhone Simulator (8.2 Simulator)': 'iPhone 6 (8.2 Simulator)',
      'iPhone Simulator (8.1 Simulator)': 'iPhone 6 (8.1 Simulator)',
      'iPhone Simulator (8.0 Simulator)': 'iPhone 6 (8.0 Simulator)'
    };
  }

  static async getDeviceString(opts) {
    opts = Object.assign({}, {
      deviceName: null,
      platformVersion: null,
      forceIphone: false,
      forceIpad: false
    }, opts);
    let logOpts = {
      deviceName: opts.deviceName,
      platformVersion: opts.platformVersion,
      forceIphone: opts.forceIphone,
      forceIpad: opts.forceIpad
    };

    _logger.default.debug(`Getting device string from options: ${JSON.stringify(logOpts)}`);

    if ((opts.deviceName || '')[0] === '=') {
      return opts.deviceName.substring(1);
    }

    let isiPhone = !!opts.forceIphone || !opts.forceIpad;

    if (opts.deviceName) {
      let device = opts.deviceName.toLowerCase();

      if (device.indexOf('iphone') !== -1) {
        isiPhone = true;
      } else if (device.indexOf('ipad') !== -1) {
        isiPhone = false;
      }
    }

    let iosDeviceString = opts.deviceName || (isiPhone ? 'iPhone Simulator' : 'iPad Simulator');

    if (/^(iPhone|iPad)$/.test(iosDeviceString)) {
      iosDeviceString += ' Simulator';
    }

    if (/[^(iPhone|iPad)] Simulator/.test(iosDeviceString)) {
      iosDeviceString = iosDeviceString.replace(' Simulator', '');
    }

    iosDeviceString += ` ${await this._getDeviceStringVersionString(opts.platformVersion)}`;

    let CONFIG_FIX = this._getDeviceStringConfigFix();

    let configFix = CONFIG_FIX;

    if (configFix[iosDeviceString]) {
      iosDeviceString = configFix[iosDeviceString];

      _logger.default.debug(`Fixing device. Changed from '${opts.deviceName}' ` + `to '${iosDeviceString}'`);
    }

    _logger.default.debug(`Final device string is '${iosDeviceString}'`);

    return iosDeviceString;
  }

  async getWebInspectorSocket() {
    return null;
  }

}

exports.SimulatorXcode6 = SimulatorXcode6;

for (let [cmd, fn] of _lodash.default.toPairs(_index.default)) {
  SimulatorXcode6.prototype[cmd] = fn;
}

var _default = SimulatorXcode6;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJTVEFSVFVQX1RJTUVPVVQiLCJFWFRSQV9TVEFSVFVQX1RJTUUiLCJVSV9DTElFTlRfQUNDRVNTX0dVQVJEIiwiQXN5bmNMb2NrIiwiVUlfQ0xJRU5UX0JVTkRMRV9JRCIsIlNQUklOR0JPQVJEX0JVTkRMRV9JRCIsIkJPT1RfQ09NUExFVEVEX0VWRU5UIiwiU2ltdWxhdG9yWGNvZGU2IiwiRXZlbnRFbWl0dGVyIiwiY29uc3RydWN0b3IiLCJ1ZGlkIiwieGNvZGVWZXJzaW9uIiwiU3RyaW5nIiwic2ltY3RsIiwiU2ltY3RsIiwiX3BsYXRmb3JtVmVyc2lvbiIsImtleWNoYWluUGF0aCIsInBhdGgiLCJyZXNvbHZlIiwiZ2V0RGlyIiwic2ltdWxhdG9yQXBwIiwiYXBwRGF0YUJ1bmRsZVBhdGhzIiwiaXNGcmVzaEZpbGVzIiwiZXh0cmFTdGFydHVwVGltZSIsImNhbGVuZGFyIiwiQ2FsZW5kYXIiLCJwZXJtaXNzaW9ucyIsIlBlcm1pc3Npb25zIiwidWlDbGllbnRCdW5kbGVJZCIsImRldmljZXNTZXRQYXRoIiwidmFsdWUiLCJnZXRVSUNsaWVudFBpZCIsInN0ZG91dCIsImV4ZWMiLCJlIiwiaXNOYU4iLCJwYXJzZUludCIsInRyaW0iLCJsb2ciLCJkZWJ1ZyIsImlzVUlDbGllbnRSdW5uaW5nIiwiXyIsImlzTnVsbCIsInN0YXJ0dXBUaW1lb3V0IiwiZ2V0UGxhdGZvcm1WZXJzaW9uIiwic2RrIiwic3RhdCIsImdldFJvb3REaXIiLCJob21lIiwicHJvY2VzcyIsImVudiIsIkhPTUUiLCJnZXRMb2dEaXIiLCJpbnN0YWxsQXBwIiwiYXBwIiwiaXNBcHBJbnN0YWxsZWQiLCJidW5kbGVJZCIsImFwcEZpbGUiLCJhcHBEaXJzIiwiZ2V0QXBwRGlycyIsImxlbmd0aCIsImdldFVzZXJJbnN0YWxsZWRCdW5kbGVJZHNCeUJ1bmRsZU5hbWUiLCJidW5kbGVOYW1lIiwicm9vdFVzZXJBcHBEaXIiLCJidWlsZEJ1bmRsZVBhdGhNYXAiLCJidW5kbGVJZHMiLCJpc0VtcHR5IiwidXNlckFwcERpclBhdGgiLCJPYmplY3QiLCJlbnRyaWVzIiwiZnMiLCJyZWFkZGlyIiwiZmluZCIsImZpbGUiLCJleHRuYW1lIiwidG9Mb3dlckNhc2UiLCJpbmZvUGxpc3RQYXRoIiwiZXhpc3RzIiwiaW5mb1BsaXN0IiwicGxpc3QiLCJwYXJzZVBsaXN0RmlsZSIsIkNGQnVuZGxlTmFtZSIsInB1c2giLCJlcnIiLCJ3YXJuIiwibWVzc2FnZSIsImdldEFwcERpciIsImlkIiwic3ViRGlyIiwiaXNGcmVzaCIsImFwcGxpY2F0aW9uTGlzdCIsInBhdGhCdW5kbGVQYWlyIiwiZGlyIiwiYXBwRmlsZXMiLCJnbG9iIiwibWF0Y2giLCJyZWFkQnVuZGxlSWQiLCJtZXRhZGF0YSIsInNldHRpbmdzIiwicmVhZCIsIk1DTU1ldGFkYXRhSWRlbnRpZmllciIsImJ1bmRsZVBhdGhEaXJzIiwiYnVuZGxlUGF0aFBhaXJzIiwiYXN5bmNtYXAiLCJyZWR1Y2UiLCJidW5kbGVNYXAiLCJidW5kbGVQYXRoIiwiZGV2aWNlQXJyIiwidG9QYWlycyIsImdldERldmljZXMiLCJkZXZpY2UiLCJmaWxlcyIsInB2IiwibWFwIiwicyIsImV4aXN0ZW5jZXMiLCJmIiwiaGFzQWNjZXNzIiwiZnJlc2giLCJjb21wYWN0IiwiaXNSdW5uaW5nIiwiZ2V0RW52IiwiaXNTaHV0ZG93biIsImluY2x1ZGVzIiwic3RkZXJyIiwid2FpdEZvckJvb3QiLCJib290ZWRJbmRpY2F0b3IiLCJnZXRCb290ZWRJbmRpY2F0b3JTdHJpbmciLCJ0YWlsTG9nc1VudGlsIiwiQiIsImRlbGF5IiwiZW1pdCIsImluZGljYXRvciIsInBsYXRmb3JtVmVyc2lvbiIsInN0YXJ0VUlDbGllbnQiLCJvcHRzIiwiY2xvbmVEZWVwIiwiZGVmYXVsdHNEZWVwIiwic2NhbGVGYWN0b3IiLCJnZXRYY29kZVBhdGgiLCJhcmdzIiwibmFtZSIsImZvcm1hdHRlZERldmljZU5hbWUiLCJyZXBsYWNlIiwiYXJndW1lbnROYW1lIiwiaW5mbyIsImpvaW4iLCJ0aW1lb3V0IiwicnVuIiwiYXNzaWduIiwiaXNTZXJ2ZXJSdW5uaW5nIiwidGltZXIiLCJ0aW1pbmciLCJUaW1lciIsInN0YXJ0Iiwic2h1dGRvd24iLCJnZXREdXJhdGlvbiIsImFzU2Vjb25kcyIsInRvRml4ZWQiLCJjbGVhbiIsImVuZFNpbXVsYXRvckRhZW1vbiIsImVyYXNlRGV2aWNlIiwic2NydWJDdXN0b21BcHAiLCJhcHBCdW5kbGVJZCIsImNsZWFuQ3VzdG9tQXBwIiwic2NydWIiLCJkZWxldGVQcm9taXNlcyIsInJpbXJhZiIsInJlbFJtUGF0aCIsInJtUGF0aCIsImFsbCIsImRpcnMiLCJkYXRhIiwiYnVuZGxlIiwidW5kZWZpbmVkIiwic3JjIiwibGF1bmNoQW5kUXVpdCIsInNhZmFyaSIsImxhdW5jaEFwcCIsIk1PQklMRV9TQUZBUklfQlVORExFX0lEIiwicmV0cnlJbnRlcnZhbCIsIkVycm9yIiwibGF1bmNoY3RsQ21kIiwic3RvcENtZCIsInJlbW92ZUNtZCIsIndhaXRGb3JDb25kaXRpb24iLCJ3YWl0TXMiLCJpbnRlcnZhbE1zIiwic2h1dGRvd25EZXZpY2UiLCJiaW5kIiwiZGVsZXRlIiwiZGVsZXRlRGV2aWNlIiwidXBkYXRlU2V0dGluZ3MiLCJ1cGRhdGVzIiwidXBkYXRlTG9jYXRpb25TZXR0aW5ncyIsImF1dGhvcml6ZWQiLCJzZXRSZWR1Y2VNb3Rpb24iLCJyZWR1Y2VNb3Rpb24iLCJzZXRBcHBlYXJhbmNlIiwiZ2V0QXBwZWFyYW5jZSIsInVwZGF0ZVNhZmFyaVNldHRpbmdzIiwidXBkYXRlZCIsInVwZGF0ZVNhZmFyaVVzZXJTZXR0aW5ncyIsInVwZGF0ZVNhZmFyaUdsb2JhbFNldHRpbmdzIiwidXBkYXRlTG9jYWxlIiwibGFuZ3VhZ2UiLCJsb2NhbGUiLCJjYWxlbmRhckZvcm1hdCIsImRlbGV0ZVNhZmFyaSIsImNsZWFuU2FmYXJpIiwia2VlcFByZWZzIiwibGlicmFyeURpciIsInNhZmFyaVJvb3QiLCJzYWZhcmlMaWJyYXJ5RGlyIiwiZmlsZXNUb0RlbGV0ZSIsInJlbW92ZUFwcCIsIm1vdmVCdWlsdEluQXBwIiwiYXBwTmFtZSIsImFwcFBhdGgiLCJuZXdBcHBQYXRoIiwic2FmZVJpbVJhZiIsImNvcHlGaWxlIiwib3BlblVybCIsInVybCIsIlNBRkFSSV9CT09URURfSU5ESUNBVE9SIiwiU0FGQVJJX1NUQVJUVVBfVElNRU9VVCIsInJldHJ5IiwiY2xlYXJDYWNoZXMiLCJmb2xkZXJOYW1lcyIsImNhY2hlc1Jvb3QiLCJpdGVtc1RvUmVtb3ZlIiwieCIsImZpbHRlciIsImlzRGlyZWN0b3J5IiwidXRpbCIsInBsdXJhbGl6ZSIsInRpbWVvdXRNcyIsInNpbUxvZyIsInRhaWxVbnRpbCIsImVuYWJsZUNhbGVuZGFyQWNjZXNzIiwiYnVuZGxlSUQiLCJkaXNhYmxlQ2FsZW5kYXJBY2Nlc3MiLCJoYXNDYWxlbmRhckFjY2VzcyIsIl9hY3RpdmF0ZVdpbmRvdyIsInBpZCIsImFjdGl2YXRlQXBwIiwiZXhlY3V0ZVVJQ2xpZW50U2NyaXB0IiwiYXBwbGVTY3JpcHQiLCJ3aW5kb3dBY3RpdmF0aW9uU2NyaXB0IiwicmVzdWx0U2NyaXB0IiwiYWNxdWlyZSIsImVycm9yQW5kVGhyb3ciLCJpc0Jpb21ldHJpY0Vucm9sbGVkIiwib3V0cHV0IiwiaXNTdHJpbmciLCJlbnJvbGxCaW9tZXRyaWMiLCJpc0VuYWJsZWQiLCJzZW5kQmlvbWV0cmljTWF0Y2giLCJzaG91bGRNYXRjaCIsImRpc21pc3NEYXRhYmFzZUFsZXJ0IiwiaW5jcmVhc2UiLCJidXR0b24iLCJiYWNrdXBLZXljaGFpbnMiLCJiYWNrdXBQYXRoIiwidGVtcERpciIsInByZWZpeCIsIk1hdGgiLCJmbG9vciIsInJhbmRvbSIsInRvU3RyaW5nIiwic3Vic3RyaW5nIiwic3VmZml4IiwiemlwQXJncyIsInNlcCIsIl9rZXljaGFpbnNCYWNrdXBQYXRoIiwidW5saW5rIiwicmVzdG9yZUtleWNoYWlucyIsImV4Y2x1ZGVQYXR0ZXJucyIsInNwbGl0IiwicGxpc3RQYXRoIiwiZ2V0TGF1bmNoRGFlbW9uc1Jvb3QiLCJzcGF3blByb2Nlc3MiLCJta2RpcnAiLCJ1bnppcEFyZ3MiLCJmbGF0TWFwIiwiY2xlYXJLZXljaGFpbnMiLCJwcyIsInNlcnZpY2VzTWF0Y2giLCJyZXN1bHQiLCJwYXR0ZXJuIiwiZ3JvdXAiLCJ0cmltRW5kIiwic2V0UGVybWlzc2lvbiIsInBlcm1pc3Npb24iLCJzZXRQZXJtaXNzaW9ucyIsInBlcm1pc3Npb25zTWFwcGluZyIsIkpTT04iLCJzdHJpbmdpZnkiLCJzZXRBY2Nlc3MiLCJnZXRQZXJtaXNzaW9uIiwic2VydmljZU5hbWUiLCJnZXRBY2Nlc3MiLCJhZGRDZXJ0aWZpY2F0ZSIsInBheWxvYWQiLCJoYXNTU0xDZXJ0IiwidHJ1bmNhdGUiLCJpbnN0YWxsU1NMQ2VydCIsInB1c2hOb3RpZmljYXRpb24iLCJkZXZSb290IiwiZ2V0RGV2ZWxvcGVyUm9vdCIsIl9nZXREZXZpY2VTdHJpbmdQbGF0Zm9ybVZlcnNpb24iLCJyZXFWZXJzaW9uIiwieGNvZGUiLCJnZXRNYXhJT1NTREsiLCJfZ2V0RGV2aWNlU3RyaW5nVmVyc2lvblN0cmluZyIsIl9nZXREZXZpY2VTdHJpbmdDb25maWdGaXgiLCJnZXREZXZpY2VTdHJpbmciLCJkZXZpY2VOYW1lIiwiZm9yY2VJcGhvbmUiLCJmb3JjZUlwYWQiLCJsb2dPcHRzIiwiaXNpUGhvbmUiLCJpbmRleE9mIiwiaW9zRGV2aWNlU3RyaW5nIiwidGVzdCIsIkNPTkZJR19GSVgiLCJjb25maWdGaXgiLCJnZXRXZWJJbnNwZWN0b3JTb2NrZXQiLCJjbWQiLCJmbiIsImV4dGVuc2lvbnMiLCJwcm90b3R5cGUiXSwic291cmNlcyI6WyIuLi8uLi9saWIvc2ltdWxhdG9yLXhjb2RlLTYuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHBhdGggZnJvbSAncGF0aCc7XG5pbXBvcnQgeyBkZWZhdWx0IGFzIHhjb2RlLCBnZXRQYXRoIGFzIGdldFhjb2RlUGF0aCB9IGZyb20gJ2FwcGl1bS14Y29kZSc7XG5pbXBvcnQgbG9nIGZyb20gJy4vbG9nZ2VyJztcbmltcG9ydCB7IGZzLCB0ZW1wRGlyLCBta2RpcnAsIHBsaXN0LCB0aW1pbmcsIHV0aWwgfSBmcm9tICdAYXBwaXVtL3N1cHBvcnQnO1xuaW1wb3J0IEIgZnJvbSAnYmx1ZWJpcmQnO1xuaW1wb3J0IF8gZnJvbSAnbG9kYXNoJztcbmltcG9ydCBBc3luY0xvY2sgZnJvbSAnYXN5bmMtbG9jayc7XG5pbXBvcnQge1xuICBzYWZlUmltUmFmLCBnZXREZXZlbG9wZXJSb290LCBpbnN0YWxsU1NMQ2VydCwgaGFzU1NMQ2VydCwgYWN0aXZhdGVBcHAsXG4gIE1PQklMRV9TQUZBUklfQlVORExFX0lELCBsYXVuY2hBcHBcbn0gZnJvbSAnLi91dGlscy5qcyc7XG5pbXBvcnQgeyBhc3luY21hcCwgcmV0cnlJbnRlcnZhbCwgd2FpdEZvckNvbmRpdGlvbiwgcmV0cnkgfSBmcm9tICdhc3luY2JveCc7XG5pbXBvcnQgKiBhcyBzZXR0aW5ncyBmcm9tICcuL3NldHRpbmdzJztcbmltcG9ydCB7IGV4ZWMgfSBmcm9tICd0ZWVuX3Byb2Nlc3MnO1xuaW1wb3J0IHsgdGFpbFVudGlsIH0gZnJvbSAnLi90YWlsLXVudGlsLmpzJztcbmltcG9ydCBleHRlbnNpb25zIGZyb20gJy4vZXh0ZW5zaW9ucy9pbmRleCc7XG5pbXBvcnQgeyBFdmVudEVtaXR0ZXIgfSBmcm9tICdldmVudHMnO1xuaW1wb3J0IENhbGVuZGFyIGZyb20gJy4vY2FsZW5kYXInO1xuaW1wb3J0IFBlcm1pc3Npb25zIGZyb20gJy4vcGVybWlzc2lvbnMnO1xuaW1wb3J0IFNpbWN0bCBmcm9tICdub2RlLXNpbWN0bCc7XG5cblxuY29uc3QgU1RBUlRVUF9USU1FT1VUID0gNjAgKiAxMDAwO1xuY29uc3QgRVhUUkFfU1RBUlRVUF9USU1FID0gMjAwMDtcbmNvbnN0IFVJX0NMSUVOVF9BQ0NFU1NfR1VBUkQgPSBuZXcgQXN5bmNMb2NrKCk7XG5jb25zdCBVSV9DTElFTlRfQlVORExFX0lEID0gJ2NvbS5hcHBsZS5pcGhvbmVzaW11bGF0b3InO1xuY29uc3QgU1BSSU5HQk9BUkRfQlVORExFX0lEID0gJ2NvbS5hcHBsZS5TcHJpbmdCb2FyZCc7XG5cbi8qXG4gKiBUaGlzIGV2ZW50IGlzIGVtaXR0ZWQgYXMgc29vbiBhcyBpT1MgU2ltdWxhdG9yXG4gKiBoYXMgZmluaXNoZWQgYm9vdGluZyBhbmQgaXQgaXMgcmVhZHkgdG8gYWNjZXB0IHhjcnVuIGNvbW1hbmRzLlxuICogVGhlIGV2ZW50IGhhbmRsZXIgaXMgY2FsbGVkIGFmdGVyICdydW4nIG1ldGhvZCBpcyBjb21wbGV0ZWRcbiAqIGZvciBYY29kZSA3IGFuZCBvbGRlciBhbmQgaXMgb25seSB1c2VmdWwgaW4gWGNvZGUgOCssXG4gKiBzaW5jZSBvbmUgY2FuIHN0YXJ0IGRvaW5nIHN0dWZmIChmb3IgZXhhbXBsZSBpbnN0YWxsL3VuaW5zdGFsbCBhbiBhcHApIGluIHBhcmFsbGVsXG4gKiB3aXRoIFNpbXVsYXRvciBVSSBzdGFydHVwLCB3aGljaCBzaG9ydGVucyBzZXNzaW9uIHN0YXJ0dXAgdGltZS5cbiAqL1xuY29uc3QgQk9PVF9DT01QTEVURURfRVZFTlQgPSAnYm9vdENvbXBsZXRlZCc7XG5cblxuY2xhc3MgU2ltdWxhdG9yWGNvZGU2IGV4dGVuZHMgRXZlbnRFbWl0dGVyIHtcblxuICAvKipcbiAgICogQ29uc3RydWN0cyB0aGUgb2JqZWN0IHdpdGggdGhlIGB1ZGlkYCBhbmQgdmVyc2lvbiBvZiBYY29kZS4gVXNlIHRoZSBleHBvcnRlZCBgZ2V0U2ltdWxhdG9yKHVkaWQpYCBtZXRob2QgaW5zdGVhZC5cbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IHVkaWQgLSBUaGUgU2ltdWxhdG9yIElELlxuICAgKiBAcGFyYW0ge29iamVjdH0geGNvZGVWZXJzaW9uIC0gVGhlIHRhcmdldCBYY29kZSB2ZXJzaW9uIGluIGZvcm1hdCB7bWFqb3IsIG1pbm9yLCBidWlsZH0uXG4gICAqL1xuICBjb25zdHJ1Y3RvciAodWRpZCwgeGNvZGVWZXJzaW9uKSB7XG4gICAgc3VwZXIoKTtcblxuICAgIHRoaXMudWRpZCA9IFN0cmluZyh1ZGlkKTtcbiAgICB0aGlzLnNpbWN0bCA9IG5ldyBTaW1jdGwoe1xuICAgICAgdWRpZDogdGhpcy51ZGlkLFxuICAgIH0pO1xuICAgIHRoaXMueGNvZGVWZXJzaW9uID0geGNvZGVWZXJzaW9uO1xuXG4gICAgLy8gcGxhdGZvcm1WZXJzaW9uIGNhbm5vdCBiZSBmb3VuZCBpbml0aWFsbHksIHNpbmNlIGdldHRpbmcgaXQgaGFzIHNpZGUgZWZmZWN0cyBmb3JcbiAgICAvLyBvdXIgbG9naWMgZm9yIGZpZ3VyaW5nIG91dCBpZiBhIHNpbSBoYXMgYmVlbiBydW5cbiAgICAvLyBpdCB3aWxsIGJlIHNldCB3aGVuIGl0IGlzIG5lZWRlZFxuICAgIHRoaXMuX3BsYXRmb3JtVmVyc2lvbiA9IG51bGw7XG5cbiAgICB0aGlzLmtleWNoYWluUGF0aCA9IHBhdGgucmVzb2x2ZSh0aGlzLmdldERpcigpLCAnTGlicmFyeScsICdLZXljaGFpbnMnKTtcbiAgICB0aGlzLnNpbXVsYXRvckFwcCA9ICdpT1MgU2ltdWxhdG9yLmFwcCc7XG5cbiAgICB0aGlzLmFwcERhdGFCdW5kbGVQYXRocyA9IHt9O1xuXG4gICAgLy8gbGlzdCBvZiBmaWxlcyB0byBjaGVjayBmb3Igd2hlbiBzZWVpbmcgaWYgYSBzaW11bGF0b3IgaXMgXCJmcmVzaFwiXG4gICAgLy8gKG1lYW5pbmcgaXQgaGFzIG5ldmVyIGJlZW4gYm9vdGVkKS5cbiAgICAvLyBJZiB0aGVzZSBmaWxlcyBhcmUgcHJlc2VudCwgd2UgYXNzdW1lIGl0J3MgYmVlbiBzdWNjZXNzZnVsbHkgYm9vdGVkXG4gICAgdGhpcy5pc0ZyZXNoRmlsZXMgPSBbXG4gICAgICAnTGlicmFyeS9Db25maWd1cmF0aW9uUHJvZmlsZXMnLFxuICAgICAgJ0xpYnJhcnkvQ29va2llcycsXG4gICAgICAnTGlicmFyeS9QcmVmZXJlbmNlcy8uR2xvYmFsUHJlZmVyZW5jZXMucGxpc3QnLFxuICAgICAgJ0xpYnJhcnkvUHJlZmVyZW5jZXMvY29tLmFwcGxlLnNwcmluZ2JvYXJkLnBsaXN0JyxcbiAgICAgICd2YXIvcnVuL3N5c2xvZy5waWQnXG4gICAgXTtcblxuICAgIC8vIGV4dHJhIHRpbWUgdG8gd2FpdCBmb3Igc2ltdWxhdG9yIHRvIGJlIGRlZW1lZCBib290ZWRcbiAgICB0aGlzLmV4dHJhU3RhcnR1cFRpbWUgPSBFWFRSQV9TVEFSVFVQX1RJTUU7XG5cbiAgICB0aGlzLmNhbGVuZGFyID0gbmV3IENhbGVuZGFyKHhjb2RlVmVyc2lvbiwgdGhpcy5nZXREaXIoKSk7XG4gICAgdGhpcy5wZXJtaXNzaW9ucyA9IG5ldyBQZXJtaXNzaW9ucyh4Y29kZVZlcnNpb24sIHRoaXMuZ2V0RGlyKCksIHRoaXMudWRpZCk7XG4gIH1cblxuICAvKipcbiAgICogQHJldHVybiB7c3RyaW5nfSBCdW5kbGUgaWRlbnRpZmllciBvZiBTaW11bGF0b3IgVUkgY2xpZW50LlxuICAgKi9cbiAgZ2V0IHVpQ2xpZW50QnVuZGxlSWQgKCkge1xuICAgIHJldHVybiBVSV9DTElFTlRfQlVORExFX0lEO1xuICB9XG5cbiAgLyoqXG4gICAqIEByZXR1cm4gez9zdHJpbmd9IFRoZSBmdWxsIHBhdGggdG8gdGhlIGRldmljZXMgc2V0IHdoZXJlIHRoZSBjdXJyZW50IHNpbXVsYXRvciBpcyBsb2NhdGVkLlxuICAgKiBgbnVsbGAgdmFsdWUgbWVhbnMgdGhhdCB0aGUgZGVmYXVsdCBwYXRoIGlzIHVzZWQsIHdoaWNoIGlzIHVzdWFsbHkgYH4vTGlicmFyeS9EZXZlbG9wZXIvQ29yZVNpbXVsYXRvci9EZXZpY2VzYFxuICAgKi9cbiAgZ2V0IGRldmljZXNTZXRQYXRoICgpIHtcbiAgICByZXR1cm4gdGhpcy5zaW1jdGwuZGV2aWNlc1NldFBhdGg7XG4gIH1cblxuICAvKipcbiAgICogU2V0IHRoZSBmdWxsIHBhdGggdG8gdGhlIGRldmljZXMgc2V0LiBJdCBpcyByZWNvbW1lbmRlZCB0byBzZXQgdGhpcyB2YWx1ZVxuICAgKiBvbmNlIHJpZ2h0IGFmdGVyIFNpbXVsYXRvciBpbnN0YW5jZSBpcyBjcmVhdGVkIGFuZCB0byBub3QgY2hhbmdlIGl0IGR1cmluZ1xuICAgKiB0aGUgaW5zdGFuY2UgbGlmZWN5Y2xlXG4gICAqXG4gICAqIEBwYXJhbSB7P3N0cmluZ30gdmFsdWUgVGhlIGZ1bGwgcGF0aCB0byB0aGUgZGV2aWNlcyBzZXQgcm9vdCBvbiB0aGVcbiAgICogbG9jYWwgZmlsZSBzeXN0ZW1cbiAgICovXG4gIHNldCBkZXZpY2VzU2V0UGF0aCAodmFsdWUpIHtcbiAgICB0aGlzLnNpbWN0bC5kZXZpY2VzU2V0UGF0aCA9IHZhbHVlO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHJpZXZlcyB0aGUgY3VycmVudCBwcm9jZXNzIGlkIG9mIHRoZSBVSSBjbGllbnRcbiAgICpcbiAgICogQHJldHVybiB7P3N0cmluZ30gVGhlIHByb2Nlc3MgSUQgb3IgbnVsbCBpZiB0aGUgVUkgY2xpZW50IGlzIG5vdCBydW5uaW5nXG4gICAqL1xuICBhc3luYyBnZXRVSUNsaWVudFBpZCAoKSB7XG4gICAgbGV0IHN0ZG91dDtcbiAgICB0cnkge1xuICAgICAgKHtzdGRvdXR9ID0gYXdhaXQgZXhlYygncGdyZXAnLCBbJy1mbicsIGAke3RoaXMuc2ltdWxhdG9yQXBwfS9Db250ZW50cy9NYWNPUy9gXSkpO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBpZiAoaXNOYU4ocGFyc2VJbnQoc3Rkb3V0LCAxMCkpKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgc3Rkb3V0ID0gc3Rkb3V0LnRyaW0oKTtcbiAgICBsb2cuZGVidWcoYEdvdCBTaW11bGF0b3IgVUkgY2xpZW50IFBJRDogJHtzdGRvdXR9YCk7XG4gICAgcmV0dXJuIHN0ZG91dDtcbiAgfVxuXG4gIC8qKlxuICAgKiBDaGVjayB0aGUgc3RhdGUgb2YgU2ltdWxhdG9yIFVJIGNsaWVudC5cbiAgICpcbiAgICogQHJldHVybiB7Ym9vbGVhbn0gVHJ1ZSBvZiBpZiBVSSBjbGllbnQgaXMgcnVubmluZyBvciBmYWxzZSBvdGhlcndpc2UuXG4gICAqL1xuICBhc3luYyBpc1VJQ2xpZW50UnVubmluZyAoKSB7XG4gICAgcmV0dXJuICFfLmlzTnVsbChhd2FpdCB0aGlzLmdldFVJQ2xpZW50UGlkKCkpO1xuICB9XG5cbiAgLyoqXG4gICAqIEhvdyBsb25nIHRvIHdhaXQgYmVmb3JlIHRocm93aW5nIGFuIGVycm9yIGFib3V0IFNpbXVsYXRvciBzdGFydHVwIHRpbWVvdXQgaGFwcGVuZWQuXG4gICAqXG4gICAqIEByZXR1cm4ge251bWJlcn0gVGhlIG51bWJlciBvZiBtaWxsaXNlY29uZHMuXG4gICAqL1xuICBnZXQgc3RhcnR1cFRpbWVvdXQgKCkge1xuICAgIHJldHVybiBTVEFSVFVQX1RJTUVPVVQ7XG4gIH1cblxuICAvKipcbiAgICogR2V0IHRoZSBwbGF0Zm9ybSB2ZXJzaW9uIG9mIHRoZSBjdXJyZW50IFNpbXVsYXRvci5cbiAgICpcbiAgICogQHJldHVybiB7c3RyaW5nfSBTREsgdmVyc2lvbiwgZm9yIGV4YW1wbGUgJzguMycuXG4gICAqL1xuICBhc3luYyBnZXRQbGF0Zm9ybVZlcnNpb24gKCkge1xuICAgIGlmICghdGhpcy5fcGxhdGZvcm1WZXJzaW9uKSB7XG4gICAgICBsZXQge3Nka30gPSBhd2FpdCB0aGlzLnN0YXQoKTtcbiAgICAgIHRoaXMuX3BsYXRmb3JtVmVyc2lvbiA9IHNkaztcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuX3BsYXRmb3JtVmVyc2lvbjtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXRyaWV2ZSB0aGUgZnVsbCBwYXRoIHRvIHRoZSBkaXJlY3Rvcnkgd2hlcmUgU2ltdWxhdG9yIHN0dWZmIGlzIGxvY2F0ZWQuXG4gICAqXG4gICAqIEByZXR1cm4ge3N0cmluZ30gVGhlIHBhdGggc3RyaW5nLlxuICAgKi9cbiAgZ2V0Um9vdERpciAoKSB7XG4gICAgbGV0IGhvbWUgPSBwcm9jZXNzLmVudi5IT01FO1xuICAgIHJldHVybiBwYXRoLnJlc29sdmUoaG9tZSwgJ0xpYnJhcnknLCAnRGV2ZWxvcGVyJywgJ0NvcmVTaW11bGF0b3InLCAnRGV2aWNlcycpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHJpZXZlIHRoZSBmdWxsIHBhdGggdG8gdGhlIGRpcmVjdG9yeSB3aGVyZSBTaW11bGF0b3IgYXBwbGljYXRpb25zIGRhdGEgaXMgbG9jYXRlZC5cbiAgICpcbiAgICogQHJldHVybiB7c3RyaW5nfSBUaGUgcGF0aCBzdHJpbmcuXG4gICAqL1xuICBnZXREaXIgKCkge1xuICAgIHJldHVybiBwYXRoLnJlc29sdmUodGhpcy5nZXRSb290RGlyKCksIHRoaXMudWRpZCwgJ2RhdGEnKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXRyaWV2ZSB0aGUgZnVsbCBwYXRoIHRvIHRoZSBkaXJlY3Rvcnkgd2hlcmUgU2ltdWxhdG9yIGxvZ3MgYXJlIHN0b3JlZC5cbiAgICpcbiAgICogQHJldHVybiB7c3RyaW5nfSBUaGUgcGF0aCBzdHJpbmcuXG4gICAqL1xuICBnZXRMb2dEaXIgKCkge1xuICAgIGxldCBob21lID0gcHJvY2Vzcy5lbnYuSE9NRTtcbiAgICByZXR1cm4gcGF0aC5yZXNvbHZlKGhvbWUsICdMaWJyYXJ5JywgJ0xvZ3MnLCAnQ29yZVNpbXVsYXRvcicsIHRoaXMudWRpZCk7XG4gIH1cblxuICAvKipcbiAgICogSW5zdGFsbCB2YWxpZCAuYXBwIHBhY2thZ2Ugb24gU2ltdWxhdG9yLlxuICAgKlxuICAgKiBAcGFyYW0ge3N0cmluZ30gYXBwIC0gVGhlIHBhdGggdG8gdGhlIC5hcHAgcGFja2FnZS5cbiAgICovXG4gIGFzeW5jIGluc3RhbGxBcHAgKGFwcCkge1xuICAgIHJldHVybiBhd2FpdCB0aGlzLnNpbWN0bC5pbnN0YWxsQXBwKGFwcCk7XG4gIH1cblxuICAvKipcbiAgICogVmVyaWZ5IHdoZXRoZXIgdGhlIHBhcnRpY3VsYXIgYXBwbGljYXRpb24gaXMgaW5zdGFsbGVkIG9uIFNpbXVsYXRvci5cbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IGJ1bmRsZUlkIC0gVGhlIGJ1bmRsZSBpZCBvZiB0aGUgYXBwbGljYXRpb24gdG8gYmUgY2hlY2tlZC5cbiAgICogQHBhcmFtIHtzdHJpbmd9IGFwcEZ1bGUgLSBBcHBsaWNhdGlvbiBuYW1lIG1pbnVzIFwiLmFwcFwiIChmb3IgaU9TIDcuMSlcbiAgICogQHJldHVybiB7Ym9vbGVhbn0gVHJ1ZSBpZiB0aGUgZ2l2ZW4gYXBwbGljYXRpb24gaXMgaW5zdGFsbGVkXG4gICAqL1xuICBhc3luYyBpc0FwcEluc3RhbGxlZCAoYnVuZGxlSWQsIGFwcEZpbGUgPSBudWxsKSB7XG4gICAgLy8gYGFwcEZpbGVgIGFyZ3VtZW50IG9ubHkgbmVjZXNzYXJ5IGZvciBpT1MgYmVsb3cgdmVyc2lvbiA4XG4gICAgbGV0IGFwcERpcnMgPSBhd2FpdCB0aGlzLmdldEFwcERpcnMoYXBwRmlsZSwgYnVuZGxlSWQpO1xuICAgIHJldHVybiBhcHBEaXJzLmxlbmd0aCAhPT0gMDtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm5zIHVzZXIgaW5zdGFsbGVkIGJ1bmRsZSBpZHMgd2hpY2ggaGFzICdidW5kbGVOYW1lJyBpbiB0aGVpciBJbmZvLlBsaXN0IGFzICdDRkJ1bmRsZU5hbWUnXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBidW5kbGVJZCAtIFRoZSBidW5kbGUgaWQgb2YgdGhlIGFwcGxpY2F0aW9uIHRvIGJlIGNoZWNrZWQuXG4gICAqIEByZXR1cm4ge2FycmF5PHN0cmluZz59IC0gVGhlIGxpc3Qgb2YgYnVuZGxlIGlkcyB3aGljaCBoYXZlICdidW5kbGVOYW1lJ1xuICAgKi9cbiAgYXN5bmMgZ2V0VXNlckluc3RhbGxlZEJ1bmRsZUlkc0J5QnVuZGxlTmFtZSAoYnVuZGxlTmFtZSkge1xuICAgIGNvbnN0IHJvb3RVc2VyQXBwRGlyID0gYXdhaXQgdGhpcy5idWlsZEJ1bmRsZVBhdGhNYXAoJ0J1bmRsZScpO1xuICAgIGNvbnN0IGJ1bmRsZUlkcyA9IFtdO1xuICAgIGlmIChfLmlzRW1wdHkocm9vdFVzZXJBcHBEaXIpKSB7XG4gICAgICByZXR1cm4gYnVuZGxlSWRzO1xuICAgIH1cblxuICAgIGZvciAoY29uc3QgW2J1bmRsZUlkLCB1c2VyQXBwRGlyUGF0aF0gb2YgT2JqZWN0LmVudHJpZXMocm9vdFVzZXJBcHBEaXIpKSB7XG4gICAgICBjb25zdCBhcHBGaWxlID0gKGF3YWl0IGZzLnJlYWRkaXIodXNlckFwcERpclBhdGgpKS5maW5kKFxuICAgICAgICAoZmlsZSkgPT4gcGF0aC5leHRuYW1lKGZpbGUpLnRvTG93ZXJDYXNlKCkgPT09ICcuYXBwJyk7XG4gICAgICBjb25zdCBpbmZvUGxpc3RQYXRoID0gcGF0aC5yZXNvbHZlKHVzZXJBcHBEaXJQYXRoLCBhcHBGaWxlLCAnSW5mby5wbGlzdCcpO1xuICAgICAgaWYgKCFhd2FpdCBmcy5leGlzdHMoaW5mb1BsaXN0UGF0aCkpIHtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCBpbmZvUGxpc3QgPSBhd2FpdCBwbGlzdC5wYXJzZVBsaXN0RmlsZShpbmZvUGxpc3RQYXRoLCBmYWxzZSk7XG4gICAgICAgIGlmIChpbmZvUGxpc3QuQ0ZCdW5kbGVOYW1lID09PSBidW5kbGVOYW1lKSB7XG4gICAgICAgICAgYnVuZGxlSWRzLnB1c2goYnVuZGxlSWQpO1xuICAgICAgICB9XG4gICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgbG9nLndhcm4oYEZhaWxlZCB0byByZWFkIHBsaXN0ICR7aW5mb1BsaXN0UGF0aH0uIE9yaWdpbmFsIGVycm9yICcke2Vyci5tZXNzYWdlfSdgKTtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgfVxuICAgIGxvZy5kZWJ1ZyhgVGhlIHNpbXVsYXRvciBoYXMgJyR7YnVuZGxlSWRzLmxlbmd0aH0nIGJ1bmRsZXMgd2hpY2ggaGF2ZSAnJHtidW5kbGVOYW1lfScgYXMgdGhlaXIgJ0NGQnVuZGxlTmFtZSc6YCk7XG4gICAgZm9yIChjb25zdCBidW5kbGVJZCBvZiBidW5kbGVJZHMpIHtcbiAgICAgIGxvZy5kZWJ1ZyhgICAgICcke2J1bmRsZUlkfSdgKTtcbiAgICB9XG4gICAgcmV0dXJuIGJ1bmRsZUlkcztcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXRyaWV2ZSB0aGUgZGlyZWN0b3J5IGZvciBhIHBhcnRpY3VsYXIgYXBwbGljYXRpb24ncyBkYXRhLlxuICAgKlxuICAgKiBAcGFyYW0ge3N0cmluZ30gaWQgLSBFaXRoZXIgYSBidW5kbGVJZCAoZS5nLiwgY29tLmFwcGxlLm1vYmlsZXNhZmFyaSkgb3IsIGZvciBpT1MgNy4xLCB0aGUgYXBwIG5hbWUgd2l0aG91dCBgLmFwcGAgKGUuZy4sIE1vYmlsZVNhZmFyaSlcbiAgICogQHBhcmFtIHtzdHJpbmd9IHN1YmRpciAtIFRoZSBzdWItZGlyZWN0b3J5IHdlIGV4cGVjdCB0byBiZSB3aXRoaW4gdGhlIGFwcGxpY2F0aW9uIGRpcmVjdG9yeS4gRGVmYXVsdHMgdG8gXCJEYXRhXCIuXG4gICAqIEByZXR1cm4ge3N0cmluZ30gVGhlIHJvb3QgYXBwbGljYXRpb24gZm9sZGVyLlxuICAgKi9cbiAgYXN5bmMgZ2V0QXBwRGlyIChpZCwgc3ViRGlyID0gJ0RhdGEnKSB7XG4gICAgdGhpcy5hcHBEYXRhQnVuZGxlUGF0aHNbc3ViRGlyXSA9IHRoaXMuYXBwRGF0YUJ1bmRsZVBhdGhzW3N1YkRpcl0gfHwge307XG4gICAgaWYgKF8uaXNFbXB0eSh0aGlzLmFwcERhdGFCdW5kbGVQYXRoc1tzdWJEaXJdKSAmJiAhYXdhaXQgdGhpcy5pc0ZyZXNoKCkpIHtcbiAgICAgIHRoaXMuYXBwRGF0YUJ1bmRsZVBhdGhzW3N1YkRpcl0gPSBhd2FpdCB0aGlzLmJ1aWxkQnVuZGxlUGF0aE1hcChzdWJEaXIpO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5hcHBEYXRhQnVuZGxlUGF0aHNbc3ViRGlyXVtpZF07XG4gIH1cblxuICAvKipcbiAgICogVGhlIHhjb2RlIDYgc2ltdWxhdG9ycyBhcmUgcmVhbGx5IGFubm95aW5nLCBhbmQgYnVyeSB0aGUgbWFpbiBhcHBcbiAgICogZGlyZWN0b3JpZXMgaW5zaWRlIGRpcmVjdG9yaWVzIGp1c3QgbmFtZWQgd2l0aCBIYXNoZXMuXG4gICAqIFRoaXMgZnVuY3Rpb24gZmluZHMgdGhlIHByb3BlciBkaXJlY3RvcnkgYnkgdHJhdmVyc2luZyBhbGwgb2YgdGhlbVxuICAgKiBhbmQgcmVhZGluZyBhIG1ldGFkYXRhIHBsaXN0IChNb2JpbGUgQ29udGFpbmVyIE1hbmFnZXIpIHRvIGdldCB0aGVcbiAgICogYnVuZGxlIGlkLlxuICAgKlxuICAgKiBAcGFyYW0ge3N0cmluZ30gc3ViZGlyIC0gVGhlIHN1Yi1kaXJlY3Rvcnkgd2UgZXhwZWN0IHRvIGJlIHdpdGhpbiB0aGUgYXBwbGljYXRpb24gZGlyZWN0b3J5LiBEZWZhdWx0cyB0byBcIkRhdGFcIi5cbiAgICogQHJldHVybiB7b2JqZWN0fSBUaGUgbGlzdCBvZiBwYXRoLWJ1bmRsZSBwYWlycyB0byBhbiBvYmplY3Qgd2hlcmUgYnVuZGxlSWRzIGFyZSBtYXBwZWQgdG8gcGF0aHMuXG4gICAqL1xuICBhc3luYyBidWlsZEJ1bmRsZVBhdGhNYXAgKHN1YkRpciA9ICdEYXRhJykge1xuICAgIGxvZy5kZWJ1ZygnQnVpbGRpbmcgYnVuZGxlIHBhdGggbWFwJyk7XG4gICAgbGV0IGFwcGxpY2F0aW9uTGlzdDtcbiAgICBsZXQgcGF0aEJ1bmRsZVBhaXI7XG4gICAgaWYgKGF3YWl0IHRoaXMuZ2V0UGxhdGZvcm1WZXJzaW9uKCkgPT09ICc3LjEnKSB7XG4gICAgICAvLyBhcHBzIGF2YWlsYWJsZVxuICAgICAgLy8gICBXZWIuYXBwLFxuICAgICAgLy8gICBXZWJWaWV3U2VydmljZS5hcHAsXG4gICAgICAvLyAgIE1vYmlsZVNhZmFyaS5hcHAsXG4gICAgICAvLyAgIFdlYkNvbnRlbnRBbmFseXNpc1VJLmFwcCxcbiAgICAgIC8vICAgRERBY3Rpb25zU2VydmljZS5hcHAsXG4gICAgICAvLyAgIFN0b3JlS2l0VUlTZXJ2aWNlLmFwcFxuICAgICAgYXBwbGljYXRpb25MaXN0ID0gcGF0aC5yZXNvbHZlKHRoaXMuZ2V0RGlyKCksICdBcHBsaWNhdGlvbnMnKTtcbiAgICAgIHBhdGhCdW5kbGVQYWlyID0gYXN5bmMgKGRpcikgPT4ge1xuICAgICAgICBkaXIgPSBwYXRoLnJlc29sdmUoYXBwbGljYXRpb25MaXN0LCBkaXIpO1xuICAgICAgICBsZXQgYXBwRmlsZXMgPSBhd2FpdCBmcy5nbG9iKGAke2Rpcn0vKi5hcHBgKTtcbiAgICAgICAgbGV0IGJ1bmRsZUlkID0gYXBwRmlsZXNbMF0ubWF0Y2goLy4qXFwvKC4qKVxcLmFwcC8pWzFdO1xuICAgICAgICByZXR1cm4ge3BhdGg6IGRpciwgYnVuZGxlSWR9O1xuICAgICAgfTtcbiAgICB9IGVsc2Uge1xuICAgICAgYXBwbGljYXRpb25MaXN0ID0gcGF0aC5yZXNvbHZlKHRoaXMuZ2V0RGlyKCksICdDb250YWluZXJzJywgc3ViRGlyLCAnQXBwbGljYXRpb24nKTtcbiAgICAgIC8vIGdpdmVuIGEgZGlyZWN0b3J5LCBmaW5kIHRoZSBwbGlzdCBmaWxlIGFuZCBwdWxsIHRoZSBidW5kbGUgaWQgZnJvbSBpdFxuICAgICAgbGV0IHJlYWRCdW5kbGVJZCA9IGFzeW5jIChkaXIpID0+IHtcbiAgICAgICAgbGV0IHBsaXN0ID0gcGF0aC5yZXNvbHZlKGRpciwgJy5jb20uYXBwbGUubW9iaWxlX2NvbnRhaW5lcl9tYW5hZ2VyLm1ldGFkYXRhLnBsaXN0Jyk7XG4gICAgICAgIGxldCBtZXRhZGF0YSA9IGF3YWl0IHNldHRpbmdzLnJlYWQocGxpc3QpO1xuICAgICAgICByZXR1cm4gbWV0YWRhdGEuTUNNTWV0YWRhdGFJZGVudGlmaWVyO1xuICAgICAgfTtcbiAgICAgIC8vIGdpdmVuIGEgZGlyZWN0b3J5LCByZXR1cm4gdGhlIHBhdGggYW5kIGJ1bmRsZSBpZCBhc3NvY2lhdGVkIHdpdGggaXRcbiAgICAgIHBhdGhCdW5kbGVQYWlyID0gYXN5bmMgKGRpcikgPT4ge1xuICAgICAgICBkaXIgPSBwYXRoLnJlc29sdmUoYXBwbGljYXRpb25MaXN0LCBkaXIpO1xuICAgICAgICBsZXQgYnVuZGxlSWQgPSBhd2FpdCByZWFkQnVuZGxlSWQoZGlyKTtcbiAgICAgICAgcmV0dXJuIHtwYXRoOiBkaXIsIGJ1bmRsZUlkfTtcbiAgICAgIH07XG4gICAgfVxuXG4gICAgaWYgKCFhd2FpdCBmcy5leGlzdHMoYXBwbGljYXRpb25MaXN0KSkge1xuICAgICAgbG9nLndhcm4oYE5vIGRpcmVjdG9yeSBwYXRoICcke2FwcGxpY2F0aW9uTGlzdH0nYCk7XG4gICAgICByZXR1cm4ge307XG4gICAgfVxuXG4gICAgbGV0IGJ1bmRsZVBhdGhEaXJzID0gYXdhaXQgZnMucmVhZGRpcihhcHBsaWNhdGlvbkxpc3QpO1xuICAgIGxldCBidW5kbGVQYXRoUGFpcnMgPSBhd2FpdCBhc3luY21hcChidW5kbGVQYXRoRGlycywgYXN5bmMgZnVuY3Rpb24gKGRpcikge1xuICAgICAgcmV0dXJuIGF3YWl0IHBhdGhCdW5kbGVQYWlyKGRpcik7XG4gICAgfSwgZmFsc2UpO1xuXG4gICAgLy8gcmVkdWNlIHRoZSBsaXN0IG9mIHBhdGgtYnVuZGxlIHBhaXJzIHRvIGFuIG9iamVjdCB3aGVyZSBidW5kbGVJZHMgYXJlIG1hcHBlZCB0byBwYXRoc1xuICAgIHJldHVybiBidW5kbGVQYXRoUGFpcnMucmVkdWNlKChidW5kbGVNYXAsIGJ1bmRsZVBhdGgpID0+IHtcbiAgICAgIGJ1bmRsZU1hcFtidW5kbGVQYXRoLmJ1bmRsZUlkXSA9IGJ1bmRsZVBhdGgucGF0aDtcbiAgICAgIHJldHVybiBidW5kbGVNYXA7XG4gICAgfSwge30pO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCB0aGUgc3RhdGUgYW5kIHNwZWNpZmljcyBvZiB0aGlzIHNpbS5cbiAgICpcbiAgICogQHJldHVybiB7b2JqZWN0fSBTaW11bGF0b3Igc3RhdHMgbWFwcGluZywgZm9yIGV4YW1wbGU6XG4gICAqIHsgbmFtZTogJ2lQaG9uZSA0cycsXG4gICAqICAgdWRpZDogJ0MwOUIzNEU1LTdEQ0ItNDQyRS1CNzlDLUFCNkJDMDM1NzQxNycsXG4gICAqICAgc3RhdGU6ICdTaHV0ZG93bicsXG4gICAqICAgc2RrOiAnOC4zJ1xuICAgKiB9XG4gICAqL1xuICBhc3luYyBzdGF0ICgpIHtcbiAgICBmb3IgKGxldCBbc2RrLCBkZXZpY2VBcnJdIG9mIF8udG9QYWlycyhhd2FpdCB0aGlzLnNpbWN0bC5nZXREZXZpY2VzKCkpKSB7XG4gICAgICBmb3IgKGxldCBkZXZpY2Ugb2YgZGV2aWNlQXJyKSB7XG4gICAgICAgIGlmIChkZXZpY2UudWRpZCA9PT0gdGhpcy51ZGlkKSB7XG4gICAgICAgICAgZGV2aWNlLnNkayA9IHNkaztcbiAgICAgICAgICByZXR1cm4gZGV2aWNlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHt9O1xuICB9XG5cbiAgLyoqXG4gICAqIFRoaXMgaXMgYSBiZXN0LWJldCBoZXVyaXN0aWMgZm9yIHdoZXRoZXIgb3Igbm90IGEgc2ltIGhhcyBiZWVuIGJvb3RlZFxuICAgKiBiZWZvcmUuIFdlIHVzdWFsbHkgd2FudCB0byBzdGFydCBhIHNpbXVsYXRvciB0byBcIndhcm1cIiBpdCB1cCwgaGF2ZVxuICAgKiBYY29kZSBwb3B1bGF0ZSBpdCB3aXRoIHBsaXN0cyBmb3IgdXMgdG8gbWFuaXB1bGF0ZSBiZWZvcmUgYSByZWFsXG4gICAqIHRlc3QgcnVuLlxuICAgKlxuICAgKiBAcmV0dXJuIHtib29sZWFufSBUcnVlIGlmIHRoZSBjdXJyZW50IFNpbXVsYXRvciBoYXMgbmV2ZXIgYmVlbiBzdGFydGVkIGJlZm9yZVxuICAgKi9cbiAgYXN5bmMgaXNGcmVzaCAoKSB7XG4gICAgLy8gaWYgdGhlIGZvbGxvd2luZyBmaWxlcyBkb24ndCBleGlzdCwgaXQgaGFzbid0IGJlZW4gYm9vdGVkLlxuICAgIC8vIFRISVMgSVMgTk9UIEFOIEVYSEFVU1RJVkUgTElTVFxuICAgIGxldCBmaWxlcyA9IHRoaXMuaXNGcmVzaEZpbGVzO1xuXG4gICAgbGV0IHB2ID0gYXdhaXQgdGhpcy5nZXRQbGF0Zm9ybVZlcnNpb24oKTtcbiAgICBpZiAocHYgIT09ICc3LjEnKSB7XG4gICAgICBmaWxlcy5wdXNoKCdMaWJyYXJ5L1ByZWZlcmVuY2VzL2NvbS5hcHBsZS5QcmVmZXJlbmNlcy5wbGlzdCcpO1xuICAgIH0gZWxzZSB7XG4gICAgICBmaWxlcy5wdXNoKCdBcHBsaWNhdGlvbnMnKTtcbiAgICB9XG5cbiAgICBjb25zdCBkaXIgPSB0aGlzLmdldERpcigpO1xuICAgIGZpbGVzID0gZmlsZXMubWFwKChzKSA9PiBwYXRoLnJlc29sdmUoZGlyLCBzKSk7XG5cbiAgICBjb25zdCBleGlzdGVuY2VzID0gYXdhaXQgYXN5bmNtYXAoZmlsZXMsIGFzeW5jIChmKSA9PiBhd2FpdCBmcy5oYXNBY2Nlc3MoZikpO1xuICAgIGNvbnN0IGZyZXNoID0gXy5jb21wYWN0KGV4aXN0ZW5jZXMpLmxlbmd0aCAhPT0gZmlsZXMubGVuZ3RoO1xuICAgIGxvZy5kZWJ1ZyhgQ2hlY2tpbmcgd2hldGhlciBzaW11bGF0b3IgaGFzIGJlZW4gcnVuIGJlZm9yZTogJHtmcmVzaCA/ICdubycgOiAneWVzJ31gKTtcblxuICAgIHJldHVybiBmcmVzaDtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXRyaWV2ZXMgdGhlIHN0YXRlIG9mIHRoZSBjdXJyZW50IFNpbXVsYXRvci4gT25lIHNob3VsZCBkaXN0aW5ndWlzaCB0aGVcbiAgICogc3RhdGVzIG9mIFNpbXVsYXRvciBVSSBhbmQgdGhlIFNpbXVsYXRvciBpdHNlbGYuXG4gICAqXG4gICAqIEByZXR1cm4ge2Jvb2xlYW59IFRydWUgaWYgdGhlIGN1cnJlbnQgU2ltdWxhdG9yIGlzIHJ1bm5pbmcuXG4gICAqL1xuICBhc3luYyBpc1J1bm5pbmcgKCkge1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCB0aGlzLnNpbWN0bC5nZXRFbnYoJ2R1bW15Jyk7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIENoZWNrcyBpZiB0aGUgc2ltdWxhdG9yIGlzIGluIHNodXRkb3duIHN0YXRlLlxuICAgKiBUaGlzIG1ldGhvZCBpcyBuZWNlc3NhcnksIGJlY2F1c2UgU2ltdWxhdG9yIG1pZ2h0IGFsc28gYmVcbiAgICogaW4gdGhlIHRyYW5zaXRpb25hbCBTaHV0dGluZyBEb3duIHN0YXRlIHJpZ2h0IGFmdGVyIHRoZSBgc2h1dGRvd25gXG4gICAqIGNvbW1hbmQgaGFzIGJlZW4gaXNzdWVkLlxuICAgKlxuICAgKiBAcmV0dXJuIHtib29sZWFufSBUcnVlIGlmIHRoZSBjdXJyZW50IFNpbXVsYXRvciBpcyBzaHV0IGRvd24uXG4gICAqL1xuICBhc3luYyBpc1NodXRkb3duICgpIHtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgdGhpcy5zaW1jdGwuZ2V0RW52KCdkdW1teScpO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIHJldHVybiBfLmluY2x1ZGVzKGUuc3RkZXJyLCAnQ3VycmVudCBzdGF0ZTogU2h1dGRvd24nKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogVmVyaWZ5IHdoZXRoZXIgdGhlIFNpbXVsYXRvciBib290aW5nIGlzIGNvbXBsZXRlZCBhbmQvb3Igd2FpdCBmb3IgaXRcbiAgICogdW50aWwgdGhlIHRpbWVvdXQgZXhwaXJlcy5cbiAgICpcbiAgICogQHBhcmFtIHtudW1iZXJ9IHN0YXJ0dXBUaW1lb3V0IC0gdGhlIG51bWJlciBvZiBtaWxsaXNlY29uZHMgdG8gd2FpdCB1bnRpbCBib290aW5nIGlzIGNvbXBsZXRlZC5cbiAgICogQGVtaXRzIEJPT1RfQ09NUExFVEVEX0VWRU5UIGlmIHRoZSBjdXJyZW50IFNpbXVsYXRvciBpcyByZWFkeSB0byBhY2NlcHQgc2ltY3RsIGNvbW1hbmRzLCBsaWtlICdpbnN0YWxsJy5cbiAgICovXG4gIGFzeW5jIHdhaXRGb3JCb290IChzdGFydHVwVGltZW91dCkge1xuICAgIC8vIHdhaXQgZm9yIHRoZSBzaW11bGF0b3IgdG8gYm9vdFxuICAgIC8vIHdhaXRpbmcgZm9yIHRoZSBzaW11bGF0b3Igc3RhdHVzIHRvIGJlICdib290ZWQnIGlzbid0IGdvb2QgZW5vdWdoXG4gICAgLy8gaXQgY2xhaW1zIHRvIGJlIGJvb3RlZCB3YXkgYmVmb3JlIGZpbmlzaGluZyBsb2FkaW5nXG4gICAgLy8gbGV0J3MgdGFpbCB0aGUgc2ltdWxhdG9yIHN5c3RlbSBsb2cgdW50aWwgd2Ugc2VlIGEgbWFnaWMgbGluZSAodGhpcy5ib290ZWRJbmRpY2F0b3IpXG4gICAgbGV0IGJvb3RlZEluZGljYXRvciA9IGF3YWl0IHRoaXMuZ2V0Qm9vdGVkSW5kaWNhdG9yU3RyaW5nKCk7XG4gICAgYXdhaXQgdGhpcy50YWlsTG9nc1VudGlsKGJvb3RlZEluZGljYXRvciwgc3RhcnR1cFRpbWVvdXQpO1xuXG4gICAgLy8gc28gc29ycnksIGJ1dCB3ZSBzaG91bGQgd2FpdCBhbm90aGVyIHR3byBzZWNvbmRzLCBqdXN0IHRvIG1ha2Ugc3VyZSB3ZSd2ZSByZWFsbHkgc3RhcnRlZFxuICAgIC8vIHdlIGNhbid0IGxvb2sgZm9yIGFub3RoZXIgbWFnaWMgbG9nIGxpbmUsIGJlY2F1c2UgdGhleSBzZWVtIHRvIGJlIGFwcC1kZXBlbmRlbnQgKG5vdCBzeXN0ZW0gZGVwZW5kZW50KVxuICAgIGxvZy5kZWJ1ZyhgV2FpdGluZyBhbiBleHRyYSAke3RoaXMuZXh0cmFTdGFydHVwVGltZX1tcyBmb3IgdGhlIHNpbXVsYXRvciB0byByZWFsbHkgZmluaXNoIGJvb3RpbmdgKTtcbiAgICBhd2FpdCBCLmRlbGF5KHRoaXMuZXh0cmFTdGFydHVwVGltZSk7XG4gICAgbG9nLmRlYnVnKCdEb25lIHdhaXRpbmcgZXh0cmEgdGltZSBmb3Igc2ltdWxhdG9yJyk7XG5cbiAgICB0aGlzLmVtaXQoQk9PVF9DT01QTEVURURfRVZFTlQpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgYSBtYWdpYyBzdHJpbmcsIHdoaWNoLCBpZiBwcmVzZW50IGluIGxvZ3MsIHJlZmxlY3RzIHRoZSBmYWN0IHRoYXQgc2ltdWxhdG9yIGJvb3RpbmcgaGFzIGJlZW4gY29tcGxldGVkLlxuICAgKlxuICAgKiBAcmV0dXJuIHtzdHJpbmd9IFRoZSBtYWdpYyBsb2cgc3RyaW5nLlxuICAgKi9cbiAgYXN5bmMgZ2V0Qm9vdGVkSW5kaWNhdG9yU3RyaW5nICgpIHtcbiAgICBsZXQgaW5kaWNhdG9yO1xuICAgIGxldCBwbGF0Zm9ybVZlcnNpb24gPSBhd2FpdCB0aGlzLmdldFBsYXRmb3JtVmVyc2lvbigpO1xuICAgIHN3aXRjaCAocGxhdGZvcm1WZXJzaW9uKSB7XG4gICAgICBjYXNlICc3LjEnOlxuICAgICAgY2FzZSAnOC4xJzpcbiAgICAgIGNhc2UgJzguMic6XG4gICAgICBjYXNlICc4LjMnOlxuICAgICAgY2FzZSAnOC40JzpcbiAgICAgICAgaW5kaWNhdG9yID0gJ3Byb2ZpbGVkOiBTZXJ2aWNlIHN0YXJ0aW5nLi4uJztcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICc5LjAnOlxuICAgICAgY2FzZSAnOS4xJzpcbiAgICAgIGNhc2UgJzkuMic6XG4gICAgICBjYXNlICc5LjMnOlxuICAgICAgICBpbmRpY2F0b3IgPSAnU3lzdGVtIGFwcCBcImNvbS5hcHBsZS5zcHJpbmdib2FyZFwiIGZpbmlzaGVkIHN0YXJ0dXAnO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJzEwLjAnOlxuICAgICAgICBpbmRpY2F0b3IgPSAnU3dpdGNoaW5nIHRvIGtleWJvYXJkJztcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICBsb2cud2FybihgTm8gYm9vdCBpbmRpY2F0b3IgY2FzZSBmb3IgcGxhdGZvcm0gdmVyc2lvbiAnJHtwbGF0Zm9ybVZlcnNpb259J2ApO1xuICAgICAgICBpbmRpY2F0b3IgPSAnbm8gYm9vdCBpbmRpY2F0b3Igc3RyaW5nIGF2YWlsYWJsZSc7XG4gICAgfVxuICAgIHJldHVybiBpbmRpY2F0b3I7XG4gIH1cblxuXG4gIC8qKlxuICAgKiBAdHlwZWRlZiB7T2JqZWN0fSBTaW11bGF0b3JPcHRpb25zXG4gICAqIEBwcm9wZXJ0eSB7P3N0cmluZ30gc2NhbGVGYWN0b3IgW251bGxdIC0gRGVmaW5lcyB0aGUgd2luZG93IHNjYWxlIHZhbHVlIGZvciB0aGUgVUkgY2xpZW50IHdpbmRvdyBmb3IgdGhlIGN1cnJlbnQgU2ltdWxhdG9yLlxuICAgKiAgIEVxdWFscyB0byBudWxsIGJ5IGRlZmF1bHQsIHdoaWNoIGtlZXBzIHRoZSBjdXJyZW50IHNjYWxlIHVuY2hhbmdlZC5cbiAgICogICBJdCBzaG91bGQgYmUgb25lIG9mIFsnMS4wJywgJzAuNzUnLCAnMC41JywgJzAuMzMnLCAnMC4yNSddLlxuICAgKiBAcHJvcGVydHkge251bWJlcn0gc3RhcnR1cFRpbWVvdXQgWzYwMDAwXSAtIE51bWJlciBvZiBtaWxsaXNlY29uZHMgdG8gd2FpdCB1bnRpbCBTaW11bGF0b3IgYm9vdGluZ1xuICAgKiAgIHByb2Nlc3MgaXMgY29tcGxldGVkLiBUaGUgZGVmYXVsdCB0aW1lb3V0IHdpbGwgYmUgdXNlZCBpZiBub3Qgc2V0IGV4cGxpY2l0bHkuXG4gICAqL1xuXG4gIC8qKlxuICAgKiBTdGFydCB0aGUgU2ltdWxhdG9yIFVJIGNsaWVudCB3aXRoIHRoZSBnaXZlbiBhcmd1bWVudHNcbiAgICogQHBhcmFtIHtTaW11bGF0b3JPcHRpb25zfSBvcHRzIC0gU2ltdWxhdG9yIHN0YXJ0dXAgb3B0aW9uc1xuICAgKi9cbiAgYXN5bmMgc3RhcnRVSUNsaWVudCAob3B0cyA9IHt9KSB7XG4gICAgb3B0cyA9IF8uY2xvbmVEZWVwKG9wdHMpO1xuICAgIF8uZGVmYXVsdHNEZWVwKG9wdHMsIHtcbiAgICAgIHNjYWxlRmFjdG9yOiBudWxsLFxuICAgICAgc3RhcnR1cFRpbWVvdXQ6IHRoaXMuc3RhcnR1cFRpbWVvdXQsXG4gICAgfSk7XG5cbiAgICBjb25zdCBzaW11bGF0b3JBcHAgPSBwYXRoLnJlc29sdmUoYXdhaXQgZ2V0WGNvZGVQYXRoKCksICdBcHBsaWNhdGlvbnMnLCB0aGlzLnNpbXVsYXRvckFwcCk7XG4gICAgY29uc3QgYXJncyA9IFtcbiAgICAgICctRm4nLCBzaW11bGF0b3JBcHAsXG4gICAgICAnLS1hcmdzJywgJy1DdXJyZW50RGV2aWNlVURJRCcsIHRoaXMudWRpZCxcbiAgICBdO1xuXG4gICAgaWYgKG9wdHMuc2NhbGVGYWN0b3IpIHtcbiAgICAgIGNvbnN0IHtuYW1lfSA9IGF3YWl0IHRoaXMuc3RhdCgpO1xuICAgICAgY29uc3QgZm9ybWF0dGVkRGV2aWNlTmFtZSA9IG5hbWUucmVwbGFjZSgvXFxzKy9nLCAnLScpO1xuICAgICAgY29uc3QgYXJndW1lbnROYW1lID0gYC1TaW11bGF0b3JXaW5kb3dMYXN0U2NhbGUtY29tLmFwcGxlLkNvcmVTaW11bGF0b3IuU2ltRGV2aWNlVHlwZS4ke2Zvcm1hdHRlZERldmljZU5hbWV9YDtcbiAgICAgIGFyZ3MucHVzaChhcmd1bWVudE5hbWUsIG9wdHMuc2NhbGVGYWN0b3IpO1xuICAgIH1cblxuICAgIGxvZy5pbmZvKGBTdGFydGluZyBTaW11bGF0b3IgVUkgd2l0aCBjb21tYW5kOiBvcGVuICR7YXJncy5qb2luKCcgJyl9YCk7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IGV4ZWMoJ29wZW4nLCBhcmdzLCB7dGltZW91dDogb3B0cy5zdGFydHVwVGltZW91dH0pO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgaWYgKCEoZXJyLnN0ZG91dCB8fCAnJykuaW5jbHVkZXMoJy0xMDgyNScpICYmICEoZXJyLnN0ZGVyciB8fCAnJykuaW5jbHVkZXMoJy0xMDgyNScpKSB7XG4gICAgICAgIHRocm93IGVycjtcbiAgICAgIH1cbiAgICAgIGxvZy53YXJuKGBFcnJvciB3aGlsZSBvcGVuaW5nIFVJOiAke2Vyci5zdGRvdXQgfHwgZXJyLnN0ZGVycn0uIENvbnRpbnVpbmdgKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogRXhlY3V0ZXMgZ2l2ZW4gU2ltdWxhdG9yIHdpdGggb3B0aW9ucy4gVGhlIFNpbXVsYXRvciB3aWxsIG5vdCBiZSByZXN0YXJ0ZWQgaWZcbiAgICogaXQgaXMgYWxyZWFkeSBydW5uaW5nLlxuICAgKlxuICAgKiBAcGFyYW0ge29iamVjdH0gb3B0cyAtIE9uZSBvciBtb3JlIG9mIGF2YWlsYWJsZSBTaW11bGF0b3Igb3B0aW9ucy5cbiAgICogICBTZWUgeyNzdGFydFVJQ2xpZW50KG9wdHMpfSBkb2N1bWVudGF0aW9uIGZvciBtb3JlIGRldGFpbHMgb24gb3RoZXIgc3VwcG9ydGVkIGtleXMuXG4gICAqL1xuICBhc3luYyBydW4gKG9wdHMgPSB7fSkge1xuICAgIG9wdHMgPSBPYmplY3QuYXNzaWduKHtcbiAgICAgIHN0YXJ0dXBUaW1lb3V0OiB0aGlzLnN0YXJ0dXBUaW1lb3V0LFxuICAgIH0sIG9wdHMpO1xuICAgIGNvbnN0IGlzU2VydmVyUnVubmluZyA9IGF3YWl0IHRoaXMuaXNSdW5uaW5nKCk7XG4gICAgY29uc3QgaXNVSUNsaWVudFJ1bm5pbmcgPSBhd2FpdCB0aGlzLmlzVUlDbGllbnRSdW5uaW5nKCk7XG4gICAgaWYgKGlzU2VydmVyUnVubmluZyAmJiBpc1VJQ2xpZW50UnVubmluZykge1xuICAgICAgbG9nLmluZm8oYEJvdGggU2ltdWxhdG9yIHdpdGggVURJRCAke3RoaXMudWRpZH0gYW5kIHRoZSBVSSBjbGllbnQgYXJlIGN1cnJlbnRseSBydW5uaW5nYCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IHRpbWVyID0gbmV3IHRpbWluZy5UaW1lcigpLnN0YXJ0KCk7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHRoaXMuc2h1dGRvd24oKTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGxvZy53YXJuKGBFcnJvciBvbiBTaW11bGF0b3Igc2h1dGRvd246ICR7ZXJyLm1lc3NhZ2V9YCk7XG4gICAgfVxuICAgIGF3YWl0IHRoaXMuc3RhcnRVSUNsaWVudChvcHRzKTtcblxuICAgIGF3YWl0IHRoaXMud2FpdEZvckJvb3Qob3B0cy5zdGFydHVwVGltZW91dCk7XG4gICAgbG9nLmluZm8oYFNpbXVsYXRvciB3aXRoIFVESUQgJHt0aGlzLnVkaWR9IGJvb3RlZCBpbiAke3RpbWVyLmdldER1cmF0aW9uKCkuYXNTZWNvbmRzLnRvRml4ZWQoMyl9c2ApO1xuICB9XG5cbiAgLy8gVE9ETyBrZWVwIGtleWNoYWluc1xuICAvKipcbiAgICogUmVzZXQgdGhlIGN1cnJlbnQgU2ltdWxhdG9yIHRvIHRoZSBjbGVhbiBzdGF0ZS5cbiAgICovXG4gIGFzeW5jIGNsZWFuICgpIHtcbiAgICBhd2FpdCB0aGlzLmVuZFNpbXVsYXRvckRhZW1vbigpO1xuICAgIGxvZy5pbmZvKGBDbGVhbmluZyBzaW11bGF0b3IgJHt0aGlzLnVkaWR9YCk7XG4gICAgYXdhaXQgdGhpcy5zaW1jdGwuZXJhc2VEZXZpY2UoMTAwMDApO1xuICB9XG5cbiAgLyoqXG4gICAqIFNjcnViIChkZWxldGUgdGhlIHByZWZlcmVuY2VzIGFuZCBjaGFuZ2VkIGZpbGVzKSB0aGUgcGFydGljdWxhciBhcHBsaWNhdGlvbiBvbiBTaW11bGF0b3IuXG4gICAqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBhcHBGaWxlIC0gQXBwbGljYXRpb24gbmFtZSBtaW51cyBcIi5hcHBcIi5cbiAgICogQHBhcmFtIHtzdHJpbmd9IGFwcEJ1bmRsZUlkIC0gQnVuZGxlIGlkZW50aWZpZXIgb2YgdGhlIGFwcGxpY2F0aW9uLlxuICAgKi9cbiAgYXN5bmMgc2NydWJDdXN0b21BcHAgKGFwcEZpbGUsIGFwcEJ1bmRsZUlkKSB7XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMuY2xlYW5DdXN0b21BcHAoYXBwRmlsZSwgYXBwQnVuZGxlSWQsIHRydWUpO1xuICB9XG5cbiAgLyoqXG4gICAqIENsZWFuL3NjcnViIHRoZSBwYXJ0aWN1bGFyIGFwcGxpY2F0aW9uIG9uIFNpbXVsYXRvci5cbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IGFwcEZpbGUgLSBBcHBsaWNhdGlvbiBuYW1lIG1pbnVzIFwiLmFwcFwiLlxuICAgKiBAcGFyYW0ge3N0cmluZ30gYXBwQnVuZGxlSWQgLSBCdW5kbGUgaWRlbnRpZmllciBvZiB0aGUgYXBwbGljYXRpb24uXG4gICAqIEBwYXJhbSB7Ym9vbGVhbn0gc2NydWIgLSBJZiBgc2NydWJgIGlzIGZhbHNlLCB3ZSB3YW50IHRvIGNsZWFuIGJ5IGRlbGV0aW5nIHRoZSBhcHAgYW5kIGFsbFxuICAgKiAgIGZpbGVzIGFzc29jaWF0ZWQgd2l0aCBpdC4gSWYgYHNjcnViYCBpcyB0cnVlLCB3ZSBqdXN0IHdhbnQgdG8gZGVsZXRlIHRoZSBwcmVmZXJlbmNlcyBhbmRcbiAgICogICBjaGFuZ2VkIGZpbGVzLlxuICAgKi9cbiAgYXN5bmMgY2xlYW5DdXN0b21BcHAgKGFwcEZpbGUsIGFwcEJ1bmRsZUlkLCBzY3J1YiA9IGZhbHNlKSB7XG4gICAgbG9nLmRlYnVnKGBDbGVhbmluZyBhcHAgZGF0YSBmaWxlcyBmb3IgJyR7YXBwRmlsZX0nLCAnJHthcHBCdW5kbGVJZH0nYCk7XG4gICAgaWYgKCFzY3J1Yikge1xuICAgICAgbG9nLmRlYnVnKGBEZWxldGluZyBhcHAgYWx0b2dldGhlcmApO1xuICAgIH1cblxuICAgIC8vIGdldCB0aGUgZGlyZWN0b3JpZXMgdG8gYmUgZGVsZXRlZFxuICAgIGxldCBhcHBEaXJzID0gYXdhaXQgdGhpcy5nZXRBcHBEaXJzKGFwcEZpbGUsIGFwcEJ1bmRsZUlkLCBzY3J1Yik7XG5cbiAgICBpZiAoYXBwRGlycy5sZW5ndGggPT09IDApIHtcbiAgICAgIGxvZy5kZWJ1ZygnQ291bGQgbm90IGZpbmQgYXBwIGRpcmVjdG9yaWVzIHRvIGRlbGV0ZS4gSXQgaXMgcHJvYmFibHkgbm90IGluc3RhbGxlZCcpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGxldCBkZWxldGVQcm9taXNlcyA9IFtdO1xuXG4gICAgZm9yIChsZXQgZGlyIG9mIGFwcERpcnMpIHtcbiAgICAgIGxvZy5kZWJ1ZyhgRGVsZXRpbmcgZGlyZWN0b3J5OiAnJHtkaXJ9J2ApO1xuICAgICAgZGVsZXRlUHJvbWlzZXMucHVzaChmcy5yaW1yYWYoZGlyKSk7XG4gICAgfVxuXG4gICAgaWYgKGF3YWl0IHRoaXMuZ2V0UGxhdGZvcm1WZXJzaW9uKCkgPj0gOCkge1xuICAgICAgbGV0IHJlbFJtUGF0aCA9IGBMaWJyYXJ5L1ByZWZlcmVuY2VzLyR7YXBwQnVuZGxlSWR9LnBsaXN0YDtcbiAgICAgIGxldCBybVBhdGggPSBwYXRoLnJlc29sdmUodGhpcy5nZXRSb290RGlyKCksIHJlbFJtUGF0aCk7XG4gICAgICBsb2cuZGVidWcoYERlbGV0aW5nIGZpbGU6ICcke3JtUGF0aH0nYCk7XG4gICAgICBkZWxldGVQcm9taXNlcy5wdXNoKGZzLnJpbXJhZihybVBhdGgpKTtcbiAgICB9XG5cbiAgICBhd2FpdCBCLmFsbChkZWxldGVQcm9taXNlcyk7XG4gIH1cblxuICAvKipcbiAgICogUmV0cmlldmUgcGF0aHMgdG8gZGlycyB3aGVyZSBhcHBsaWNhdGlvbiBkYXRhIGlzIHN0b3JlZC4gaU9TIDgrIHN0b3JlcyBhcHAgZGF0YSBpbiB0d28gcGxhY2VzLFxuICAgKiBhbmQgaU9TIDcuMSBoYXMgb25seSBvbmUgZGlyZWN0b3J5XG4gICAqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBhcHBGaWxlIC0gQXBwbGljYXRpb24gbmFtZSBtaW51cyBcIi5hcHBcIi5cbiAgICogQHBhcmFtIHtzdHJpbmd9IGFwcEJ1bmRsZUlkIC0gQnVuZGxlIGlkZW50aWZpZXIgb2YgdGhlIGFwcGxpY2F0aW9uLlxuICAgKiBAcGFyYW0ge2Jvb2xlYW59IHNjcnViIC0gVGhlIGBCdW5kbGVgIGRpcmVjdG9yeSBoYXMgdGhlIGFjdHVhbCBhcHAgaW4gaXQuIElmIHdlIGFyZSBqdXN0IHNjcnViYmluZyxcbiAgICogICB3ZSB3YW50IHRoaXMgdG8gc3RheS4gSWYgd2UgYXJlIGNsZWFuaW5nIHdlIGRlbGV0ZS5cbiAgICogQHJldHVybiB7YXJyYXk8c3RyaW5nPn0gQXJyYXkgb2YgYXBwbGljYXRpb24gZGF0YSBwYXRocy5cbiAgICovXG4gIGFzeW5jIGdldEFwcERpcnMgKGFwcEZpbGUsIGFwcEJ1bmRsZUlkLCBzY3J1YiA9IGZhbHNlKSB7XG4gICAgbGV0IGRpcnMgPSBbXTtcbiAgICBpZiAoYXdhaXQgdGhpcy5nZXRQbGF0Zm9ybVZlcnNpb24oKSA+PSA4KSB7XG4gICAgICBsZXQgZGF0YSA9IGF3YWl0IHRoaXMuZ2V0QXBwRGlyKGFwcEJ1bmRsZUlkKTtcbiAgICAgIGlmICghZGF0YSkgcmV0dXJuIGRpcnM7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgY3VybHlcblxuICAgICAgbGV0IGJ1bmRsZSA9ICFzY3J1YiA/IGF3YWl0IHRoaXMuZ2V0QXBwRGlyKGFwcEJ1bmRsZUlkLCAnQnVuZGxlJykgOiB1bmRlZmluZWQ7XG5cbiAgICAgIGZvciAobGV0IHNyYyBvZiBbZGF0YSwgYnVuZGxlXSkge1xuICAgICAgICBpZiAoc3JjKSB7XG4gICAgICAgICAgZGlycy5wdXNoKHNyYyk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgbGV0IGRhdGEgPSBhd2FpdCB0aGlzLmdldEFwcERpcihhcHBGaWxlKTtcbiAgICAgIGlmIChkYXRhKSB7XG4gICAgICAgIGRpcnMucHVzaChkYXRhKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGRpcnM7XG4gIH1cblxuICAvKipcbiAgICogRXhlY3V0ZSB0aGUgU2ltdWxhdG9yIGluIG9yZGVyIHRvIGhhdmUgdGhlIGluaXRpYWwgZmlsZSBzdHJ1Y3R1cmUgY3JlYXRlZCBhbmQgc2h1dGRvd24gaXQgYWZ0ZXJ3YXJkcy5cbiAgICpcbiAgICogQHBhcmFtIHtib29sZWFufSBzYWZhcmkgLSBXaGV0aGVyIHRvIGV4ZWN1dGUgbW9iaWxlIFNhZmFyaSBhZnRlciBzdGFydHVwLlxuICAgKiBAcGFyYW0ge251bWJlcn0gc3RhcnR1cFRpbWVvdXQgLSBIb3cgbG9uZyB0byB3YWl0IHVudGlsIFNpbXVsYXRvciBib290aW5nIGlzIGNvbXBsZXRlZCAoaW4gbWlsbGlzZWNvbmRzKS5cbiAgICovXG4gIGFzeW5jIGxhdW5jaEFuZFF1aXQgKHNhZmFyaSA9IGZhbHNlLCBzdGFydHVwVGltZW91dCA9IHRoaXMuc3RhcnR1cFRpbWVvdXQpIHtcbiAgICBsb2cuZGVidWcoJ0F0dGVtcHRpbmcgdG8gbGF1bmNoIGFuZCBxdWl0IHRoZSBzaW11bGF0b3IgdG8gY3JlYXRlIHRoZSBkaXJlY3Rvcnkgc3RydWN0dXJlJyk7XG4gICAgYXdhaXQgdGhpcy5ydW4oe3N0YXJ0dXBUaW1lb3V0fSk7XG5cbiAgICBpZiAoc2FmYXJpKSB7XG4gICAgICBsb2cuZGVidWcoJ1NwYXduaW5nIFNhZmFyaSBicm93c2VyIGluIG9yZGVyIHRvIGNyZWF0ZSB0aGUgbmVjZXNzYXJ5IGZpbGUgc3lzdGVtIGl0ZW1zJyk7XG4gICAgICBhd2FpdCBsYXVuY2hBcHAodGhpcy5zaW1jdGwsIE1PQklMRV9TQUZBUklfQlVORExFX0lEKTtcbiAgICB9XG5cbiAgICAvLyB3YWl0IGZvciB0aGUgc3lzdGVtIHRvIGNyZWF0ZSB0aGUgZmlsZXMgd2Ugd2lsbCBtYW5pcHVsYXRlXG4gICAgLy8gbmVlZCBxdWl0ZSBhIGhpZ2ggcmV0cnkgbnVtYmVyLCBpbiBvcmRlciB0byBhY2NvbW1vZGF0ZSBpT1MgNy4xXG4gICAgLy8gbG9jYWxseSwgNy4xIGF2ZXJhZ2VzIDguNSByZXRyaWVzIChmcm9tIDYgLSAxMilcbiAgICAvLyAgICAgICAgICA4IGF2ZXJhZ2VzIDAuNiByZXRyaWVzIChmcm9tIDAgLSAyKVxuICAgIC8vICAgICAgICAgIDkgYXZlcmFnZXMgMTQgcmV0cmllc1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCByZXRyeUludGVydmFsKDYwLCAyNTAsIGFzeW5jICgpID0+IHtcbiAgICAgICAgaWYgKGF3YWl0IHRoaXMuaXNGcmVzaCgpKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdTaW11bGF0b3IgZmlsZXMgbm90IGZ1bGx5IGNyZWF0ZWQuIFdhaXRpbmcgYSBiaXQnKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBsb2cud2FybihgVGltZW91dCB3YWl0aW5nIGZvciBzaW11bGF0b3IgZmlsZXMgdG8gYmUgY3JlYXRlZC4gQ29udGludWluZ2ApO1xuICAgIH1cblxuICAgIC8vIGFuZCBxdWl0XG4gICAgYXdhaXQgdGhpcy5zaHV0ZG93bigpO1xuICB9XG5cbiAgLyoqXG4gICAqIExvb2tzIGZvciBsYXVuY2hkIGRhZW1vbnMgY29ycmVzcG9uZGluZyB0byB0aGUgc2ltIHVkaWQgYW5kIHRyaWVzIHRvIHN0b3AgdGhlbSBjbGVhbmx5XG4gICAqIFRoaXMgcHJldmVudHMgeGNydW4gc2ltY3RsIGVyYXNlIGZyb20gaGFuZ2luZy5cbiAgICovXG4gIGFzeW5jIGVuZFNpbXVsYXRvckRhZW1vbiAoKSB7XG4gICAgbG9nLmRlYnVnKGBLaWxsaW5nIGFueSBzaW11bGF0b3IgZGFlbW9ucyBmb3IgJHt0aGlzLnVkaWR9YCk7XG5cbiAgICBsZXQgbGF1bmNoY3RsQ21kID0gYGxhdW5jaGN0bCBsaXN0IHwgZ3JlcCAke3RoaXMudWRpZH0gfCBjdXQgLWYgMyB8IHhhcmdzIC1uIDEgbGF1bmNoY3RsYDtcbiAgICB0cnkge1xuICAgICAgbGV0IHN0b3BDbWQgPSBgJHtsYXVuY2hjdGxDbWR9IHN0b3BgO1xuICAgICAgYXdhaXQgZXhlYygnYmFzaCcsIFsnLWMnLCBzdG9wQ21kXSk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBsb2cud2FybihgQ291bGQgbm90IHN0b3Agc2ltdWxhdG9yIGRhZW1vbnM6ICR7ZXJyLm1lc3NhZ2V9YCk7XG4gICAgICBsb2cuZGVidWcoJ0NhcnJ5aW5nIG9uIGFueXdheSEnKTtcbiAgICB9XG4gICAgdHJ5IHtcbiAgICAgIGxldCByZW1vdmVDbWQgPSBgJHtsYXVuY2hjdGxDbWR9IHJlbW92ZWA7XG4gICAgICBhd2FpdCBleGVjKCdiYXNoJywgWyctYycsIHJlbW92ZUNtZF0pO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgbG9nLndhcm4oYENvdWxkIG5vdCByZW1vdmUgc2ltdWxhdG9yIGRhZW1vbnM6ICR7ZXJyLm1lc3NhZ2V9YCk7XG4gICAgICBsb2cuZGVidWcoJ0NhcnJ5aW5nIG9uIGFueXdheSEnKTtcbiAgICB9XG4gICAgdHJ5IHtcbiAgICAgIC8vIFdhaXRzIDEwIHNlYyBmb3IgdGhlIHNpbXVsYXRvciBsYXVuY2hkIHNlcnZpY2VzIHRvIHN0b3AuXG4gICAgICBhd2FpdCB3YWl0Rm9yQ29uZGl0aW9uKGFzeW5jICgpID0+IHtcbiAgICAgICAgbGV0IHtzdGRvdXR9ID0gYXdhaXQgZXhlYygnYmFzaCcsIFsnLWMnLFxuICAgICAgICAgIGBwcyAtZSAgfCBncmVwICR7dGhpcy51ZGlkfSB8IGdyZXAgbGF1bmNoZF9zaW0gfCBncmVwIC12IGJhc2ggfCBncmVwIC12IGdyZXAgfCBhd2sgeydwcmludCQxJ31gXSk7XG4gICAgICAgIHJldHVybiBzdGRvdXQudHJpbSgpLmxlbmd0aCA9PT0gMDtcbiAgICAgIH0sIHt3YWl0TXM6IDEwMDAwLCBpbnRlcnZhbE1zOiA1MDB9KTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGxvZy53YXJuKGBDb3VsZCBub3QgZW5kIHNpbXVsYXRvciBkYWVtb24gZm9yICR7dGhpcy51ZGlkfTogJHtlcnIubWVzc2FnZX1gKTtcbiAgICAgIGxvZy5kZWJ1ZygnQ2Fycnlpbmcgb24gYW55d2F5IScpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBAdHlwZWRlZiB7T2JqZWN0fSBTaHV0ZG93bk9wdGlvbnNcbiAgICogQHByb3BlcnR5IHs/bnVtYmVyfHN0cmluZ30gdGltZW91dCBUaGUgbnVtYmVyIG9mIG1pbGxpc2Vjb25kcyB0byB3YWl0IHVudGlsXG4gICAqIFNpbXVsYXRvciBpcyBzaHV0IGRvd24gY29tcGxldGVseS4gTm8gd2FpdCBoYXBwZW5zIGlmIHRoZSB0aW1lb3V0IHZhbHVlIGlzIG5vdCBzZXRcbiAgICovXG5cbiAgLyoqXG4gICAqIFNodXQgZG93biB0aGUgY3VycmVudCBTaW11bGF0b3IuXG4gICAqXG4gICAqIEBwYXJhbSB7P1NodXRkb3duT3B0aW9uc30gb3B0c1xuICAgKiBAdGhyb3dzIHtFcnJvcn0gSWYgU2ltdWxhdG9yIGZhaWxzIHRvIHRyYW5zaXRpb24gaW50byBTaHV0ZG93biBzdGF0ZSBhZnRlclxuICAgKiB0aGUgZ2l2ZW4gdGltZW91dFxuICAgKi9cbiAgYXN5bmMgc2h1dGRvd24gKG9wdHMgPSB7fSkge1xuICAgIGlmIChhd2FpdCB0aGlzLmlzU2h1dGRvd24oKSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGF3YWl0IHJldHJ5SW50ZXJ2YWwoNSwgNTAwLCB0aGlzLnNpbWN0bC5zaHV0ZG93bkRldmljZS5iaW5kKHRoaXMuc2ltY3RsKSk7XG4gICAgY29uc3Qgd2FpdE1zID0gcGFyc2VJbnQob3B0cy50aW1lb3V0LCAxMCk7XG4gICAgaWYgKHdhaXRNcyA+IDApIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IHdhaXRGb3JDb25kaXRpb24oYXN5bmMgKCkgPT4gYXdhaXQgdGhpcy5pc1NodXRkb3duKCksIHtcbiAgICAgICAgICB3YWl0TXMsXG4gICAgICAgICAgaW50ZXJ2YWxNczogMTAwLFxuICAgICAgICB9KTtcbiAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFNpbXVsYXRvciBpcyBub3QgaW4gJ1NodXRkb3duJyBzdGF0ZSBhZnRlciAke3dhaXRNc31tc2ApO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBEZWxldGUgdGhlIHBhcnRpY3VsYXIgU2ltdWxhdG9yIGZyb20gZGV2aWNlcyBsaXN0XG4gICAqL1xuICBhc3luYyBkZWxldGUgKCkge1xuICAgIGF3YWl0IHRoaXMuc2ltY3RsLmRlbGV0ZURldmljZSgpO1xuICB9XG5cbiAgLyoqXG4gICAqIFVwZGF0ZSB0aGUgcGFydGljdWxhciBwcmVmZXJlbmNlIGZpbGUgd2l0aCB0aGUgZ2l2ZW4ga2V5L3ZhbHVlIHBhaXJzLlxuICAgKlxuICAgKiBAcGFyYW0ge3N0cmluZ30gcGxpc3QgLSBUaGUgcHJlZmVyZW5jZXMgZmlsZSB0byB1cGRhdGUuXG4gICAqIEBwYXJhbSB7b2JqZWN0fSB1cGRhdGVzIC0gVGhlIGtleS92YWx1ZSBwYWlycyB0byB1cGRhdGUuXG4gICAqL1xuICBhc3luYyB1cGRhdGVTZXR0aW5ncyAocGxpc3QsIHVwZGF0ZXMpIHtcbiAgICByZXR1cm4gYXdhaXQgc2V0dGluZ3MudXBkYXRlU2V0dGluZ3ModGhpcywgcGxpc3QsIHVwZGF0ZXMpO1xuICB9XG5cbiAgLyoqXG4gICAqIEF1dGhvcml6ZS9kZS1hdXRob3JpemUgbG9jYXRpb24gc2V0dGluZ3MgZm9yIGEgcGFydGljdWxhciBhcHBsaWNhdGlvbi5cbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IGJ1bmRsZUlkIC0gVGhlIGFwcGxpY2F0aW9uIElEIHRvIHVwZGF0ZS5cbiAgICogQHBhcmFtIHtib29sZWFufSBhdXRob3JpemVkIC0gV2hldGhlciBvciBub3QgdG8gYXV0aG9yaXplLlxuICAgKi9cbiAgYXN5bmMgdXBkYXRlTG9jYXRpb25TZXR0aW5ncyAoYnVuZGxlSWQsIGF1dGhvcml6ZWQpIHtcbiAgICByZXR1cm4gYXdhaXQgc2V0dGluZ3MudXBkYXRlTG9jYXRpb25TZXR0aW5ncyh0aGlzLCBidW5kbGVJZCwgYXV0aG9yaXplZCk7XG4gIH1cblxuICAvKipcbiAgICogRW5hYmxlL0Rpc2FibGUgcmVkdWNlIG1vdGlvbi5cbiAgICpcbiAgICogQHBhcmFtIHtib29sZWFufSByZWR1Y2VNb3Rpb24gLSBXaGV0aGVyIG9yIG5vdCB0byBlbmFibGUgaXQuXG4gICAqL1xuICBhc3luYyBzZXRSZWR1Y2VNb3Rpb24gKHJlZHVjZU1vdGlvbiA9IHRydWUpIHtcbiAgICBpZiAoYXdhaXQgdGhpcy5pc0ZyZXNoKCkpIHtcbiAgICAgIGF3YWl0IHRoaXMubGF1bmNoQW5kUXVpdChmYWxzZSwgU1RBUlRVUF9USU1FT1VUKTtcbiAgICB9XG5cbiAgICBhd2FpdCBzZXR0aW5ncy5zZXRSZWR1Y2VNb3Rpb24odGhpcywgcmVkdWNlTW90aW9uKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXRzIFVJIGFwcGVhcmFuY2Ugc3R5bGUuXG4gICAqIFRoaXMgZnVuY3Rpb24gY2FuIG9ubHkgYmUgY2FsbGVkIG9uIGEgYm9vdGVkIHNpbXVsYXRvci5cbiAgICpcbiAgICogQHNpbmNlIFhjb2RlIFNESyAxMS40XG4gICAqL1xuICBhc3luYyBzZXRBcHBlYXJhbmNlICgvKiB2YWx1ZSAqLykgeyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIHJlcXVpcmUtYXdhaXRcbiAgICB0aHJvdyBuZXcgRXJyb3IoYFhjb2RlIFNESyAnJHt0aGlzLnhjb2RlVmVyc2lvbn0nIGlzIHRvbyBvbGQgdG8gc2V0IFVJIGFwcGVhcmFuY2VgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXRzIHRoZSBjdXJyZW50IFVJIGFwcGVhcmFuY2Ugc3R5bGVcbiAgICogVGhpcyBmdW5jdGlvbiBjYW4gb25seSBiZSBjYWxsZWQgb24gYSBib290ZWQgc2ltdWxhdG9yLlxuICAgKlxuICAgKiBAc2luY2UgWGNvZGUgU0RLIDExLjRcbiAgICovXG4gIGFzeW5jIGdldEFwcGVhcmFuY2UgKCkgeyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIHJlcXVpcmUtYXdhaXRcbiAgICB0aHJvdyBuZXcgRXJyb3IoYFhjb2RlIFNESyAnJHt0aGlzLnhjb2RlVmVyc2lvbn0nIGlzIHRvbyBvbGQgdG8gZ2V0IFVJIGFwcGVhcmFuY2VgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGUgc2V0dGluZ3MgZm9yIFNhZmFyaS5cbiAgICpcbiAgICogQHBhcmFtIHtvYmplY3R9IHVwZGF0ZXMgLSBUaGUgaGFzaCBvZiBrZXkvdmFsdWUgcGFpcnMgdG8gdXBkYXRlIGZvciBTYWZhcmkuXG4gICAqL1xuICBhc3luYyB1cGRhdGVTYWZhcmlTZXR0aW5ncyAodXBkYXRlcykge1xuICAgIGxldCB1cGRhdGVkID0gYXdhaXQgc2V0dGluZ3MudXBkYXRlU2FmYXJpVXNlclNldHRpbmdzKHRoaXMsIHVwZGF0ZXMpO1xuICAgIHJldHVybiBhd2FpdCBzZXR0aW5ncy51cGRhdGVTZXR0aW5ncyh0aGlzLCAnbW9iaWxlU2FmYXJpJywgdXBkYXRlcykgfHwgdXBkYXRlZDtcbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGUgZ2xvYmFsIHNldHRpbmdzIGZvciBTYWZhcmkuXG4gICAqXG4gICAqIEBwYXJhbSB7b2JqZWN0fSB1cGRhdGVzIC0gVGhlIGhhc2ggb2Yga2V5L3ZhbHVlIHBhaXJzIHRvIHVwZGF0ZSBmb3IgU2FmYXJpLlxuICAgKi9cbiAgYXN5bmMgdXBkYXRlU2FmYXJpR2xvYmFsU2V0dGluZ3MgKHVwZGF0ZXMpIHtcbiAgICByZXR1cm4gYXdhaXQgc2V0dGluZ3MudXBkYXRlU2FmYXJpR2xvYmFsU2V0dGluZ3ModGhpcywgdXBkYXRlcyk7XG4gIH1cblxuICAvKipcbiAgICogVXBkYXRlIHRoZSBsb2NhbGUgZm9yIHRoZSBTaW11bGF0b3IuXG4gICAqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBsYW5ndWFnZSAtIFRoZSBsYW5ndWFnZSBmb3IgdGhlIHNpbXVsYXRvci4gRS5nLiwgYFwiZnJfVVNcImAuXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBsb2NhbGUgLSBUaGUgbG9jYWxlIHRvIHNldCBmb3IgdGhlIHNpbXVsYXRvci4gRS5nLiwgYFwiZW5cImAuXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBjYWxlbmRhckZvcm1hdCAtIFRoZSBmb3JtYXQgb2YgdGhlIGNhbGVuZGFyLlxuICAgKi9cbiAgYXN5bmMgdXBkYXRlTG9jYWxlIChsYW5ndWFnZSwgbG9jYWxlLCBjYWxlbmRhckZvcm1hdCkge1xuICAgIHJldHVybiBhd2FpdCBzZXR0aW5ncy51cGRhdGVMb2NhbGUodGhpcywgbGFuZ3VhZ2UsIGxvY2FsZSwgY2FsZW5kYXJGb3JtYXQpO1xuICB9XG5cbiAgLyoqXG4gICAqIENvbXBsZXRlbHkgZGVsZXRlIG1vYmlsZSBTYWZhcmkgYXBwbGljYXRpb24gZnJvbSB0aGUgY3VycmVudCBTaW11bGF0b3IuXG4gICAqL1xuICBhc3luYyBkZWxldGVTYWZhcmkgKCkge1xuICAgIGxvZy5kZWJ1ZygnRGVsZXRpbmcgU2FmYXJpIGFwcHMgZnJvbSBzaW11bGF0b3InKTtcblxuICAgIGxldCBkaXJzID0gW107XG5cbiAgICAvLyBnZXQgdGhlIGRhdGEgZGlyZWN0b3J5XG4gICAgZGlycy5wdXNoKGF3YWl0IHRoaXMuZ2V0QXBwRGlyKE1PQklMRV9TQUZBUklfQlVORExFX0lEKSk7XG5cbiAgICBsZXQgcHYgPSBhd2FpdCB0aGlzLmdldFBsYXRmb3JtVmVyc2lvbigpO1xuICAgIGlmIChwdiA+PSA4KSB7XG4gICAgICAvLyBnZXQgdGhlIGJ1bmRsZSBkaXJlY3RvcnlcbiAgICAgIGRpcnMucHVzaChhd2FpdCB0aGlzLmdldEFwcERpcihNT0JJTEVfU0FGQVJJX0JVTkRMRV9JRCwgJ0J1bmRsZScpKTtcbiAgICB9XG5cbiAgICBsZXQgZGVsZXRlUHJvbWlzZXMgPSBbXTtcbiAgICBmb3IgKGxldCBkaXIgb2YgXy5jb21wYWN0KGRpcnMpKSB7XG4gICAgICBsb2cuZGVidWcoYERlbGV0aW5nIGRpcmVjdG9yeTogJyR7ZGlyfSdgKTtcbiAgICAgIGRlbGV0ZVByb21pc2VzLnB1c2goZnMucmltcmFmKGRpcikpO1xuICAgIH1cbiAgICBhd2FpdCBCLmFsbChkZWxldGVQcm9taXNlcyk7XG4gIH1cblxuICAvKipcbiAgICogQ2xlYW4gdXAgdGhlIGRpcmVjdG9yaWVzIGZvciBtb2JpbGUgU2FmYXJpLlxuICAgKlxuICAgKiBAcGFyYW0ge2Jvb2xlYW59IGtlZXBQcmVmcyAtIFdoZXRoZXIgdG8ga2VlcCBTYWZhcmkgcHJlZmVyZW5jZXMgZnJvbSBiZWluZyBkZWxldGVkLlxuICAgKi9cbiAgYXN5bmMgY2xlYW5TYWZhcmkgKGtlZXBQcmVmcyA9IHRydWUpIHtcbiAgICBsb2cuZGVidWcoJ0NsZWFuaW5nIG1vYmlsZSBzYWZhcmkgZGF0YSBmaWxlcycpO1xuICAgIGlmIChhd2FpdCB0aGlzLmlzRnJlc2goKSkge1xuICAgICAgbG9nLmluZm8oJ0NvdWxkIG5vdCBmaW5kIFNhZmFyaSBzdXBwb3J0IGRpcmVjdG9yaWVzIHRvIGNsZWFuIG91dCBvbGQgJyArXG4gICAgICAgICAgICAgICAnZGF0YS4gUHJvYmFibHkgdGhlcmUgaXMgbm90aGluZyB0byBjbGVhbiBvdXQnKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBsZXQgbGlicmFyeURpciA9IHBhdGgucmVzb2x2ZSh0aGlzLmdldERpcigpLCAnTGlicmFyeScpO1xuICAgIGxldCBzYWZhcmlSb290ID0gYXdhaXQgdGhpcy5nZXRBcHBEaXIoTU9CSUxFX1NBRkFSSV9CVU5ETEVfSUQpO1xuICAgIGlmICghc2FmYXJpUm9vdCkge1xuICAgICAgbG9nLmluZm8oJ0NvdWxkIG5vdCBmaW5kIFNhZmFyaSBzdXBwb3J0IGRpcmVjdG9yaWVzIHRvIGNsZWFuIG91dCBvbGQgJyArXG4gICAgICAgICAgICAgICAnZGF0YS4gUHJvYmFibHkgdGhlcmUgaXMgbm90aGluZyB0byBjbGVhbiBvdXQnKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgbGV0IHNhZmFyaUxpYnJhcnlEaXIgPSBwYXRoLnJlc29sdmUoc2FmYXJpUm9vdCwgJ0xpYnJhcnknKTtcbiAgICBsZXQgZmlsZXNUb0RlbGV0ZSA9IFtcbiAgICAgIGBDYWNoZXMvU25hcHNob3RzLyR7TU9CSUxFX1NBRkFSSV9CVU5ETEVfSUR9YCxcbiAgICAgIGBDYWNoZXMvJHtNT0JJTEVfU0FGQVJJX0JVTkRMRV9JRH0vKmAsXG4gICAgICAnQ2FjaGVzL2NvbS5hcHBsZS5XZWJBcHBDYWNoZS8qJyxcbiAgICAgICdDYWNoZXMvY29tLmFwcGxlLldlYktpdC5OZXR3b3JraW5nLyonLFxuICAgICAgJ0NhY2hlcy9jb20uYXBwbGUuV2ViS2l0LldlYkNvbnRlbnQvKicsXG4gICAgICAnSW1hZ2UgQ2FjaGUvKicsXG4gICAgICBgV2ViS2l0LyR7TU9CSUxFX1NBRkFSSV9CVU5ETEVfSUR9LypgLFxuICAgICAgJ1dlYktpdC9HZW9sb2NhdGlvblNpdGVzLnBsaXN0JyxcbiAgICAgICdXZWJLaXQvTG9jYWxTdG9yYWdlLyouKicsXG4gICAgICAnU2FmYXJpLyonLFxuICAgICAgJ0Nvb2tpZXMvKi5iaW5hcnljb29raWVzJyxcbiAgICAgICdDYWNoZXMvY29tLmFwcGxlLlVJU3RhdHVzQmFyLyonLFxuICAgICAgJ0NhY2hlcy9jb20uYXBwbGUua2V5Ym9hcmRzL2ltYWdlcy8qJyxcbiAgICAgICdDYWNoZXMvY29tLmFwcGxlLlNhZmFyaS5TYWZlQnJvd3NpbmcvKicsXG4gICAgICBgLi4vdG1wLyR7TU9CSUxFX1NBRkFSSV9CVU5ETEVfSUR9LypgXG4gICAgXTtcbiAgICBsZXQgZGVsZXRlUHJvbWlzZXMgPSBbXTtcblxuICAgIGZvciAobGV0IGZpbGUgb2YgZmlsZXNUb0RlbGV0ZSkge1xuICAgICAgZGVsZXRlUHJvbWlzZXMucHVzaChmcy5yaW1yYWYocGF0aC5yZXNvbHZlKGxpYnJhcnlEaXIsIGZpbGUpKSk7XG4gICAgICBkZWxldGVQcm9taXNlcy5wdXNoKGZzLnJpbXJhZihwYXRoLnJlc29sdmUoc2FmYXJpTGlicmFyeURpciwgZmlsZSkpKTtcbiAgICB9XG5cbiAgICBpZiAoIWtlZXBQcmVmcykge1xuICAgICAgZGVsZXRlUHJvbWlzZXMucHVzaChmcy5yaW1yYWYocGF0aC5yZXNvbHZlKHNhZmFyaUxpYnJhcnlEaXIsICdQcmVmZXJlbmNlcy8qLnBsaXN0JykpKTtcbiAgICB9XG5cbiAgICBhd2FpdCBCLmFsbChkZWxldGVQcm9taXNlcyk7XG4gIH1cblxuICAvKipcbiAgICogVW5pbnN0YWxsIHRoZSBnaXZlbiBhcHBsaWNhdGlvbiBmcm9tIHRoZSBjdXJyZW50IFNpbXVsYXRvci5cbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IGJ1bmRsZUlkIC0gVGhlIGJ1aW5kbGUgSUQgb2YgdGhlIGFwcGxpY2F0aW9uIHRvIGJlIHJlbW92ZWQuXG4gICAqL1xuICBhc3luYyByZW1vdmVBcHAgKGJ1bmRsZUlkKSB7XG4gICAgYXdhaXQgdGhpcy5zaW1jdGwucmVtb3ZlQXBwKGJ1bmRsZUlkKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBNb3ZlIGEgYnVpbHQtaW4gYXBwbGljYXRpb24gdG8gYSBuZXcgcGxhY2UgKGFjdHVhbGx5LCByZW5hbWUgaXQpLlxuICAgKlxuICAgKiBAcGFyYW0ge3N0cmluZ30gYXBwTmFtZSAtIFRoZSBuYW1lIG9mIHRoZSBhcHAgdG8gYmUgbW92ZWQuXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBhcHBQYXRoIC0gVGhlIGN1cnJlbnQgcGF0aCB0byB0aGUgYXBwbGljYXRpb24uXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBuZXdBcHBQYXRoIC0gVGhlIG5ldyBwYXRoIHRvIHRoZSBhcHBsaWNhdGlvbi5cbiAgICogICBJZiBzb21lIGFwcGxpY2F0aW9uIGFscmVhZHkgZXhpc3RzIGJ5IHRoaXMgcGF0aCB0aGVuIGl0J3MgZ29pbmcgdG8gYmUgcmVtb3ZlZC5cbiAgICovXG4gIGFzeW5jIG1vdmVCdWlsdEluQXBwIChhcHBOYW1lLCBhcHBQYXRoLCBuZXdBcHBQYXRoKSB7XG4gICAgYXdhaXQgc2FmZVJpbVJhZihuZXdBcHBQYXRoKTtcbiAgICBhd2FpdCBmcy5jb3B5RmlsZShhcHBQYXRoLCBuZXdBcHBQYXRoKTtcbiAgICBsb2cuZGVidWcoYENvcGllZCAnJHthcHBOYW1lfScgdG8gJyR7bmV3QXBwUGF0aH0nYCk7XG5cbiAgICBhd2FpdCBmcy5yaW1yYWYoYXBwUGF0aCk7XG4gICAgbG9nLmRlYnVnKGBUZW1wb3JhcmlseSBkZWxldGVkIG9yaWdpbmFsIGFwcCBhdCAnJHthcHBQYXRofSdgKTtcblxuICAgIHJldHVybiBbbmV3QXBwUGF0aCwgYXBwUGF0aF07XG4gIH1cblxuICAvKipcbiAgICogT3BlbiB0aGUgZ2l2ZW4gVVJMIGluIG1vYmlsZSBTYWZhcmkgYnJvd3Nlci5cbiAgICogVGhlIGJyb3dzZXIgd2lsbCBiZSBzdGFydGVkIGF1dG9tYXRpY2FsbHkgaWYgaXQgaXMgbm90IHJ1bm5pbmcuXG4gICAqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSB1cmwgLSBUaGUgVVJMIHRvIGJlIG9wZW5lZC5cbiAgICovXG4gIGFzeW5jIG9wZW5VcmwgKHVybCkge1xuICAgIGNvbnN0IFNBRkFSSV9CT09URURfSU5ESUNBVE9SID0gJ01vYmlsZVNhZmFyaVsnO1xuICAgIGNvbnN0IFNBRkFSSV9TVEFSVFVQX1RJTUVPVVQgPSAxNSAqIDEwMDA7XG4gICAgY29uc3QgRVhUUkFfU1RBUlRVUF9USU1FID0gMyAqIDEwMDA7XG5cbiAgICBpZiAoYXdhaXQgdGhpcy5pc1J1bm5pbmcoKSkge1xuICAgICAgYXdhaXQgcmV0cnkoNTAwMCwgdGhpcy5zaW1jdGwub3BlblVybC5iaW5kKHRoaXMuc2ltY3RsKSwgdXJsKTtcbiAgICAgIGF3YWl0IHRoaXMudGFpbExvZ3NVbnRpbChTQUZBUklfQk9PVEVEX0lORElDQVRPUiwgU0FGQVJJX1NUQVJUVVBfVElNRU9VVCk7XG4gICAgICAvLyBTbyBzb3JyeSwgYnV0IHRoZSBsb2dzIGhhdmUgbm90aGluZyBlbHNlIGZvciBTYWZhcmkgc3RhcnRpbmcuLiBqdXN0IGRlbGF5IGEgbGl0dGxlIGJpdFxuICAgICAgbG9nLmRlYnVnKGBTYWZhcmkgc3RhcnRlZCwgd2FpdGluZyAke0VYVFJBX1NUQVJUVVBfVElNRX1tcyBmb3IgaXQgdG8gZnVsbHkgc3RhcnRgKTtcbiAgICAgIGF3YWl0IEIuZGVsYXkoRVhUUkFfU1RBUlRVUF9USU1FKTtcbiAgICAgIGxvZy5kZWJ1ZygnRG9uZSB3YWl0aW5nIGZvciBTYWZhcmknKTtcbiAgICAgIHJldHVybjtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdUcmllZCB0byBvcGVuIGEgdXJsLCBidXQgdGhlIFNpbXVsYXRvciBpcyBub3QgQm9vdGVkJyk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFBlcmZvcm0gU2ltdWxhdG9yIGNhY2hlcyBjbGVhbnVwLlxuICAgKlxuICAgKiBAcGFyYW0gey4uLnN0cmluZ30gZm9sZGVyTmFtZXMgLSBUaGUgbmFtZXMgb2YgQ2FjaGVzIHN1YmZvbGRlcnMgdG8gYmUgY2xlYW5lZC5cbiAgICogICBOb24tYWNjZXNzaWJsZS9ub24tZXhpc3Rpbmcgc3ViZm9sZGVycyB3aWxsIGJlIHNraXBwZWQuXG4gICAqICAgQWxsIGV4aXN0aW5nIHN1YmZvbGRlcnMgdW5kZXIgQ2FjaGVzIHdpbGwgYmUgZGVsZXRlZCBpZiB0aGlzIHBhcmFtZXRlciBpcyBvbWl0dGVkLlxuICAgKiBAcmV0dXJucyB7bnVtYmVyfSBUaGUgY291bnQgb2YgY2xlYW5lZCBjYWNoZSBpdGVtcy5cbiAgICogICBaZXJvIGlzIHJldHVybmVkIGlmIG5vIGl0ZW1zIHdlcmUgbWF0Y2hlZCBmb3IgY2xlYW51cCAoZWl0aGVyIG5vdCBhY2Nlc3NpYmxlIG9yIG5vdCBkaXJlY3RvcmllcykuXG4gICAqL1xuICBhc3luYyBjbGVhckNhY2hlcyAoLi4uZm9sZGVyTmFtZXMpIHtcbiAgICBjb25zdCBjYWNoZXNSb290ID0gcGF0aC5yZXNvbHZlKHRoaXMuZ2V0RGlyKCksICdMaWJyYXJ5JywgJ0NhY2hlcycpO1xuICAgIGlmICghKGF3YWl0IGZzLmhhc0FjY2VzcyhjYWNoZXNSb290KSkpIHtcbiAgICAgIGxvZy5kZWJ1ZyhgQ2FjaGVzIHJvb3QgYXQgJyR7Y2FjaGVzUm9vdH0nIGRvZXMgbm90IGV4aXN0IG9yIGlzIG5vdCBhY2Nlc3NpYmxlLiBOb3RoaW5nIHRvIGRvIHRoZXJlYCk7XG4gICAgICByZXR1cm4gMDtcbiAgICB9XG5cbiAgICBsZXQgaXRlbXNUb1JlbW92ZSA9IGZvbGRlck5hbWVzLmxlbmd0aCA/IGZvbGRlck5hbWVzIDogKGF3YWl0IGZzLnJlYWRkaXIoY2FjaGVzUm9vdCkpO1xuICAgIGl0ZW1zVG9SZW1vdmUgPSBpdGVtc1RvUmVtb3ZlLm1hcCgoeCkgPT4gcGF0aC5yZXNvbHZlKGNhY2hlc1Jvb3QsIHgpKTtcbiAgICBpZiAoZm9sZGVyTmFtZXMubGVuZ3RoKSB7XG4gICAgICBpdGVtc1RvUmVtb3ZlID0gYXdhaXQgQi5maWx0ZXIoaXRlbXNUb1JlbW92ZSwgKHgpID0+IGZzLmhhc0FjY2Vzcyh4KSk7XG4gICAgfVxuICAgIGl0ZW1zVG9SZW1vdmUgPSBhd2FpdCBCLmZpbHRlcihpdGVtc1RvUmVtb3ZlLCBhc3luYyAoeCkgPT4gKGF3YWl0IGZzLnN0YXQoeCkpLmlzRGlyZWN0b3J5KCkpO1xuICAgIGlmICghaXRlbXNUb1JlbW92ZS5sZW5ndGgpIHtcbiAgICAgIGxvZy5kZWJ1ZyhgTm8gU2ltdWxhdG9yIGNhY2hlIGl0ZW1zIGZvciBjbGVhbnVwIHdlcmUgbWF0Y2hlZCBpbiAnJHtjYWNoZXNSb290fSdgKTtcbiAgICAgIHJldHVybiAwO1xuICAgIH1cblxuICAgIGxvZy5kZWJ1ZyhgTWF0Y2hlZCAke3V0aWwucGx1cmFsaXplKCdzaW11bGF0b3IgY2FjaGUgaXRlbScsIGl0ZW1zVG9SZW1vdmUubGVuZ3RoLCB0cnVlKX0gYCArXG4gICAgICBgZm9yIGNsZWFudXA6ICR7aXRlbXNUb1JlbW92ZX1gKTtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgQi5hbGwoaXRlbXNUb1JlbW92ZSwgKHgpID0+IGZzLnJpbXJhZih4KSk7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgbG9nLndhcm4oYEdvdCBhbiBleGNlcHRpb24gd2hpbGUgY2xlYW5pbmcgU2ltdWxhdG9yIGNhY2hlczogJHtlLm1lc3NhZ2V9YCk7XG4gICAgfVxuICAgIHJldHVybiBpdGVtc1RvUmVtb3ZlLmxlbmd0aDtcbiAgfVxuXG4gIC8qKlxuICAgKiBCbG9ja3MgdW50aWwgdGhlIGdpdmVuIGluZGljYXRlciBzdHJpbmcgYXBwZWFycyBpbiBTaW11bGF0b3IgbG9ncy5cbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IGJvb3RlZEluZGljYXRvciAtIFRoZSBtYWdpYyBzdHJpbmcsIHdoaWNoIGFwcGVhcnMgaW4gbG9ncyBhZnRlciBTaW11bGF0b3IgYm9vdGluZyBpcyBjb21wbGV0ZWQuXG4gICAqIEBwYXJhbSB7bnVtYmVyfSB0aW1lb3V0TXMgLSBUaGUgbWF4aW11bW0gbnVtYmVyIG9mIG1pbGxpc2Vjb25kcyB0byB3YWl0IGZvciB0aGUgc3RyaW5nIGluZGljYXRvciBwcmVzZW5jZS5cbiAgICogQHJldHVybnMge1Byb21pc2V9IEEgcHJvbWlzZSB0aGF0IHJlc29sdmVzIHdoZW4gdGhlIGlvcyBzaW11bGF0b3IgbG9ncyBvdXRwdXQgYSBsaW5lIG1hdGNoaW5nIGBib290ZWRJbmRpY2F0b3JgXG4gICAqIHRpbWVzIG91dCBhZnRlciB0aW1lb3V0TXNcbiAgICovXG4gIGFzeW5jIHRhaWxMb2dzVW50aWwgKGJvb3RlZEluZGljYXRvciwgdGltZW91dE1zKSB7XG4gICAgbGV0IHNpbUxvZyA9IHBhdGgucmVzb2x2ZSh0aGlzLmdldExvZ0RpcigpLCAnc3lzdGVtLmxvZycpO1xuXG4gICAgLy8gd2UgbmVlZCB0byBtYWtlIHN1cmUgbG9nIGZpbGUgZXhpc3RzIGJlZm9yZSB3ZSBjYW4gdGFpbCBpdFxuICAgIGF3YWl0IHJldHJ5SW50ZXJ2YWwoMjAwLCAyMDAsIGFzeW5jICgpID0+IHtcbiAgICAgIGxldCBleGlzdHMgPSBhd2FpdCBmcy5leGlzdHMoc2ltTG9nKTtcbiAgICAgIGlmICghZXhpc3RzKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgQ291bGQgbm90IGZpbmQgU2ltdWxhdG9yIGxvZzogJyR7c2ltTG9nfSdgKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGxvZy5pbmZvKGBTaW11bGF0b3IgbG9nIGF0ICcke3NpbUxvZ30nYCk7XG4gICAgbG9nLmluZm8oYFRhaWxpbmcgc2ltdWxhdG9yIGxvZ3MgdW50aWwgd2UgZW5jb3VudGVyIHRoZSBzdHJpbmcgXCIke2Jvb3RlZEluZGljYXRvcn1cImApO1xuICAgIGxvZy5pbmZvKGBXZSB3aWxsIHRpbWUgb3V0IGFmdGVyICR7dGltZW91dE1zfW1zYCk7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHRhaWxVbnRpbChzaW1Mb2csIGJvb3RlZEluZGljYXRvciwgdGltZW91dE1zKTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGxvZy5kZWJ1ZygnU2ltdWxhdG9yIHN0YXJ0dXAgdGltZWQgb3V0LiBDb250aW51aW5nIGFueXdheS4nKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogRW5hYmxlIENhbGVuZGFyIGFjY2VzcyBmb3IgdGhlIGdpdmVuIGFwcGxpY2F0aW9uLlxuICAgKlxuICAgKiBAcGFyYW0ge3N0cmluZ30gYnVuZGxlSUQgLSBCdW5kbGUgSUQgb2YgdGhlIGFwcGxpY2F0aW9uLCBmb3Igd2hpY2ggdGhlIGFjY2VzcyBzaG91bGQgYmUgZ3JhbnRlZC5cbiAgICovXG4gIGFzeW5jIGVuYWJsZUNhbGVuZGFyQWNjZXNzIChidW5kbGVJRCkge1xuICAgIGF3YWl0IHRoaXMuY2FsZW5kYXIuZW5hYmxlQ2FsZW5kYXJBY2Nlc3MoYnVuZGxlSUQpO1xuICB9XG5cbiAgLyoqXG4gICAqIERpc2FibGUgQ2FsZW5kYXIgYWNjZXNzIGZvciB0aGUgZ2l2ZW4gYXBwbGljYXRpb24uXG4gICAqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBidW5kbGVJRCAtIEJ1bmRsZSBJRCBvZiB0aGUgYXBwbGljYXRpb24sIGZvciB3aGljaCB0aGUgYWNjZXNzIHNob3VsZCBiZSBkZW5pZWQuXG4gICAqL1xuICBhc3luYyBkaXNhYmxlQ2FsZW5kYXJBY2Nlc3MgKGJ1bmRsZUlEKSB7XG4gICAgYXdhaXQgdGhpcy5jYWxlbmRhci5kaXNhYmxlQ2FsZW5kYXJBY2Nlc3MoYnVuZGxlSUQpO1xuICB9XG5cbiAgLyoqXG4gICAqIENoZWNrIHdoZXRoZXIgdGhlIGdpdmVuIGFwcGxpY2F0aW9uIGhhcyBhY2Nlc3MgdG8gQ2FsZW5kYXIuXG4gICAqXG4gICAqIEByZXR1cm4ge2Jvb2xlYW59IFRydWUgaWYgdGhlIGdpdmVuIGFwcGxpY2F0aW9uIGhhcyB0aGUgYWNjZXNzLlxuICAgKi9cbiAgYXN5bmMgaGFzQ2FsZW5kYXJBY2Nlc3MgKGJ1bmRsZUlEKSB7XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMuY2FsZW5kYXIuaGFzQ2FsZW5kYXJBY2Nlc3MoYnVuZGxlSUQpO1xuICB9XG5cbiAgLyoqXG4gICAqIEFjdGl2YXRlcyBTaW11bGF0b3Igd2luZG93LlxuICAgKlxuICAgKiBAcHJpdmF0ZVxuICAgKiBAcmV0dXJucyB7P3N0cmluZ30gSWYgdGhlIG1ldGhvZCByZXR1cm5zIGEgc3RyaW5nIHRoZW4gaXQgc2hvdWxkIGJlIGEgdmFsaWQgQXBwbGUgU2NyaXB0IHdoaWNoXG4gICAqIGlzIGFwcGVuZGVkIGJlZm9yZSBlYWNoIFVJIGNsaWVudCBjb21tYW5kIGlzIGV4ZWN1dGVkLiBPdGhlcndpc2UgdGhlIG1ldGhvZCBzaG91bGQgYWN0aXZhdGUgdGhlIHdpbmRvd1xuICAgKiBpdHNlbGYgYW5kIHJldHVybiBub3RoaW5nLlxuICAgKi9cbiAgYXN5bmMgX2FjdGl2YXRlV2luZG93ICgpIHsgLy8gZXNsaW50LWRpc2FibGUtbGluZSByZXF1aXJlLWF3YWl0XG4gICAgY29uc3QgcGlkID0gYXdhaXQgdGhpcy5nZXRVSUNsaWVudFBpZCgpO1xuICAgIGlmIChwaWQpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIHJldHVybiBhd2FpdCBhY3RpdmF0ZUFwcChwaWQpO1xuICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICBsb2cuZGVidWcoZS5zdGRlcnIgfHwgZS5tZXNzYWdlKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGBcbiAgICAgIHRlbGwgYXBwbGljYXRpb24gXCJTeXN0ZW0gRXZlbnRzXCJcbiAgICAgICAgdGVsbCBwcm9jZXNzIFwiU2ltdWxhdG9yXCJcbiAgICAgICAgICBzZXQgZnJvbnRtb3N0IHRvIGZhbHNlXG4gICAgICAgICAgc2V0IGZyb250bW9zdCB0byB0cnVlXG4gICAgICAgIGVuZCB0ZWxsXG4gICAgICBlbmQgdGVsbFxuICAgIGA7XG4gIH1cblxuICAvKipcbiAgICogRXhlY3V0ZSBnaXZlbiBBcHBsZSBTY3JpcHQgaW5zaWRlIGEgY3JpdGljYWwgc2VjdGlvbiwgc28gb3RoZXJcbiAgICogc2Vzc2lvbnMgY2Fubm90IGluZmx1ZW5jZSB0aGUgVUkgY2xpZW50IGF0IHRoZSBzYW1lIHRpbWUuXG4gICAqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBhcHBsZVNjcmlwdCAtIFRoZSB2YWxpZCBBcHBsZSBTY3JpcHQgc25pcHBldCB0byBiZSBleGVjdXRlZC5cbiAgICogQHJldHVybiB7c3RyaW5nfSBUaGUgc3Rkb3V0IG91dHB1dCBwcm9kdWNlZCBieSB0aGUgc2NyaXB0LlxuICAgKiBAdGhyb3dzIHtFcnJvcn0gSWYgb3Nhc2NyaXB0IHRvb2wgcmV0dXJucyBub24temVybyBleGl0IGNvZGUuXG4gICAqL1xuICBhc3luYyBleGVjdXRlVUlDbGllbnRTY3JpcHQgKGFwcGxlU2NyaXB0KSB7XG4gICAgY29uc3Qgd2luZG93QWN0aXZhdGlvblNjcmlwdCA9IGF3YWl0IHRoaXMuX2FjdGl2YXRlV2luZG93KCk7XG4gICAgY29uc3QgcmVzdWx0U2NyaXB0ID0gYCR7d2luZG93QWN0aXZhdGlvblNjcmlwdCA/IHdpbmRvd0FjdGl2YXRpb25TY3JpcHQgKyAnXFxuJyA6ICcnfSR7YXBwbGVTY3JpcHR9YDtcbiAgICBsb2cuZGVidWcoYEV4ZWN1dGluZyBVSSBBcHBsZSBTY3JpcHQgb24gU2ltdWxhdG9yIHdpdGggVURJRCAke3RoaXMudWRpZH06ICR7cmVzdWx0U2NyaXB0fWApO1xuICAgIHJldHVybiBhd2FpdCBVSV9DTElFTlRfQUNDRVNTX0dVQVJELmFjcXVpcmUodGhpcy5zaW11bGF0b3JBcHAsIGFzeW5jICgpID0+IHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHtzdGRvdXR9ID0gYXdhaXQgZXhlYygnb3Nhc2NyaXB0JywgWyctZScsIHJlc3VsdFNjcmlwdF0pO1xuICAgICAgICByZXR1cm4gc3Rkb3V0O1xuICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgIGxvZy5lcnJvckFuZFRocm93KGBDb3VsZCBub3QgY29tcGxldGUgb3BlcmF0aW9uLiBNYWtlIHN1cmUgU2ltdWxhdG9yIFVJIGlzIHJ1bm5pbmcgYW5kIHRoZSBwYXJlbnQgQXBwaXVtIGFwcGxpY2F0aW9uIChlLiBnLiBBcHBpdW0uYXBwIG9yIFRlcm1pbmFsLmFwcCkgYCArXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGBpcyBwcmVzZW50IGluIFN5c3RlbSBQcmVmZXJlbmNlcyA+IFNlY3VyaXR5ICYgUHJpdmFjeSA+IFByaXZhY3kgPiBBY2Nlc3NpYmlsaXR5IGxpc3QuIElmIHRoZSBvcGVyYXRpb24gaXMgc3RpbGwgdW5zdWNjZXNzZnVsIHRoZW4gYCArXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGBpdCBpcyBub3Qgc3VwcG9ydGVkIGJ5IHRoaXMgU2ltdWxhdG9yLiBgICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgYE9yaWdpbmFsIGVycm9yOiAke2Vyci5tZXNzYWdlfWApO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCB0aGUgY3VycmVudCBzdGF0ZSBvZiBCaW9tZXRyaWMgRW5yb2xsbWVudCBmZWF0dXJlLlxuICAgKlxuICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gRWl0aGVyIHRydWUgb3IgZmFsc2VcbiAgICogQHRocm93cyB7RXJyb3J9IElmIEVucm9sbG1lbnQgc3RhdGUgY2Fubm90IGJlIGRldGVybWluZWRcbiAgICovXG4gIGFzeW5jIGlzQmlvbWV0cmljRW5yb2xsZWQgKCkge1xuICAgIGNvbnN0IG91dHB1dCA9IGF3YWl0IHRoaXMuZXhlY3V0ZVVJQ2xpZW50U2NyaXB0KGBcbiAgICAgIHRlbGwgYXBwbGljYXRpb24gXCJTeXN0ZW0gRXZlbnRzXCJcbiAgICAgICAgdGVsbCBwcm9jZXNzIFwiU2ltdWxhdG9yXCJcbiAgICAgICAgICBzZXQgZHN0TWVudUl0ZW0gdG8gbWVudSBpdGVtIFwiVG91Y2ggSUQgRW5yb2xsZWRcIiBvZiBtZW51IDEgb2YgbWVudSBiYXIgaXRlbSBcIkhhcmR3YXJlXCIgb2YgbWVudSBiYXIgMVxuICAgICAgICAgIHNldCBpc0NoZWNrZWQgdG8gKHZhbHVlIG9mIGF0dHJpYnV0ZSBcIkFYTWVudUl0ZW1NYXJrQ2hhclwiIG9mIGRzdE1lbnVJdGVtKSBpcyBcIuKck1wiXG4gICAgICAgIGVuZCB0ZWxsXG4gICAgICBlbmQgdGVsbFxuICAgIGApO1xuICAgIGxvZy5kZWJ1ZyhgVG91Y2ggSUQgZW5yb2xsZWQgc3RhdGU6ICR7b3V0cHV0fWApO1xuICAgIHJldHVybiBfLmlzU3RyaW5nKG91dHB1dCkgJiYgb3V0cHV0LnRyaW0oKSA9PT0gJ3RydWUnO1xuICB9XG5cbiAgLyoqXG4gICAqIEVucm9sbHMgYmlvbWV0cmljIChUb3VjaElkLCBGYWNlSWQpIGZlYXR1cmUgdGVzdGluZyBpbiBTaW11bGF0b3IgVUkgY2xpZW50LlxuICAgKlxuICAgKiBAcGFyYW0ge2Jvb2xlYW59IGlzRW5hYmxlZCAtIERlZmluZXMgd2hldGhlciBiaW9tZXRyaWMgc3RhdGUgaXMgZW5hYmxlZC9kaXNhYmxlZFxuICAgKiBAdGhyb3dzIHtFcnJvcn0gSWYgdGhlIGVucm9sbGVkIHN0YXRlIGNhbm5vdCBiZSBjaGFuZ2VkXG4gICAqL1xuICBhc3luYyBlbnJvbGxCaW9tZXRyaWMgKGlzRW5hYmxlZCA9IHRydWUpIHtcbiAgICBhd2FpdCB0aGlzLmV4ZWN1dGVVSUNsaWVudFNjcmlwdChgXG4gICAgICB0ZWxsIGFwcGxpY2F0aW9uIFwiU3lzdGVtIEV2ZW50c1wiXG4gICAgICAgIHRlbGwgcHJvY2VzcyBcIlNpbXVsYXRvclwiXG4gICAgICAgICAgc2V0IGRzdE1lbnVJdGVtIHRvIG1lbnUgaXRlbSBcIlRvdWNoIElEIEVucm9sbGVkXCIgb2YgbWVudSAxIG9mIG1lbnUgYmFyIGl0ZW0gXCJIYXJkd2FyZVwiIG9mIG1lbnUgYmFyIDFcbiAgICAgICAgICBzZXQgaXNDaGVja2VkIHRvICh2YWx1ZSBvZiBhdHRyaWJ1dGUgXCJBWE1lbnVJdGVtTWFya0NoYXJcIiBvZiBkc3RNZW51SXRlbSkgaXMgXCLinJNcIlxuICAgICAgICAgIGlmICR7aXNFbmFibGVkID8gJ25vdCAnIDogJyd9aXNDaGVja2VkIHRoZW5cbiAgICAgICAgICAgIGNsaWNrIGRzdE1lbnVJdGVtXG4gICAgICAgICAgZW5kIGlmXG4gICAgICAgIGVuZCB0ZWxsXG4gICAgICBlbmQgdGVsbFxuICAgIGApO1xuICB9XG5cbiAgLyoqXG4gICAqIFNlbmRzIGEgbm90aWZpY2F0aW9uIHRvIG1hdGNoL25vdCBtYXRjaCB0aGUgdG91Y2ggaWQuXG4gICAqXG4gICAqIEBwYXJhbSB7P2Jvb2xlYW59IHNob3VsZE1hdGNoIFt0cnVlXSAtIFNldCBpdCB0byB0cnVlIG9yIGZhbHNlIGluIG9yZGVyIHRvIGVtdWxhdGVcbiAgICogbWF0Y2hpbmcvbm90IG1hdGNoaW5nIHRoZSBjb3JyZXNwb25kaW5nIGJpb21ldHJpY1xuICAgKi9cbiAgYXN5bmMgc2VuZEJpb21ldHJpY01hdGNoIChzaG91bGRNYXRjaCA9IHRydWUpIHtcbiAgICBhd2FpdCB0aGlzLmV4ZWN1dGVVSUNsaWVudFNjcmlwdChgXG4gICAgICB0ZWxsIGFwcGxpY2F0aW9uIFwiU3lzdGVtIEV2ZW50c1wiXG4gICAgICAgIHRlbGwgcHJvY2VzcyBcIlNpbXVsYXRvclwiXG4gICAgICAgICAgc2V0IGRzdE1lbnVJdGVtIHRvIG1lbnUgaXRlbSBcIiR7c2hvdWxkTWF0Y2ggPyAnTWF0Y2hpbmcnIDogJ05vbi1tYXRjaGluZyd9XCIgb2YgbWVudSAxIG9mIG1lbnUgaXRlbSBcIlNpbXVsYXRlIEZpbmdlciBUb3VjaFwiIG9mIG1lbnUgMSBvZiBtZW51IGJhciBpdGVtIFwiSGFyZHdhcmVcIiBvZiBtZW51IGJhciAxXG4gICAgICAgICAgY2xpY2sgZHN0TWVudUl0ZW1cbiAgICAgICAgZW5kIHRlbGxcbiAgICAgIGVuZCB0ZWxsXG4gICAgYCk7XG4gIH1cblxuICAvKipcbiAgICogRXhlY3V0ZSBhIHNwZWNpYWwgQXBwbGUgc2NyaXB0LCB3aGljaCBjbGlja3MgdGhlIHBhcnRpY3VsYXIgYnV0dG9uIG9uIERhdGFiYXNlIGFsZXJ0LlxuICAgKlxuICAgKiBAcGFyYW0ge2Jvb2xlYW59IGluY3JlYXNlIC0gQ2xpY2sgdGhlIGJ1dHRvbiB3aXRoICdJbmNyZWFzZScgdGl0bGUgb24gdGhlIGFsZXJ0IGlmIHRoaXNcbiAgICogICBwYXJhbWV0ZXIgaXMgdHJ1ZS4gVGhlICdDYW5jZWwnIGJ1dHRvbiB3aWxsIGJlIGNsaWNrZWQgb3RoZXJ3aXNlLlxuICAgKi9cbiAgYXN5bmMgZGlzbWlzc0RhdGFiYXNlQWxlcnQgKGluY3JlYXNlID0gdHJ1ZSkge1xuICAgIGxldCBidXR0b24gPSBpbmNyZWFzZSA/ICdJbmNyZWFzZScgOiAnQ2FuY2VsJztcbiAgICBsb2cuZGVidWcoYEF0dGVtcHRpbmcgdG8gZGlzbWlzcyBkYXRhYmFzZSBhbGVydCB3aXRoICcke2J1dHRvbn0nIGJ1dHRvbmApO1xuICAgIGF3YWl0IHRoaXMuZXhlY3V0ZVVJQ2xpZW50U2NyaXB0KGBcbiAgICAgIHRlbGwgYXBwbGljYXRpb24gXCJTeXN0ZW0gRXZlbnRzXCJcbiAgICAgICAgdGVsbCBwcm9jZXNzIFwiU2ltdWxhdG9yXCJcbiAgICAgICAgICBjbGljayBidXR0b24gXCIke2J1dHRvbn1cIiBvZiB3aW5kb3cgMVxuICAgICAgICBlbmQgdGVsbFxuICAgICAgZW5kIHRlbGxcbiAgICBgKTtcbiAgfVxuXG4gIC8vcmVnaW9uIEtleWNoYWlucyBJbnRlcmFjdGlvblxuICAvKipcbiAgICogQ3JlYXRlIHRoZSBiYWNrdXAgb2Yga2V5Y2hhaW5zIGZvbGRlci5cbiAgICogVGhlIHByZXZpb3VzbHkgY3JlYXRlZCBiYWNrdXAgd2lsbCBiZSBhdXRvbWF0aWNhbGx5XG4gICAqIGRlbGV0ZWQgaWYgdGhpcyBtZXRob2Qgd2FzIGNhbGxlZCB0d2ljZSBpbiBhIHJvdyB3aXRob3V0XG4gICAqIGByZXN0b3JlS2V5Y2hhaW5zYCBiZWluZyBpbnZva2VkLlxuICAgKlxuICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gVHJ1ZSBpZiB0aGUgYmFja3VwIG9wZXJhdGlvbiB3YXMgc3VjY2Vzc2Z1bGwuXG4gICAqL1xuICBhc3luYyBiYWNrdXBLZXljaGFpbnMgKCkge1xuICAgIGlmICghYXdhaXQgZnMuZXhpc3RzKHRoaXMua2V5Y2hhaW5QYXRoKSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIGNvbnN0IGJhY2t1cFBhdGggPSBhd2FpdCB0ZW1wRGlyLnBhdGgoe1xuICAgICAgcHJlZml4OiBga2V5Y2hhaW5zX2JhY2t1cF8ke01hdGguZmxvb3IoKDEgKyBNYXRoLnJhbmRvbSgpKSAqIDB4MTAwMDApLnRvU3RyaW5nKDE2KS5zdWJzdHJpbmcoMSl9YCxcbiAgICAgIHN1ZmZpeDogJy56aXAnLFxuICAgIH0pO1xuICAgIGNvbnN0IHppcEFyZ3MgPSBbXG4gICAgICAnLXInLCBiYWNrdXBQYXRoLFxuICAgICAgYCR7dGhpcy5rZXljaGFpblBhdGh9JHtwYXRoLnNlcH1gXG4gICAgXTtcbiAgICBsb2cuZGVidWcoYENyZWF0aW5nIGtleWNoYWlucyBiYWNrdXAgd2l0aCAnemlwICR7emlwQXJncy5qb2luKCcgJyl9JyBjb21tYW5kYCk7XG4gICAgYXdhaXQgZXhlYygnemlwJywgemlwQXJncyk7XG4gICAgaWYgKF8uaXNTdHJpbmcodGhpcy5fa2V5Y2hhaW5zQmFja3VwUGF0aCkgJiYgYXdhaXQgZnMuZXhpc3RzKHRoaXMuX2tleWNoYWluc0JhY2t1cFBhdGgpKSB7XG4gICAgICBhd2FpdCBmcy51bmxpbmsodGhpcy5fa2V5Y2hhaW5zQmFja3VwUGF0aCk7XG4gICAgfVxuICAgIHRoaXMuX2tleWNoYWluc0JhY2t1cFBhdGggPSBiYWNrdXBQYXRoO1xuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlc3RvcmUgdGhlIHByZXZpc291bHkgY3JlYXRlZCBrZXljaGFpbnMgYmFja3VwLlxuICAgKlxuICAgKiBAcGFyYW0gez9zdHJpbmd8QXJyYXk8c3RyaW5nPn0gZXhjbHVkZVBhdHRlcm5zIC0gVGhlIGxpc3RcbiAgICogb2YgZmlsZSBuYW1lIHBhdHRlcm5zIHRvIGJlIGV4Y2x1ZGVkIGZyb20gcmVzdG9yZS4gVGhlIGZvcm1hdFxuICAgKiBvZiBlYWNoIGl0ZW0gc2hvdWxkIGJlIHRoZSBzYW1lIGFzICcteCcgb3B0aW9uIGZvcm1hdCBmb3JcbiAgICogJ3VuemlwJyB1dGlsaXR5LiBUaGlzIGNhbiBhbHNvIGJlIGEgY29tbWEtc2VwYXJhdGVkIHN0cmluZyxcbiAgICogd2hpY2ggaXMgZ29pbmcgYmUgdHJhbnNmb3JtZWQgaW50byBhIGxpc3QgYXV0b21hdGljYWxseSxcbiAgICogZm9yIGV4YW1wbGU6ICcqLmRiKixibGFibGEuc3FsaXRlJ1xuICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gSWYgdGhlIHJlc3RvcmUgb3ByYXRpb24gd2FzIHN1Y2Nlc3NmdWwuXG4gICAqIEB0aHJvd3Mge0Vycm9yfSBJZiB0aGVyZSBpcyBubyBrZXljaGFpbnMgYmFja3VwIGF2YWlsYWJsZSBmb3IgcmVzdG9yZS5cbiAgICovXG4gIGFzeW5jIHJlc3RvcmVLZXljaGFpbnMgKGV4Y2x1ZGVQYXR0ZXJucyA9IFtdKSB7XG4gICAgaWYgKCFfLmlzU3RyaW5nKHRoaXMuX2tleWNoYWluc0JhY2t1cFBhdGgpIHx8ICFhd2FpdCBmcy5leGlzdHModGhpcy5fa2V5Y2hhaW5zQmFja3VwUGF0aCkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgVGhlIGtleWNoYWlucyBiYWNrdXAgYXJjaGl2ZSBkb2VzIG5vdCBleGlzdC4gYCArXG4gICAgICAgICAgICAgICAgICAgICAgYEFyZSB5b3Ugc3VyZSBpdCB3YXMgY3JlYXRlZCBiZWZvcmU/YCk7XG4gICAgfVxuXG4gICAgaWYgKF8uaXNTdHJpbmcoZXhjbHVkZVBhdHRlcm5zKSkge1xuICAgICAgZXhjbHVkZVBhdHRlcm5zID0gZXhjbHVkZVBhdHRlcm5zLnNwbGl0KCcsJykubWFwKCh4KSA9PiB4LnRyaW0oKSk7XG4gICAgfVxuICAgIGNvbnN0IGlzU2VydmVyUnVubmluZyA9IGF3YWl0IHRoaXMuaXNSdW5uaW5nKCk7XG4gICAgbGV0IHBsaXN0UGF0aDtcbiAgICBpZiAoaXNTZXJ2ZXJSdW5uaW5nKSB7XG4gICAgICBwbGlzdFBhdGggPSBwYXRoLnJlc29sdmUoYXdhaXQgdGhpcy5nZXRMYXVuY2hEYWVtb25zUm9vdCgpLCAnY29tLmFwcGxlLnNlY3VyaXR5ZC5wbGlzdCcpO1xuICAgICAgaWYgKCFhd2FpdCBmcy5leGlzdHMocGxpc3RQYXRoKSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYENhbm5vdCBjbGVhciBrZXljaGFpbnMgYmVjYXVzZSAnJHtwbGlzdFBhdGh9JyBkb2VzIG5vdCBleGlzdGApO1xuICAgICAgfVxuICAgICAgYXdhaXQgdGhpcy5zaW1jdGwuc3Bhd25Qcm9jZXNzKFsnbGF1bmNoY3RsJywgJ3VubG9hZCcsIHBsaXN0UGF0aF0pO1xuICAgIH1cbiAgICB0cnkge1xuICAgICAgYXdhaXQgZnMucmltcmFmKHRoaXMua2V5Y2hhaW5QYXRoKTtcbiAgICAgIGF3YWl0IG1rZGlycCh0aGlzLmtleWNoYWluUGF0aCk7XG4gICAgICBjb25zdCB1bnppcEFyZ3MgPSBbXG4gICAgICAgICctbycsIHRoaXMuX2tleWNoYWluc0JhY2t1cFBhdGgsXG4gICAgICAgIC4uLihfLmZsYXRNYXAoZXhjbHVkZVBhdHRlcm5zLm1hcCgoeCkgPT4gWycteCcsIHhdKSkpLFxuICAgICAgICAnLWQnLCAnLydcbiAgICAgIF07XG4gICAgICBsb2cuZGVidWcoYFJlc3RvcmluZyBrZXljaGFpbnMgd2l0aCAndW56aXAgJHt1bnppcEFyZ3Muam9pbignICcpfScgY29tbWFuZGApO1xuICAgICAgYXdhaXQgZXhlYygndW56aXAnLCB1bnppcEFyZ3MpO1xuICAgICAgYXdhaXQgZnMudW5saW5rKHRoaXMuX2tleWNoYWluc0JhY2t1cFBhdGgpO1xuICAgICAgdGhpcy5fa2V5Y2hhaW5zQmFja3VwUGF0aCA9IG51bGw7XG4gICAgfSBmaW5hbGx5IHtcbiAgICAgIGlmIChpc1NlcnZlclJ1bm5pbmcgJiYgcGxpc3RQYXRoKSB7XG4gICAgICAgIGF3YWl0IHRoaXMuc2ltY3RsLnNwYXduUHJvY2VzcyhbJ2xhdW5jaGN0bCcsICdsb2FkJywgcGxpc3RQYXRoXSk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgLyoqXG4gICAqIENsZWFycyBLZXljaGFpbnMgZm9yIHRoZSBwYXJ0aWN1bGFyIHNpbXVsYXRvciBpbiBydW50aW1lICh0aGVyZSBpcyBubyBuZWVkIHRvIHN0b3AgaXQpLlxuICAgKlxuICAgKiBAdGhyb3dzIHtFcnJvcn0gSWYga2V5Y2hhaW4gY2xlYW51cCBoYXMgZmFpbGVkLlxuICAgKi9cbiAgYXN5bmMgY2xlYXJLZXljaGFpbnMgKCkge1xuICAgIGNvbnN0IHBsaXN0UGF0aCA9IHBhdGgucmVzb2x2ZShhd2FpdCB0aGlzLmdldExhdW5jaERhZW1vbnNSb290KCksICdjb20uYXBwbGUuc2VjdXJpdHlkLnBsaXN0Jyk7XG4gICAgaWYgKCFhd2FpdCBmcy5leGlzdHMocGxpc3RQYXRoKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBDYW5ub3QgY2xlYXIga2V5Y2hhaW5zIGJlY2F1c2UgJyR7cGxpc3RQYXRofScgZG9lcyBub3QgZXhpc3RgKTtcbiAgICB9XG4gICAgYXdhaXQgdGhpcy5zaW1jdGwuc3Bhd25Qcm9jZXNzKFsnbGF1bmNoY3RsJywgJ3VubG9hZCcsIHBsaXN0UGF0aF0pO1xuICAgIHRyeSB7XG4gICAgICBpZiAoYXdhaXQgZnMuZXhpc3RzKHRoaXMua2V5Y2hhaW5QYXRoKSkge1xuICAgICAgICBhd2FpdCBmcy5yaW1yYWYodGhpcy5rZXljaGFpblBhdGgpO1xuICAgICAgICBhd2FpdCBta2RpcnAodGhpcy5rZXljaGFpblBhdGgpO1xuICAgICAgfVxuICAgIH0gZmluYWxseSB7XG4gICAgICBhd2FpdCB0aGlzLnNpbWN0bC5zcGF3blByb2Nlc3MoWydsYXVuY2hjdGwnLCAnbG9hZCcsIHBsaXN0UGF0aF0pO1xuICAgIH1cbiAgfVxuXG4gIC8vZW5kcmVnaW9uXG5cbiAgLyoqXG4gICAqIEB0eXBlZGVmIHtPYmplY3R9IFByb2Nlc3NJbmZvXG4gICAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBwaWQgVGhlIGFjdHVhbCBwcm9jZXNzIGlkZW50aWZpZXIuXG4gICAqIENvdWxkIGJlIHplcm8gaWYgdGhlIHByb2Nlc3MgaXMgdGhlIHN5c3RlbSBvbmUuXG4gICAqIEBwcm9wZXJ0eSB7P3N0cmluZ30gZ3JvdXAgVGhlIHByb2Nlc3MgZ3JvdXAgaWRlbnRpZmllci5cbiAgICogVGhpcyBjb3VsZCBiZSBgbnVsbGAgaWYgdGhlIHByb2Nlc3MgaXMgbm90IGEgcGFydCBvZiB0aGVcbiAgICogcGFydGljdWxhciBncm91cC4gRm9yIGBub3JtYWxgIGFwcGxpY2F0aW9uIHByb2Nlc3NlcyB0aGUgZ3JvdXBcbiAgICogbmFtZSB1c3VhbGx5IGVxdWFscyB0byBgVUlLaXRBcHBsaWNhdGlvbmAuXG4gICAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBuYW1lIFRoZSBwcm9jZXNzIG5hbWUsIGZvciBleGFtcGxlXG4gICAqIGBjb20uYXBwbGUuUHJlZmVyZW5jZXNgXG4gICAqL1xuXG4gIC8qKlxuICAgKiBMaXN0cyBwcm9jZXNzZXMgdGhhdCBhcmUgY3VycmVudGx5IHJ1bm5pbmcgb24gdGhlIGdpdmVuIFNpbXVsYXRvci5cbiAgICogVGhlIHNpbXVsYXRvciBtdXN0IGJlIGluIHJ1bm5pbmcgc3RhdGUgaW4gb3JkZXIgZm9yIHRoaXNcbiAgICogbWV0aG9kIHRvIHdvcmsgcHJvcGVybHkuXG4gICAqXG4gICAqIEByZXR1cm4ge0FycmF5PFByb2Nlc3NJbmZvPn0gVGhlIGxpc3Qgb2YgcmV0cmlldmVkIHByb2Nlc3NcbiAgICogaW5mb3JtYXRpb25cbiAgICogQHRocm93cyB7RXJyb3J9IGlmIG5vIHByb2Nlc3MgaW5mb3JtYXRpb24gY291bGQgYmUgcmV0cmlldmVkLlxuICAgKi9cbiAgYXN5bmMgcHMgKCkge1xuICAgIGNvbnN0IHtzdGRvdXR9ID0gYXdhaXQgdGhpcy5zaW1jdGwuc3Bhd25Qcm9jZXNzKFtcbiAgICAgICdsYXVuY2hjdGwnLFxuICAgICAgJ3ByaW50JyxcbiAgICAgICdzeXN0ZW0nLFxuICAgIF0pO1xuXG4gICAgY29uc3Qgc2VydmljZXNNYXRjaCA9IC9eXFxzKnNlcnZpY2VzXFxzKj1cXHMqeyhbXn1dKykvbS5leGVjKHN0ZG91dCk7XG4gICAgaWYgKCFzZXJ2aWNlc01hdGNoKSB7XG4gICAgICBsb2cuZGVidWcoc3Rkb3V0KTtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgVGhlIGxpc3Qgb2YgYWN0aXZlIHByb2Nlc3NlcyBjYW5ub3QgYmUgcmV0cmlldmVkYCk7XG4gICAgfVxuICAgIC8qXG4gICAgRXhhbXBsZSBtYXRjaDpcbiAgICAgICAgMCAgICAgNzggXHRjb20uYXBwbGUucmVzb3VyY2VncmFiYmVyZFxuICAgIDgyMTU4ICAgICAgLSBcdGNvbS5hcHBsZS5hc3Npc3RhbnRfc2VydmljZVxuICAgIDgyMTIwICAgICAgLSBcdGNvbS5hcHBsZS5uYW5vcmVnaXN0cnlkXG4gICAgODIwODcgICAgICAtIFx0Y29tLmFwcGxlLm5vdGlmeWRcbiAgICA4MjI2NCAgICAgIC0gXHRVSUtpdEFwcGxpY2F0aW9uOmNvbS5hcHBsZS5QcmVmZXJlbmNlc1s3MDRiXVtyYi1sZWdhY3ldXG4gICAgKi9cbiAgICBjb25zdCByZXN1bHQgPSBbXTtcbiAgICBjb25zdCBwYXR0ZXJuID0gL15cXHMqKFxcZCspXFxzK1tcXGQtXStcXHMrKFtcXHdcXC0uXSs6KT8oW1xcd1xcLS5dKykvZ207XG4gICAgbGV0IG1hdGNoO1xuICAgIHdoaWxlICgobWF0Y2ggPSBwYXR0ZXJuLmV4ZWMoc2VydmljZXNNYXRjaFsxXSkpKSB7XG4gICAgICByZXN1bHQucHVzaCh7XG4gICAgICAgIHBpZDogcGFyc2VJbnQobWF0Y2hbMV0sIDEwKSxcbiAgICAgICAgZ3JvdXA6IF8udHJpbUVuZChtYXRjaFsyXSwgJzonKSB8fCBudWxsLFxuICAgICAgICBuYW1lOiBtYXRjaFszXSxcbiAgICAgIH0pO1xuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgLyoqXG4gICAqIFNldHMgdGhlIHBhcnRpY3VsYXIgcGVybWlzc2lvbiB0byB0aGUgYXBwbGljYXRpb24gYnVuZGxlLiBTZWVcbiAgICogaHR0cHM6Ly9naXRodWIuY29tL3dpeC9BcHBsZVNpbXVsYXRvclV0aWxzIGZvciBtb3JlIGRldGFpbHMgb25cbiAgICogdGhlIGF2YWlsYWJsZSBzZXJ2aWNlIG5hbWVzIGFuZCBzdGF0dXNlcy5cbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IGJ1bmRsZUlkIC0gQXBwbGljYXRpb24gYnVuZGxlIGlkZW50aWZpZXIuXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBwZXJtaXNzaW9uIC0gU2VydmljZSBuYW1lIHRvIGJlIHNldC5cbiAgICogQHBhcmFtIHtzdHJpbmd9IHZhbHVlIC0gVGhlIGRlc2lyZWQgc3RhdHVzIGZvciB0aGUgc2VydmljZS5cbiAgICogQHRocm93cyB7RXJyb3J9IElmIHRoZXJlIHdhcyBhbiBlcnJvciB3aGlsZSBjaGFuZ2luZyBwZXJtaXNzaW9uLlxuICAgKi9cbiAgYXN5bmMgc2V0UGVybWlzc2lvbiAoYnVuZGxlSWQsIHBlcm1pc3Npb24sIHZhbHVlKSB7XG4gICAgYXdhaXQgdGhpcy5zZXRQZXJtaXNzaW9ucyhidW5kbGVJZCwge1twZXJtaXNzaW9uXTogdmFsdWV9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXRzIHRoZSBwZXJtaXNzaW9ucyBmb3IgdGhlIHBhcnRpY3VsYXIgYXBwbGljYXRpb24gYnVuZGxlLlxuICAgKlxuICAgKiBAcGFyYW0ge3N0cmluZ30gYnVuZGxlSWQgLSBBcHBsaWNhdGlvbiBidW5kbGUgaWRlbnRpZmllci5cbiAgICogQHBhcmFtIHtPYmplY3R9IHBlcm1pc3Npb25zTWFwcGluZyAtIEEgbWFwcGluZyB3aGVyZSBrYXlzXG4gICAqIGFyZSBzZXJ2aWNlIG5hbWVzIGFuZCB2YWx1ZXMgYXJlIHRoZWlyIGNvcnJlc3BvbmRpbmcgc3RhdHVzIHZhbHVlcy5cbiAgICogU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS93aXgvQXBwbGVTaW11bGF0b3JVdGlsc1xuICAgKiBmb3IgbW9yZSBkZXRhaWxzIG9uIGF2YWlsYWJsZSBzZXJ2aWNlIG5hbWVzIGFuZCBzdGF0dXNlcy5cbiAgICogQHRocm93cyB7RXJyb3J9IElmIHRoZXJlIHdhcyBhbiBlcnJvciB3aGlsZSBjaGFuZ2luZyBwZXJtaXNzaW9ucy5cbiAgICovXG4gIGFzeW5jIHNldFBlcm1pc3Npb25zIChidW5kbGVJZCwgcGVybWlzc2lvbnNNYXBwaW5nKSB7XG4gICAgbG9nLmRlYnVnKGBTZXR0aW5nIGFjY2VzcyBmb3IgJyR7YnVuZGxlSWR9JzogYCArXG4gICAgICBKU09OLnN0cmluZ2lmeShwZXJtaXNzaW9uc01hcHBpbmcsIG51bGwsIDIpKTtcbiAgICBhd2FpdCB0aGlzLnBlcm1pc3Npb25zLnNldEFjY2VzcyhidW5kbGVJZCwgcGVybWlzc2lvbnNNYXBwaW5nKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXRyaWV2ZXMgY3VycmVudCBwZXJtaXNzaW9uIHN0YXR1cyBmb3IgdGhlIGdpdmVuIGFwcGxpY2F0aW9uIGJ1bmRsZS5cbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IGJ1bmRsZUlkIC0gQXBwbGljYXRpb24gYnVuZGxlIGlkZW50aWZpZXIuXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBzZXJ2aWNlTmFtZSAtIE9uZSBvZiBhdmFpbGFibGUgc2VydmljZSBuYW1lcy5cbiAgICogQHRocm93cyB7RXJyb3J9IElmIHRoZXJlIHdhcyBhbiBlcnJvciB3aGlsZSByZXRyaWV2aW5nIHBlcm1pc3Npb25zLlxuICAgKi9cbiAgYXN5bmMgZ2V0UGVybWlzc2lvbiAoYnVuZGxlSWQsIHNlcnZpY2VOYW1lKSB7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5wZXJtaXNzaW9ucy5nZXRBY2Nlc3MoYnVuZGxlSWQsIHNlcnZpY2VOYW1lKTtcbiAgICBsb2cuZGVidWcoYEdvdCAke3NlcnZpY2VOYW1lfSBhY2Nlc3Mgc3RhdHVzIGZvciAnJHtidW5kbGVJZH0nOiAke3Jlc3VsdH1gKTtcbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgLyoqXG4gICAqIEFkZHMgdGhlIGdpdmVuIGNlcnRpZmljYXRlIGludG8gdGhlIFRydXN0ZWQgUm9vdCBTdG9yZSBvbiB0aGUgc2ltdWxhdG9yLlxuICAgKiBUaGUgc2ltdWxhdG9yIG11c3QgYmUgc2h1dCBkb3duIGluIG9yZGVyIGZvciB0aGlzIG1ldGhvZCB0byB3b3JrIHByb3Blcmx5LlxuICAgKlxuICAgKiBAcGFyYW0ge3N0cmluZ30gcGF5bG9hZCB0aGUgY29udGVudCBvZiB0aGUgUEVNIGNlcnRpZmljYXRlXG4gICAqIEByZXR1cm5zIHtib29sZWFufSBgdHJ1ZWAgaWYgdGhlIGNlcnRpZmljYXRlIGhhcyBiZWVuIHN1Y2Nlc3NmdWxseSBpbnN0YWxsZWRcbiAgICogb3IgYGZhbHNlYCBpZiBpdCBoYXMgYWxyZWFkeSBiZWVuIHRoZXJlXG4gICAqL1xuICBhc3luYyBhZGRDZXJ0aWZpY2F0ZSAocGF5bG9hZCwgLyogb3B0cyA9IHt9ICovKSB7XG4gICAgaWYgKGF3YWl0IGhhc1NTTENlcnQocGF5bG9hZCwgdGhpcy51ZGlkKSkge1xuICAgICAgbG9nLmluZm8oYFNTTCBjZXJ0aWZpY2F0ZSAnJHtfLnRydW5jYXRlKHBheWxvYWQsIHtsZW5ndGg6IDIwfSl9JyBhbHJlYWR5IGluc3RhbGxlZGApO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBsb2cuaW5mbyhgSW5zdGFsbGluZyBTU0wgcm9vdCBjZXJ0aWZpY2F0ZSAnJHtfLnRydW5jYXRlKHBheWxvYWQsIHtsZW5ndGg6IDIwfSl9J2ApO1xuICAgIGF3YWl0IGluc3RhbGxTU0xDZXJ0KHBheWxvYWQsIHRoaXMudWRpZCk7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICAvKipcbiAgICogU2ltdWxhdGVzIHB1c2ggbm90aWZpY2F0aW9uIGRlbGl2ZXJ5XG4gICAqXG4gICAqIEBzaW5jZSBYY29kZSBTREsgMTEuNFxuICAgKi9cbiAgYXN5bmMgcHVzaE5vdGlmaWNhdGlvbiAoLyogcGF5bG9hZCAqLykgeyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIHJlcXVpcmUtYXdhaXRcbiAgICB0aHJvdyBuZXcgRXJyb3IoYFhjb2RlIFNESyAnJHt0aGlzLnhjb2RlVmVyc2lvbn0nIGlzIHRvbyBvbGQgdG8gcHVzaCBub3RpZmljYXRpb25zYCk7XG4gIH1cblxuICBhc3luYyBnZXRMYXVuY2hEYWVtb25zUm9vdCAoKSB7XG4gICAgY29uc3QgZGV2Um9vdCA9IGF3YWl0IGdldERldmVsb3BlclJvb3QoKTtcbiAgICByZXR1cm4gcGF0aC5yZXNvbHZlKGRldlJvb3QsXG4gICAgICAnUGxhdGZvcm1zL2lQaG9uZVNpbXVsYXRvci5wbGF0Zm9ybS9EZXZlbG9wZXIvU0RLcy9pUGhvbmVTaW11bGF0b3Iuc2RrL1N5c3RlbS9MaWJyYXJ5L0xhdW5jaERhZW1vbnMnKTtcbiAgfVxuXG4gIHN0YXRpYyBhc3luYyBfZ2V0RGV2aWNlU3RyaW5nUGxhdGZvcm1WZXJzaW9uIChwbGF0Zm9ybVZlcnNpb24pIHtcbiAgICBsZXQgcmVxVmVyc2lvbiA9IHBsYXRmb3JtVmVyc2lvbjtcbiAgICBpZiAoIXJlcVZlcnNpb24pIHtcbiAgICAgIHJlcVZlcnNpb24gPSBhd2FpdCB4Y29kZS5nZXRNYXhJT1NTREsoKTtcbiAgICAgIGxvZy53YXJuKGBObyBwbGF0Zm9ybSB2ZXJzaW9uIHNldC4gVXNpbmcgbWF4IFNESyB2ZXJzaW9uOiAke3JlcVZlcnNpb259YCk7XG4gICAgICAvLyB0aGlzIHdpbGwgYmUgYSBudW1iZXIsIGFuZCBwb3NzaWJseSBhbiBpbnRlZ2VyIChlLmcuLCBpZiBtYXggaU9TIFNESyBpcyA5KVxuICAgICAgLy8gc28gdHVybiBpdCBpbnRvIGEgc3RyaW5nIGFuZCBhZGQgYSAuMCBpZiBuZWNlc3NhcnlcbiAgICAgIGlmICghXy5pc1N0cmluZyhyZXFWZXJzaW9uKSkge1xuICAgICAgICByZXFWZXJzaW9uID0gKHJlcVZlcnNpb24gJSAxKSA/IFN0cmluZyhyZXFWZXJzaW9uKSA6IGAke3JlcVZlcnNpb259LjBgO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gcmVxVmVyc2lvbjtcbiAgfVxuXG4gIC8vIGNoYW5nZSB0aGUgZm9ybWF0IGluIHN1YmNsYXNzZXMsIGFzIG5lY2Vzc2FyeVxuICBzdGF0aWMgYXN5bmMgX2dldERldmljZVN0cmluZ1ZlcnNpb25TdHJpbmcgKHBsYXRmb3JtVmVyc2lvbikge1xuICAgIGxldCByZXFWZXJzaW9uID0gYXdhaXQgdGhpcy5fZ2V0RGV2aWNlU3RyaW5nUGxhdGZvcm1WZXJzaW9uKHBsYXRmb3JtVmVyc2lvbik7XG5cbiAgICByZXR1cm4gYCgke3JlcVZlcnNpb259IFNpbXVsYXRvcilgO1xuICB9XG5cbiAgLy8gY2hhbmdlIHRoZSBmb3JtYXQgaW4gc3ViY2xhc3NlcywgYXMgbmVjZXNzYXJ5XG4gIHN0YXRpYyBfZ2V0RGV2aWNlU3RyaW5nQ29uZmlnRml4ICgpIHtcbiAgICAvLyBzb21lIGRldmljZXMgbmVlZCB0byBiZSB1cGRhdGVkXG4gICAgcmV0dXJuIHtcbiAgICAgICdpUGFkIFNpbXVsYXRvciAoNy4xIFNpbXVsYXRvciknOiAnaVBhZCAyICg3LjEgU2ltdWxhdG9yKScsXG4gICAgICAnaVBhZCBTaW11bGF0b3IgKDguMCBTaW11bGF0b3IpJzogJ2lQYWQgMiAoOC4wIFNpbXVsYXRvciknLFxuICAgICAgJ2lQYWQgU2ltdWxhdG9yICg4LjEgU2ltdWxhdG9yKSc6ICdpUGFkIDIgKDguMSBTaW11bGF0b3IpJyxcbiAgICAgICdpUGFkIFNpbXVsYXRvciAoOC4yIFNpbXVsYXRvciknOiAnaVBhZCAyICg4LjIgU2ltdWxhdG9yKScsXG4gICAgICAnaVBhZCBTaW11bGF0b3IgKDguMyBTaW11bGF0b3IpJzogJ2lQYWQgMiAoOC4zIFNpbXVsYXRvciknLFxuICAgICAgJ2lQYWQgU2ltdWxhdG9yICg4LjQgU2ltdWxhdG9yKSc6ICdpUGFkIDIgKDguNCBTaW11bGF0b3IpJyxcbiAgICAgICdpUGhvbmUgU2ltdWxhdG9yICg3LjEgU2ltdWxhdG9yKSc6ICdpUGhvbmUgNXMgKDcuMSBTaW11bGF0b3IpJyxcbiAgICAgICdpUGhvbmUgU2ltdWxhdG9yICg4LjQgU2ltdWxhdG9yKSc6ICdpUGhvbmUgNiAoOC40IFNpbXVsYXRvciknLFxuICAgICAgJ2lQaG9uZSBTaW11bGF0b3IgKDguMyBTaW11bGF0b3IpJzogJ2lQaG9uZSA2ICg4LjMgU2ltdWxhdG9yKScsXG4gICAgICAnaVBob25lIFNpbXVsYXRvciAoOC4yIFNpbXVsYXRvciknOiAnaVBob25lIDYgKDguMiBTaW11bGF0b3IpJyxcbiAgICAgICdpUGhvbmUgU2ltdWxhdG9yICg4LjEgU2ltdWxhdG9yKSc6ICdpUGhvbmUgNiAoOC4xIFNpbXVsYXRvciknLFxuICAgICAgJ2lQaG9uZSBTaW11bGF0b3IgKDguMCBTaW11bGF0b3IpJzogJ2lQaG9uZSA2ICg4LjAgU2ltdWxhdG9yKSdcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIFRha2VzIGEgc2V0IG9mIG9wdGlvbnMgYW5kIGZpbmRzIHRoZSBjb3JyZWN0IGRldmljZSBzdHJpbmcgaW4gb3JkZXIgZm9yIEluc3RydW1lbnRzIHRvXG4gICAqIGlkZW50aWZ5IHRoZSBjb3JyZWN0IHNpbXVsYXRvci5cbiAgICpcbiAgICogQHBhcmFtIHtvYmplY3R9IG9wdHMgLSBUaGUgb3B0aW9ucyBhdmFpbGFibGUgYXJlOlxuICAgKiAgIC0gYGRldmljZU5hbWVgIC0gYSBuYW1lIGZvciB0aGUgZGV2aWNlLiBJZiB0aGUgZ2l2ZW4gZGV2aWNlIG5hbWUgc3RhcnRzIHdpdGggYD1gLCB0aGUgbmFtZSwgbGVzcyB0aGUgZXF1YWxzIHNpZ24sIGlzIHJldHVybmVkLlxuICAgKiAgIC0gYHBsYXRmb3JtVmVyc2lvbmAgLSB0aGUgdmVyc2lvbiBvZiBpT1MgdG8gdXNlLiBEZWZhdWx0cyB0byB0aGUgY3VycmVudCBYY29kZSdzIG1heGltdW0gU0RLIHZlcnNpb24uXG4gICAqICAgLSBgZm9yY2VJcGhvbmVgIC0gZm9yY2UgdGhlIGNvbmZpZ3VyYXRpb24gb2YgdGhlIGRldmljZSBzdHJpbmcgdG8gaVBob25lLiBEZWZhdWx0cyB0byBgZmFsc2VgLlxuICAgKiAgIC0gYGZvcmNlSXBhZGAgLSBmb3JjZSB0aGUgY29uZmlndXJhdGlvbiBvZiB0aGUgZGV2aWNlIHN0cmluZyB0byBpUGFkLiBEZWZhdWx0cyB0byBgZmFsc2VgLlxuICAgKiAgIElmIGJvdGggYGZvcmNlSXBob25lYCBhbmQgYGZvcmNlSXBhZGAgYXJlIHRydWUsIHRoZSBkZXZpY2Ugd2lsbCBiZSBmb3JjZWQgdG8gaVBob25lLlxuICAgKlxuICAgKiBAcmV0dXJuIHtzdHJpbmd9IFRoZSBmb3VuZCBkZXZpY2Ugc3RyaW5nLlxuICAgKi9cbiAgc3RhdGljIGFzeW5jIGdldERldmljZVN0cmluZyAob3B0cykge1xuICAgIG9wdHMgPSBPYmplY3QuYXNzaWduKHt9LCB7XG4gICAgICBkZXZpY2VOYW1lOiBudWxsLFxuICAgICAgcGxhdGZvcm1WZXJzaW9uOiBudWxsLFxuICAgICAgZm9yY2VJcGhvbmU6IGZhbHNlLFxuICAgICAgZm9yY2VJcGFkOiBmYWxzZVxuICAgIH0sIG9wdHMpO1xuICAgIGxldCBsb2dPcHRzID0ge1xuICAgICAgZGV2aWNlTmFtZTogb3B0cy5kZXZpY2VOYW1lLFxuICAgICAgcGxhdGZvcm1WZXJzaW9uOiBvcHRzLnBsYXRmb3JtVmVyc2lvbixcbiAgICAgIGZvcmNlSXBob25lOiBvcHRzLmZvcmNlSXBob25lLFxuICAgICAgZm9yY2VJcGFkOiBvcHRzLmZvcmNlSXBhZFxuICAgIH07XG4gICAgbG9nLmRlYnVnKGBHZXR0aW5nIGRldmljZSBzdHJpbmcgZnJvbSBvcHRpb25zOiAke0pTT04uc3RyaW5naWZ5KGxvZ09wdHMpfWApO1xuXG4gICAgLy8gc2hvcnQgY2lyY3VpdCBpZiB3ZSBhbHJlYWR5IGhhdmUgYSBkZXZpY2UgbmFtZVxuICAgIGlmICgob3B0cy5kZXZpY2VOYW1lIHx8ICcnKVswXSA9PT0gJz0nKSB7XG4gICAgICByZXR1cm4gb3B0cy5kZXZpY2VOYW1lLnN1YnN0cmluZygxKTtcbiAgICB9XG5cbiAgICBsZXQgaXNpUGhvbmUgPSAhIW9wdHMuZm9yY2VJcGhvbmUgfHwgIW9wdHMuZm9yY2VJcGFkO1xuXG4gICAgaWYgKG9wdHMuZGV2aWNlTmFtZSkge1xuICAgICAgbGV0IGRldmljZSA9IG9wdHMuZGV2aWNlTmFtZS50b0xvd2VyQ2FzZSgpO1xuICAgICAgaWYgKGRldmljZS5pbmRleE9mKCdpcGhvbmUnKSAhPT0gLTEpIHtcbiAgICAgICAgaXNpUGhvbmUgPSB0cnVlO1xuICAgICAgfSBlbHNlIGlmIChkZXZpY2UuaW5kZXhPZignaXBhZCcpICE9PSAtMSkge1xuICAgICAgICBpc2lQaG9uZSA9IGZhbHNlO1xuICAgICAgfVxuICAgIH1cblxuICAgIGxldCBpb3NEZXZpY2VTdHJpbmcgPSBvcHRzLmRldmljZU5hbWUgfHwgKGlzaVBob25lID8gJ2lQaG9uZSBTaW11bGF0b3InIDogJ2lQYWQgU2ltdWxhdG9yJyk7XG5cbiAgICAvLyBpZiBzb21lb25lIHBhc3NlcyBpbiBqdXN0IFwiaVBob25lXCIsIG1ha2UgdGhhdCBcImlQaG9uZSBTaW11bGF0b3JcIiB0b1xuICAgIC8vIGNvbmZvcm0gdG8gYWxsIHRoZSBsb2dpYyBiZWxvd1xuICAgIGlmICgvXihpUGhvbmV8aVBhZCkkLy50ZXN0KGlvc0RldmljZVN0cmluZykpIHtcbiAgICAgIGlvc0RldmljZVN0cmluZyArPSAnIFNpbXVsYXRvcic7XG4gICAgfVxuXG4gICAgLy8gd2Ugc3VwcG9ydCBkZXZpY2VOYW1lOiBcImlQaG9uZSBTaW11bGF0b3JcIiwgYW5kIGFsc28gd2FudCB0byBzdXBwb3J0XG4gICAgLy8gXCJpUGhvbmUgWFlaIFNpbXVsYXRvclwiLCBidXQgdGhlc2Ugc3RyaW5ncyBhcmVuJ3QgaW4gdGhlIGRldmljZSBsaXN0LlxuICAgIC8vIFNvLCBpZiBzb21lb25lIHNlbnQgaW4gXCJpUGhvbmUgWFlaIFNpbXVsYXRvclwiLCBzdHJpcCBvZmYgXCIgU2ltdWxhdG9yXCJcbiAgICAvLyBpbiBvcmRlciB0byBhbGxvdyB0aGUgZGVmYXVsdCBcImlQaG9uZSBYWVpcIiBtYXRjaFxuICAgIGlmICgvW14oaVBob25lfGlQYWQpXSBTaW11bGF0b3IvLnRlc3QoaW9zRGV2aWNlU3RyaW5nKSkge1xuICAgICAgaW9zRGV2aWNlU3RyaW5nID0gaW9zRGV2aWNlU3RyaW5nLnJlcGxhY2UoJyBTaW11bGF0b3InLCAnJyk7XG4gICAgfVxuICAgIGlvc0RldmljZVN0cmluZyArPSBgICR7YXdhaXQgdGhpcy5fZ2V0RGV2aWNlU3RyaW5nVmVyc2lvblN0cmluZyhvcHRzLnBsYXRmb3JtVmVyc2lvbil9YDtcblxuICAgIGxldCBDT05GSUdfRklYID0gdGhpcy5fZ2V0RGV2aWNlU3RyaW5nQ29uZmlnRml4KCk7XG5cbiAgICBsZXQgY29uZmlnRml4ID0gQ09ORklHX0ZJWDtcbiAgICBpZiAoY29uZmlnRml4W2lvc0RldmljZVN0cmluZ10pIHtcbiAgICAgIGlvc0RldmljZVN0cmluZyA9IGNvbmZpZ0ZpeFtpb3NEZXZpY2VTdHJpbmddO1xuICAgICAgbG9nLmRlYnVnKGBGaXhpbmcgZGV2aWNlLiBDaGFuZ2VkIGZyb20gJyR7b3B0cy5kZXZpY2VOYW1lfScgYCArXG4gICAgICAgICAgICAgICAgYHRvICcke2lvc0RldmljZVN0cmluZ30nYCk7XG4gICAgfVxuXG4gICAgbG9nLmRlYnVnKGBGaW5hbCBkZXZpY2Ugc3RyaW5nIGlzICcke2lvc0RldmljZVN0cmluZ30nYCk7XG4gICAgcmV0dXJuIGlvc0RldmljZVN0cmluZztcbiAgfVxuXG4gIC8qKlxuICAgKiBAcmV0dXJuIHs/c3RyaW5nfSBUaGUgZnVsbCBwYXRoIHRvIHRoZSBzaW11bGF0b3IncyBXZWJJbnNwZWN0b3IgVW5peCBEb21haW4gU29ja2V0XG4gICAqICAgb3IgYG51bGxgIGlmIHRoZXJlIGlzIG5vIHNvY2tldC5cbiAgICovXG4gIGFzeW5jIGdldFdlYkluc3BlY3RvclNvY2tldCAoKSB7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgcmVxdWlyZS1hd2FpdFxuICAgIC8vIHRoZXJlIGlzIG5vIFdlYkluc3BlY3RvciBzb2NrZXQgZm9yIHRoaXMgdmVyc2lvbiBvZiBYY29kZVxuICAgIHJldHVybiBudWxsO1xuICB9XG59XG5cbmZvciAobGV0IFtjbWQsIGZuXSBvZiBfLnRvUGFpcnMoZXh0ZW5zaW9ucykpIHtcbiAgU2ltdWxhdG9yWGNvZGU2LnByb3RvdHlwZVtjbWRdID0gZm47XG59XG5cbmV4cG9ydCBkZWZhdWx0IFNpbXVsYXRvclhjb2RlNjtcbmV4cG9ydCB7IFNpbXVsYXRvclhjb2RlNiwgQk9PVF9DT01QTEVURURfRVZFTlQsIFNQUklOR0JPQVJEX0JVTkRMRV9JRCB9O1xuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQUFBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUlBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOzs7Ozs7QUFHQSxNQUFNQSxlQUFlLEdBQUcsS0FBSyxJQUE3QjtBQUNBLE1BQU1DLGtCQUFrQixHQUFHLElBQTNCO0FBQ0EsTUFBTUMsc0JBQXNCLEdBQUcsSUFBSUMsa0JBQUosRUFBL0I7QUFDQSxNQUFNQyxtQkFBbUIsR0FBRywyQkFBNUI7QUFDQSxNQUFNQyxxQkFBcUIsR0FBRyx1QkFBOUI7O0FBVUEsTUFBTUMsb0JBQW9CLEdBQUcsZUFBN0I7OztBQUdBLE1BQU1DLGVBQU4sU0FBOEJDLG9CQUE5QixDQUEyQztFQVF6Q0MsV0FBVyxDQUFFQyxJQUFGLEVBQVFDLFlBQVIsRUFBc0I7SUFDL0I7SUFFQSxLQUFLRCxJQUFMLEdBQVlFLE1BQU0sQ0FBQ0YsSUFBRCxDQUFsQjtJQUNBLEtBQUtHLE1BQUwsR0FBYyxJQUFJQyxtQkFBSixDQUFXO01BQ3ZCSixJQUFJLEVBQUUsS0FBS0E7SUFEWSxDQUFYLENBQWQ7SUFHQSxLQUFLQyxZQUFMLEdBQW9CQSxZQUFwQjtJQUtBLEtBQUtJLGdCQUFMLEdBQXdCLElBQXhC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