{"version":3,"file":"driver.js","names":["SHUTDOWN_OTHER_FEAT_NAME","CUSTOMIZE_RESULT_BUNDPE_PATH","SUPPORTED_EXTENSIONS","IPA_EXT","APP_EXT","MAX_ARCHIVE_SCAN_DEPTH","defaultServerCaps","webStorageEnabled","locationContextEnabled","browserName","platform","javascriptEnabled","databaseEnabled","takesScreenshot","networkConnectionEnabled","WDA_SIM_STARTUP_RETRIES","WDA_REAL_DEV_STARTUP_RETRIES","WDA_REAL_DEV_TUTORIAL_URL","WDA_STARTUP_RETRY_INTERVAL","DEFAULT_SETTINGS","nativeWebTap","nativeWebTapStrict","useJSONSource","shouldUseCompactResponses","elementResponseAttributes","mjpegServerScreenshotQuality","mjpegServerFramerate","screenshotQuality","mjpegScalingFactor","reduceMotion","SHARED_RESOURCES_GUARD","AsyncLock","WEB_ELEMENTS_CACHE_SIZE","NO_PROXY_NATIVE_LIST","NO_PROXY_WEB_LIST","concat","MEMOIZED_FUNCTIONS","XCUITestDriver","BaseDriver","constructor","opts","shouldValidateCaps","desiredCapConstraints","locatorStrategies","webLocatorStrategies","resetIos","settings","DeviceSettings","onSettingsUpdate","bind","logs","fn","_","memoize","key","value","proxyCommand","wda","device","jwpProxyActive","proxyReqRes","jwpProxyAvoid","safari","cachedWdaStatus","curWebFrames","_currentUrl","curContext","xcodeVersion","contexts","implicitWaitMs","asynclibWaitMs","pageLoadMs","landscapeWebCoordsOffset","remote","_conditionInducerService","webElementsCache","LRU","max","driverData","getStatus","driverInfo","getDriverInfo","status","build","version","mergeCliArgsToOpts","didMerge","Object","entries","cliArgs","has","log","info","createSession","args","lifecycleData","sessionId","caps","validateDesiredCaps","start","assign","udid","updateSettings","wdaSettings","mjpegScreenshotUrl","mjpegStream","mjpeg","MJpegStream","e","error","JSON","stringify","deleteSession","getDefaultUrl","isRealDevice","wdaLocalPort","address","includes","port","noReset","fullReset","printUser","iosSdkVersion","realDevice","determineDevice","simulatorDevicesSetPath","devicesSetPath","platformVersion","getPlatformVersion","normalizedVersion","normalizePlatformVersion","util","compareVersions","Error","isEmpty","webDriverAgentUrl","getAndCheckXcodeVersion","logEvent","toLower","app","undefined","processArguments","bundleId","SAFARI_BUNDLE_ID","safariInitialUrl","configureApp","checkAppPresent","extractBundleId","runReset","WebDriverAgent","retrieveDerivedDataPath","catch","debug","memoizedLogInfo","startLogCapture","skipLogCapture","result","isLogCaptureStarted","isSimulator","shutdownOtherSimulators","ensureFeatureEnabled","isSafari","safariGlobalPreferences","updateSafariGlobalSettings","localConfig","setLocaleAndPreferences","sim","shutdownSimulator","customSSLCert","doesSupportKeychainApi","certHead","truncate","length","hasCertificateLegacy","installCertificateLegacy","startSim","installCertificate","launchWithIDB","idb","IDB","connect","message","Pyidevice","installProfile","payload","installAUT","isAppInstalled","errorAndThrow","permissions","permissionsMapping","toPairs","parse","setPermissions","warn","calendarAccessAuthorized","enableCalendarAccess","disableCalendarAccess","startWda","setReduceMotion","setInitialOrientation","orientation","autoWebview","activateRecentWebview","isNil","getCurrentUrl","setUrl","setCurrentUrl","getUrl","hasValue","cleanupObsoleteProcesses","usePortForwarding","isLocalHost","wdaBaseUrl","DEVICE_CONNECTIONS_FACTORY","requestConnection","url","devicePort","wdaRemotePort","synchronizationKey","name","useXctestrunFile","isSourceFresh","derivedDataPath","path","normalize","isBusy","bootstrapPath","acquire","useNewWDA","quitAndUninstall","setupCaching","msg","resultBundlePath","startupRetries","wdaStartupRetries","startupRetryInterval","wdaStartupRetryInterval","retryCount","retryInterval","retries","major","retry","launch","err","errorMsg","originalStacktrace","startWdaSession","stack","clearSystemFiles","markSystemFilesForCleanup","fullyStarted","runRealDeviceReset","runSimulatorReset","removeAllSessionWebSocketHandlers","server","recorder","compact","_recentScreenRecorder","_audioRecorder","_trafficCapture","interrupt","cleanup","_perfRecorders","B","all","map","x","stop","mobileDisableConditionInducer","stopRemote","resetOnSessionStartOnly","enforceSimulatorShutdown","createSim","delete","shouldResetLocationServivce","resetLocationService","mobileResetLocationService","ignore","syslog","stopCapture","jwproxy","quit","releaseConnection","executeCommand","cmd","receiveAsyncResponse","appIsPackageOrBundle","test","helpers","onPostProcess","onPostConfigureApp","supportedExtensions","unzipApp","appPath","depth","rootDir","matchedPaths","findApps","basename","pluralize","matchedPath","fullPath","join","isAppBundle","supportedPlatforms","fetchSupportedAppPlatforms","some","p","isolateAppBundle","endsWith","fs","stat","isFile","rimraf","cachedAppInfo","isUrl","isPlainObject","hash","packageHash","exists","glob","cwd","strict","nosort","integrity","folder","deviceName","translateDeviceName","setupVersionCaps","getAndCheckIosSdkVersion","toLowerCase","detectUdid","getExistingSim","devicePlatform","devices","getConnectedDevices","getSimulator","ign","getRealDeviceObj","enforceFreshSimulatorCreation","runOpts","scaleFactor","connectHardwareKeyboard","pasteboardAutomaticSync","simulatorPasteboardAutomaticSync","isHeadless","tracePointer","simulatorTracePointer","devicePreferences","SimulatorWindowCenter","isInteger","simulatorStartupTimeout","startupTimeout","isString","toUpperCase","SimulatorWindowOrientation","SimulatorWindowRotationAngle","run","platformName","isTvOS","PLATFORM_NAME_TVOS","PLATFORM_NAME_IOS","launchApp","APP_LAUNCH_TIMEOUT","simctl","checkStatus","response","currentApp","bundleID","parseInt","isArray","env","language","push","locale","shouldTerminateApp","forceAppLaunch","wdaCaps","autoLaunch","arguments","environment","eventloopIdleDelaySec","wdaEventloopIdleDelay","shouldWaitForQuiescence","waitForQuiescence","shouldUseTestManagerForVisibilityDetection","simpleIsVisibleCheck","maxTypingFrequency","shouldUseSingletonTestManager","waitForIdleTimeout","elementResponseFields","disableAutomaticScreenshots","useNativeCachingStrategy","forceSimulatorSoftwareKeyboardPresence","autoAcceptAlerts","defaultAlertAction","autoDismissAlerts","capabilities","firstMatch","alwaysMatch","proxyActive","getProxyAvoidList","isWebview","canProxy","isWebContext","validateLocatorStrategy","strategy","coerceVersion","verifyProcessArgument","keychainPath","keychainPassword","commandTimeouts","normalizeCommandTimeouts","protocol","host","perms","additionalWebviewBundleIds","parseCapsArray","verifyApplicationPlatform","installToRealDevice","timeout","appPushTimeout","appInstallStrategy","installToSimulator","newSimulator","otherApps","installOtherApps","iosInstallPause","pause","delay","appsList","appPaths","otherApp","isEnabled","isBoolean","curOrientation","_getCommandTimeout","cmdName","DEFAULT_TIMEOUT_KEY","getSession","driverSession","shouldGetDeviceCaps","includeDeviceCapsToSessionInfo","deviceCaps","statusBarSize","scale","getScreenInfo","pixelRatio","statBarHeight","height","viewportRect","getViewportRect","reset","cloneDeep","shutdownHandler","resetOnUnexpectedShutdown","prototype","commands"],"sources":["../../lib/driver.js"],"sourcesContent":["import { BaseDriver, DeviceSettings } from 'appium/driver';\nimport { util, mjpeg, fs } from 'appium/support';\nimport _ from 'lodash';\nimport url from 'url';\nimport { WebDriverAgent } from 'appium-webdriveragent';\nimport LRU from 'lru-cache';\nimport {\n  createSim, getExistingSim, runSimulatorReset, installToSimulator,\n  shutdownOtherSimulators, shutdownSimulator, setLocaleAndPreferences\n} from './simulator-management';\nimport { getSimulator } from 'appium-ios-simulator';\nimport {\n  doesSupportKeychainApi, installCertificate, installCertificateLegacy,\n  hasCertificateLegacy,\n} from './cert-utils';\nimport { retryInterval, retry } from 'asyncbox';\nimport {\n  verifyApplicationPlatform, extractBundleId, SAFARI_BUNDLE_ID,\n  fetchSupportedAppPlatforms, APP_EXT, IPA_EXT,\n  isAppBundle, findApps, isolateAppBundle,\n} from './app-utils';\nimport {\n  desiredCapConstraints, PLATFORM_NAME_IOS, PLATFORM_NAME_TVOS\n} from './desired-caps';\nimport commands from './commands/index';\nimport {\n  detectUdid, getAndCheckXcodeVersion, getAndCheckIosSdkVersion,\n  checkAppPresent, getDriverInfo,\n  clearSystemFiles, translateDeviceName, normalizeCommandTimeouts,\n  DEFAULT_TIMEOUT_KEY, markSystemFilesForCleanup,\n  printUser, removeAllSessionWebSocketHandlers,\n  normalizePlatformVersion, isLocalHost\n} from './utils';\nimport {\n  getConnectedDevices, runRealDeviceReset, installToRealDevice,\n  getRealDeviceObj\n} from './real-device-management';\nimport B from 'bluebird';\nimport AsyncLock from 'async-lock';\nimport path from 'path';\nimport IDB from 'appium-idb';\nimport DEVICE_CONNECTIONS_FACTORY from './device-connections-factory';\nimport Pyidevice from './py-ios-device-client';\n\n\nconst SHUTDOWN_OTHER_FEAT_NAME = 'shutdown_other_sims';\nconst CUSTOMIZE_RESULT_BUNDPE_PATH = 'customize_result_bundle_path';\n\nconst SUPPORTED_EXTENSIONS = [IPA_EXT, APP_EXT];\nconst MAX_ARCHIVE_SCAN_DEPTH = 1;\nconst defaultServerCaps = {\n  webStorageEnabled: false,\n  locationContextEnabled: false,\n  browserName: '',\n  platform: 'MAC',\n  javascriptEnabled: true,\n  databaseEnabled: false,\n  takesScreenshot: true,\n  networkConnectionEnabled: false,\n};\nconst WDA_SIM_STARTUP_RETRIES = 2;\nconst WDA_REAL_DEV_STARTUP_RETRIES = 1;\nconst WDA_REAL_DEV_TUTORIAL_URL = 'https://github.com/appium/appium-xcuitest-driver/blob/master/docs/real-device-config.md';\nconst WDA_STARTUP_RETRY_INTERVAL = 10000;\nconst DEFAULT_SETTINGS = {\n  nativeWebTap: false,\n  nativeWebTapStrict: false,\n  useJSONSource: false,\n  shouldUseCompactResponses: true,\n  elementResponseAttributes: 'type,label',\n  // Read https://github.com/appium/WebDriverAgent/blob/master/WebDriverAgentLib/Utilities/FBConfiguration.m for following settings' values\n  mjpegServerScreenshotQuality: 25,\n  mjpegServerFramerate: 10,\n  screenshotQuality: 1,\n  mjpegScalingFactor: 100,\n  // set `reduceMotion` to `null` so that it will be verified but still set either true/false\n  reduceMotion: null,\n};\n// This lock assures, that each driver session does not\n// affect shared resources of the other parallel sessions\nconst SHARED_RESOURCES_GUARD = new AsyncLock();\nconst WEB_ELEMENTS_CACHE_SIZE = 500;\n\n/* eslint-disable no-useless-escape */\nconst NO_PROXY_NATIVE_LIST = [\n  ['DELETE', /window/],\n  ['GET', /^\\/session\\/[^\\/]+$/],\n  ['GET', /alert_text/],\n  ['GET', /alert\\/[^\\/]+/],\n  ['GET', /appium/],\n  ['GET', /attribute/],\n  ['GET', /context/],\n  ['GET', /location/],\n  ['GET', /log/],\n  ['GET', /screenshot/],\n  ['GET', /size/],\n  ['GET', /source/],\n  ['GET', /timeouts$/],\n  ['GET', /url/],\n  ['GET', /window/],\n  ['POST', /accept_alert/],\n  ['POST', /actions$/],\n  ['POST', /alert_text/],\n  ['POST', /alert\\/[^\\/]+/],\n  ['POST', /appium/],\n  ['POST', /appium\\/device\\/is_locked/],\n  ['POST', /appium\\/device\\/lock/],\n  ['POST', /appium\\/device\\/unlock/],\n  ['POST', /back/],\n  ['POST', /clear/],\n  ['POST', /context/],\n  ['POST', /dismiss_alert/],\n  ['POST', /element\\/active/], // MJSONWP get active element should proxy\n  ['POST', /element$/],\n  ['POST', /elements$/],\n  ['POST', /execute/],\n  ['POST', /keys/],\n  ['POST', /log/],\n  ['POST', /moveto/],\n  ['POST', /receive_async_response/], // always, in case context switches while waiting\n  ['POST', /session\\/[^\\/]+\\/location/], // geo location, but not element location\n  ['POST', /shake/],\n  ['POST', /timeouts/],\n  ['POST', /touch/],\n  ['POST', /url/],\n  ['POST', /value/],\n  ['POST', /window/],\n  ['DELETE', /cookie/],\n  ['GET', /cookie/],\n  ['POST', /cookie/],\n];\nconst NO_PROXY_WEB_LIST = [\n  ['GET', /attribute/],\n  ['GET', /element/],\n  ['GET', /text/],\n  ['GET', /title/],\n  ['POST', /clear/],\n  ['POST', /click/],\n  ['POST', /element/],\n  ['POST', /forward/],\n  ['POST', /frame/],\n  ['POST', /keys/],\n  ['POST', /refresh/],\n].concat(NO_PROXY_NATIVE_LIST);\n/* eslint-enable no-useless-escape */\n\nconst MEMOIZED_FUNCTIONS = [\n  'getStatusBarHeight',\n  'getDevicePixelRatio',\n  'getScreenInfo',\n];\n\n\nclass XCUITestDriver extends BaseDriver {\n  constructor (opts = {}, shouldValidateCaps = true) {\n    super(opts, shouldValidateCaps);\n\n    this.desiredCapConstraints = desiredCapConstraints;\n\n    this.locatorStrategies = [\n      'xpath',\n      'id',\n      'name',\n      'class name',\n      '-ios predicate string',\n      '-ios class chain',\n      'accessibility id',\n      'css selector',\n    ];\n    this.webLocatorStrategies = [\n      'link text',\n      'css selector',\n      'tag name',\n      'link text',\n      'partial link text',\n    ];\n    this.resetIos();\n    this.settings = new DeviceSettings(DEFAULT_SETTINGS, this.onSettingsUpdate.bind(this));\n    this.logs = {};\n\n    // memoize functions here, so that they are done on a per-instance basis\n    for (const fn of MEMOIZED_FUNCTIONS) {\n      this[fn] = _.memoize(this[fn]);\n    }\n  }\n\n  async onSettingsUpdate (key, value) {\n    if (key !== 'nativeWebTap' && key !== 'nativeWebTapStrict') {\n      return await this.proxyCommand('/appium/settings', 'POST', {\n        settings: {[key]: value}\n      });\n    }\n    this.opts[key] = !!value;\n  }\n\n  resetIos () {\n    this.opts = this.opts || {};\n    this.wda = null;\n    this.opts.device = null;\n    this.jwpProxyActive = false;\n    this.proxyReqRes = null;\n    this.jwpProxyAvoid = [];\n    this.safari = false;\n    this.cachedWdaStatus = null;\n\n    this.curWebFrames = [];\n    this._currentUrl = null;\n    this.curContext = null;\n    this.xcodeVersion = {};\n    this.contexts = [];\n    this.implicitWaitMs = 0;\n    this.asynclibWaitMs = 0;\n    this.pageLoadMs = 6000;\n    this.landscapeWebCoordsOffset = 0;\n    this.remote = null;\n    this._conditionInducerService = null;\n\n    this.webElementsCache = new LRU({\n      max: WEB_ELEMENTS_CACHE_SIZE,\n    });\n  }\n\n  get driverData () {\n    // TODO fill out resource info here\n    return {};\n  }\n\n  async getStatus () {\n    if (typeof this.driverInfo === 'undefined') {\n      this.driverInfo = await getDriverInfo();\n    }\n    let status = {build: {version: this.driverInfo.version}};\n    if (this.cachedWdaStatus) {\n      status.wda = this.cachedWdaStatus;\n    }\n    return status;\n  }\n\n  mergeCliArgsToOpts () {\n    let didMerge = false;\n    // this.cliArgs should never include anything we do not expect.\n    for (const [key, value] of Object.entries(this.cliArgs ?? {})) {\n      if (_.has(this.opts, key)) {\n        this.log.info(`CLI arg '${key}' with value '${value}' overwrites value '${this.opts[key]}' sent in via caps)`);\n        didMerge = true;\n      }\n      this.opts[key] = value;\n    }\n    return didMerge;\n  }\n\n  async createSession (...args) {\n    this.lifecycleData = {}; // this is used for keeping track of the state we start so when we delete the session we can put things back\n    try {\n      let [sessionId, caps] = await super.createSession(...args);\n      this.opts.sessionId = sessionId;\n\n      // merge cli args to opts, and if we did merge any, revalidate opts to ensure the final set\n      // is also consistent\n      if (this.mergeCliArgsToOpts()) {\n        this.validateDesiredCaps({...caps, ...this.cliArgs});\n      }\n\n      await this.start();\n\n      // merge server capabilities + desired capabilities\n      caps = Object.assign({}, defaultServerCaps, caps);\n      // update the udid with what is actually used\n      caps.udid = this.opts.udid;\n      // ensure we track nativeWebTap capability as a setting as well\n      if (_.has(this.opts, 'nativeWebTap')) {\n        await this.updateSettings({nativeWebTap: this.opts.nativeWebTap});\n      }\n      // ensure we track nativeWebTapStrict capability as a setting as well\n      if (_.has(this.opts, 'nativeWebTapStrict')) {\n        await this.updateSettings({nativeWebTapStrict: this.opts.nativeWebTapStrict});\n      }\n      // ensure we track useJSONSource capability as a setting as well\n      if (_.has(this.opts, 'useJSONSource')) {\n        await this.updateSettings({useJSONSource: this.opts.useJSONSource});\n      }\n\n      let wdaSettings = {\n        elementResponseAttributes: DEFAULT_SETTINGS.elementResponseAttributes,\n        shouldUseCompactResponses: DEFAULT_SETTINGS.shouldUseCompactResponses,\n      };\n      if (_.has(this.opts, 'elementResponseAttributes')) {\n        wdaSettings.elementResponseAttributes = this.opts.elementResponseAttributes;\n      }\n      if (_.has(this.opts, 'shouldUseCompactResponses')) {\n        wdaSettings.shouldUseCompactResponses = this.opts.shouldUseCompactResponses;\n      }\n      if (_.has(this.opts, 'mjpegServerScreenshotQuality')) {\n        wdaSettings.mjpegServerScreenshotQuality = this.opts.mjpegServerScreenshotQuality;\n      }\n      if (_.has(this.opts, 'mjpegServerFramerate')) {\n        wdaSettings.mjpegServerFramerate = this.opts.mjpegServerFramerate;\n      }\n      if (_.has(this.opts, 'screenshotQuality')) {\n        this.log.info(`Setting the quality of phone screenshot: '${this.opts.screenshotQuality}'`);\n        wdaSettings.screenshotQuality = this.opts.screenshotQuality;\n      }\n      // ensure WDA gets our defaults instead of whatever its own might be\n      await this.updateSettings(wdaSettings);\n\n      // turn on mjpeg stream reading if requested\n      if (this.opts.mjpegScreenshotUrl) {\n        this.log.info(`Starting MJPEG stream reading URL: '${this.opts.mjpegScreenshotUrl}'`);\n        this.mjpegStream = new mjpeg.MJpegStream(this.opts.mjpegScreenshotUrl);\n        await this.mjpegStream.start();\n      }\n      return [sessionId, caps];\n    } catch (e) {\n      this.log.error(JSON.stringify(e));\n      await this.deleteSession();\n      throw e;\n    }\n  }\n\n  /**\n   * Returns the default URL for Safari browser\n   * @returns {string} The default URL\n   */\n  getDefaultUrl () {\n    // Setting this to some external URL slows down Appium startup\n    return this.isRealDevice()\n      ? `http://127.0.0.1:${this.opts.wdaLocalPort || 8100}/health`\n      : `http://${\n        this.opts.address.includes(':') ? `[${this.opts.address}]` : this.opts.address\n      }:${this.opts.port}/welcome`;\n  }\n\n  async start () {\n    this.opts.noReset = !!this.opts.noReset;\n    this.opts.fullReset = !!this.opts.fullReset;\n\n    await printUser();\n\n    this.opts.iosSdkVersion = null; // For WDA and xcodebuild\n    const {device, udid, realDevice} = await this.determineDevice();\n    this.log.info(`Determining device to run tests on: udid: '${udid}', real device: ${realDevice}`);\n    this.opts.device = device;\n    this.opts.udid = udid;\n    this.opts.realDevice = realDevice;\n\n    if (this.opts.simulatorDevicesSetPath) {\n      if (realDevice) {\n        this.log.info(`The 'simulatorDevicesSetPath' capability is only supported for Simulator devices`);\n      } else {\n        this.log.info(`Setting simulator devices set path to '${this.opts.simulatorDevicesSetPath}'`);\n        this.opts.device.devicesSetPath = this.opts.simulatorDevicesSetPath;\n      }\n    }\n\n    // at this point if there is no platformVersion, get it from the device\n    if (!this.opts.platformVersion && this.opts.device) {\n      this.opts.platformVersion = await this.opts.device.getPlatformVersion();\n      this.log.info(`No platformVersion specified. Using device version: '${this.opts.platformVersion}'`);\n    }\n\n    const normalizedVersion = normalizePlatformVersion(this.opts.platformVersion);\n    if (this.opts.platformVersion !== normalizedVersion) {\n      this.log.info(`Normalized platformVersion capability value '${this.opts.platformVersion}' to '${normalizedVersion}'`);\n      this.opts.platformVersion = normalizedVersion;\n    }\n    if (util.compareVersions(this.opts.platformVersion, '<', '9.3')) {\n      throw new Error(`Platform version must be 9.3 or above. '${this.opts.platformVersion}' is not supported.`);\n    }\n\n    if (_.isEmpty(this.xcodeVersion) && (!this.opts.webDriverAgentUrl || !this.opts.realDevice)) {\n      // no `webDriverAgentUrl`, or on a simulator, so we need an Xcode version\n      this.xcodeVersion = await getAndCheckXcodeVersion();\n    }\n    this.logEvent('xcodeDetailsRetrieved');\n\n    if (_.toLower(this.opts.browserName) === 'safari') {\n      this.log.info('Safari test requested');\n      this.safari = true;\n      this.opts.app = undefined;\n      this.opts.processArguments = this.opts.processArguments || {};\n      this.opts.bundleId = SAFARI_BUNDLE_ID;\n      this._currentUrl = this.opts.safariInitialUrl || this.getDefaultUrl();\n    } else if (this.opts.app || this.opts.bundleId) {\n      await this.configureApp();\n    }\n    this.logEvent('appConfigured');\n\n    // fail very early if the app doesn't actually exist\n    // or if bundle id doesn't point to an installed app\n    if (this.opts.app) {\n      await checkAppPresent(this.opts.app);\n\n      if (!this.opts.bundleId) {\n        this.opts.bundleId = await extractBundleId(this.opts.app);\n      }\n    }\n\n    await this.runReset();\n\n    this.wda = new WebDriverAgent(this.xcodeVersion, this.opts, this.log);\n    // Derived data path retrieval is an expensive operation\n    // We could start that now in background and get the cached result\n    // whenever it is needed\n    // eslint-disable-next-line promise/prefer-await-to-then\n    this.wda.retrieveDerivedDataPath().catch((e) => this.log.debug(e));\n\n    const memoizedLogInfo = _.memoize(() => {\n      this.log.info(\"'skipLogCapture' is set. Skipping starting logs such as crash, system, safari console and safari network.\");\n    });\n    const startLogCapture = async () => {\n      if (this.opts.skipLogCapture) {\n        memoizedLogInfo();\n        return false;\n      }\n\n      const result = await this.startLogCapture();\n      if (result) {\n        this.logEvent('logCaptureStarted');\n      }\n      return result;\n    };\n    const isLogCaptureStarted = await startLogCapture();\n\n    this.log.info(`Setting up ${this.isRealDevice() ? 'real device' : 'simulator'}`);\n\n    if (this.isSimulator()) {\n      if (this.opts.shutdownOtherSimulators) {\n        this.ensureFeatureEnabled(SHUTDOWN_OTHER_FEAT_NAME);\n        await shutdownOtherSimulators(this.opts.device);\n      }\n\n      // this should be done before the simulator is started\n      // if it is already running, this cap won't work, which is documented\n      if (this.isSafari() && this.opts.safariGlobalPreferences) {\n        if (await this.opts.device.updateSafariGlobalSettings(this.opts.safariGlobalPreferences)) {\n          this.log.debug(`Safari global preferences updated`);\n        }\n      }\n\n      this.localConfig = await setLocaleAndPreferences(this.opts.device, this.opts, this.isSafari(), async (sim) => {\n        await shutdownSimulator(sim);\n\n        // we don't know if there needs to be changes a priori, so change first.\n        // sometimes the shutdown process changes the settings, so reset them,\n        // knowing that the sim is already shut\n        await setLocaleAndPreferences(sim, this.opts, this.isSafari());\n      });\n\n      if (this.opts.customSSLCert && !(await doesSupportKeychainApi(this.opts.device))) {\n        const certHead = _.truncate(this.opts.customSSLCert, {length: 20});\n        this.log.info(`Installing the custom SSL certificate '${certHead}'`);\n        if (await hasCertificateLegacy(this.opts.device, this.opts.customSSLCert)) {\n          this.log.info(`SSL certificate '${certHead}' already installed`);\n        } else {\n          this.log.info(`Making sure Simulator is shut down, ' +\n            'so that SSL certificate installation takes effect`);\n          await shutdownSimulator(this.opts.device);\n          await installCertificateLegacy(this.opts.device, this.opts.customSSLCert);\n        }\n        this.logEvent('customCertInstalled');\n      }\n\n      await this.startSim();\n\n      if (this.opts.customSSLCert && await doesSupportKeychainApi(this.opts.device)) {\n        // Simulator must be booted in order to call this helper\n        await installCertificate(this.opts.device, this.opts.customSSLCert);\n        this.logEvent('customCertInstalled');\n      }\n\n      if (this.opts.launchWithIDB && this.isSimulator()) {\n        try {\n          const idb = new IDB({udid});\n          await idb.connect();\n          this.opts.device.idb = idb;\n        } catch (e) {\n          this.log.info(`idb will not be used for Simulator interaction. Original error: ${e.message}`);\n        }\n      }\n\n      this.logEvent('simStarted');\n      if (!isLogCaptureStarted) {\n        // Retry log capture if Simulator was not running before\n        await startLogCapture();\n      }\n    } else if (this.opts.customSSLCert) {\n      await new Pyidevice(udid).installProfile({payload: this.opts.customSSLCert});\n    }\n\n    if (this.opts.app) {\n      await this.installAUT();\n      this.logEvent('appInstalled');\n    }\n\n    // if we only have bundle identifier and no app, fail if it is not already installed\n    if (!this.opts.app && this.opts.bundleId && !this.isSafari()) {\n      if (!await this.opts.device.isAppInstalled(this.opts.bundleId)) {\n        this.log.errorAndThrow(`App with bundle identifier '${this.opts.bundleId}' unknown`);\n      }\n    }\n\n    if (this.opts.permissions) {\n      if (this.isSimulator()) {\n        this.log.debug('Setting the requested permissions before WDA is started');\n        for (const [bundleId, permissionsMapping] of _.toPairs(JSON.parse(this.opts.permissions))) {\n          await this.opts.device.setPermissions(bundleId, permissionsMapping);\n        }\n      } else {\n        this.log.warn('Setting permissions is only supported on Simulator. ' +\n          'The \"permissions\" capability will be ignored.');\n      }\n    }\n\n    if (this.isSimulator()) {\n      if (this.opts.calendarAccessAuthorized) {\n        await this.opts.device.enableCalendarAccess(this.opts.bundleId);\n      } else if (this.opts.calendarAccessAuthorized === false) {\n        await this.opts.device.disableCalendarAccess(this.opts.bundleId);\n      }\n    }\n\n    await this.startWda(this.opts.sessionId, realDevice);\n\n    await this.setReduceMotion(this.opts.reduceMotion);\n\n    await this.setInitialOrientation(this.opts.orientation);\n    this.logEvent('orientationSet');\n\n    if (this.isSafari() || this.opts.autoWebview) {\n      await this.activateRecentWebview();\n    }\n    if (this.isSafari()) {\n      if (!(this.opts.safariInitialUrl === ''\n          || (this.opts.noReset && _.isNil(this.opts.safariInitialUrl)))) {\n        this.log.info(`About to set the initial Safari URL to '${this.getCurrentUrl()}'.` +\n          `Use 'safariInitialUrl' capability in order to customize it`);\n        await this.setUrl(this.getCurrentUrl());\n      } else {\n        this.setCurrentUrl(await this.getUrl());\n      }\n    }\n  }\n\n  /**\n   * Start WebDriverAgentRunner\n   * @param {string} sessionId - The id of the target session to launch WDA with.\n   * @param {boolean} realDevice - Equals to true if the test target device is a real device.\n   */\n  async startWda (sessionId, realDevice) {\n    // Don't cleanup the processes if webDriverAgentUrl is set\n    if (!util.hasValue(this.wda.webDriverAgentUrl)) {\n      await this.wda.cleanupObsoleteProcesses();\n    }\n\n    const usePortForwarding = this.isRealDevice()\n      && !this.wda.webDriverAgentUrl\n      && isLocalHost(this.wda.wdaBaseUrl);\n    await DEVICE_CONNECTIONS_FACTORY.requestConnection(this.opts.udid, this.wda.url.port, {\n      devicePort: usePortForwarding ? this.wda.wdaRemotePort : null,\n      usePortForwarding,\n    });\n\n    // Let multiple WDA binaries with different derived data folders be built in parallel\n    // Concurrent WDA builds from the same source will cause xcodebuild synchronization errors\n    let synchronizationKey = XCUITestDriver.name;\n    if (this.opts.useXctestrunFile || !(await this.wda.isSourceFresh())) {\n      // First-time compilation is an expensive operation, which is done faster if executed\n      // sequentially. Xcodebuild spreads the load caused by the clang compiler to all available CPU cores\n      const derivedDataPath = await this.wda.retrieveDerivedDataPath();\n      if (derivedDataPath) {\n        synchronizationKey = path.normalize(derivedDataPath);\n      }\n    }\n    this.log.debug(`Starting WebDriverAgent initialization with the synchronization key '${synchronizationKey}'`);\n    if (SHARED_RESOURCES_GUARD.isBusy() && !this.opts.derivedDataPath && !this.opts.bootstrapPath) {\n      this.log.debug(`Consider setting a unique 'derivedDataPath' capability value for each parallel driver instance ` +\n        `to avoid conflicts and speed up the building process`);\n    }\n    return await SHARED_RESOURCES_GUARD.acquire(synchronizationKey, async () => {\n      if (this.opts.useNewWDA) {\n        this.log.debug(`Capability 'useNewWDA' set to true, so uninstalling WDA before proceeding`);\n        await this.wda.quitAndUninstall();\n        this.logEvent('wdaUninstalled');\n      } else if (!util.hasValue(this.wda.webDriverAgentUrl)) {\n        await this.wda.setupCaching();\n      }\n\n      // local helper for the two places we need to uninstall wda and re-start it\n      const quitAndUninstall = async (msg) => {\n        this.log.debug(msg);\n        if (this.opts.webDriverAgentUrl) {\n          this.log.debug('Not quitting/uninstalling WebDriverAgent since webDriverAgentUrl capability is provided');\n          throw new Error(msg);\n        }\n        this.log.warn('Quitting and uninstalling WebDriverAgent');\n        await this.wda.quitAndUninstall();\n\n        throw new Error(msg);\n      };\n\n      // Used in the following WDA build\n      if (this.opts.resultBundlePath) {\n        this.ensureFeatureEnabled(CUSTOMIZE_RESULT_BUNDPE_PATH);\n      }\n\n      const startupRetries = this.opts.wdaStartupRetries || (this.isRealDevice() ? WDA_REAL_DEV_STARTUP_RETRIES : WDA_SIM_STARTUP_RETRIES);\n      const startupRetryInterval = this.opts.wdaStartupRetryInterval || WDA_STARTUP_RETRY_INTERVAL;\n      this.log.debug(`Trying to start WebDriverAgent ${startupRetries} times with ${startupRetryInterval}ms interval`);\n      if (!util.hasValue(this.opts.wdaStartupRetries) && !util.hasValue(this.opts.wdaStartupRetryInterval)) {\n        this.log.debug(`These values can be customized by changing wdaStartupRetries/wdaStartupRetryInterval capabilities`);\n      }\n      let retryCount = 0;\n      await retryInterval(startupRetries, startupRetryInterval, async () => {\n        this.logEvent('wdaStartAttempted');\n        if (retryCount > 0) {\n          this.log.info(`Retrying WDA startup (${retryCount + 1} of ${startupRetries})`);\n        }\n        try {\n          // on xcode 10 installd will often try to access the app from its staging\n          // directory before fully moving it there, and fail. Retrying once\n          // immediately helps\n          const retries = this.xcodeVersion.major >= 10 ? 2 : 1;\n          this.cachedWdaStatus = await retry(retries, this.wda.launch.bind(this.wda), sessionId, realDevice);\n        } catch (err) {\n          this.logEvent('wdaStartFailed');\n          retryCount++;\n          let errorMsg = `Unable to launch WebDriverAgent because of xcodebuild failure: ${err.message}`;\n          if (this.isRealDevice()) {\n            errorMsg += `. Make sure you follow the tutorial at ${WDA_REAL_DEV_TUTORIAL_URL}. ` +\n                        `Try to remove the WebDriverAgentRunner application from the device if it is installed ` +\n                        `and reboot the device.`;\n          }\n          await quitAndUninstall(errorMsg);\n        }\n\n        this.proxyReqRes = this.wda.proxyReqRes.bind(this.wda);\n        this.jwpProxyActive = true;\n\n        let originalStacktrace = null;\n        try {\n          await retryInterval(15, 1000, async () => {\n            this.logEvent('wdaSessionAttempted');\n            this.log.debug('Sending createSession command to WDA');\n            try {\n              this.cachedWdaStatus = this.cachedWdaStatus || await this.proxyCommand('/status', 'GET');\n              await this.startWdaSession(this.opts.bundleId, this.opts.processArguments);\n            } catch (err) {\n              originalStacktrace = err.stack;\n              this.log.debug(`Failed to create WDA session (${err.message}). Retrying...`);\n              throw err;\n            }\n          });\n          this.logEvent('wdaSessionStarted');\n        } catch (err) {\n          if (originalStacktrace) {\n            this.log.debug(originalStacktrace);\n          }\n          let errorMsg = `Unable to start WebDriverAgent session because of xcodebuild failure: ${err.message}`;\n          if (this.isRealDevice()) {\n            errorMsg += ` Make sure you follow the tutorial at ${WDA_REAL_DEV_TUTORIAL_URL}. ` +\n                        `Try to remove the WebDriverAgentRunner application from the device if it is installed ` +\n                        `and reboot the device.`;\n          }\n          await quitAndUninstall(errorMsg);\n        }\n\n        if (this.opts.clearSystemFiles && !this.opts.webDriverAgentUrl) {\n          await markSystemFilesForCleanup(this.wda);\n        }\n\n        // we expect certain socket errors until this point, but now\n        // mark things as fully working\n        this.wda.fullyStarted = true;\n        this.logEvent('wdaStarted');\n      });\n    });\n  }\n\n  async runReset (opts = null) {\n    this.logEvent('resetStarted');\n    if (this.isRealDevice()) {\n      await runRealDeviceReset(this.opts.device, opts || this.opts);\n    } else {\n      await runSimulatorReset(this.opts.device, opts || this.opts);\n    }\n    this.logEvent('resetComplete');\n  }\n\n  async deleteSession () {\n    await removeAllSessionWebSocketHandlers(this.server, this.sessionId);\n\n    for (const recorder of _.compact([\n      this._recentScreenRecorder, this._audioRecorder, this._trafficCapture\n    ])) {\n      await recorder.interrupt(true);\n      await recorder.cleanup();\n    }\n\n    if (!_.isEmpty(this._perfRecorders)) {\n      await B.all(this._perfRecorders.map((x) => x.stop(true)));\n      this._perfRecorders = [];\n    }\n\n    if (this._conditionInducerService) {\n      this.mobileDisableConditionInducer();\n    }\n\n    await this.stop();\n\n    if (this.wda && !this.opts.webDriverAgentUrl) {\n      if (this.opts.clearSystemFiles) {\n        let synchronizationKey = XCUITestDriver.name;\n        const derivedDataPath = await this.wda.retrieveDerivedDataPath();\n        if (derivedDataPath) {\n          synchronizationKey = path.normalize(derivedDataPath);\n        }\n        await SHARED_RESOURCES_GUARD.acquire(synchronizationKey, async () => {\n          await clearSystemFiles(this.wda);\n        });\n      } else {\n        this.log.debug('Not clearing log files. Use `clearSystemFiles` capability to turn on.');\n      }\n    }\n\n    if (this.remote) {\n      this.log.debug('Found a remote debugger session. Removing...');\n      await this.stopRemote();\n    }\n\n    if (this.opts.resetOnSessionStartOnly === false) {\n      await this.runReset(Object.assign({}, this.opts, {\n        enforceSimulatorShutdown: true,\n      }));\n    }\n\n    if (this.isSimulator() && !this.opts.noReset && !!this.opts.device) {\n      if (this.lifecycleData.createSim) {\n        this.log.debug(`Deleting simulator created for this run (udid: '${this.opts.udid}')`);\n        await shutdownSimulator(this.opts.device);\n        await this.opts.device.delete();\n      }\n    }\n\n    const shouldResetLocationServivce = this.isRealDevice() && !!this.opts.resetLocationService;\n    if (shouldResetLocationServivce) {\n      try {\n        await this.mobileResetLocationService();\n      } catch (ignore) { /* Ignore this error since mobileResetLocationService already logged the error */ }\n    }\n\n    if (!_.isEmpty(this.logs)) {\n      await this.logs.syslog.stopCapture();\n      this.logs = {};\n    }\n\n    if (this.mjpegStream) {\n      this.log.info('Closing MJPEG stream');\n      this.mjpegStream.stop();\n    }\n\n    this.resetIos();\n\n    await super.deleteSession();\n  }\n\n  async stop () {\n    this.jwpProxyActive = false;\n    this.proxyReqRes = null;\n\n\n    if (this.wda && this.wda.fullyStarted) {\n      if (this.wda.jwproxy) {\n        try {\n          await this.proxyCommand(`/session/${this.sessionId}`, 'DELETE');\n        } catch (err) {\n          // an error here should not short-circuit the rest of clean up\n          this.log.debug(`Unable to DELETE session on WDA: '${err.message}'. Continuing shutdown.`);\n        }\n      }\n      if (!this.wda.webDriverAgentUrl && this.opts.useNewWDA) {\n        await this.wda.quit();\n      }\n    }\n\n    DEVICE_CONNECTIONS_FACTORY.releaseConnection(this.opts.udid);\n  }\n\n  async executeCommand (cmd, ...args) {\n    this.log.debug(`Executing command '${cmd}'`);\n\n    if (cmd === 'receiveAsyncResponse') {\n      return await this.receiveAsyncResponse(...args);\n    }\n    // TODO: once this fix gets into base driver remove from here\n    if (cmd === 'getStatus') {\n      return await this.getStatus();\n    }\n    return await super.executeCommand(cmd, ...args);\n  }\n\n  async configureApp () {\n    function appIsPackageOrBundle (app) {\n      return (/^([a-zA-Z0-9\\-_]+\\.[a-zA-Z0-9\\-_]+)+$/).test(app);\n    }\n\n    // the app name is a bundleId assign it to the bundleId property\n    if (!this.opts.bundleId && appIsPackageOrBundle(this.opts.app)) {\n      this.opts.bundleId = this.opts.app;\n      this.opts.app = '';\n    }\n    // we have a bundle ID, but no app, or app is also a bundle\n    if ((this.opts.bundleId && appIsPackageOrBundle(this.opts.bundleId)) &&\n        (this.opts.app === '' || appIsPackageOrBundle(this.opts.app))) {\n      this.log.debug('App is an iOS bundle, will attempt to run as pre-existing');\n      return;\n    }\n\n    // check for supported build-in apps\n    switch (_.toLower(this.opts.app)) {\n      case 'settings':\n        this.opts.bundleId = 'com.apple.Preferences';\n        this.opts.app = null;\n        return;\n      case 'calendar':\n        this.opts.bundleId = 'com.apple.mobilecal';\n        this.opts.app = null;\n        return;\n    }\n\n    this.opts.app = await this.helpers.configureApp(this.opts.app, {\n      onPostProcess: this.onPostConfigureApp.bind(this),\n      supportedExtensions: SUPPORTED_EXTENSIONS\n    });\n  }\n\n  /**\n   * Unzip the given archive and find a matching .app bundle in it\n   *\n   * @param {string} appPath The path to the archive.\n   * @param {number} depth [0] the current nesting depth. App bundles whose nesting level\n   * is greater than 1 are not supported.\n   * @returns {string} Full path to the first matching .app bundle..\n   * @throws If no matching .app bundles were found in the provided archive.\n   */\n  async unzipApp (appPath, depth = 0) {\n    if (depth > MAX_ARCHIVE_SCAN_DEPTH) {\n      throw new Error('Nesting of package bundles is not supported');\n    }\n    const [rootDir, matchedPaths] = await findApps(appPath, SUPPORTED_EXTENSIONS);\n    if (_.isEmpty(matchedPaths)) {\n      this.log.debug(`'${path.basename(appPath)}' has no bundles`);\n    } else {\n      this.log.debug(\n        `Found ${util.pluralize('bundle', matchedPaths.length, true)} in ` +\n        `'${path.basename(appPath)}': ${matchedPaths}`\n      );\n    }\n    try {\n      for (const matchedPath of matchedPaths) {\n        const fullPath = path.join(rootDir, matchedPath);\n        if (await isAppBundle(fullPath)) {\n          const supportedPlatforms = await fetchSupportedAppPlatforms(fullPath);\n          if (this.isSimulator() && !supportedPlatforms.some((p) => _.includes(p, 'Simulator'))) {\n            this.log.info(`'${matchedPath}' does not have Simulator devices in the list of supported platforms ` +\n              `(${supportedPlatforms.join(',')}). Skipping it`);;\n            continue;\n          }\n          if (this.isRealDevice() && !supportedPlatforms.some((p) => _.includes(p, 'OS'))) {\n            this.log.info(`'${matchedPath}' does not have real devices in the list of supported platforms ` +\n              `(${supportedPlatforms.join(',')}). Skipping it`);;\n            continue;\n          }\n          this.log.info(`'${matchedPath}' is the resulting application bundle selected from '${appPath}'`);\n          return await isolateAppBundle(fullPath);\n        } else if (_.endsWith(_.toLower(fullPath), IPA_EXT) && (await fs.stat(fullPath)).isFile()) {\n          try {\n            return await this.unzipApp(fullPath, depth + 1);\n          } catch (e) {\n            this.log.warn(`Skipping processing of '${matchedPath}': ${e.message}`);\n          }\n        }\n      }\n    } finally {\n      await fs.rimraf(rootDir);\n    }\n    throw new Error(`${this.opts.app} did not have any matching ${APP_EXT} or ${IPA_EXT} ` +\n      `bundles. Please make sure the provided package is valid and contains at least one matching ` +\n      `application bundle which is not nested.`\n    );\n  }\n\n  async onPostConfigureApp ({cachedAppInfo, isUrl, appPath}) {\n    // Pick the previously cached entry if its integrity has been preserved\n    if (_.isPlainObject(cachedAppInfo)\n        && (await fs.stat(appPath)).isFile()\n        && await fs.hash(appPath) === cachedAppInfo.packageHash\n        && await fs.exists(cachedAppInfo.fullPath)\n        && (await fs.glob('**/*', {\n          cwd: cachedAppInfo.fullPath, strict: false, nosort: true\n        })).length === cachedAppInfo.integrity.folder) {\n      this.log.info(`Using '${cachedAppInfo.fullPath}' which was cached from '${appPath}'`);\n      return {appPath: cachedAppInfo.fullPath};\n    }\n\n    // Only local .app bundles that are available in-place should not be cached\n    if (await isAppBundle(appPath)) {\n      return false;\n    }\n\n    // Extract the app bundle and cache it\n    try {\n      return {appPath: await this.unzipApp(appPath)};\n    } finally {\n      // Cleanup previously downloaded archive\n      if (isUrl) {\n        await fs.rimraf(appPath);\n      }\n    }\n  }\n\n  async determineDevice () {\n    // in the one case where we create a sim, we will set this state\n    this.lifecycleData.createSim = false;\n\n    // if we get generic names, translate them\n    this.opts.deviceName = translateDeviceName(this.opts.platformVersion, this.opts.deviceName);\n\n    const setupVersionCaps = async () => {\n      this.opts.iosSdkVersion = await getAndCheckIosSdkVersion();\n      this.log.info(`iOS SDK Version set to '${this.opts.iosSdkVersion}'`);\n      if (!this.opts.platformVersion && this.opts.iosSdkVersion) {\n        this.log.info(`No platformVersion specified. Using the latest version Xcode supports: '${this.opts.iosSdkVersion}'. ` +\n          `This may cause problems if a simulator does not exist for this platform version.`);\n        this.opts.platformVersion = normalizePlatformVersion(this.opts.iosSdkVersion);\n      }\n    };\n\n    if (this.opts.udid) {\n      if (this.opts.udid.toLowerCase() === 'auto') {\n        try {\n          this.opts.udid = await detectUdid();\n        } catch (err) {\n          // Trying to find matching UDID for Simulator\n          this.log.warn(`Cannot detect any connected real devices. Falling back to Simulator. Original error: ${err.message}`);\n          const device = await getExistingSim(this.opts);\n          if (!device) {\n            // No matching Simulator is found. Throw an error\n            this.log.errorAndThrow(`Cannot detect udid for ${this.opts.deviceName} Simulator running iOS ${this.opts.platformVersion}`);\n          }\n\n          // Matching Simulator exists and is found. Use it\n          this.opts.udid = device.udid;\n          const devicePlatform = normalizePlatformVersion(await device.getPlatformVersion());\n          if (this.opts.platformVersion !== devicePlatform) {\n            this.opts.platformVersion = devicePlatform;\n            this.log.info(`Set platformVersion to '${devicePlatform}' to match the device with given UDID`);\n          }\n          await setupVersionCaps();\n          return {device, realDevice: false, udid: device.udid};\n        }\n      } else {\n        // make sure it is a connected device. If not, the udid passed in is invalid\n        const devices = await getConnectedDevices();\n        this.log.debug(`Available devices: ${devices.join(', ')}`);\n        if (!devices.includes(this.opts.udid)) {\n          // check for a particular simulator\n          this.log.debug(`No real device with udid '${this.opts.udid}'. Looking for simulator`);\n          try {\n            const device = await getSimulator(this.opts.udid, {\n              devicesSetPath: this.opts.simulatorDevicesSetPath,\n            });\n            return {device, realDevice: false, udid: this.opts.udid};\n          } catch (ign) {\n            throw new Error(`Unknown device or simulator UDID: '${this.opts.udid}'`);\n          }\n        }\n      }\n\n      const device = await getRealDeviceObj(this.opts.udid);\n      return {device, realDevice: true, udid: this.opts.udid};\n    }\n\n    // Now we know for sure the device will be a Simulator\n    await setupVersionCaps();\n    if (this.opts.enforceFreshSimulatorCreation) {\n      this.log.debug(`New simulator is requested. If this is not wanted, set 'enforceFreshSimulatorCreation' capability to false`);\n    } else {\n      // figure out the correct simulator to use, given the desired capabilities\n      const device = await getExistingSim(this.opts);\n\n      // check for an existing simulator\n      if (device) {\n        return {device, realDevice: false, udid: device.udid};\n      }\n\n      this.log.info('Simulator udid not provided');\n    }\n\n    // no device of this type exists, or they request new sim, so create one\n    this.log.info('Using desired caps to create a new simulator');\n    const device = await this.createSim();\n    return {device, realDevice: false, udid: device.udid};\n  }\n\n  async startSim () {\n    const runOpts = {\n      scaleFactor: this.opts.scaleFactor,\n      connectHardwareKeyboard: !!this.opts.connectHardwareKeyboard,\n      pasteboardAutomaticSync: this.opts.simulatorPasteboardAutomaticSync ?? 'off',\n      isHeadless: !!this.opts.isHeadless,\n      tracePointer: this.opts.simulatorTracePointer,\n      devicePreferences: {},\n    };\n\n    // add the window center, if it is specified\n    if (this.opts.SimulatorWindowCenter) {\n      runOpts.devicePreferences.SimulatorWindowCenter = this.opts.SimulatorWindowCenter;\n    }\n\n    if (_.isInteger(this.opts.simulatorStartupTimeout)) {\n      runOpts.startupTimeout = this.opts.simulatorStartupTimeout;\n    }\n\n    // This is to workaround XCTest bug about changing Simulator\n    // orientation is not synchronized to the actual window orientation\n    const orientation = _.isString(this.opts.orientation) && this.opts.orientation.toUpperCase();\n    switch (orientation) {\n      case 'LANDSCAPE':\n        runOpts.devicePreferences.SimulatorWindowOrientation = 'LandscapeLeft';\n        runOpts.devicePreferences.SimulatorWindowRotationAngle = 90;\n        break;\n      case 'PORTRAIT':\n        runOpts.devicePreferences.SimulatorWindowOrientation = 'Portrait';\n        runOpts.devicePreferences.SimulatorWindowRotationAngle = 0;\n        break;\n    }\n\n    await this.opts.device.run(runOpts);\n  }\n\n  async createSim () {\n    this.lifecycleData.createSim = true;\n\n    // Get platform name from const since it must be case sensitive to create a new simulator\n    const platformName = this.isTvOS() ? PLATFORM_NAME_TVOS : PLATFORM_NAME_IOS;\n\n    // create sim for caps\n    const sim = await createSim(this.opts, platformName);\n    this.log.info(`Created simulator with udid '${sim.udid}'.`);\n\n    return sim;\n  }\n\n  async launchApp () {\n    const APP_LAUNCH_TIMEOUT = 20 * 1000;\n\n    this.logEvent('appLaunchAttempted');\n    await this.opts.device.simctl.launchApp(this.opts.bundleId);\n\n    let checkStatus = async () => {\n      let response = await this.proxyCommand('/status', 'GET');\n      let currentApp = response.currentApp.bundleID;\n      if (currentApp !== this.opts.bundleId) {\n        throw new Error(`${this.opts.bundleId} not in foreground. ${currentApp} is in foreground`);\n      }\n    };\n\n    this.log.info(`Waiting for '${this.opts.bundleId}' to be in foreground`);\n    let retries = parseInt(APP_LAUNCH_TIMEOUT / 200, 10);\n    await retryInterval(retries, 200, checkStatus);\n    this.log.info(`${this.opts.bundleId} is in foreground`);\n    this.logEvent('appLaunched');\n  }\n\n  async startWdaSession (bundleId, processArguments) {\n    const args = processArguments ? (processArguments.args || []) : [];\n    if (!_.isArray(args)) {\n      throw new Error(`processArguments.args capability is expected to be an array. ` +\n        `${JSON.stringify(args)} is given instead`);\n    }\n    const env = processArguments ? (processArguments.env || {}) : {};\n    if (!_.isPlainObject(env)) {\n      throw new Error(`processArguments.env capability is expected to be a dictionary. ` +\n        `${JSON.stringify(env)} is given instead`);\n    }\n\n    if (util.hasValue(this.opts.language)) {\n      args.push('-AppleLanguages', `(${this.opts.language})`);\n      args.push('-NSLanguages', `(${this.opts.language})`);\n    }\n    if (util.hasValue(this.opts.locale)) {\n      args.push('-AppleLocale', this.opts.locale);\n    }\n\n    if (this.opts.noReset) {\n      if (_.isNil(this.opts.shouldTerminateApp)) {\n        this.opts.shouldTerminateApp = false;\n      }\n      if (_.isNil(this.opts.forceAppLaunch)) {\n        this.opts.forceAppLaunch = false;\n      }\n    }\n\n    const wdaCaps = {\n      bundleId: this.opts.autoLaunch === false ? undefined : bundleId,\n      arguments: args,\n      environment: env,\n      eventloopIdleDelaySec: this.opts.wdaEventloopIdleDelay ?? 0,\n      shouldWaitForQuiescence: this.opts.waitForQuiescence ?? true,\n      shouldUseTestManagerForVisibilityDetection: this.opts.simpleIsVisibleCheck ?? false,\n      maxTypingFrequency: this.opts.maxTypingFrequency ?? 60,\n      shouldUseSingletonTestManager: this.opts.shouldUseSingletonTestManager ?? true,\n      waitForIdleTimeout: this.opts.waitForIdleTimeout,\n      shouldUseCompactResponses: this.opts.shouldUseCompactResponses,\n      elementResponseFields: this.opts.elementResponseFields,\n      disableAutomaticScreenshots: this.opts.disableAutomaticScreenshots,\n      shouldTerminateApp: this.opts.shouldTerminateApp ?? true,\n      forceAppLaunch: this.opts.forceAppLaunch ?? true,\n      useNativeCachingStrategy: this.opts.useNativeCachingStrategy ?? true,\n      forceSimulatorSoftwareKeyboardPresence: this.opts.forceSimulatorSoftwareKeyboardPresence\n        ?? (this.opts.connectHardwareKeyboard === true ? false : true),\n    };\n    if (this.opts.autoAcceptAlerts) {\n      wdaCaps.defaultAlertAction = 'accept';\n    } else if (this.opts.autoDismissAlerts) {\n      wdaCaps.defaultAlertAction = 'dismiss';\n    }\n\n    await this.proxyCommand('/session', 'POST', {\n      capabilities: {\n        firstMatch: [wdaCaps],\n        alwaysMatch: {},\n      }\n    });\n  }\n\n  // Override Proxy methods from BaseDriver\n  proxyActive () {\n    return this.jwpProxyActive;\n  }\n\n  getProxyAvoidList () {\n    if (this.isWebview()) {\n      return NO_PROXY_WEB_LIST;\n    }\n    return NO_PROXY_NATIVE_LIST;\n  }\n\n  canProxy () {\n    return true;\n  }\n\n  isSafari () {\n    return !!this.safari;\n  }\n\n  isRealDevice () {\n    return this.opts.realDevice;\n  }\n\n  isSimulator () {\n    return !this.opts.realDevice;\n  }\n\n  isTvOS () {\n    return _.toLower(this.opts.platformName) === _.toLower(PLATFORM_NAME_TVOS);\n  }\n\n  isWebview () {\n    return this.isSafari() || this.isWebContext();\n  }\n\n  validateLocatorStrategy (strategy) {\n    super.validateLocatorStrategy(strategy, this.isWebContext());\n  }\n\n  validateDesiredCaps (caps) {\n    if (!super.validateDesiredCaps(caps)) {\n      return false;\n    }\n\n    // make sure that the capabilities have one of `app` or `bundleId`\n    if (_.toLower(caps.browserName) !== 'safari' && !caps.app && !caps.bundleId) {\n      this.log.info('The desired capabilities include neither an app nor a bundleId. ' +\n        'WebDriverAgent will be started without the default app');\n    }\n\n    if (!util.coerceVersion(caps.platformVersion, false)) {\n      this.log.warn(`'platformVersion' capability ('${caps.platformVersion}') is not a valid version number. ` +\n        `Consider fixing it or be ready to experience an inconsistent driver behavior.`);\n    }\n\n    let verifyProcessArgument = (processArguments) => {\n      const {args, env} = processArguments;\n      if (!_.isNil(args) && !_.isArray(args)) {\n        this.log.errorAndThrow('processArguments.args must be an array of strings');\n      }\n      if (!_.isNil(env) && !_.isPlainObject(env)) {\n        this.log.errorAndThrow('processArguments.env must be an object <key,value> pair {a:b, c:d}');\n      }\n    };\n\n    // `processArguments` should be JSON string or an object with arguments and/ environment details\n    if (caps.processArguments) {\n      if (_.isString(caps.processArguments)) {\n        try {\n          // try to parse the string as JSON\n          caps.processArguments = JSON.parse(caps.processArguments);\n          verifyProcessArgument(caps.processArguments);\n        } catch (err) {\n          this.log.errorAndThrow(`processArguments must be a JSON format or an object with format {args : [], env : {a:b, c:d}}. ` +\n            `Both environment and argument can be null. Error: ${err}`);\n        }\n      } else if (_.isPlainObject(caps.processArguments)) {\n        verifyProcessArgument(caps.processArguments);\n      } else {\n        this.log.errorAndThrow(`'processArguments must be an object, or a string JSON object with format {args : [], env : {a:b, c:d}}. ` +\n          `Both environment and argument can be null.`);\n      }\n    }\n\n    // there is no point in having `keychainPath` without `keychainPassword`\n    if ((caps.keychainPath && !caps.keychainPassword) || (!caps.keychainPath && caps.keychainPassword)) {\n      this.log.errorAndThrow(`If 'keychainPath' is set, 'keychainPassword' must also be set (and vice versa).`);\n    }\n\n    // `resetOnSessionStartOnly` should be set to true by default\n    this.opts.resetOnSessionStartOnly = !util.hasValue(this.opts.resetOnSessionStartOnly) || this.opts.resetOnSessionStartOnly;\n    this.opts.useNewWDA = util.hasValue(this.opts.useNewWDA) ? this.opts.useNewWDA : false;\n\n    if (caps.commandTimeouts) {\n      caps.commandTimeouts = normalizeCommandTimeouts(caps.commandTimeouts);\n    }\n\n    if (_.isString(caps.webDriverAgentUrl)) {\n      const {protocol, host} = url.parse(caps.webDriverAgentUrl);\n      if (_.isEmpty(protocol) || _.isEmpty(host)) {\n        this.log.errorAndThrow(`'webDriverAgentUrl' capability is expected to contain a valid WebDriverAgent server URL. ` +\n                          `'${caps.webDriverAgentUrl}' is given instead`);\n      }\n    }\n\n    if (caps.browserName) {\n      if (caps.bundleId) {\n        this.log.errorAndThrow(`'browserName' cannot be set together with 'bundleId' capability`);\n      }\n      // warn if the capabilities have both `app` and `browser, although this\n      // is common with selenium grid\n      if (caps.app) {\n        this.log.warn(`The capabilities should generally not include both an 'app' and a 'browserName'`);\n      }\n    }\n\n    if (caps.permissions) {\n      try {\n        for (const [bundleId, perms] of _.toPairs(JSON.parse(caps.permissions))) {\n          if (!_.isString(bundleId)) {\n            throw new Error(`'${JSON.stringify(bundleId)}' must be a string`);\n          }\n          if (!_.isPlainObject(perms)) {\n            throw new Error(`'${JSON.stringify(perms)}' must be a JSON object`);\n          }\n        }\n      } catch (e) {\n        this.log.errorAndThrow(`'${caps.permissions}' is expected to be a valid object with format ` +\n          `{\"<bundleId1>\": {\"<serviceName1>\": \"<serviceStatus1>\", ...}, ...}. Original error: ${e.message}`);\n      }\n    }\n\n    if (caps.platformVersion && !util.coerceVersion(caps.platformVersion, false)) {\n      this.log.errorAndThrow(`'platformVersion' must be a valid version number. ` +\n        `'${caps.platformVersion}' is given instead.`);\n    }\n\n    // additionalWebviewBundleIds is an array, JSON array, or string\n    if (caps.additionalWebviewBundleIds) {\n      caps.additionalWebviewBundleIds = this.helpers.parseCapsArray(caps.additionalWebviewBundleIds);\n    }\n\n    // finally, return true since the superclass check passed, as did this\n    return true;\n  }\n\n  async installAUT () {\n    if (this.isSafari()) {\n      return;\n    }\n\n    await verifyApplicationPlatform(this.opts.app, {\n      isSimulator: this.isSimulator(),\n      isTvOS: this.isTvOS(),\n    });\n\n    if (this.isRealDevice()) {\n      await installToRealDevice(this.opts.device, this.opts.app, this.opts.bundleId, {\n        noReset: this.opts.noReset,\n        timeout: this.opts.appPushTimeout,\n        strategy: this.opts.appInstallStrategy,\n      });\n    } else {\n      await installToSimulator(this.opts.device, this.opts.app, this.opts.bundleId, {\n        noReset: this.opts.noReset,\n        newSimulator: this.lifecycleData.createSim,\n      });\n    }\n    if (this.opts.otherApps) {\n      await this.installOtherApps(this.opts.otherApps);\n    }\n\n    if (util.hasValue(this.opts.iosInstallPause)) {\n      // https://github.com/appium/appium/issues/6889\n      let pause = parseInt(this.opts.iosInstallPause, 10);\n      this.log.debug(`iosInstallPause set. Pausing ${pause} ms before continuing`);\n      await B.delay(pause);\n    }\n  }\n\n  async installOtherApps (otherApps) {\n    if (this.isRealDevice()) {\n      this.log.warn('Capability otherApps is only supported for Simulators');\n      return;\n    }\n    let appsList;\n    try {\n      appsList = this.helpers.parseCapsArray(otherApps);\n    } catch (e) {\n      this.log.errorAndThrow(`Could not parse \"otherApps\" capability: ${e.message}`);\n    }\n    if (_.isEmpty(appsList)) {\n      this.log.info(`Got zero apps from 'otherApps' capability value. Doing nothing`);\n      return;\n    }\n\n    const appPaths = await B.all(appsList.map(\n      (app) => this.helpers.configureApp(app, '.app')\n    ));\n    for (const otherApp of appPaths) {\n      await installToSimulator(this.opts.device, otherApp, undefined, {\n        noReset: this.opts.noReset,\n        newSimulator: this.lifecycleData.createSim,\n      });\n    }\n  }\n\n  /**\n   * Set reduceMotion as 'isEnabled' only when the capabilities has 'reduceMotion'\n   * The call is ignored for real devices.\n   * @param {?boolean} isEnabled Wether enable reduceMotion\n   */\n  async setReduceMotion (isEnabled) {\n    if (this.isRealDevice() || !_.isBoolean(isEnabled)) {\n      return;\n    }\n\n    this.log.info(`Setting reduceMotion to ${isEnabled}`);\n    await this.updateSettings({reduceMotion: isEnabled});\n  }\n\n  async setInitialOrientation (orientation) {\n    if (!_.isString(orientation)) {\n      this.log.info('Skipping setting of the initial display orientation. ' +\n        'Set the \"orientation\" capability to either \"LANDSCAPE\" or \"PORTRAIT\", if this is an undesired behavior.');\n      return;\n    }\n    orientation = orientation.toUpperCase();\n    if (!_.includes(['LANDSCAPE', 'PORTRAIT'], orientation)) {\n      this.log.debug(`Unable to set initial orientation to '${orientation}'`);\n      return;\n    }\n    this.log.debug(`Setting initial orientation to '${orientation}'`);\n    try {\n      await this.proxyCommand('/orientation', 'POST', {orientation});\n      this.opts.curOrientation = orientation;\n    } catch (err) {\n      this.log.warn(`Setting initial orientation failed with: ${err.message}`);\n    }\n  }\n\n  _getCommandTimeout (cmdName) {\n    if (this.opts.commandTimeouts) {\n      if (cmdName && _.has(this.opts.commandTimeouts, cmdName)) {\n        return this.opts.commandTimeouts[cmdName];\n      }\n      return this.opts.commandTimeouts[DEFAULT_TIMEOUT_KEY];\n    }\n  }\n\n  /**\n   * Get session capabilities merged with what WDA reports\n   * This is a library command but needs to call 'super' so can't be on\n   * a helper object\n   */\n  async getSession () {\n    // call super to get event timings, etc...\n    const driverSession = await super.getSession();\n    if (!this.wdaCaps) {\n      this.wdaCaps = await this.proxyCommand('/', 'GET');\n    }\n\n    const shouldGetDeviceCaps = _.isBoolean(this.opts.includeDeviceCapsToSessionInfo)\n      ? this.opts.includeDeviceCapsToSessionInfo\n      : true; // Backward compatibility\n    if (shouldGetDeviceCaps && !this.deviceCaps) {\n      const {statusBarSize, scale} = await this.getScreenInfo();\n      this.deviceCaps = {\n        pixelRatio: scale,\n        statBarHeight: statusBarSize.height,\n        viewportRect: await this.getViewportRect(),\n      };\n    }\n    this.log.info('Merging WDA caps over Appium caps for session detail response');\n    return Object.assign({udid: this.opts.udid}, driverSession,\n      this.wdaCaps.capabilities, this.deviceCaps || {});\n  }\n\n  async reset () {\n    if (this.opts.noReset) {\n      // This is to make sure reset happens even if noReset is set to true\n      let opts = _.cloneDeep(this.opts);\n      opts.noReset = false;\n      opts.fullReset = false;\n      const shutdownHandler = this.resetOnUnexpectedShutdown;\n      this.resetOnUnexpectedShutdown = () => {};\n      try {\n        await this.runReset(opts);\n      } finally {\n        this.resetOnUnexpectedShutdown = shutdownHandler;\n      }\n    }\n    await super.reset();\n  }\n}\n\nObject.assign(XCUITestDriver.prototype, commands);\n\nexport default XCUITestDriver;\nexport { XCUITestDriver };\n"],"mappings":"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"}